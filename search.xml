<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>东山岛篇</title>
      <link href="/2023/09/26/%E6%BC%B3%E5%B7%9E3%E5%A4%A92%E5%A4%9C%E6%B8%B8/"/>
      <url>/2023/09/26/%E6%BC%B3%E5%B7%9E3%E5%A4%A92%E5%A4%9C%E6%B8%B8/</url>
      
        <content type="html"><![CDATA[<p>漳州 3 天两日游（赣州到东山县）</p><h3 id="1、出发"><a href="#1、出发" class="headerlink" title="1、出发"></a>1、出发</h3><p>赣州站(7.25)→ 漳州站(10.50)</p><p>票：6 车 8B、6 车 8C</p><p>漳州站(11.32)→ 云霄站(11.55)</p><p>票:6 车无座 需站 23 分钟</p><p>出去打滴滴：32 分钟左右 预计 12.30 左右抵达住宿地</p><h3 id="2、住宿地-离金銮湾沙滩-1-6-公里"><a href="#2、住宿地-离金銮湾沙滩-1-6-公里" class="headerlink" title="2、住宿地(离金銮湾沙滩 1.6 公里)"></a>2、住宿地(离金銮湾沙滩 1.6 公里)</h3><p><strong>东山笠泊居海景民宿</strong></p><p>详细地址：福建省漳州市东山县金銮湾路 9 号御龙海湾四号楼二单元 211 室</p><p>14 点后入住——到期后需 12 点前离店</p><p><a href="https://j.map.baidu.com/99/3gQu">百度地图</a></p><link rel="stylesheet" href="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="//unpkg.com/hexo-tag-map/lib/proj4@2.4.3.js"></script><script data-pjax src="//unpkg.com/hexo-tag-map/lib/proj4leaflet@1.0.1.min.js"></script><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div id="baiduMap-117.494972-23.714365" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div><script type="text/javascript">var normalMap=L.tileLayer.chinaProvider('Baidu.Normal.Map',{maxZoom:20,minZoom:4,attribution:'Baidu Map'}),satelliteMap=L.tileLayer.chinaProvider('Baidu.Satellite.Map',{maxZoom:18,minZoom:1,attribution:'Baidu Map'}),annotionMap=L.tileLayer.chinaProvider('Baidu.Satellite.Annotion',{maxZoom:18,minZoom:1,attribution:'Baidu Map'});var imageMap=L.layerGroup([satelliteMap,annotionMap]);var baseLayers={"百度地图":normalMap,"百度卫星图":satelliteMap,"百度卫星标注":imageMap};var mymap=L.map("baiduMap-117.494972-23.714365",{crs:L.CRS.Baidu,minZoom:2,maxZoom:20,attributionControl:true,center:[23.714365,117.494972],zoom:16,layers:[normalMap],zoomControl:false});L.control.layers(baseLayers,overlayLayers).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);var marker = L.marker(['23.714365','117.494972']).addTo(mymap);marker.bindPopup("淘气小公举薇薇殿下即将入住此地！").openPopup();</script><p><a href="https://mmapgwh.map.qq.com/shortlink/short?l=1b00c1eee4b0c945d0d1c03a6149a9cb">腾讯地图</a></p><p>混合地图</p><link rel="stylesheet" href="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div class="map-box" style="margin: 0.8rem 0 1.6rem 0;"><div id="map-117.490035-23.707502" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div></div><script type="text/javascript">var normalm=L.tileLayer.chinaProvider('GaoDe.Normal.Map',{maxZoom:20,minZoom:1,attribution:'高德地图'});var imgm=L.tileLayer.chinaProvider('GaoDe.Satellite.Map',{maxZoom:20,minZoom:1,attribution:'高德地图'});var imga=L.tileLayer.chinaProvider('GaoDe.Satellite.Annotion',{maxZoom:20,minZoom:1,attribution:'高德地图'});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:20,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'});routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1,attribution:'Google Maps'});var normalm1=L.tileLayer.chinaProvider('Geoq.Normal.Map',{maxZoom:21,minZoom:1,attribution:'GeoQ'});var normal=L.layerGroup([normalm]),image=L.layerGroup([imgm,imga]);var baseLayers={"高德地图":normal,"智图地图":normalm1,"谷歌地图":normalMap,"高德卫星地图":imgm,"谷歌卫星地图":satelliteMap,"高德卫星标注":image,"谷歌卫星标注":routeMap};var mymap=L.map('map-117.490035-23.707502',{center:[23.707502,117.490035],zoom:16,layers:[normal],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);var marker = L.marker(['23.707502','117.490035']).addTo(mymap);marker.bindPopup("淘气小公举薇薇殿下即将入住此地！").openPopup();</script><p><strong>房间</strong></p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/zhangzhoubed.jpg" alt=""></p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/zhangzhoubed2.jpg" alt=""></p><h3 id="3、游玩地"><a href="#3、游玩地" class="headerlink" title="3、游玩地"></a>3、游玩地</h3><h4 id="全岛图"><a href="#全岛图" class="headerlink" title="全岛图"></a>全岛图</h4><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/全岛图.png" alt=""></p><h4 id="南门湾"><a href="#南门湾" class="headerlink" title="南门湾"></a>南门湾</h4><p>距离 7.2 公里</p><p>打车：26 分钟 约 16-18 元 骑行：25 分钟 3 个红绿灯 沿海骑行 27 分钟 7.5 公里</p><p>南门湾：左耳同款拍摄地——顶街 文公祠(ci) 风动石景区(60 块门票)</p><p><a href="https://j.map.baidu.com/68/mQ1J">百度地图</a> <a href="https://mmapgwh.map.qq.com/shortlink/short?l=d8b8de5cbd35b42575df4f1f38e07217">腾讯地图</a></p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/nanmenwang.jpg" alt=""></p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/nanmenwangyangmao.png" alt=""></p><h4 id="南屿"><a href="#南屿" class="headerlink" title="南屿"></a>南屿</h4><p>距离：7.9 公里 在南门湾附近 退潮可以去塔下</p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/nanyudengta.jpg" alt=""></p><h4 id="苏峰山环岛路"><a href="#苏峰山环岛路" class="headerlink" title="苏峰山环岛路"></a>苏峰山环岛路</h4><p>超超超想骑小毛驴逛！！！ 特别注意单行道，不能掉头</p><p>骑行路程：10.8 公里 骑行 38 分钟 一来一回近一个小时</p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/sufengshan.jpg" alt=""></p><h4 id="金銮湾"><a href="#金銮湾" class="headerlink" title="金銮湾"></a>金銮湾</h4><p>近两公里 离我们最近 10 来分钟</p><p>可看日出日落</p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/jinluanwan.jpg" alt=""></p><h3 id="4、美食"><a href="#4、美食" class="headerlink" title="4、美食"></a>4、美食</h3><h4 id="地图"><a href="#地图" class="headerlink" title="地图"></a>地图</h4><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/meishiditu.jpg" alt=""></p><h4 id="南门湾-1"><a href="#南门湾-1" class="headerlink" title="南门湾"></a>南门湾</h4><ul><li>小媳妇甜汤 10 块钱有好多 大部分去过的都推荐尝一尝</li><li>一杯潮茶 人均 18 块</li><li>阿勇果汁铺</li><li>旧戏院猫仔粥</li><li>陈记肉丸</li><li>烧腱灵</li><li><p>海蛎煎</p></li><li><p>铜陵夜市可以晚上逛逛</p></li><li>太多啦，看不过来，上面是一些特色小吃，还有好吃的，我们可以边走边看</li></ul><h4 id="住宿区"><a href="#住宿区" class="headerlink" title="住宿区"></a>住宿区</h4><ul><li>三只小管 不是节假日点套餐 200 多，从外面看装修还可以</li><li>边上好多吃饭的店，1 公里内</li></ul><h4 id="主食"><a href="#主食" class="headerlink" title="主食"></a>主食</h4><p>海鲜大排档 ——到处都是，哪个评分高就哪里。抖音太多了，花里胡哨的</p><h4 id="美食图片"><a href="#美食图片" class="headerlink" title="美食图片"></a>美食图片</h4><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/shaojianrou.png" alt=""></p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/shouqiangtui.jpg" alt=""></p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/naicha.jpg" alt=""></p><p><img src="https://picbed.jnchan.top/travel/zhangzhou/dongshan/meishi.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 旅游攻略 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 东山岛 </tag>
            
            <tag> 漳州 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker笔记</title>
      <link href="/2023/06/12/Docker/"/>
      <url>/2023/06/12/Docker/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p><img src="/images/dockerimages/image-20200606203315597.png" alt="image-20200606203315597"></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>官方文档：<a href="https://docs.docker.com/docker-for-windows/">https://docs.docker.com/docker-for-windows/</a></p><p>【官方文档超级详细】</p><p>仓库地址：<a href="https://hub.docker.com/">https://hub.docker.com/</a></p><p>【发布到仓库，git pull push】</p><p>这个笔记 b 站教程：<a href="https://www.bilibili.com/video/BV1og4y1q7M4?">https://www.bilibili.com/video/BV1og4y1q7M4?</a></p><h2 id="前期基础"><a href="#前期基础" class="headerlink" title="前期基础"></a>前期基础</h2><p>linux 基本命令</p><h2 id="Docker-概述"><a href="#Docker-概述" class="headerlink" title="Docker 概述"></a>Docker 概述</h2><p>使用 Docker 后的流程：</p><p>开发：建立模型—环境—打包带上环境，即镜像—放到 Docker 仓库</p><p>部署：下载 Docker 中的镜像，直接运行即可</p><p>Docker 的思想来自于集装箱，集装箱，对环境进行隔离</p><p>Docker 通过隔离机制，可以将服务器利用到极致。</p><h2 id=""><a href="#" class="headerlink" title="#"></a>#</h2><h2 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h2><h3 id="Docker-的基本组成"><a href="#Docker-的基本组成" class="headerlink" title="Docker 的基本组成"></a>Docker 的基本组成</h3><p><img src="/images/dockerimages/image-20200606212250845.png" alt="image-20200606212250845"></p><p>明确几个概念：</p><ol><li><p>镜像(image)：docker 镜像好比一个模板，可以通过这个模板来创建容器(container)，一个镜像可以创建多个容器，类似 Python 中的 Class</p></li><li><p>容器(container)：类似 Python 中通过 Class 创建的实例，Object；容器可以理解为一个简易的系统</p></li><li><p>仓库(repository)：存放镜像的地方，</p><p> 分为共有仓库和私有仓库</p><ul><li><p>Docker Hub：国外的</p></li><li><p>阿里云：配置镜像加速</p></li></ul></li></ol><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>我们要有一台服务器，并且可以操作它</p><ol><li>Linux 命令基础，购买 linux 阿里云的服务器</li><li>CentOS 7</li><li>使用 Xshell 链接远程服务器</li></ol><h3 id="安装-xshell"><a href="#安装-xshell" class="headerlink" title="安装 xshell"></a>安装 xshell</h3><p>下载 CentOS7 <a href="https://www.jianshu.com/p/a63f47e096e8">https://www.jianshu.com/p/a63f47e096e8</a></p><p>xshell 链接服务器 <a href="https://blog.csdn.net/zzy1078689276/article/details/77280814">https://blog.csdn.net/zzy1078689276/article/details/77280814</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# cd /</span><br><span class="line">[root@192 /]# pwd</span><br><span class="line">/</span><br><span class="line">[root@192 /]# ls</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@192 /]# uname -r</span><br><span class="line">3.10.0-1127.el7.x86_64</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200608091950655.png" alt="image-20200608091950655"></p><h3 id="Centos-安装"><a href="#Centos-安装" class="headerlink" title="Centos 安装"></a>Centos 安装</h3><p><a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p><h3 id="卸载旧的版本"><a href="#卸载旧的版本" class="headerlink" title="卸载旧的版本"></a>卸载旧的版本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 卸载旧的版本</span><br><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200608092628498.png" alt="image-20200608092628498"></p><h3 id="安装基本环境"><a href="#安装基本环境" class="headerlink" title="安装基本环境"></a>安装基本环境</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装基本的安装包</span><br><span class="line">$ sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure><p>!</p><p><img src="/images/dockerimages/image-20200608093114774.png" alt="image-20200608093114774"></p><h3 id="设置镜像的仓库"><a href="#设置镜像的仓库" class="headerlink" title="设置镜像的仓库"></a>设置镜像的仓库</h3><p>注意！！下载默认用国外的，太慢不要用！</p><p>用国内镜像，百度搜索，docker 的阿里云镜像地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 不要用官网默认这个！</span><br><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo # 默认是国外的</span><br><span class="line"></span><br><span class="line"># 换成下面的</span><br><span class="line"></span><br><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # 阿里云镜像</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616145430166.png" alt="image-20200616145430166"></p><p>直接复制粘贴就 OK 了</p><p>更像软件包索引</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616150014082.png" alt="image-20200616150014082"></p><p>没有问题的话就是可以用的</p><h3 id="安装-docker-引擎"><a href="#安装-docker-引擎" class="headerlink" title="安装 docker 引擎"></a>安装 docker 引擎</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io <span class="comment"># docker-ce 社区版 ee 企业版</span></span><br></pre></td></tr></table></figure><p>注意这里会有几个个 y/n 的判断</p><p><img src="/images/dockerimages/image-20200616150818860.png" alt="image-20200616150818860"></p><p><img src="/images/dockerimages/image-20200616150922549.png" alt="image-20200616150922549"></p><p>要看到 Complet 再收手！</p><h3 id="启动-Docker"><a href="#启动-Docker" class="headerlink" title="启动 Docker"></a>启动 Docker</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker # 代表启动成功</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.11</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.10</span><br><span class="line"> Git commit:        42e35e61f3</span><br><span class="line"> Built:             Mon Jun  1 09:13:48 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.11</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.10</span><br><span class="line">  Git commit:       42e35e61f3</span><br><span class="line">  Built:            Mon Jun  1 09:12:26 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.2.13</span><br><span class="line">  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616151641013.png" alt="image-20200616151641013"></p><p>中间一堆是签名信息</p><p>run 的运行流程图</p><p><img src="/images/dockerimages/image-20200616161441669.png" alt="image-20200616161441669"></p><p>查看下载的镜像</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616151913277.png" alt="image-20200616151913277"></p><h3 id="卸载-Docker"><a href="#卸载-Docker" class="headerlink" title="卸载 Docker"></a>卸载 Docker</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 卸载依赖</span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"># 删除资源</span><br><span class="line">rm -rf /var/lib/docker # docker 的默认工作路径</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker # 创建一个陌路</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://uyfgafsw.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF # 编写配置文件</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload # 重启服务</span><br><span class="line">sudo systemctl restart docker # 重启docker</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616160315298.png" alt="image-20200616160315298"></p><p><a href="https://www.processon.com/">在线画图软件 ProcessOn</a></p><h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><p>Docker 是真么工作的？</p><p>Docker 是一个 Client-Server 结构的系统，Docker 的守护进程在主机上。通过 Socket 从客户端访问！</p><p>DockerServer 接受到 Docker-Client 的指令，</p><p><img src="/images/dockerimages/image-20200616162107363.png" alt="image-20200616162107363"></p><p>Docker 为什么比 VM 快？</p><ol><li>Docker 有着比虚拟机更少的抽象层</li><li>docker 主要用的是宿主机的内核，vm 需要 Guest OS</li></ol><p><img src="/images/dockerimages/image-20200616162302653.png" alt="image-20200616162302653"></p><p>所以说新建一个容器的时候，docker 不需要像虚拟机一样重新加载一个操作系统内核，避免引导</p><h2 id="Docker-命令"><a href="#Docker-命令" class="headerlink" title="Docker 命令"></a>Docker 命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version # 显示docker的基本信息</span><br><span class="line">docker info # 系统信息，镜像和容器的数量</span><br><span class="line">docker 命令 --help # 全部信息</span><br></pre></td></tr></table></figure><p><a href="https://docs.docker.com/reference/">官网文档</a></p><p><img src="/images/dockerimages/image-20200616163338187.png" alt="image-20200616163338187"></p><h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><h4 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a>docker images</h4><p>查看所有本地主机上的镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># docker images</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616172056530.png" alt="image-20200616172056530"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 解释</span><br><span class="line">REPOSITORY  # 镜像仓库源</span><br><span class="line">TAG                 # 镜像的标签</span><br><span class="line">IMAGE ID           # 镜像的ID</span><br><span class="line">CREATED           # 镜像的创建时间</span><br><span class="line">SIZE # 镜像的大小</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--all , -aShow all images (default hides intermediate images) <span class="comment"># 显示所有</span></span><br><span class="line">--digestsShow digests</span><br><span class="line">--filter , -fFilter output based on conditions provided</span><br><span class="line">--formatPretty-<span class="built_in">print</span> images using a Go template</span><br><span class="line">--no-truncDon’t <span class="built_in">truncate</span> output</span><br><span class="line">--quiet , -qOnly show numeric IDs <span class="comment"># 只显示id</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616172651835.png" alt="image-20200616172651835"></p><h4 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h4><p>搜索仓库中的镜像，相当于网页搜索</p><p><a href="http://hub.docker.com">网页搜索</a></p><p><img src="/images/dockerimages/image-20200616173009473.png" alt="image-20200616173009473"></p><p>mysql</p><p><img src="/images/dockerimages/image-20200616173050756.png" alt="image-20200616173050756"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616173308194.png" alt="image-20200616173308194"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search --help</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616173740981.png" alt="image-20200616173740981"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解释</span></span><br><span class="line">Options:</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-<span class="built_in">print</span> search using a Go template</span><br><span class="line">      --<span class="built_in">limit</span> int       Max number of search results (default 25)</span><br><span class="line">      --no-trunc        Don<span class="string">&#x27;t truncate output</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql --filter=STARS=3000 # 搜索出Stars大于3000的</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616174440284.png" alt="image-20200616174440284"></p><p>【视频书签，<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=9】">https://www.bilibili.com/video/BV1og4y1q7M4?p=9】</a></p><h4 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h4><p>下载镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql <span class="comment"># 下载mysql镜像，default tag，默认最新版latest</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># sudo systemctl daemon-reload</span></span><br><span class="line">[root@192 ~]<span class="comment"># sudo systemctl restart docker</span></span><br><span class="line">[root@192 ~]<span class="comment"># docker pull mysql</span></span><br><span class="line">Using default tag: latest <span class="comment"># 不写tag默认最新版</span></span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">8559a31e96f4: Pull complete  <span class="comment"># layer 分层下载，docker image的核心 联合文件系统</span></span><br><span class="line">d51ce1c2e575: Pull complete</span><br><span class="line">c2344adc4858: Pull complete</span><br><span class="line">fcf3ceff18fc: Pull complete</span><br><span class="line">16da0c38dc5b: Pull complete</span><br><span class="line">b905d1797e97: Pull complete</span><br><span class="line">4b50d1c6b05c: Pull complete</span><br><span class="line">c75914a65ca2: Pull complete</span><br><span class="line">1ae8042bdd09: Pull complete</span><br><span class="line">453ac13c00a3: Pull complete</span><br><span class="line">9e680cd72f08: Pull complete</span><br><span class="line">a6b5dc864b6c: Pull complete</span><br><span class="line">Digest: sha256:8b7b328a7ff6de46ef96bcf83af048cb00a1c86282bfca0cb119c84568b4caf6<span class="comment">#签名</span></span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:latest</span><br><span class="line">docker.io/library/mysql:latest <span class="comment"># 真实地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 即</span></span><br><span class="line">docker pull mysql</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 指定版本下载</span></span><br><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure><p>版本来自于官网，版本库<a href="https://hub.docker.com/_/mysql">https://hub.docker.com/_/mysql</a></p><p><img src="/images/dockerimages/image-20200617094339687.png" alt="image-20200617094339687"></p><p><img src="/images/dockerimages/image-20200617100948088.png" alt="image-20200617100948088"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>此时查看镜像，可以看到新下载的两个</p><p><img src="/images/dockerimages/image-20200617101105899.png" alt="image-20200617101105899"></p><h4 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h4><p>remove images</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除一个 可以通过名称 也可以指定id -f表示删除所有</span></span><br><span class="line">docker rmi -f 9cfcce23593a</span><br><span class="line"><span class="comment"># 删除多个 用空格分隔id</span></span><br><span class="line">docker rmi -f <span class="built_in">id</span> <span class="built_in">id</span> <span class="built_in">id</span></span><br><span class="line"><span class="comment"># 删除所有</span></span><br><span class="line">docker rmi -f $(docker images -aq) <span class="comment"># images -aq就是查所有镜像id，从而递归删除</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617102049613.png" alt="image-20200617102049613"></p><p><img src="/images/dockerimages/image-20200617102126526.png" alt="image-20200617102126526"></p><h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><p>说明：有了镜像才能创建容器，linux，下载一个 centos 镜像来测试学习</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617103406974.png" alt="image-20200617103406974"></p><h4 id="新建容器并启动"><a href="#新建容器并启动" class="headerlink" title="新建容器并启动"></a>新建容器并启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参数说明</span></span><br><span class="line">--name=“Name” # 容器名字，用于区分容器</span><br><span class="line">-d 后台方式运行</span><br><span class="line">-it 使用交互方式运行，进入容器查看内容</span><br><span class="line">-p 指定容器的端口 如-p 8080::8080</span><br><span class="line">-p ip:主机端口：容器端口</span><br><span class="line">-p 主机端口:容器端口</span><br><span class="line">-p 容器端口</span><br><span class="line"></span><br><span class="line">-p 随机指定端口</span><br></pre></td></tr></table></figure><h4 id="进入退出容器"><a href="#进入退出容器" class="headerlink" title="进入退出容器"></a>进入退出容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入</span></span><br><span class="line">docker run -it centos /bin/bash</span><br><span class="line"><span class="comment"># 查看目录</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617104004004.png" alt="image-20200617104004004"></p><p>注意这里面主机名，编程了 centos 的 id</p><p>这里面就是一个容器，套娃啊</p><h4 id="查看运行的容器"><a href="#查看运行的容器" class="headerlink" title="查看运行的容器"></a>查看运行的容器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看正在运行的容器</span><br><span class="line">docker ps</span><br><span class="line"># 查看曾经运行的容器</span><br><span class="line">docker ps -a</span><br><span class="line"># 显示最近创建的容器，设置显示个数</span><br><span class="line">docker ps -a - n=?</span><br><span class="line"># 只显示容器的编号</span><br><span class="line">docker ps -aq</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@192 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">9939864fa2e6        centos              &quot;bin/bash&quot;          4 minutes ago       Exited (0) 4 minutes ago                       unruffled_knuth</span><br><span class="line">5f42e9930435        centos              &quot;/bin/bash&quot;         8 minutes ago       Exited (0) 4 minutes ago                       lucid_cannon</span><br><span class="line">a89ddb393d3d        bf756fb1ae65        &quot;/hello&quot;            19 hours ago        Exited (0) 19 hours ago                        gracious_bhabha</span><br><span class="line">[root@192 ~]# docker ps -a -n=2</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">9939864fa2e6        centos              &quot;bin/bash&quot;          6 minutes ago       Exited (0) 6 minutes ago                       unruffled_knuth</span><br><span class="line">5f42e9930435        centos              &quot;/bin/bash&quot;         10 minutes ago      Exited (0) 7 minutes ago</span><br><span class="line">[root@192 ~]# docker ps -aq</span><br><span class="line">9939864fa2e6</span><br><span class="line">5f42e9930435</span><br><span class="line">a89ddb393d3d</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器停止退出</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器不停止退出 注意必须在英文输入法下，中文输入法不行</span></span><br><span class="line">Ctrl + P + Q</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@bfcea13c40cd /]# [root@192 ~]# docker ps ##注意这里会自动给个命令，删掉</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES</span><br><span class="line">bfcea13c40cd        centos              &quot;/bin/bash&quot;         About a minute ago   Up About a minute                       stoic_wilson</span><br><span class="line">edbd9366d959        centos              &quot;/bin/bash&quot;         7 minutes ago        Up 7 minutes                            affectionate_bartik</span><br><span class="line">[root@192 ~]# docker exec -it edbd9366d959 /bin/bash ## 再次进入</span><br><span class="line">[root@edbd9366d959 /]# exit ##停止并推出</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第一次启动镜像用run</span><br><span class="line">再次启动容器用exec</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除指定容器 不能删除正在运行的容器，如果强制删除 <span class="built_in">rm</span> -f</span></span><br><span class="line">docker rm 容器id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有容器</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有容器</span></span><br><span class="line">docker ps -a -q|xargs docker rm</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">bfcea13c40cd        centos              &quot;/bin/bash&quot;         29 minutes ago      Up 29 minutes                                   stoic_wilson</span><br><span class="line">edbd9366d959        centos              &quot;/bin/bash&quot;         35 minutes ago      Up 35 minutes                                   affectionate_bartik</span><br><span class="line">9939864fa2e6        centos              &quot;bin/bash&quot;          48 minutes ago      Exited (0) 48 minutes ago                       unruffled_knuth</span><br><span class="line">5f42e9930435        centos              &quot;/bin/bash&quot;         52 minutes ago      Exited (0) 49 minutes ago                       lucid_cannon</span><br><span class="line">a89ddb393d3d        bf756fb1ae65        &quot;/hello&quot;            20 hours ago        Exited (0) 20 hours ago                         gracious_bhabha</span><br><span class="line">[root@192 ~]# docker rm 5f42e9930435</span><br><span class="line">5f42e9930435</span><br><span class="line">[root@192 ~]# docker rm edbd9366d959      # 注意正在运行的容器不能删除</span><br><span class="line">Error response from daemon: You cannot remove a running container edbd9366d9596c744dd449119269b04de2f2a494e7fc471f6396bcefd94c33fe. Stop the container before attempting removal or force remove</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker ps -aq # 所有容器id</span><br><span class="line">bfcea13c40cd</span><br><span class="line">edbd9366d959</span><br><span class="line">9939864fa2e6</span><br><span class="line">a89ddb393d3d</span><br><span class="line">[root@192 ~]# docker rm -f $(docker ps -aq) # 全部删除</span><br><span class="line">bfcea13c40cd</span><br><span class="line">edbd9366d959</span><br><span class="line">9939864fa2e6</span><br><span class="line">a89ddb393d3d</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="启动和停止容器的操作"><a href="#启动和停止容器的操作" class="headerlink" title="启动和停止容器的操作"></a>启动和停止容器的操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start</span><br><span class="line">docker restart</span><br><span class="line">docker stop</span><br><span class="line">docker kill</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@7b1a7dd10ea4 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@192 ~]# docker ps #查看正在运行的</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@192 ~]# docker ps -a # 查看历史运行过的</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;         54 seconds ago      Exited (0) 42 seconds ago                       fervent_mirzakhani</span><br><span class="line">[root@192 ~]# docker start 7b1a7dd10ea4 # 启动当前这个容器 container id 粘过 来</span><br><span class="line">7b1a7dd10ea4</span><br><span class="line">[root@192 ~]# docker ps # 查看当前运行容器 发现启动成功</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;         2 minutes ago       Up 28 seconds                           fervent_mirzakhani</span><br><span class="line">[root@192 ~]# docker stop 7b1a7dd10ea4 # 停止运行</span><br><span class="line">7b1a7dd10ea4</span><br><span class="line">[root@192 ~]# docker ps # 再次查看 没有这个容器了</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h3><p>【视频书签：<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=11】">https://www.bilibili.com/video/BV1og4y1q7M4?p=11】</a></p><h4 id="后台启动-docker"><a href="#后台启动-docker" class="headerlink" title="后台启动 docker"></a>后台启动 docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d 镜像名</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用docker ps 查看的时候 发现停止了</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台运行，docker发现前台没有，容器启动后，发现自己没有提供服务，会立刻停止</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Last login: Wed Jun 17 19:47:35 2020</span><br><span class="line">[root@192 ~]# systemctl start docker # 关机后重启了，需要启动docker</span><br><span class="line">[root@192 ~]# docker run -d centos # 运行</span><br><span class="line">8ce188e5fee31c2fac93c0a405ee1a95c38dbc50cb47c35b19c0039c27558ded</span><br><span class="line">[root@192 ~]# docker ps -a # 查看正在运行的</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">8ce188e5fee3        centos              &quot;/bin/bash&quot;         19 seconds ago      Exited (0) 18 seconds ago                       tender_dirac</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;         8 hours ago         Exited (0) 8 hours ago                          fervent_mirzakhani</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker logs</span><br><span class="line">docker logs -f -t --tail n 【id】</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617161744298.png" alt="image-20200617161744298"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker logs --help</span><br><span class="line"></span><br><span class="line">Usage:docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">Fetch the logs of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow log output</span><br><span class="line">      --since string   Show logs since timestamp (e.g.</span><br><span class="line">                       2013-01-02T13:23:37) or relative</span><br><span class="line">                       (e.g. 42m for 42 minutes)</span><br><span class="line">      --tail string    Number of lines to show from the</span><br><span class="line">                       end of the logs (default &quot;all&quot;)</span><br><span class="line">  -t, --timestamps     Show timestamps # 时间戳</span><br><span class="line">      --until string   Show logs before a timestamp (e.g.</span><br><span class="line">                       2013-01-02T13:23:37) or relative</span><br><span class="line">                       (e.g. 42m for 42 minutes)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whiel true;do echo shen;sleep</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行一个</span></span><br><span class="line">[root@192 ~]# docker run -it centos /bin/bash</span><br><span class="line"></span><br><span class="line">[root@c2887d35c71d /]# [root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;         57 seconds ago      Up 56 seconds                           vigorous_kare</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看日志，由于没有运行脚本，所以啥也没显示</span></span><br><span class="line">[root@192 ~]# docker logs -f -t --tail 10 c2887d35c71d</span><br><span class="line">^C # ctrl+c退出</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行centos里面加个脚本</span></span><br><span class="line">[root@192 ~]# docker run -d centos /bin/sh -c &quot;while true;do echo shenzai;sleep 1;done&quot;</span><br><span class="line">cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388</span><br><span class="line"></span><br><span class="line">[root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">cb6d7fbc3f27        centos              &quot;/bin/sh -c &#x27;while t…&quot;   7 seconds ago       Up 6 seconds                            dreamy_almeida</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;              3 minutes ago       Up 3 minutes                            vigorous_kare</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看日志 发现隔一秒打印一条</span></span><br><span class="line">[root@192 ~]# docker logs -f -t --tail 10 cb6d7fbc3f27</span><br><span class="line">2020-06-17T12:02:11.293765084Z shen</span><br><span class="line">2020-06-17T12:02:12.297675608Z shen</span><br><span class="line">2020-06-17T12:02:13.301845582Z shen</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="查看正在运行的容器信息"><a href="#查看正在运行的容器信息" class="headerlink" title="查看正在运行的容器信息"></a>查看正在运行的容器信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker inspect cb6d7fbc3f27</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        # 容器的完整id</span><br><span class="line">        &quot;Id&quot;: &quot;cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388&quot;,</span><br><span class="line"></span><br><span class="line">        # 创建时间</span><br><span class="line">        &quot;Created&quot;: &quot;2020-06-17T12:00:50.706906186Z&quot;,</span><br><span class="line"></span><br><span class="line">        # 脚本位置</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line"></span><br><span class="line">        # 运行的脚本</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo shenzai;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;, # 状态，正在运行</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 1909, # 父进程id</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-06-17T12:00:51.093617477Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        # 来源镜像</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:831691599b88ad6cc2a4abbd0e89661a121aff14cfa289ad840fd3946f274f1f&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388-json.log&quot;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &quot;Name&quot;: &quot;/dreamy_almeida&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line"></span><br><span class="line">        # 主机配置</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Capabilities&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        # 其他配置</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907-init/diff:/var/lib/docker/overlay2/7f79322e0f58d651a84a555dadd83d92537788172525945d3f538dd95dce336c/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &quot;Mounts&quot;: [], # 挂载</span><br><span class="line"></span><br><span class="line">        # 基本配置</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;cb6d7fbc3f27&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ], # 基本环境变量，这里没有Java</span><br><span class="line"></span><br><span class="line">            # 基本命令</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo shenzai;sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20200611&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        # 网卡，比如现在用的是桥接的网卡</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;4d701985d7e77aa153790b697b2f38a61e20555c224b7675e4bf650b82799882&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/4d701985d7e7&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;8a6c71e2bafb19ca7dfd85445ccc4bef6d17467360a243d624089e676a24a018&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;22b0fd2290ccbc4e066a75d3f01bd8bf32ee4352c5bbcfc9f911287219219571&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;8a6c71e2bafb19ca7dfd85445ccc4bef6d17467360a243d624089e676a24a018&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止正在疯狂输出的那个容器</span></span><br><span class="line">[root@192 ~]# docker stop cb6d7fbc3f27</span><br><span class="line">cb6d7fbc3f27</span><br></pre></td></tr></table></figure><h4 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们通常容器都是使用后台方式运行的e</span></span><br><span class="line"></span><br><span class="line">docker exec -it 容器id bashSHELL</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;         35 minutes ago      Up 35 minutes                           vigorous_kare</span><br><span class="line">[root@192 ~]# docker exec -it c2887d35c71d /bin/bash</span><br><span class="line">[root@c2887d35c71d /]# ls</span><br><span class="line">bin  etc   lib  lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line">[root@c2887d35c71d /]# ps -ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 11:57 pts/0    00:00:00 /bin/bash</span><br><span class="line">root         14      0  0 12:32 pts/1    00:00:00 /bin/bash</span><br><span class="line">root         28     14  0 12:32 pts/1    00:00:00 ps -ef</span><br><span class="line">[root@c2887d35c71d /]# c2887d35c71d</span><br><span class="line">[root@c2887d35c71d /]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式二</span></span><br><span class="line">[root@192 ~]# docker attach c2887d35c71d</span><br><span class="line">[root@c2887d35c71d /]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">区别</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">exec</span> <span class="comment"># 进入容器后开启一个新的终端，可以在里面操作(常用)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker attach 进入容器正在执行的终端，不会启动新的进程</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="从容器内拷贝文件到主机上"><a href="#从容器内拷贝文件到主机上" class="headerlink" title="从容器内拷贝文件到主机上"></a>从容器内拷贝文件到主机上</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行</span></span><br><span class="line">[root@192 ~]# docker run -it centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ctrl P Q 不关闭退出，查看</span></span><br><span class="line">[root@0569081aa89c /]# [root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">0569081aa89c        centos              &quot;/bin/bash&quot;         19 seconds ago      Up 19 seconds</span><br><span class="line">hopeful_chebyshev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看主机home下无文件</span></span><br><span class="line">[root@192 ~]# cd /home</span><br><span class="line">[root@192 home]# ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入正在运行的容器</span></span><br><span class="line">[root@192 home]# docker attach 0569081aa89c</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器home目录</span></span><br><span class="line">[root@0569081aa89c /]# cd /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在目录中创建java文件</span></span><br><span class="line">[root@0569081aa89c home]# touch test.java</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出并停止容器</span></span><br><span class="line">[root@0569081aa89c home]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看现在运行的容器</span></span><br><span class="line">[root@192 home]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器虽然被停止，但是数据都会保留</span></span><br><span class="line">[root@192 home]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                         PORTS               NAMES</span><br><span class="line">0569081aa89c        centos              &quot;/bin/bash&quot;              3 minutes ago       Exited (0) 8 seconds ago                           hopeful_chebyshev</span><br><span class="line">f589e5684a01        centos              &quot;/bin/bash&quot;              44 minutes ago      Exited (0) 44 minutes ago                          cranky_easley</span><br><span class="line">cb6d7fbc3f27        centos              &quot;/bin/sh -c &#x27;while t…&quot;   54 minutes ago      Exited (137) 42 minutes ago                        dreamy_almeida</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;              58 minutes ago      Exited (127) 16 minutes ago                        vigorous_kare</span><br><span class="line">8ce188e5fee3        centos              &quot;/bin/bash&quot;              About an hour ago   Exited (0) About an hour ago                       tender_dirac</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;              9 hours ago         Exited (0) 9 hours ago                             fervent_mirzakhani</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器数据拷贝到主机</span></span><br><span class="line">[root@192 home]# docker cp 0569081aa89c:/home/test.java /home</span><br><span class="line">[root@192 home]# ls</span><br><span class="line">test.java</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝是一个手动过程，未来我们使用 -v 卷的技术，可以实现自动同步 /home /home</span></span><br></pre></td></tr></table></figure><h4 id="查看内容占用"><a href="#查看内容占用" class="headerlink" title="查看内容占用"></a>查看内容占用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stats</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p><img src="/images/dockerimages/image-20200617210554147.png" alt="image-20200617210554147"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">[root@192 home]# docker --help</span><br><span class="line"></span><br><span class="line">Usage:docker [OPTIONS] COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime for containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config</span><br><span class="line">                           files (default &quot;/root/.docker&quot;)</span><br><span class="line">  -c, --context string     Name of the context to use to</span><br><span class="line">                           connect to the daemon</span><br><span class="line">                           (overrides DOCKER_HOST env var</span><br><span class="line">                           and default context set with</span><br><span class="line">                           &quot;docker context use&quot;)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to</span><br><span class="line">  -l, --log-level string   Set the logging level</span><br><span class="line">                           (&quot;debug&quot;|&quot;info&quot;|&quot;warn&quot;|&quot;error&quot;|&quot;fatal&quot;) (default &quot;info&quot;)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by</span><br><span class="line">                           this CA (default</span><br><span class="line">                           &quot;/root/.docker/ca.pem&quot;)</span><br><span class="line">      --tlscert string     Path to TLS certificate file</span><br><span class="line">                           (default &quot;/root/.docker/cert.pem&quot;)</span><br><span class="line">      --tlskey string      Path to TLS key file (default</span><br><span class="line">                           &quot;/root/.docker/key.pem&quot;)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  builder     Manage builds</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers</span><br><span class="line">  context     Manage contexts</span><br><span class="line">  engine      Manage the docker engine</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach local standard input, output, and error streams to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container&#x27;s changes</span><br><span class="line">  cp          Copy files/folders between a container and the local filesystem</span><br><span class="line">  create      Create a new container</span><br><span class="line">  diff        Inspect changes to files or directories on a container&#x27;s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  exec        Run a command in a running container</span><br><span class="line">  export      Export a container&#x27;s filesystem as a tar archive</span><br><span class="line">  history     Show the history of an image</span><br><span class="line">  images      List images</span><br><span class="line">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">  info        Display system-wide information</span><br><span class="line">  inspect     Return low-level information on Docker objects</span><br><span class="line">  kill        Kill one or more running containers</span><br><span class="line">  load        Load an image from a tar archive or STDIN</span><br><span class="line">  login       Log in to a Docker registry</span><br><span class="line">  logout      Log out from a Docker registry</span><br><span class="line">  logs        Fetch the logs of a container</span><br><span class="line">  pause       Pause all processes within one or more containers</span><br><span class="line">  port        List port mappings or a specific mapping for the container</span><br><span class="line">  ps          List containers</span><br><span class="line">  pull        Pull an image or a repository from a registry</span><br><span class="line">  push        Push an image or a repository to a registry</span><br><span class="line">  rename      Rename a container</span><br><span class="line">  restart     Restart one or more containers</span><br><span class="line">  rm          Remove one or more containers</span><br><span class="line">  rmi         Remove one or more images</span><br><span class="line">  run         Run a command in a new container</span><br><span class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">  search      Search the Docker Hub for images</span><br><span class="line">  start       Start one or more stopped containers</span><br><span class="line">  stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">  stop        Stop one or more running containers</span><br><span class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line">  top         Display the running processes of a container</span><br><span class="line">  unpause     Unpause all processes within one or more containers</span><br><span class="line">  update      Update configuration of one or more containers</span><br><span class="line">  version     Show the Docker version information</span><br><span class="line">  wait        Block until one or more containers stop, then print their exit codes</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617210932306.png" alt="image-20200617210932306"></p><p><img src="/images/dockerimages/image-20200617211021003.png" alt="image-20200617211021003"></p><p><img src="/images/dockerimages/image-20200617211039508.png" alt="image-20200617211039508"></p><h4 id="作业练习"><a href="#作业练习" class="headerlink" title="作业练习"></a>作业练习</h4><h5 id="部署-Nginx"><a href="#部署-Nginx" class="headerlink" title="部署 Nginx"></a>部署 Nginx</h5><p><img src="/images/dockerimages/image-20200618100621199.png" alt="image-20200618100621199"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官网搜索nginx，可以看到帮助文档</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载镜像</span></span><br><span class="line">[root@192 home]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">8559a31e96f4: Pull complete</span><br><span class="line">8d69e59170f7: Pull complete</span><br><span class="line">3f9f1ec1d262: Pull complete</span><br><span class="line">d1f5ff4f210d: Pull complete</span><br><span class="line">1e22bfa8652e: Pull complete</span><br><span class="line">Digest: sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看镜像</span></span><br><span class="line">[root@192 home]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              831691599b88        13 hours ago        215MB</span><br><span class="line">nginx               latest              2622e6cca7eb        7 days ago          132MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行测试</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台运行，--name 命名，-p 暴露端口，3344服务器、宿主机的端口，容器内部端口</span></span><br><span class="line">[root@192 home]# docker run -d --name nginx01 -p:3344:80 nginx</span><br><span class="line">38dbf7bdcaef232d269b7184d91e44e06087181b5ee929494e177ad526810fa8</span><br><span class="line">[root@192 home]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">38dbf7bdcaef        nginx               &quot;/docker-entrypoint.…&quot;   7 seconds ago       Up 6 seconds        0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用3344可以访问成功</span></span><br><span class="line">[root@192 home]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>端口暴露</p><p><img src="/images/dockerimages/image-20200617212310709.png" alt="image-20200617212310709"></p><p>可以公网访问</p><p>找到服务器地址</p><p><img src="/images/dockerimages/image-20200617213213721.png" alt="image-20200617213213721"></p><p>浏览器输入 192.168.147.132:3344/</p><p><img src="/images/dockerimages/image-20200617213142079.png" alt="image-20200617213142079"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@192 home]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">38dbf7bdcaef        nginx               &quot;/docker-entrypoint.…&quot;   21 minutes ago      Up 21 minutes       0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@192 home]# docker exec -it nginx01 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查一下nginx在哪</span></span><br><span class="line">root@38dbf7bdcaef:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">到这个目录</span></span><br><span class="line">root@38dbf7bdcaef:/# cd /etc/nginx</span><br><span class="line">root@38dbf7bdcaef:/etc/nginx# ls</span><br><span class="line">conf.dkoi-utf  mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_paramskoi-win  modules     scgi_params  win-utf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出</span></span><br><span class="line">root@38dbf7bdcaef:/etc/nginx# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止</span></span><br><span class="line">[root@192 home]# docker stop 38dbf7bdcaef</span><br><span class="line">38dbf7bdcaef</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再次刷新网页，服务关闭</p><p>思考问题：每次改动 nginx 配置文件，都需要进入容器内部，十分麻烦，要是可以在容器外部提供一个映射路径，达到在容器修改文件名，容器内部就可以自动修改？-v 数据卷技术！</p><h5 id="部署-tomcat"><a href="#部署-tomcat" class="headerlink" title="部署 tomcat"></a>部署 tomcat</h5><p><img src="/images/dockerimages/image-20200618100551587.png" alt="image-20200618100551587"></p><p>【视频书签：<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=15】">https://www.bilibili.com/video/BV1og4y1q7M4?p=15】</a></p><p>【20200618 毕竟生产力工具，加油搞，这周一定刷完！！每次关机都要重连，麻烦(<em>╹▽╹</em>)】</p><p>在 docker hub 上查看版本号和使用方法</p><p><img src="/images/dockerimages/image-20200618100319796.png" alt="image-20200618100319796"></p><p>官方文档一定要翻烂，超多版本，我的天呐~</p><h6 id="官方方法"><a href="#官方方法" class="headerlink" title="官方方法"></a>官方方法</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run 可以不用pull，能自动下载</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it 直接进去运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--<span class="built_in">rm</span> 是什么意思？入门的意思？</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们之前的启动都是后台，停止了容器之后，容器还是可以查到</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写了--<span class="built_in">rm</span>，类似阅后即焚模式，用完即删除，这种通常用来测试</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">最后冒号查好的版本号</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618101811914.png" alt="image-20200618101811914"></p><p><img src="/images/dockerimages/image-20200618101849917.png" alt="image-20200618101849917"></p><p>ctrl+c 退出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618102022167.png" alt="image-20200618102022167"></p><p>可以看到并没有 tomcat，印证阅后即焚模式，容器会删除，镜像不会删除</p><p>平时不建议这样搞</p><h6 id="正常方法"><a href="#正常方法" class="headerlink" title="正常方法"></a>正常方法</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat:9.0 # 之前下过了，应该不用下了，这里老师讲错了</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618102544564.png" alt="image-20200618102544564"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动运行，应该加上版本号</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618102837397.png" alt="image-20200618102837397"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">docker exec -it tomcat01 /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618103109004.png" alt="image-20200618103109004"></p><p>发现问题</p><ol><li>linux 命令少了</li><li>没有 webapps</li></ol><p><img src="/images/dockerimages/image-20200618103407205.png" alt="image-20200618103407205"></p><p>这是阿里云镜像的原因：默认使用最小镜像，所有不必要的都剔除了，保证最小可运行环境</p><p><img src="C:\Users\Null\AppData\Roaming\Typora\typora-user-images\image-20200820152110088.png" alt="image-20200820152110088"></p><p>再次找到结构</p><p><img src="/images/dockerimages/image-20200618104052242.png" alt="image-20200618104052242"></p><p>在浏览器中输入：<a href="http://192.168.147.132:3355/">http://192.168.147.132:3355/</a></p><p><img src="/images/dockerimages/image-20200618103958168.png" alt="image-20200618103958168"></p><p>思考问题：我们以后部署项目，如果每次都要进入容器是不是身份麻烦？我要是可以在容器外部提供一个映射路径，webapps，我们在外部放置项目，就自动同步到内部就好了！</p><p>docker 容器 tomcat+网站</p><p>docker mysql</p><h5 id="部署-es-kibana"><a href="#部署-es-kibana" class="headerlink" title="部署 es+kibana"></a>部署 es+kibana</h5><p><img src="/images/dockerimages/image-20200618104950722.png" alt="image-20200618104950722"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 暴露的端口很多</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 十分耗内存</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 的数据一般需要放置到安全目录！挂载</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 elasticsearch</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d --name elasticsearch01 -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:7.6.2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看内存占用情况</span></span><br><span class="line">docker stats</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618111713885.png" alt="image-20200618111713885"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先感觉stop一下</span></span><br><span class="line">docker stop ba18713ca536</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618105057785.png" alt="image-20200618105057785"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过 -e 限制内存</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d --name elasticsearch02 -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=“-Xms64m -Xmx512m” elasticsearch:7.6.2</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618113018622.png" alt="image-20200618113018622"></p><p>没成功啊，SEI 能告诉我为啥！！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch02 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br></pre></td></tr></table></figure><blockquote><p>py0003null 大佬:<br>“ES_JAVA_OPTS=-Xms64m -Xmx512m”</p><p>py0003null 大佬:<br>引号提前试试</p></blockquote><p>原因是引号！！你没觉得怪怪的嘛</p><p><img src="/images/dockerimages/image-20200618115302656.png" alt="image-20200618115302656"></p><p>此时查看 stats，发现内存占用在控制范围内</p><p><img src="/images/dockerimages/image-20200618115149971.png" alt="image-20200618115149971"></p><p>ctrl + C 退出，记得 stop</p><p><img src="/images/dockerimages/image-20200618115921069.png" alt="image-20200618115921069"></p><h5 id="思考：用-kibana-链接-elasticsearch"><a href="#思考：用-kibana-链接-elasticsearch" class="headerlink" title="思考：用 kibana 链接 elasticsearch"></a>思考：用 kibana 链接 elasticsearch</h5><p><img src="/images/dockerimages/image-20200618113556445.png" alt="image-20200618113556445"></p><h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><ul><li>portainer(先用这个)</li><li>Rancher(CI/CD 时用)</li></ul><h4 id="portainer"><a href="#portainer" class="headerlink" title="portainer"></a>portainer</h4><p>Docker 图像化界面管理工具，提供一个后台面板供我们操作！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618114542622.png" alt="image-20200618114542622"></p><p>访问外网 8088</p><p><img src="/images/dockerimages/image-20200618114902169.png" alt="image-20200618114902169"></p><p>用户名</p><p>密码</p><p><img src="/images/dockerimages/image-20200618134706491.png" alt="image-20200618134706491"></p><p>失败，不知道发生了啥</p><p><img src="/images/dockerimages/image-20200618135424706.png" alt="image-20200618135424706"></p><p><img src="/images/dockerimages/image-20200618135450037.png" alt="image-20200618135450037"></p><h2 id="-1"><a href="#-1" class="headerlink" title="#"></a>#</h2><h2 id="Docker-镜像"><a href="#Docker-镜像" class="headerlink" title="Docker 镜像"></a>Docker 镜像</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>UnionFS 联合文件系统</p><p><img src="/images/dockerimages/image-20200618140242423.png" alt="image-20200618140242423"></p><p>bootfs：boot file system</p><p>rootfs：root file system</p><p><img src="/images/dockerimages/image-20200618140907894.png" alt="image-20200618140907894"></p><p><img src="/images/dockerimages/image-20200618140932621.png" alt="image-20200618140932621"></p><p><img src="/images/dockerimages/image-20200618141014511.png" alt="image-20200618141014511"></p><p><img src="/images/dockerimages/image-20200618153329894.png" alt="image-20200618153329894"></p><p>Docker 镜像都是只读的，当容器启动时，一个新的可写层被加到镜像的顶部，这一层就是我们通常说的容器层，容器层之下的都叫镜像层</p><p><img src="/images/dockerimages/image-20200618153855605.png" alt="image-20200618153855605"></p><h3 id="commit-提交镜像"><a href="#commit-提交镜像" class="headerlink" title="commit 提交镜像"></a>commit 提交镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit # 提交容器成为一个新的副本</span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名：[TAG]</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618154457286.png" alt="image-20200618154457286"></p><p>这是一个前台程序</p><p><img src="/images/dockerimages/image-20200618154736475.png" alt="image-20200618154736475"></p><p>将 webapps.dist 里面所有的文件拷贝到 webapps 里面，其中-r 必须有，表示目录递归拷贝</p><p><img src="/images/dockerimages/image-20200618154943194.png" alt="image-20200618154943194"></p><p><img src="/images/dockerimages/image-20200618155750591.png" alt="image-20200618155750591"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -a=&quot;paidaxing&quot; -m=&quot;add webapps app&quot; 当前容器的id tomcat02:1.0</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618160425265.png" alt="image-20200618160425265"></p><p>发现新的版本，比之前的大了一些，因为里面记录了我们的改动</p><blockquote><p>如果想保存当前容器的状态，可以通过 commit 提交，获得一个镜像</p><p>好比我们以前学习 VM 的时候的快照</p><p>到这里算是入门了</p><p>接下来三个部分是 docker 的精髓</p></blockquote><h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><h3 id="什么是容器卷"><a href="#什么是容器卷" class="headerlink" title="什么是容器卷"></a>什么是容器卷</h3><p>docker 是要将应用和环境打包成一个镜像</p><p>这样，数据就不应该在容器中，否则容器删除，数据就会丢失，这就是删库跑路</p><p>故容器之间要有一个数据共享技术</p><p>在 Docker 容器中产生的数据，同步到本地，这就是卷技术</p><p>本质上是一个目录挂载，将容器内的目录挂载到虚拟机上</p><p><img src="/images/dockerimages/image-20200618162917672.png" alt="image-20200618162917672"></p><p>目的：容器的持久化和同步操作</p><p>容器间可以数据共享</p><h3 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h3><p>方式一：直接使用命令来挂载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v -p</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it 交互式进入</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v volume卷技术</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 主机端口</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618163659503.png" alt="image-20200618163659503"></p><p>新开一个窗口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618163938466.png" alt="image-20200618163938466"></p><p>找到挂载信息 Mounts</p><p><img src="/images/dockerimages/image-20200618164148642.png" alt="image-20200618164148642"></p><p>测试</p><p><img src="/images/dockerimages/image-20200618164818624.png" alt="image-20200618164818624"></p><p>容器停止后，修改主机文件，再启动容器的时候，数据同样改变</p><p>双向同步</p><h3 id="实战安装-mysql"><a href="#实战安装-mysql" class="headerlink" title="实战安装 mysql"></a>实战安装 mysql</h3><p>MySQL 的数据持久化命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取</span></span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载</span></span><br><span class="line">docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql5.7</span><br><span class="line"></span><br><span class="line">-d 后台运行</span><br><span class="line">-p 端口映射</span><br><span class="line">-v 卷挂载</span><br><span class="line">-e 环境配置 安装启动mysql需要配置密码</span><br><span class="line">--name 容器名字</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618171353336.png" alt="image-20200618171353336"></p><p>链接测试：打开 SQLyog</p><p><img src="/images/dockerimages/image-20200618173234347.png" alt="image-20200618173234347"></p><p>点 测试链接</p><p><img src="/images/dockerimages/image-20200618173300551.png" alt="image-20200618173300551"></p><p>点 链接</p><p><img src="/images/dockerimages/image-20200618173729692.png" alt="image-20200618173729692"></p><h3 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h3><p>【视频书签：<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=23】">https://www.bilibili.com/video/BV1og4y1q7M4?p=23】</a></p><p><img src="/images/dockerimages/image-20200618203452205.png" alt="image-20200618203452205"></p><p><img src="/images/dockerimages/image-20200618203744983.png" alt="image-20200618203744983"></p><h2 id="-2"><a href="#-2" class="headerlink" title="#"></a>#</h2><p>DockerFile 使用来构建 docker 镜像的文件</p><p><img src="/images/dockerimages/image-20200618211547398.png" alt="image-20200618211547398"></p><blockquote><p>kas:<br>没有安装吧？</p><p>kas:<br>安装一下就可以了</p><p>py9001021 曾叙坚:<br>centos 默认使用 vi 写内容，vim 需要下载</p><p>py9001021 曾叙坚:<br>是的，需要下载 vim 才能使用</p><p>YF:<br>配置可以改下，字体就很炫酷了</p><p>都建民:<br>用 vi 试试</p><p>都建民:<br>你没有安装 vim</p><p>都建民:<br>yum install vim</p><p>都建民:<br>试试这个命令</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vim # 编辑文件的，没有装一下</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618211516566.png" alt="image-20200618211516566"></p><p>安装完之后就可以运行这个命令了</p><p><img src="/images/dockerimages/image-20200618211803012.png" alt="image-20200618211803012"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">镜像是一层一层的，脚本是一行一行的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指令都是大写的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里的每个命令可以理解为镜像的一层</span></span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;] # 再创建镜像的时候就挂载出来</span><br><span class="line"></span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618211023834.png" alt="image-20200618211023834"></p><p>想保存并退出</p><blockquote><p>Wesley.:<br>shift 加 冒号</p></blockquote><p><img src="/images/dockerimages/image-20200618211318410.png" alt="image-20200618211318410"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat dockerfile1</span><br><span class="line"></span><br><span class="line">docker build -f dockerfile1 -t padaxing/centos:1.0 .  # 最后的点很重要 镜像名不能有/</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618212936481.png" alt="image-20200618212936481"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618213310752.png" alt="image-20200618213310752"></p><p>启动生成的镜像</p><p><img src="/images/dockerimages/image-20200618220658979.png" alt="image-20200618220658979"></p><p>在容器内部创建一个文件</p><p><img src="/images/dockerimages/image-20200618221801103.png" alt="image-20200618221801103"></p><p>查看 Mounts，Source 对应容器外目录，匿名挂载卷</p><p><img src="/images/dockerimages/image-20200618221837895.png" alt="image-20200618221837895"></p><p>测试一下，在 container volume01 下生成文件</p><p><img src="/images/dockerimages/image-20200618222224352.png" alt="image-20200618222224352"></p><p>在主机挂载路径下，也同样生成</p><h3 id="多个容器数据共享"><a href="#多个容器数据共享" class="headerlink" title="多个容器数据共享"></a>多个容器数据共享</h3><p>【视频书签：<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=25】">https://www.bilibili.com/video/BV1og4y1q7M4?p=25】</a></p><p><img src="/images/dockerimages/image-20200621165403842.png" alt="image-20200621165403842"></p><p>看一下有啥 images</p><p><img src="/images/dockerimages/image-20200621165733780.png" alt="image-20200621165733780"></p><p>启动 docker01，用之前建的 padaxing/centos 1.0 镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker01 padaxing/centos:1.0 # 1.0必须写</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621170429658.png" alt="image-20200621170429658"></p><p>当前这个 ctrl+p+q 不停止退出</p><p><img src="/images/dockerimages/image-20200621170540593.png" alt="image-20200621170540593"></p><p>依次启动 docker02、docker03</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker02 --volumes-from docker01 padaxing/centos:1.0</span><br></pre></td></tr></table></figure><p>docker02 继承 docker01 的 volumes</p><p>可以验证，在 docker01 下加一个数据，在 docker02 下也会出现</p><p><img src="/images/dockerimages/image-20200621171513650.png" alt="image-20200621171513650"></p><p>创建 docker03，同样继承 docker01</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker03 --volumes-from docker01 padaxing/centos:1.0</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621172333639.png" alt="image-20200621172333639"></p><p>在 docker03 的 volume01 下建立文件，在 docker01 的 volume01 下同样也有</p><p>即通过—volumes-from 可以实现不同容器间的数据共享</p><p>删除 docker01，数据还在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621172830779.png" alt="image-20200621172830779"></p><p>可以看到，删除 docker01，进入 docker02，数据依然在</p><p>结论：</p><p>容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用位置</p><p>但是如果持久化到了本地，即使所有容器删除了，本地数据是不会删除的</p><hr><h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><p>是用来构建 docker 镜像的文件，可以理解为命令参数脚本</p><p>构建步骤：</p><ol><li>编写一个 dockerfile 文件</li><li>docker build 构建成为一个镜像</li><li>docker run 运行镜像</li><li>docker push 发布镜像（DockerHub、阿里云镜像仓库 私有/共有）</li></ol><p>这个写一个项目时一样的</p><h3 id="官方-DockerFile-示例"><a href="#官方-DockerFile-示例" class="headerlink" title="官方 DockerFile 示例"></a>官方 DockerFile 示例</h3><p>看一下官方的 DockerFile</p><p><img src="/images/dockerimages/image-20200621174204807.png" alt="image-20200621174204807"></p><p>可以看到官方镜像都是基础包，很多功能没有，我们通常会自己搭建自己的镜像</p><p>官方既然可以制作镜像，我们亦可以</p><hr><h3 id="DockerFile-基础知识"><a href="#DockerFile-基础知识" class="headerlink" title="DockerFile 基础知识"></a>DockerFile 基础知识</h3><ol><li>每个指令都必须是大写字母</li><li>按照从上到下顺序执行</li><li><em>#</em>表示注释</li><li>每一个指令都会创建体检一个新的镜像层，并提交</li></ol><p><img src="/images/dockerimages/image-20200621174948310.png" alt="image-20200621174948310"></p><p>docker 是面向开发的，我们以后要发布项目，做镜像，就要编写 dockerfile 文件，这个文件十分简单！</p><p>Docker 镜像逐渐成为企业的交付标准，必须掌握！</p><hr><h3 id="DockerFile-命令"><a href="#DockerFile-命令" class="headerlink" title="DockerFile 命令"></a>DockerFile 命令</h3><p><img src="http://www.yunweipai.com/wp-content/uploads/2016/09/171.jpg" alt="æ¥çæºå¾å"></p><h2 id="-3"><a href="#-3" class="headerlink" title="#"></a>#</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM # 基础镜像 比如centos</span><br><span class="line">MAINTAINER # 镜像是谁写的 姓名+邮箱</span><br><span class="line">RUN # 镜像构建时需要运行的命令</span><br><span class="line">ADD # 添加，比如添加一个tomcat压缩包</span><br><span class="line">WORKDIR # 镜像的工作目录</span><br><span class="line">VOLUME # 挂载的目录</span><br><span class="line">EXPOSE # 指定暴露端口，跟-p一个道理</span><br><span class="line">RUN # 最终要运行的</span><br><span class="line">CMD # 指定这个容器启动的时候要运行的命令，只有最后一个会生效，而且可被替代</span><br><span class="line">ENTRYPOINT # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD # 当构建一个被继承Dockerfile 这个时候运行ONBUILD指定，触发指令</span><br><span class="line">COPY # 将文件拷贝到镜像中</span><br><span class="line">ENV # 构建的时候设置环境变量</span><br></pre></td></tr></table></figure><h3 id="实战构建自己的-centos"><a href="#实战构建自己的-centos" class="headerlink" title="实战构建自己的 centos"></a>实战构建自己的 centos</h3><p>Docker Hub 中 99%的镜像都是从 FROM scratch 开始的</p><p>添加 centos7 的压缩包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个自己的centos</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入home目录</span></span><br><span class="line">cd /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个目录，之后的东西都保存到这里</span></span><br><span class="line">mkdir dockerfile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入这个目录</span></span><br><span class="line">cd dockerfile/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个dockerfile，名字叫mydockerfile</span></span><br><span class="line">vim mydockerfile-centos</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>xshell 新开一个界面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方默认centos</span></span><br><span class="line">docker run -it centos</span><br><span class="line">pwd # 官方默认有pwd命令</span><br><span class="line">vim # 官方默认没有vim命令</span><br><span class="line">ifconfig # 官方默认没有ifconfig命令</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621184333206.png" alt="image-20200621184333206"></p><p>回到 mydockerfile</p><p><img src="/images/dockerimages/image-20200621184847524.png" alt="image-20200621184847524"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下面给官方centos加上自定义的内容</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER padaxing&lt;010301200@hai.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621185539523.png" alt="image-20200621185539523"></p><p>ESC, shif + : 输入 wq 保存并退出</p><p>如果写错了需要修改、</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim mydockerfile-centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入之后按i或者INSERT键即可修改</span></span><br></pre></td></tr></table></figure><p>下面通过这个这个文件创建镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f dockerfile-centos -t mycentos:0.1 .</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621190219978.png" alt="image-20200621190219978"></p><p>依次执行命令</p><p><img src="/images/dockerimages/image-20200621190439448.png" alt="image-20200621190439448"></p><p>最终返回 Successfully 表示成功</p><p><img src="/images/dockerimages/image-20200621190524848.png" alt="image-20200621190524848"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it mycentos:0.1 # 版本号必须写，不然他会去找最新的</span><br><span class="line">pwd</span><br><span class="line">vim</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621190812481.png" alt="image-20200621190812481"></p><p>这时可以看到这些功能都有了</p><p>可以通过查看 docker 构建历史</p><p><img src="/images/dockerimages/image-20200621192103460.png" alt="image-20200621192103460"></p><p>可以看到当前这个镜像是怎么一步一步构建起来的</p><p>我们平时拿到一个镜像也可以通过这个方法研究一下他是怎么做的</p><h3 id="CMD-与-ENTRYPOINT"><a href="#CMD-与-ENTRYPOINT" class="headerlink" title="CMD 与 ENTRYPOINT"></a>CMD 与 ENTRYPOINT</h3><p>【视频书签，<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=29】">https://www.bilibili.com/video/BV1og4y1q7M4?p=29】</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;] # 启动centos展示目录</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200622075427103.png" alt="image-20200622075427103"></p><p>测试 ENTRYPOINT</p><p><img src="/images/dockerimages/image-20200622075653789.png" alt="image-20200622075653789"></p><p>run 的时候可以直接加命令</p><p><img src="/images/dockerimages/image-20200622075802180.png" alt="image-20200622075802180"></p><p>Docker 中许多命令都十分相似，我们需要了解他们的区别，最好的方式就是这样对比测试</p><hr><h3 id="实战-Tomcat-镜像"><a href="#实战-Tomcat-镜像" class="headerlink" title="实战 Tomcat 镜像"></a>实战 Tomcat 镜像</h3><p>【视频书签，<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=30】">https://www.bilibili.com/video/BV1og4y1q7M4?p=30】</a></p><h2 id="IDEA-整合-Docker"><a href="#IDEA-整合-Docker" class="headerlink" title="IDEA 整合 Docker"></a>IDEA 整合 Docker</h2><h2 id="Docker-整合-Docker"><a href="#Docker-整合-Docker" class="headerlink" title="Docker 整合 Docker"></a>Docker 整合 Docker</h2><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>git笔记</title>
      <link href="/2023/06/12/git%E5%91%BD%E4%BB%A4/"/>
      <url>/2023/06/12/git%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 align='center'>git命令</h1><h1 id="一、常用命令"><a href="#一、常用命令" class="headerlink" title="一、常用命令"></a>一、常用命令</h1><h2 id="1-基本操作"><a href="#1-基本操作" class="headerlink" title="1.基本操作"></a>1.基本操作</h2><h3 id="用户配置"><a href="#用户配置" class="headerlink" title="用户配置"></a>用户配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;bettyaner&quot;</span><br><span class="line">git config --global user.email bettyaner@163.com</span><br></pre></td></tr></table></figure><h2 id="配置级别"><a href="#配置级别" class="headerlink" title="配置级别"></a>配置级别</h2><ul><li>–local（默认，高级优先）：只影响本地仓库</li><li>–global(中优先级)：只影响所有当前用户的 git 仓库</li><li>–system（低优先级）：影响到全系统的 git 仓库</li></ul><h1 id="二、问题处理"><a href="#二、问题处理" class="headerlink" title="二、问题处理"></a>二、问题处理</h1><h2 id="1、当需要本地代码与远程仓库合并时"><a href="#1、当需要本地代码与远程仓库合并时" class="headerlink" title="1、当需要本地代码与远程仓库合并时"></a>1、当需要本地代码与远程仓库合并时</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">远程仓库已经建立，将本地代码上传至远程仓库。</span><br><span class="line"></span><br><span class="line">1、(先进入项目文件夹)通过命令 git init 把这个目录变成git可以管理的仓库</span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line">2、把文件添加到版本库中，使用命令 git add .添加到暂存区里面去，不要忘记后面的小数点“.”，意为添加文件夹下的所有文件</span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">3、用命令 git commit告诉Git，把文件提交到仓库。引号内为提交说明</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line"></span><br><span class="line">4、关联到远程库</span><br><span class="line">git remote add origin 你的远程库地址</span><br><span class="line">如：</span><br><span class="line">git remote add origin https://github.com/cade8800/ionic-demo.git</span><br><span class="line"></span><br><span class="line">5、获取远程库与本地同步合并(如果远程库不为空必须做这一步，否则后面的提交会失败)</span><br><span class="line">git pull --rebase origin master</span><br><span class="line"></span><br><span class="line">6、把本地库的内容推送到远程，使用 git push命令，实际上是把当前分支master推送到远程。执行此命令后会要求输入用户名、密码，验证通过后即开始上传。</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2、开发分支（dev）上的代码更新后，要合并到-master-分支"><a href="#2、开发分支（dev）上的代码更新后，要合并到-master-分支" class="headerlink" title="2、开发分支（dev）上的代码更新后，要合并到 master 分支"></a>2、开发分支（dev）上的代码更新后，要合并到 master 分支</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout dev     #切换到dev分支</span><br><span class="line">git pull             #将远程更新的代码同步到本地</span><br><span class="line">git checkout master  #切换到master</span><br><span class="line">git merge dev        #将dev分支合并到master上</span><br><span class="line">git push -u origin master   #提交</span><br></pre></td></tr></table></figure><h2 id="3、当-master-代码改动了，需要更新开发分支（dev）上的代码"><a href="#3、当-master-代码改动了，需要更新开发分支（dev）上的代码" class="headerlink" title="3、当 master 代码改动了，需要更新开发分支（dev）上的代码"></a>3、当 master 代码改动了，需要更新开发分支（dev）上的代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git pull</span><br><span class="line">git checkout dev</span><br><span class="line">git merge master</span><br><span class="line">git push -u origin dev</span><br></pre></td></tr></table></figure><h2 id="4、a-分支代码更新，将-a-分支代码提交到新分支-b"><a href="#4、a-分支代码更新，将-a-分支代码提交到新分支-b" class="headerlink" title="4、a 分支代码更新，将 a 分支代码提交到新分支 b"></a>4、a 分支代码更新，将 a 分支代码提交到新分支 b</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git branch b</span><br><span class="line">git checkout a</span><br><span class="line">git add xxxxxx</span><br><span class="line">git commit -m &quot;xxxx&quot;</span><br><span class="line">git push -u origin a:b</span><br></pre></td></tr></table></figure><h2 id="5、a-分支代码更新，将-a-分支代码合并到旧分支-b-上"><a href="#5、a-分支代码更新，将-a-分支代码合并到旧分支-b-上" class="headerlink" title="5、a 分支代码更新，将 a 分支代码合并到旧分支 b 上"></a>5、a 分支代码更新，将 a 分支代码合并到旧分支 b 上</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout b</span><br><span class="line">git pull origin b</span><br><span class="line">git merge a</span><br><span class="line">git push origin b</span><br></pre></td></tr></table></figure><h2 id="6、git-命令"><a href="#6、git-命令" class="headerlink" title="6、git 命令"></a>6、git 命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git branch aaa    创建aaa分支</span><br><span class="line">git checkout bbb         切换到bbb分支</span><br><span class="line">git pull origin bbb   表示将远程origin主机的bbb分支拉取过来和本地的当前分支进行合并</span><br><span class="line">git status     查看当前状态</span><br><span class="line">git branch -a   查看当前都有那些分支</span><br><span class="line">git clean -xfd  清楚掉本地被修改的文件</span><br><span class="line">git reset --hard 回退代码至当前版本</span><br></pre></td></tr></table></figure><h2 id="7、提交本地代码至远程仓库"><a href="#7、提交本地代码至远程仓库" class="headerlink" title="7、提交本地代码至远程仓库"></a>7、提交本地代码至远程仓库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git status   查看待提交的文件global_pickup_recommend</span><br><span class="line">git add global_pickup_recommend</span><br><span class="line">git commit -m &quot;update&quot;</span><br><span class="line">git pull</span><br><span class="line">git push origin master    #合并到master上</span><br></pre></td></tr></table></figure><h2 id="8、当代码提交错误分支，需要回滚时，git-回退远程代码到制定版本"><a href="#8、当代码提交错误分支，需要回滚时，git-回退远程代码到制定版本" class="headerlink" title="8、当代码提交错误分支，需要回滚时，git 回退远程代码到制定版本"></a>8、当代码提交错误分支，需要回滚时，git 回退远程代码到制定版本</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard 3266044634a9ac3891b015b3666d99e70aeaab98（回到版本）</span><br><span class="line"> git push origin HEAD --force</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Seata解决分布式事务问题</title>
      <link href="/2023/04/06/Seata%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98/"/>
      <url>/2023/04/06/Seata%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Seata解决分布式事务问题"><a href="#Seata解决分布式事务问题" class="headerlink" title="Seata解决分布式事务问题"></a>Seata解决分布式事务问题</h1><h2 id="1、分布式事务问题由来"><a href="#1、分布式事务问题由来" class="headerlink" title="1、分布式事务问题由来"></a>1、<a href="https://so.csdn.net/so/search?q=分布式事务&amp;spm=1001.2101.3001.7020">分布式事务</a>问题由来</h2><p>分布式前</p><ul><li>单机单库没这个问题</li><li>从1:1 -&gt; 1:N -&gt; N:N</li></ul><p>单体应用被拆分成微服务应用，原来的三个模块被拆分成三个独立的应用,分别使用三个独立的数据源，业务操作需要调用三个服务来完成。此时<strong>每个服务内部的数据一致性由本地事务来保证， 但是全局的数据一致性问题没法保证</strong>。</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_1.png" alt=""></p><h2 id="2、Seata简介"><a href="#2、Seata简介" class="headerlink" title="2、Seata简介"></a>2、<a href="https://so.csdn.net/so/search?q=Seata&amp;spm=1001.2101.3001.7020">Seata</a>简介</h2><h3 id="2-1、是什么"><a href="#2-1、是什么" class="headerlink" title="2-1、是什么"></a>2-1、是什么</h3><p>Seata是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务</p><h3 id="2-2、能干嘛"><a href="#2-2、能干嘛" class="headerlink" title="2-2、能干嘛"></a>2-2、能干嘛</h3><p>一个典型的分布式事务过程</p><p><strong>分布式事务处理过程的一一ID+三组件模型：</strong></p><ul><li>Transaction ID XID 全局唯一的事务ID</li></ul><p>三组件概念</p><ul><li>TC (Transaction Coordinator) - 事务协调者：维护全局和分支事务的状态，驱动全局事务提交或回滚。</li><li>TM (Transaction Manager) - 事务管理器：定义全局事务的范围：开始全局事务、提交或回滚全局事务。</li><li>RM (Resource Manager) - 资源管理器：管理分支事务处理的资源，与TC交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。</li></ul><p><strong>处理过程</strong></p><ol><li>TM向TC申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的XID；</li><li>XID在微服务调用链路的上下文中传播；</li><li>RM向TC注册分支事务，将其纳入XID对应全局事务的管辖；</li><li>TM向TC发起针对XID的全局提交或回滚决议；</li><li>TC调度XID下管辖的全部分支事务完成提交或回滚请求。</li></ol><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_2.png" alt=""></p><h2 id="3、Seata-Server安装"><a href="#3、Seata-Server安装" class="headerlink" title="3、Seata-Server安装"></a>3、Seata-Server安装</h2><h3 id="3-1、去哪下"><a href="#3-1、去哪下" class="headerlink" title="3-1、去哪下"></a><strong>3-1、去哪下</strong></h3><p>发布说明: <a href="https://github.com/seata/seata/releases">https://github.com/seata/seata/releases</a></p><h3 id="3-2、怎么玩"><a href="#3-2、怎么玩" class="headerlink" title="3-2、怎么玩"></a><strong>3-2、怎么玩</strong></h3><ul><li>本地 @Transactional </li><li>全局 @GlobalTransactional </li></ul><h3 id="3-3、SEATA-的分布式交易解决方案"><a href="#3-3、SEATA-的分布式交易解决方案" class="headerlink" title="3-3、SEATA 的分布式交易解决方案"></a><strong>3-3、SEATA 的分布式交易解决方案</strong></h3><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_3.png" alt=""></p><p> 我们只需要使用一个 <code>@GlobalTransactional</code> 注解在业务方法上</p><h3 id="3-4、Seata-Server安装"><a href="#3-4、Seata-Server安装" class="headerlink" title="3-4、Seata-Server安装"></a><strong>3-4、Seata-Server安装</strong></h3><p>官网地址 - <a href="http://seata.io/zh-cn/">http://seata.io/zh-cn/</a></p><p>下载版本 - 0.9.0</p><p>seata-server-0.9.0.zip解压到指定目录并修改conf目录下的file.conf配置文件</p><p>先备份原始file.conf文件</p><p>主要修改:自定义事务组名称+事务日志存储模式为db +数据库连接信息</p><p>service模块</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">service &#123;</span><br><span class="line">  #vgroup-&gt;rgroup</span><br><span class="line">  #jcvv_tx_group自定义的</span><br><span class="line">  vgroup_mapping.jcvv_tx_group = <span class="string">&quot;default&quot;</span></span><br><span class="line">  #only support single node</span><br><span class="line">  <span class="keyword">default</span>.grouplist = <span class="string">&quot;119.3.211.104:8091&quot;</span></span><br><span class="line">  #degrade current not <span class="type">support</span></span><br><span class="line">  <span class="variable">enableDegrade</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  #<span class="type">disable</span></span><br><span class="line">  <span class="variable">disable</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, <span class="keyword">default</span> permanent</span><br><span class="line">  max.commit.retry.timeout = <span class="string">&quot;-1&quot;</span></span><br><span class="line">  max.rollback.retry.timeout = <span class="string">&quot;-1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>store模块</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">## transaction log store</span><br><span class="line">store &#123;</span><br><span class="line">  ## store mode: file、<span class="type">db</span></span><br><span class="line">  <span class="variable">mode</span> <span class="operator">=</span> <span class="string">&quot;file&quot;</span></span><br><span class="line"> </span><br><span class="line">  ## file store</span><br><span class="line">  file &#123;</span><br><span class="line">    dir = <span class="string">&quot;sessionStore&quot;</span></span><br><span class="line"> </span><br><span class="line">    # branch session size , <span class="keyword">if</span> exceeded first <span class="keyword">try</span> compress lockkey, still exceeded <span class="keyword">throws</span> exceptions</span><br><span class="line">    max-branch-session-size = <span class="number">16384</span></span><br><span class="line">    # globe session size , <span class="keyword">if</span> exceeded <span class="keyword">throws</span> exceptions</span><br><span class="line">    max-global-session-size = <span class="number">512</span></span><br><span class="line">    # file buffer size , <span class="keyword">if</span> exceeded allocate <span class="keyword">new</span> <span class="title class_">buffer</span></span><br><span class="line">    file-write-buffer-cache-size = <span class="number">16384</span></span><br><span class="line">    # when recover batch read size</span><br><span class="line">    session.reload.read_size = <span class="number">100</span></span><br><span class="line">    # async, sync</span><br><span class="line">    flush-disk-mode = async</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  ## database store</span><br><span class="line">  db &#123;</span><br><span class="line">    ## the implement of javax.sql.DataSource, such as <span class="title function_">DruidDataSource</span><span class="params">(druid)</span>/BasicDataSource(dbcp) etc.</span><br><span class="line">    datasource = <span class="string">&quot;dbcp&quot;</span></span><br><span class="line">    ## mysql/oracle/h2/oceanbase etc.</span><br><span class="line">    db-type = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    driver-class-name = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    url = <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/seata&quot;</span></span><br><span class="line">    user = <span class="string">&quot;root&quot;</span></span><br><span class="line">    password = <span class="string">&quot;12345&quot;</span></span><br><span class="line">    min-conn = <span class="number">1</span></span><br><span class="line">    max-conn = <span class="number">3</span></span><br><span class="line">    global.table = <span class="string">&quot;global_table&quot;</span></span><br><span class="line">    branch.table = <span class="string">&quot;branch_table&quot;</span></span><br><span class="line">    lock-table = <span class="string">&quot;lock_table&quot;</span></span><br><span class="line">    query-limit = <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mysql5.7数据库新建库seata，在seata库里建表</p><p>建表db_store.sql在\seata-server-0.9.0\seata\conf目录里面</p><p>修改seata-server-0.9.0\seata\conf目录下的registry.conf配置文件，改用为nacos</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">registry &#123;</span><br><span class="line">  # file 、nacos 、eureka、redis、zk、consul、etcd3、<span class="type">sofa</span></span><br><span class="line">  <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;nacos&quot;</span></span><br><span class="line"> </span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;119.3.211.104:8089&quot;</span>#nginx代理nacos地址</span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>linux启动seata</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh seata-server.sh -p <span class="number">8091</span> -h <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span> -m file</span><br></pre></td></tr></table></figure><p>参考：<a href="https://blog.csdn.net/acmjiayou/article/details/123756335">seata配置各种问题解决办法（周阳老师版）<em>seata setaip不生效</em>橙留香_的博客-CSDN博客</a></p><h2 id="4、Seata业务数据库准备"><a href="#4、Seata业务数据库准备" class="headerlink" title="4、Seata业务数据库准备"></a>4、Seata业务数据库准备</h2><p>这里我们会创建三个服务，一个订单服务，一个库存服务，一个账户服务。</p><p>当用户下单时,会在订单服务中创建一个订单, 然后通过远程调用库存服务来扣减下单商品的库存，再通过远程调用账户服务来扣减用户账户里面的余额，最后在订单服务中修改订单状态为已完成。</p><p>该操作跨越三个数据库，有两次远程调用，很明显会有分布式事务问题。</p><p>创建业务数据库</p><ul><li>seata_ order：存储订单的数据库;</li><li>seata_ storage：存储库存的数据库;</li><li>seata_ account：存储账户信息的数据库。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE seata_order;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE seata_storage;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE seata_account;</span><br></pre></td></tr></table></figure><p>seata_order库下建t_order表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USE seata_order;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order (</span><br><span class="line">    `id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    `user_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">    `product_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;产品id&#x27;</span>,</span><br><span class="line">    `count` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">    `money` <span class="type">DECIMAL</span>(<span class="number">11</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;金额&#x27;</span>,</span><br><span class="line">    `status` <span class="type">INT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单状态: 0:创建中; 1:已完结&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>seata_storage库下建t_storage表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">USE seata_storage;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_storage (</span><br><span class="line">`id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">`product_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;产品id&#x27;</span>,</span><br><span class="line">`total` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;总库存&#x27;</span>,</span><br><span class="line">`used` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;已用库存&#x27;</span>,</span><br><span class="line">`residue` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;剩余库存&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_storage.t_storage(`id`, `product_id`, `total`, `used`, `residue`)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;100&#x27;</span>);</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>seata_account库下建t_account表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">USE seata_account;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_account(</span><br><span class="line">`id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">`user_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">`total` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;总额度&#x27;</span>,</span><br><span class="line">`used` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;已用余额&#x27;</span>,</span><br><span class="line">`residue` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;剩余可用额度&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_account.t_account(`id`, `user_id`, `total`, `used`, `residue`)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>);</span><br></pre></td></tr></table></figure><p> 按照上述3库分别建对应的回滚日志表</p><ul><li>订单-库存-账户3个库下<strong>都需要建各自的回滚日志表</strong></li><li>\seata-server-0.9.0\seata\conf目录下的db<em> undo</em> log.sql</li><li>建表SQL</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> `undo_log`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><h2 id="5、Module配置搭建"><a href="#5、Module配置搭建" class="headerlink" title="5、Module配置搭建"></a>5、Module配置搭建</h2><h3 id="5-1、Seata之Order-Module配置搭建"><a href="#5-1、Seata之Order-Module配置搭建" class="headerlink" title="5-1、Seata之Order-Module配置搭建"></a>5-1、Seata之Order-Module配置搭建</h3><p>cloudalibaba-seata-order2001</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2020<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-seata-order2001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- seata --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos 依赖,Nacos Server 服务注册中心 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- open feign 服务调用 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- springboot整合Web组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- 持久层支持 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- 日常通用jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.activation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata-order-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="comment"># 自定义事务组，需要和当时在 seata/conf/file.conf 中的一致</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">fsp_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/seata_order</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 注意，这是自定义的，原来的是mapper_locations</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_4.png" alt=""></p><p>将 seata/conf 下的 file.conf ，registry.conf 移到 rescources 目录下</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_11.png" alt=""></p><h4 id="订单类"><a href="#订单类" class="headerlink" title="订单类"></a>订单类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> BigDecimal money;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单状态：0：创建中；1：已完结</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dao接口及实现"><a href="#Dao接口及实现" class="headerlink" title="Dao接口及实现"></a>Dao接口及实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改订单状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId, <span class="meta">@Param(&quot;status&quot;)</span> Integer status)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OrderMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jcvv.springcloud.dao.OrderDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.jcvv.springcloud.domain.Order&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;product_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;productId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;count&quot;</span> <span class="attr">property</span>=<span class="string">&quot;count&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;money&quot;</span> <span class="attr">property</span>=<span class="string">&quot;money&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;create&quot;</span>&gt;</span></span><br><span class="line">        insert into t_order (id,user_id,product_id,count,money,status)</span><br><span class="line">        values (null,#&#123;userId&#125;,#&#123;productId&#125;,#&#123;count&#125;,#&#123;money&#125;,0);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update t_order set status = 1</span><br><span class="line">        where user_id=#&#123;userId&#125; and status = #&#123;status&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Service接口及实现"><a href="#Service接口及实现" class="headerlink" title="Service接口及实现"></a>Service接口及实现</h4><ul><li>OrderService<ul><li>OrderServiceImpl</li></ul></li><li>StorageService</li><li>AccountService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;seata-storage-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/storage/decrease&quot;)</span></span><br><span class="line">    CommonResult <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;productId&quot;)</span> Long productId, <span class="meta">@RequestParam(&quot;count&quot;)</span> Integer count)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;seata-account-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减账户余额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/account/decrease&quot;)</span></span><br><span class="line">    CommonResult <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单-&gt;调用库存服务扣减库存-&gt;调用账户服务扣减账户余额-&gt;修改订单状态</span></span><br><span class="line"><span class="comment">     * 简单说：</span></span><br><span class="line"><span class="comment">     * 下订单-&gt;减库存-&gt;减余额-&gt;改状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;下单开始&quot;</span>);</span><br><span class="line">        <span class="comment">//本应用创建订单</span></span><br><span class="line">        orderDao.create(order);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//远程调用库存服务扣减库存</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减库存开始&quot;</span>);</span><br><span class="line">        storageService.decrease(order.getProductId(),order.getCount());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减库存结束&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//远程调用账户服务扣减余额</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减余额开始&quot;</span>);</span><br><span class="line">        accountService.decrease(order.getUserId(),order.getMoney());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减余额结束&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//修改订单状态为已完成</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中修改订单状态开始&quot;</span>);</span><br><span class="line">        orderDao.update(order.getUserId(),<span class="number">0</span>);</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中修改订单状态结束&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;下单结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller类"><a href="#controller类" class="headerlink" title="controller类"></a>controller类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/order/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orderService.create(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;订单创建成功!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="config类"><a href="#config类" class="headerlink" title="config类"></a>config类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.jcvv.springcloud.dao&quot;)</span> <span class="comment">//表明mybatis和dao层相关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> DataSourceProxyConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Seata对数据源进行代理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>());</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="comment">//取消数据源的自动创建，而是使用自己定义的</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataOrderMain2001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SeataOrderMain2001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2、Seata之Storage-Module配置搭建"><a href="#5-2、Seata之Storage-Module配置搭建" class="headerlink" title="5-2、Seata之Storage-Module配置搭建"></a>5-2、Seata之Storage-Module配置搭建</h3><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-storage-service2002<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--nacos--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--feign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata-storage-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">jcvv_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://119.3.211.104:3306/seata_storage?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><p>将 seata/conf 下的 file.conf ，registry.conf 移到 rescources 目录下</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_12.png" alt=""></p><h4 id="主启动类-1"><a href="#主启动类-1" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SeataStorageMain2002</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataStorageMain2002</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SeataStorageMain2002.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="库存实体类"><a href="#库存实体类" class="headerlink" title="库存实体类"></a>库存实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 产品id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer total;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 已用库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer used;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 剩余库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer residue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dao接口及实现-1"><a href="#Dao接口及实现-1" class="headerlink" title="Dao接口及实现"></a>Dao接口及实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageDao</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(<span class="meta">@Param(&quot;productId&quot;)</span> Long productId, <span class="meta">@Param(&quot;count&quot;)</span> Integer count)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>StorageMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jcvv.springcloud.dao.StorageDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.jcvv.springcloud.domain.Storage&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;product_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;productId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total&quot;</span> <span class="attr">property</span>=<span class="string">&quot;total&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;used&quot;</span> <span class="attr">property</span>=<span class="string">&quot;used&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">property</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;decrease&quot;</span>&gt;</span></span><br><span class="line">        UPDATE t_storage</span><br><span class="line">        SET used    = used + #&#123;count&#125;,</span><br><span class="line">            residue = residue - #&#123;count&#125;</span><br><span class="line">        WHERE product_id = #&#123;productId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Service接口及实现-1"><a href="#Service接口及实现-1" class="headerlink" title="Service接口及实现"></a>Service接口及实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long productId, Integer count)</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(StorageServiceImpl.class);</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageDao storageDao;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long productId, Integer count)</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;storage-service中扣减库存开始&quot;</span>);</span><br><span class="line">        storageDao.decrease(productId,count);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;storage-service中扣减库存结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controller类"><a href="#Controller类" class="headerlink" title="Controller类"></a>Controller类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/storage/decrease&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">decrease</span><span class="params">(Long productId, Integer count)</span> &#123;</span><br><span class="line">        storageService.decrease(productId, count);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;扣减库存成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Config配置"><a href="#Config配置" class="headerlink" title="Config配置"></a>Config配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MyBatisConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.jcvv.springcloud.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> DataSourceProxyConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>());</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3、Seata之Account-Module配置搭建"><a href="#5-3、Seata之Account-Module配置搭建" class="headerlink" title="5-3、Seata之Account-Module配置搭建"></a>5-3、Seata之Account-Module配置搭建</h3><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-account-service2003<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--nacos--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--feign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2003</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata-account-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="comment"># 自定义事务组，需要和当时在 seata/conf/file.conf 中的一致</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">jcvv_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://119.3.211.104:3306/seata_account?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意，这是自定义的，原来的是mapper_locations</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure><p>将 seata/conf 下的 file.conf ，registry.conf 移到 rescources 目录下</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_13.png" alt=""></p><h4 id="主启动类-2"><a href="#主启动类-2" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SeataAccountMain2003</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataAccountMain2003</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        SpringApplication.run(SeataAccountMain2003.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="账号实体类"><a href="#账号实体类" class="headerlink" title="账号实体类"></a>账号实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总额度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal total;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 已用额度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal used;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 剩余额度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal residue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dao接口及实现-2"><a href="#Dao接口及实现-2" class="headerlink" title="Dao接口及实现"></a>Dao接口及实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减账户余额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId, <span class="meta">@Param(&quot;money&quot;)</span> BigDecimal money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AccountMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.springcloud.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.springcloud.domain.Account&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total&quot;</span> <span class="attr">property</span>=<span class="string">&quot;total&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;used&quot;</span> <span class="attr">property</span>=<span class="string">&quot;used&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">property</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;decrease&quot;</span>&gt;</span></span><br><span class="line">        UPDATE t_account</span><br><span class="line">        SET</span><br><span class="line">          residue = residue - #&#123;money&#125;,used = used + #&#123;money&#125;</span><br><span class="line">        WHERE</span><br><span class="line">          user_id = #&#123;userId&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Service接口及实现-2"><a href="#Service接口及实现-2" class="headerlink" title="Service接口及实现"></a>Service接口及实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减账户余额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money 金额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(AccountServiceImpl.class);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AccountDao accountDao;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减账户余额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long userId, BigDecimal money)</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-service中扣减账户余额开始&quot;</span>);</span><br><span class="line">        accountDao.decrease(userId,money);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-service中扣减账户余额结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controller类-1"><a href="#Controller类-1" class="headerlink" title="Controller类"></a>Controller类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AccountService accountService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减账户余额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/account/decrease&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span>&#123;</span><br><span class="line">        accountService.decrease(userId,money);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;扣减账户余额成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Config配置-1"><a href="#Config配置-1" class="headerlink" title="Config配置"></a>Config配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MyBatisConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.jcvv.springcloud.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> DataSourceProxyConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>());</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6、Seata之-GlobalTransactional验证"><a href="#6、Seata之-GlobalTransactional验证" class="headerlink" title="6、Seata之@GlobalTransactional验证"></a>6、Seata之@GlobalTransactional验证</h2><h3 id="6-1、正常情况演示"><a href="#6-1、正常情况演示" class="headerlink" title="6-1、正常情况演示"></a>6-1、正常情况演示</h3><p>下订单 -&gt; 减库存 -&gt; 扣余额 -&gt; 改（订单）状态</p><p>启动nacos，seata，及三个微服务</p><p>数据库初始情况：</p><p>库存表：</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_库存表.png" alt=""></p><p>订单表：</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_订单表.png" alt=""></p><p>账户表：</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_账户表.png" alt=""></p><p>正常下单</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100</span></span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_5.png" alt=""></p><p>数据库正常下单后状况：</p><p>库存表：</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_正常下单库存表.png" alt=""></p><p>订单表：</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_正常下单订单表.png" alt=""></p><p>账户表：</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_正常下单账户表.png" alt=""></p><h3 id="6-2、超时异常，没加-GlobalTransactional"><a href="#6-2、超时异常，没加-GlobalTransactional" class="headerlink" title="6-2、超时异常，没加@GlobalTransactional"></a>6-2、<strong>超时异常，没加@GlobalTransactional</strong></h3><p>AccountServiceImpl添加超时</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(AccountServiceImpl.class);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AccountDao accountDao;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扣减账户余额</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long userId, BigDecimal money)</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-service中扣减账户余额开始&quot;</span>);</span><br><span class="line">        <span class="comment">//模拟超时异常，全局事务回滚</span></span><br><span class="line">        <span class="comment">//暂停几秒钟线程</span></span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">30</span>); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125;</span><br><span class="line">        accountDao.decrease(userId,money);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-service中扣减账户余额结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OpenFeign的调用默认时间是1s以内，所以最后会抛异常。</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_超时异常.png" alt=""></p><p>数据库情况：</p><p>账户表：</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_超时异常账户表.png" alt=""></p><p>订单表： </p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_超时异常订单表.png" alt=""></p><p>库存表： </p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_超时异常库存表.png" alt=""></p><p><strong>故障情况</strong></p><ul><li>当库存和账户金额扣减后，订单状态并没有设置为已经完成，没有从零改为1</li><li>而且由于feign的重试机制，账户余额还有可能被多次扣减</li></ul><h3 id="6-3、超时异常，加了-GlobalTransactional"><a href="#6-3、超时异常，加了-GlobalTransactional" class="headerlink" title="6-3、超时异常，加了@GlobalTransactional"></a><strong>6-3、超时异常，加了@GlobalTransactional</strong></h3><p>用@GlobalTransactional标注OrderServiceImpl的create()方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建订单-&gt;调用库存服务扣减库存-&gt;调用账户服务扣减账户余额-&gt;修改订单状态</span></span><br><span class="line"><span class="comment">     * 简单说：</span></span><br><span class="line"><span class="comment">     * 下订单-&gt;减库存-&gt;减余额-&gt;改状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@GlobalTransactional(name = &quot;fsp-create-order&quot;,rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;下单开始&quot;</span>);</span><br><span class="line">        <span class="comment">//本应用创建订单</span></span><br><span class="line">        orderDao.create(order);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//远程调用库存服务扣减库存</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减库存开始&quot;</span>);</span><br><span class="line">        storageService.decrease(order.getProductId(),order.getCount());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减库存结束&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//远程调用账户服务扣减余额</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减余额开始&quot;</span>);</span><br><span class="line">        accountService.decrease(order.getUserId(),order.getMoney());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中扣减余额结束&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//修改订单状态为已完成</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中修改订单状态开始&quot;</span>);</span><br><span class="line">        orderDao.update(order.getUserId(),<span class="number">0</span>);</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-service中修改订单状态结束&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;下单结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>还是模拟AccountServiceImpl添加超时，下单后数据库数据并没有任何改变，记录都添加不进来，<strong>达到出异常，数据库回滚的效果</strong>。</p><h2 id="7、Seata之原理简介"><a href="#7、Seata之原理简介" class="headerlink" title="7、Seata之原理简介"></a>7、Seata之原理简介</h2><p>2019年1月份蚂蚁金服和阿里巴巴共同开源的分布式事务解决方案。</p><p>Simple Extensible Autonomous Transaction Architecture，简单可扩展自治事务框架。</p><p>2020起始，用1.0以后的版本。Alina Gingertail</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_6.png" alt=""></p><ul><li>TC (Transaction Coordinator) - 事务协调者</li><li>TM (Transaction Manager) - 事务管理器</li><li>RM (Resource Manager) - 资源管理器</li></ul><p><strong>分布式事务的执行流程</strong></p><ul><li>TM开启分布式事务(TM向TC注册全局事务记录) ;</li><li>按业务场景，编排数据库、服务等事务内资源(RM向TC汇报资源准备状态) ;</li><li>TM结束分布式事务，事务一阶段结束(TM通知TC提交/回滚分布式事务) ;</li><li>TC汇总事务信息，决定分布式事务是提交还是回滚；</li><li>TC通知所有RM提交/回滚资源，事务二阶段结束。</li></ul><p><strong>AT模式如何做到对业务的无侵入</strong></p><p>是什么</p><blockquote><p>前提</p><ul><li>基于支持本地 ACID 事务的关系型数据库。</li><li>Java 应用，通过 JDBC 访问数据库。</li></ul><p>整体机制</p><p>两阶段提交协议的演变：</p><ul><li>一阶段：业务数据和回滚日志记录在同一个本地事务中提交，释放本地锁和连接资源。</li><li>二阶段：<ul><li>提交异步化，非常快速地完成。</li><li>回滚通过一阶段的回滚日志进行反向补偿。</li></ul></li></ul></blockquote><p>一阶段加载</p><p>在一阶段，Seata会拦截“业务SQL”</p><ol><li>解析SQL语义，找到“业务SQL” 要更新的业务数据，在业务数据被更新前，将其保存成”before image”</li><li>执行“业务SQL” 更新业务数据，在业务数据更新之后,</li><li>其保存成”after image”，最后生成行锁。</li></ol><p>以上操作全部在一个数据库事务内完成, 这样保证了一阶段操作的原子性。</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_7.png" alt=""></p><p>二阶段提交 </p><p>二阶段如果顺利提交的话，因为”业务SQL”在一阶段已经提交至数据库，所以Seata框架只需将一阶段保存的快照数据和行锁删掉，完成数据清理即可。</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_8.png" alt=""></p><p>二阶段回滚</p><p>二阶段如果是回滚的话，Seata 就需要回滚一阶段已经执行的 “业务SQL”，还原业务数据。</p><p>回滚方式便是用”before image”还原业务数据；但在还原前要首先要校验脏写，对比“数据库当前业务数据”和”after image”。</p><p>如果两份数据完全一致就说明没有脏写， 可以还原业务数据，如果不一致就说明有脏写, 出现脏写就需要转人工处理。</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_9.png" alt=""></p><p>补充</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_10.png" alt=""></p><h2 id="8、seata遗留错误问题"><a href="#8、seata遗留错误问题" class="headerlink" title="8、seata遗留错误问题"></a>8、seata遗留错误问题</h2><p>报错如下：</p><p><code>0101 can not connect to 119.3.211.104:8091 cause:can not register RM,err:can not connect to services-server.</code></p><p>解决方式：</p><p>暂无解决，时好时坏</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sentinel实现熔断与限流</title>
      <link href="/2023/04/05/Sentinel%E5%AE%9E%E7%8E%B0%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81/"/>
      <url>/2023/04/05/Sentinel%E5%AE%9E%E7%8E%B0%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h1 id="Sentinel-实现熔断与限流"><a href="#Sentinel-实现熔断与限流" class="headerlink" title="Sentinel 实现熔断与限流"></a>Sentinel 实现熔断与限流</h1><h2 id="1、Sentinel-介绍"><a href="#1、Sentinel-介绍" class="headerlink" title="1、Sentinel 介绍"></a>1、Sentinel 介绍</h2><p><a href="https://github.com/alibaba/Sentinel">官方 Github</a></p><p><a href="https://sentinelguard.io/zh-cn/docs/introduction.html">官方文档</a></p><h3 id="1-1、是什么"><a href="#1-1、是什么" class="headerlink" title="1-1、是什么"></a>1-1、是什么</h3><p>随着微服务的流行，服务和服务之间的稳定性变得越来越重要。<font color='red'><strong>Sentinel 以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</strong></font></p><p>Sentinel 具有以下特征:</p><ul><li><strong>丰富的应用场景：</strong>Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</li><li><strong>完备的实时监控：</strong>Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</li><li><strong>广泛的开源生态：</strong>Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</li><li><strong>完善的 SPI 扩展点：</strong>Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</li></ul><p>Sentinel 的主要特性：<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel.png" alt=""></p><p>—句话解释，之前我们讲解过的<strong>Hystrix</strong>。</p><h3 id="2-2、Hystrix-与-Sentinel-比较"><a href="#2-2、Hystrix-与-Sentinel-比较" class="headerlink" title="2-2、Hystrix 与 Sentinel 比较"></a>2-2、Hystrix 与 Sentinel 比较</h3><p>Hystrix：</p><ul><li><p>需要我们程序员自己手工搭建监控平台</p></li><li><p>没有一套 web 界面可以给我们进行更加细粒度化得配置流控、速率控制、服务熔断、服务降级</p></li></ul><p>Sentinel：</p><ul><li>单独一个组件，可以独立出来。</li><li>直接界面化的细粒度统一配置。</li></ul><p>约定 &gt; 配置 &gt; 编码</p><p>都可以写在代码里面，但是我们本次还是大规模的学习使用配置和注解的方式，尽量少写代码</p><h2 id="2、Sentinel-下载安装运行"><a href="#2、Sentinel-下载安装运行" class="headerlink" title="2、Sentinel 下载安装运行"></a>2、Sentinel 下载安装运行</h2><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel">官方文档</a></p><p>服务使用中的各种问题：</p><ul><li><p>服务雪崩</p></li><li><p>服务降级</p></li><li>服务熔断</li><li>服务限流</li></ul><p>Sentinel 分为两个部分：</p><ul><li><p>核心库（Java 客户端）不依赖任何框架/库，能够运行于所有 Java 运行时环境，同时对 Dubbo / Spring Cloud 等框架也有较好的支持。</p></li><li><p>控制台（Dashboard）基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器。</p></li></ul><h4 id="2-1、安装步骤"><a href="#2-1、安装步骤" class="headerlink" title="2-1、安装步骤"></a>2-1、安装步骤</h4><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p><a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel2.png" alt=""></p><h4 id="运行命令"><a href="#运行命令" class="headerlink" title="运行命令"></a><strong>运行命令</strong></h4><p>前提：java8 环境 OK + 8080 端口不能被占用</p><p>运行命令：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard-<span class="number">1.7</span><span class="number">.1</span>.jar</span><br></pre></td></tr></table></figure><p>由于我的 8080 端口被占用，我换成了 8888 端口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard-<span class="number">1.7</span><span class="number">.1</span>.jar --server.port=<span class="number">8888</span></span><br></pre></td></tr></table></figure><h4 id="访问-sentinel-管理界面"><a href="#访问-sentinel-管理界面" class="headerlink" title="访问 sentinel 管理界面"></a><strong>访问 sentinel 管理界面</strong></h4><p><a href="http://localhost:8080，登录账号密码均为">http://localhost:8080，登录账号密码均为</a> sentinel</p><p><img src="" alt=""></p><h2 id="3、初始化演示工程"><a href="#3、初始化演示工程" class="headerlink" title="3、初始化演示工程"></a>3、初始化演示工程</h2><p>启动 Nacos8848 成功</p><h3 id="3-1、新建-cloudalibaba-sentinel-service8401"><a href="#3-1、新建-cloudalibaba-sentinel-service8401" class="headerlink" title="3-1、新建 cloudalibaba-sentinel-service8401"></a>3-1、新建 cloudalibaba-sentinel-service8401</h3><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-sentinel-service8401<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--         后续做Sentinel的持久化会用到的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-transport-simple-http<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos 依赖,Nacos Server 服务注册中心 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springboot整合Web组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日常通用jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="comment"># 服务注册中心 # sentinel注册进nacos</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">transport:</span></span><br><span class="line">                <span class="comment"># 配置 Sentinel Dashboard 的地址</span></span><br><span class="line">                <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">                <span class="comment"># 默认8719 ，如果端口被占用，端口号会自动 +1，直到找到未被占用的端口，提供给 sentinel 的监控端口</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">                <span class="attr">client-ip:</span> <span class="string">localhost</span> <span class="comment">#电脑ip地址</span></span><br><span class="line">            <span class="attr">eager:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MainApp8401</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp8401</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        System.setProperty(TransportConfig.HEARTBEAT_CLIENT_IP, &quot;localhost&quot;);</span></span><br><span class="line">        SpringApplication.run(MainApp8401.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a>controller 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> FlowLimitController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowLimitController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testB</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;...testB&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>空空如也，啥都没有</p><p>Sentinel 采用的懒加载说明：</p><p>执行一次访问即可：<a href="http://localhost:8401/testA、http://localhost:8401/testB">http://localhost:8401/testA、http://localhost:8401/testB</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel_test.png" alt=""></p><p>结论：sentinel8080 正在监控微服务 8401</p><h5 id="遇到问题"><a href="#遇到问题" class="headerlink" title="遇到问题"></a>遇到问题</h5><ul><li>问题 1</li></ul><p>​ 注意：<strong>云服务器</strong>的要开放 8719 端口，且<strong>项目也必须在服务器上</strong>。</p><p>​ <font color='red'><strong>百度一下，网上关于解决错误简直是胡言乱语。扯淡成分太多了，妈了个巴子的，害的我研究了一天</strong></font></p><p>​ 原因：要使用 sentinel，必须双方都能连通，而服务器网络 ping 不通本机网络</p><p>参考文章：<a href="https://huaweicloud.csdn.net/633113d9d3efff3090b51790.html">https://huaweicloud.csdn.net/633113d9d3efff3090b51790.html</a></p><ul><li>问题 2</li></ul><p>​ 遇到 timeout 之类的错误</p><p>​ 解决方式：添加<code>client-ip</code> 即 <code>sentinel.transport.client-ip:192.168.43.116</code> 其中这里的地址为项目启动设备的 ip 地址</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="comment"># 服务注册中心 # sentinel注册进nacos</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">transport:</span></span><br><span class="line">                <span class="comment"># 配置 Sentinel Dashboard 的地址</span></span><br><span class="line">                <span class="attr">dashboard:</span> <span class="number">192.168</span><span class="number">.43</span><span class="number">.116</span><span class="string">:8080</span></span><br><span class="line">                <span class="comment"># 默认8719 ，如果端口被占用，端口号会自动 +1，直到找到未被占用的端口，提供给 sentinel 的监控端口</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">                <span class="attr">client-ip:</span> <span class="number">192.168</span><span class="number">.43</span><span class="number">.116</span> <span class="comment">#电脑ip地址</span></span><br><span class="line">            <span class="attr">eager:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="4、流控规则"><a href="#4、流控规则" class="headerlink" title="4、流控规则"></a>4、流控规则</h2><h3 id="4-1、基本介绍"><a href="#4-1、基本介绍" class="headerlink" title="4-1、基本介绍"></a>4-1、基本介绍</h3><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel3.png" alt=""></p><h4 id="解释说明"><a href="#解释说明" class="headerlink" title="解释说明"></a>解释说明</h4><ul><li><p>资源名：唯一名称，默认请求路径</p></li><li><p>针对来源：sentinel 可以针对调用者进行限流，填写微服务名，默认 default（不区分来源）</p></li><li><p>阈值类型/单机值：</p><ul><li><p>QPS（每秒钟的请求数量）：当调用该 api 就 QPS 达到阈值的时候，进行限流</p></li><li><p>线程数．当调用该 api 的线程数达到阈值的时候，进行限流</p></li></ul></li><li><p>是否集群：不需要集群</p></li><li><p>流控模式：</p><ul><li><p>直接：api 达到限流条件时，直接限流。分为 QPS 和线程数</p></li><li><p>关联：当关联的资源达到阈值时，就限流自己。</p></li><li><p>链路：只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流）【api 级别的针对来源】</p></li></ul></li><li><p>流控效果：</p><ul><li>快速失败：直接抛异常</li><li>warm up：根据 codeFactor（冷加载因子，默认 3）的值，从阈值 codeFactor，经过预热时长，才达到设置的 QPS 阈值</li><li>排队等待：匀速排毒，让请求以匀速通过，阈值类型必须设置为 QPS，否则无效</li></ul></li></ul><h4 id="QPS-和线程数的区别"><a href="#QPS-和线程数的区别" class="headerlink" title="QPS 和线程数的区别"></a>QPS 和线程数的区别</h4><ul><li>QPS 类似于银行的保安：所有的请求到 Sentinel 后，他会根据阈值放行，超过报错</li><li>线程数类似于银行的窗口：所有的请求会被放进来，但如果阈值设置为 1，那么其他的请求就会报错也就是，银行里只有一个窗口，一个人在办理业务中，其他人跑过来则会告诉你“现在不行，没到你”</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel4.png" alt=""></p><h4 id="重要属性"><a href="#重要属性" class="headerlink" title="重要属性"></a><strong>重要属性</strong></h4><div class="table-container"><table><thead><tr><th>Field</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>resource</td><td>资源名，资源名是限流规则的作用对象</td><td></td></tr><tr><td>count</td><td>限流阈值</td><td></td></tr><tr><td>grade</td><td>限流阈值类型，QPS 模式（1）或并发线程数模式（0）</td><td>QPS 模式</td></tr><tr><td>limitApp</td><td>流控针对的调用来源</td><td>default，代表不区分调用来源</td></tr><tr><td>strategy</td><td>调用关系限流策略：直接、链路、关联</td><td>根据资源本身（直接）</td></tr><tr><td>controlBehavior</td><td>流控效果（直接拒绝/WarmUp/匀速+排队等待），不支持按调用关系限流</td><td>直接拒绝</td></tr><tr><td>clusterMode</td><td>是否集群限流</td><td>否</td></tr></tbody></table></div><h3 id="4-2、流控模式"><a href="#4-2、流控模式" class="headerlink" title="4-2、流控模式"></a>4-2、流控模式</h3><h4 id="直接（默认）"><a href="#直接（默认）" class="headerlink" title="直接（默认）"></a><strong>直接（默认）</strong></h4><ul><li>直接-&gt;快速失败：系统默认</li><li>配置及说明：表示 1 秒钟内查询 1 次就是 OK，若超过次数 1，就直接-快速失败，报默认错误</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel5.png" alt=""><br>测试</p><p>访问 testB 成功</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel5_2.png" alt=""></p><p>思考</p><p>直接调用默认报错信息，技术方面 OK，但是否应该有我们自己的后续处理？类似有个 fallback 的兜底方法？</p><h4 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h4><p>当关联的资源达到阈值时，就限流自己<br>当与 A 关联的资源 B 达到阀值后，就限流 A 自己<br><strong>设置 testA</strong></p><p>当关联资源/testB 的 qps 阀值超过 1 时，就限流/testA 的 Rest 访问地址，<strong>当关联资源到阈值后限制配置好的资源名。</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel7.png" alt=""></p><p>测试</p><p>访问 testB 成功</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel7_2.png" alt=""></p><p>postman 里新建多线程集合组：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel8.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel8_2.png" alt=""></p><p>Run：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel9.png" alt=""></p><p>20 个线程，每隔 0.3s 访问一次</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel9_2.png" alt=""></p><p>运行后发现 testA 挂了，点击访问：<a href="http://localhost:8401/testA">http://localhost:8401/testA</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel9_3.png" alt=""></p><h4 id="链路"><a href="#链路" class="headerlink" title="链路"></a>链路</h4><p>只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就进行限流)【API 级别的针对来源】</p><h3 id="4-3、流控效果"><a href="#4-3、流控效果" class="headerlink" title="4-3、流控效果"></a>4-3、流控效果</h3><h4 id="快速失败（默认的流控处理）"><a href="#快速失败（默认的流控处理）" class="headerlink" title="快速失败（默认的流控处理）"></a>快速失败（默认的流控处理）</h4><p>直接失败，抛出异常：Blocked by Sentinel (flow limiting)</p><h4 id="预热"><a href="#预热" class="headerlink" title="预热"></a>预热</h4><p>Warm Up（<font color='red'><strong>RuleConstant.CONTROL_BEHAVIOR_WARM_UP</strong></font>）方式，即预热/冷启动方式。当系统长期处于低水位的情况下，当流量突然增加时，直接把系统拉升到高水位可能瞬间把系统压垮。通过”冷启动”，让通过的流量缓慢增加，在一定时间内逐渐增加到阈值上限，给冷系统一个预热的时间，避免冷系统被压垮。详细文档可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/限流---冷启动">流量控制 - Warm Up 文档</a>，具体的例子可参见<a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/WarmUpFlowDemo.java">WarmUpFlowDemo</a></p><p>通常冷启动的过程系统允许通过的 QPS 曲线如下图所示：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel_qps.png" alt=""></p><h4 id="WarmUp-配置"><a href="#WarmUp-配置" class="headerlink" title="WarmUp 配置"></a>WarmUp 配置</h4><p>默认 coldFactor 为 3，即请求 QPS 从(threshold / 3) 开始，经多少预热时长才逐渐升至设定的 QPS 阈值</p><p>系统初始化的阀值为 10 / 3 约等于 3，即阀值刚开始为 3；然后过了 5 秒后阀值才慢慢升高恢复到 10。效果为：开始访问 localhost:/testA 时每秒请求别超过 10/3 个才能正常访问，5 秒后可以接受的请求可以达到每秒 10 次。<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel10.png" alt=""></p><p><strong>应用场景</strong></p><p>秒杀系统在开启的瞬间，会有很多流量上来，很有可能把系统打死，预热方式就是把为了保护系统，可慢慢的把流量放进来，慢慢的把阀值增长到设置的阀值</p><h4 id="排队等待"><a href="#排队等待" class="headerlink" title="排队等待"></a>排队等待</h4><p>匀速排队，让请求以均匀的速度通过，阀值类型必须设成 QPS，否则无效</p><p>设置含义：/testA 每秒 1 次请求，超过的话就排队等待，等待的超时时间为 20000 毫秒<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel11.png" alt=""></p><p>说明：匀速排队，阈值必须设置为 QPS</p><p>匀速排队（<font color='red'><strong>RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER</strong></font>）方式会严格控制请求通过的间隔时间，也即是让请求以均匀的速度通过，对应的是漏桶算法。详细文档可以参考<a href="https://github.com/alibaba/Sentinel/wiki/流量控制-匀速排队模式">流量控制 - 匀速器模式</a> ，具体的例子可以参见 <a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/PaceFlowDemo.java">PaceFlowDemo</a>。</p><p>该方式的作用如下图所示：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel12.png" alt=""></p><h2 id="5、降级规则"><a href="#5、降级规则" class="headerlink" title="5、降级规则"></a>5、降级规则</h2><h3 id="5-1、熔断降级概述"><a href="#5-1、熔断降级概述" class="headerlink" title="5-1、熔断降级概述"></a>5-1、熔断降级概述</h3><p>除了流量控制以外，对调用链路中不稳定的资源进行熔断降级也是保障高可用的重要措施之一。一个服务常常会调用别的模块，可能是另外的一个远程服务、数据库，或者第三方 API 等。例如，支付的时候，可能需要远程调用银联提供的 API；查询某个商品的价格，可能需要进行数据库查询。然而，这个被依赖服务的稳定性是不能保证的。如果依赖的服务出现了不稳定的情况，请求的响应时间变长，那么调用服务的方法的响应时间也会变长，线程会产生堆积，最终可能耗尽业务自身的线程池，服务本身也变得不可用。</p><p>现代微服务架构都是分布式的，由非常多的服务组成。不同服务之间相互调用，组成复杂的调用链路。以上的问题在链路调用中会产生放大的效果。复杂链路上的某一环不稳定，就可能会层层级联，最终导致整个链路都不可用。因此我们需要对不稳定的<strong>弱依赖服务调用</strong>进行熔断降级，暂时切断不稳定调用，避免局部不稳定因素导致整体的雪崩。熔断降级作为保护自身的手段，通常在客户端（调用端）进行配置。</p><h3 id="5-2、降级策略介绍"><a href="#5-2、降级策略介绍" class="headerlink" title="5-2、降级策略介绍"></a>5-2、降级策略介绍</h3><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel13.png" alt=""></p><p>RT（平均响应时间，秒级）</p><ul><li><p>平均响应时间<strong>超出阈值</strong>且<strong>在时间窗口内通过的请求&gt;=5</strong>，两个条件同时满足后触发降级</p></li><li><p>窗口期过后关闭断路器</p></li><li>RT 最大 4900（更大的需要通过-Dcsp.sentinel.statistic.max.rt=XXXX 才能生效）</li></ul><p>异常比列（秒级）</p><ul><li><strong>QPS &gt;= 5 且异常比例（秒级统计）超过阈值时</strong>，触发降级；时间窗口结束后，关闭降级</li></ul><p>异常数（分钟级）</p><ul><li>异常数（分钟统计）超过阈值时，触发降级；时间窗口结束后，关闭降级</li></ul><p>进一步说明：</p><p>Sentinel 熔断降级会在调用链路中某个资源出现不稳定状态时（例如调用超时或异常比例升高），对这个资源的调用进行限制，让请求快速失败，避免影响到其它的资源而导致级联错误</p><p>当资源被降级后，在接下来的降级时间窗口之内，对该资源的调用都自动熔断（默认行为是抛出 DegradeException）</p><p>Sentinel 的断路器是没有半开状态的。(Sentinei 1.8.0 已有半开状态)</p><p>半开的状态系统自动去检测是否请求有异常，没有异常就关闭断路器恢复使用；有异常则继续打开断路器不可用。具体可以参考 Hystrix</p><h3 id="5-3、RT"><a href="#5-3、RT" class="headerlink" title="5-3、RT"></a>5-3、RT</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><blockquote><p>平均响应时间(<font color='red'>DEGRADE_GRADE_RT</font>)：当 1s 内持续进入 5 个请求，对应时刻的平均响应时间（秒级）均超过阈值（ <font color='red'>count</font>，以 ms 为单位），那么在接下的时间窗口（<font color='red'>DegradeRule</font>中的<font color='red'>timeWindow</font>，以 s 为单位）之内，对这个方法的调用都会自动地熔断(抛出<font color='red'>DegradeException</font> )。注意 Sentinel 默认统计的 RT 上限是 4900 ms，超出此阈值的都会算作 4900ms，若需要变更此上限可以通过启动配置项<font color='red'>-Dcsp.sentinel.statistic.max.rt=xxx</font>来配置。</p></blockquote><p><strong>注意</strong>：Sentinel 1.7.0 才有<strong>平均响应时间</strong>（<code>DEGRADE_GRADE_RT</code>），Sentinel 1.8.0 的没有这项，取而代之的是<strong>慢调用比例</strong> (<code>SLOW_REQUEST_RATIO</code>)。</p><blockquote><p>慢调用比例 (<font color='red'>SLOW_REQUEST_RATIO</font>)：选择以慢调用比例作为阈值，需要设置允许的慢调用 RT（即最大的响应时间），请求的响应时间大于该值则统计为慢调用。当单位统计时长（<font color='red'>statIntervalMs</font>）内请求数目大于设置的最小请求数目，并且慢调用的比例大于阈值，则接下来的熔断时长内请求会自动被熔断。经过熔断时长后熔断器会进入探测恢复状态（HALF-OPEN 状态），若接下来的一个请求响应时间小于设置的慢调用 RT 则结束熔断，若大于设置的慢调用 RT 则会再次被熔断。熔断降级 · <a href="https://github.com/alibaba/Sentinel/wiki/熔断降级#熔断策略">熔断降级 · alibaba/Sentinel Wiki · GitHub</a></p></blockquote><p>接下来讲解 Sentinel 1.7.0 的。</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel14.png" alt=""></p><h4 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h4><p>在 controller 中加入 textD</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testD</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;testD 测试RT&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testD&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel15.png" alt=""></p><p>jmeter 压测：永远一秒钟打进来 10 个线程（大于 5 个了）调用 testD</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel16.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel16_2.png" alt=""></p><p>压测时访问 /testD</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel17.png" alt=""></p><p>停止压测后：`</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel17_2.png" alt=""></p><p>结论：</p><p>按照上述配置，永远一秒钟打进来 10 个线程（大于 5 个了）调用 testD，我们希望 200 毫秒处理完本次任务，如果超过 200 毫秒还没处理完，在未来 1 秒钟的时间窗口内，断路器打开(保险丝跳闸)微服务不可用，保险丝跳闸断电了，后续停止 jmeter，没有这么大的访问量了，断路器关闭(保险丝恢复)，微服务恢复正常。</p><h3 id="5-4、异常比例"><a href="#5-4、异常比例" class="headerlink" title="5-4、异常比例"></a>5-4、异常比例</h3><h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><blockquote><p>异常比例(<font color='red'>DEGRADE_GRADE_EXCEPTION_RATIO</font>)：当资源的每秒请求量 &gt;= 5，并且每秒异常总数占通过量的比值超过阈值（<font color='red'> DegradeRule</font>中的 <font color='red'>count</font>）之后，资源进入降级状态，即在接下的时间窗口( <font color='red'>DegradeRule</font> 中的 <font color='red'>timeWindow</font>，以 s 为单位）之内，对这个方法的调用都会自动地返回。异常比率的阈值范围是<font color='red'>[0.0, 1.0]</font>，代表 0% -100%。</p></blockquote><p><strong>注意</strong>，与 Sentinel 1.8.0 相比，有些不同（Sentinel 1.8.0 才有的半开状态），Sentinel 1.8.0 的如下：</p><blockquote><p>异常比例 (<font color='red'>ERROR_RATIO</font>)：当单位统计时长（<font color='red'>statIntervalMs</font>）内请求数目大于设置的最小请求数目，并且异常的比例大于阈值，则接下来的熔断时长内请求会自动被熔断。经过熔断时长后熔断器会进入探测恢复状态（HALF-OPEN 状态），若接下来的一个请求成功完成（没有错误）则结束熔断，否则会再次被熔断。异常比率的阈值范围是<font color='red'> [0.0, 1.0]</font>，代表 0% - 100%。<a href="https://github.com/alibaba/Sentinel/wiki/熔断降级#熔断策略">熔断降级 · alibaba/Sentinel Wiki · GitHub</a></p></blockquote><p>接下来讲解 Sentinel 1.7.0 的。</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel18.png" alt=""></p><h4 id="实操-1"><a href="#实操-1" class="headerlink" title="实操"></a>实操</h4><p>在 controller 中加入 textE</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testE</span><span class="params">()</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;testE 测试异常数&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testE&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel19.png" alt=""></p><p>单独一次访问：<a href="http://localhost:8401/testE">http://localhost:8401/testE</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel19_1.png" alt=""></p><p>jmeter 压测后：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel19_2.png" alt=""></p><p>结论</p><p>按照上述配置，单独访问一次，必然来一次报错一次(int age = 10/0)，调一次错一次；开启 jmeter 后，直接高并发发送请求，多次调用达到我们的配置条件了。</p><p>断路器开启(保险丝跳闸)，微服务不可用了，不再报错 error 而是服务降级了</p><h3 id="5-5、异常数"><a href="#5-5、异常数" class="headerlink" title="5-5、异常数"></a>5-5、异常数</h3><h4 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a><strong>介绍</strong></h4><blockquote><p>异常数( <font color='red'>DEGRADE_GRADF_EXCEPTION_COUNT</font> )：当资源近 1 分钟的异常数目超过阈值之后会进行熔断。注意由于统计时间窗口是<strong>分钟级别</strong>的，若<font color='red'>timeWindow</font>小于 60s，则结束熔断状态后可能再进入熔断状态。</p><p>说明：假设时间窗口期为 10 秒，设置的异常数不能超过 5，统计阶段第 1 秒的时候有 5 个异常，服务熔断后进入时间窗口期，时间窗口期结束，但是一分钟还没结束，那么此时的异常数还是 5 个，又进入熔断状态。</p></blockquote><p>注意，与 Sentinel 1.8.0 相比，有些不同（Sentinel 1.8.0 才有的半开状态），Sentinel 1.8.0 的如下：</p><blockquote><p>异常数 (<font color='red'>ERROR_COUNT</font>)：当单位统计时长内的异常数目超过阈值之后会自动进行熔断。经过熔断时长后熔断器会进入探测恢复状态（HALF-OPEN 状态），若接下来的一个请求成功完成（没有错误）则结束熔断，否则会再次被熔断。</p></blockquote><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel20‘.png" alt=""></p><p>接下来讲解 Sentinel 1.7.0 的。</p><p><strong>异常数是按照分钟统计的，时间窗口一定要大于等于 60 秒</strong>。</p><h4 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h4><p>配置：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel21.png" alt=""></p><p>测试：</p><p>一到五次访问会报错，第六次访问后会服务降级，直到时间窗口期结束，服务才开始报错</p><h2 id="6、热点-key-限流"><a href="#6、热点-key-限流" class="headerlink" title="6、热点 key 限流"></a>6、热点 key 限流</h2><h3 id="6-1、基本介绍"><a href="#6-1、基本介绍" class="headerlink" title="6-1、基本介绍"></a>6-1、基本介绍</h3><p>何为热点：热点即经常访问的数据，很多时候我们希望统计或者限制某个热点数据中访问频次最高的 Top N 数据，并对其访问进行限流或者其它操作：</p><ul><li>商品 ID 为参数，统计一段时间内最常购买的商品 ID 并进行限制</li><li>用户 ID 为参数，针对一段时间内频繁访问的用户 ID 进行限制</li></ul><p>热点参数限流会统计传入参数中的热点参数，并根据配置的限流阈值与模式，对包含热点参数的资源调用进行限流。热点参数限流可以看做是一种特殊的流量控制，仅对包含热点参数的资源调用生效。<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel22.png" alt=""></p><p>Sentinel 利用 LRU 策略统计最近最常访问的热点参数，结合令牌桶算法来进行参数级别的流控。热点参数限流支持集群模式。<a href="https://github.com/alibaba/Sentinel/wiki/热点参数限流#overview">热点参数限流 · alibaba/Sentinel Wiki · GitHub</a></p><p><strong>承上启下复习</strong></p><p>兜底方法，分为 系统默认 和 客户自定义 两种。</p><p>之前的案例，限流出问题后，都是用 sentinel 系统默认的提示: Blocked by Sentinel (flow limiting)</p><p>我们能不能自定？类似 hystrix，某个方法出问题了，就找对应的兜底降级方法?</p><p>结论 - <strong>从 HystrixCommand 到@SentinelResource</strong></p><h3 id="6-2、实操"><a href="#6-2、实操" class="headerlink" title="6-2、实操"></a>6-2、实操</h3><p>在 controller 中加入：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testHotKey&quot;,blockHandler = &quot;deal_testHotKey&quot;)</span><span class="comment">//value可以不与getmapping一样，但必须唯一。当新增热点规则时，资源名有斜杠，找的是GetMapping，没有则找的是SentinelResource</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testHotKey</span><span class="params">(<span class="meta">@RequestParam(value = &quot;p1&quot;,required = false)</span>String p1,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestParam(value = &quot;p2&quot;,required = false)</span>String p2)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKty&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deal_testHotKey</span><span class="params">(String p1, String p2, BlockException exception)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKty,o(T~~T)o&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>@SentinelResource(value = “testHotKey”)异常打到了前台用户界面看到，不友好</li><li>@SentinelResource(value = “testHotKey”,blockHandler = “deal_testHotKey”)方法 testHotKey 里面第一个参数只要 QPS 超过每秒 1 次，马上降级处理，异常用了我们自己定义的兜底方法。</li><li><font color='red'>**当新增热点规则时，资源名有斜杠，找的是 GetMapping，没有则找的是 SentinelResource**</font></li></ul><p>配置：<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel23.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel24.png" alt=""></p><ul><li><p>限流模式只支持 QPS 模式，固定写死了。（这才叫热点）</p></li><li><p>@SentinelResource 注解的方法参数索引，0 代表第一个参数，1 代表第二个参数，以此类推，单机阀值以及统计窗口时长表示在此窗口时间超过阀值就限流。</p></li></ul><p>上面的抓图表示第一个参数有值的话，1 秒的 QPS 为 1，超过就限流，限流后调用 deal_testHotKey 支持方法。</p><p>测试：<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel25.png" alt=""></p><h3 id="6-3、参数例外项"><a href="#6-3、参数例外项" class="headerlink" title="6-3、参数例外项"></a>6-3、参数例外项</h3><p>上述案例演示了第一个参数 p1，当 QPS 超过 1 秒 1 次点击后马上被限流</p><p>特例情况：我们期望 p1 参数当它是某个特殊值时，它的限流值和平时不一样</p><p>特例：假如当 p1 的值等于 5 时，它的阈值可以达到 200</p><blockquote><p>热点参数的注意点，参数必须是基本类型或者 String</p></blockquote><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel26.png" alt=""></p><p>测试：</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel27.png" alt=""></p><p>说明：</p><ul><li>@SentinelResource ：处理的是 Sentine 控制台配置的违规情况，有 blockHandler 方法配置的兜底处理</li><li>@RuntimeException：int age=10/0，这个是 java 运行时报出的运行时异异常 RunTimeException，@SentineResource 不管</li></ul><h2 id="7、系统规则"><a href="#7、系统规则" class="headerlink" title="7、系统规则"></a>7、系统规则</h2><h3 id="7-1、各项配置参数说明"><a href="#7-1、各项配置参数说明" class="headerlink" title="7-1、各项配置参数说明"></a>7-1、各项配置参数说明</h3><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel28.png" alt=""></p><h3 id="7-2、-SentinelResource-配置"><a href="#7-2、-SentinelResource-配置" class="headerlink" title="7-2、@SentinelResource 配置"></a>7-2、@SentinelResource 配置</h3><h4 id="按资源名称限流-后续处理"><a href="#按资源名称限流-后续处理" class="headerlink" title="按资源名称限流+后续处理"></a><strong>按资源名称限流+后续处理</strong></h4><p>pom 文件增加</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>新增 controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/byResource&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byResource&quot;,blockHandler = &quot;handleException&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">byResource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;按资源名称限流测试OK&quot;</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>,<span class="string">&quot;serial001&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleException</span><span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>,exception.getClass().getCanonicalName()+<span class="string">&quot;\t 服务不可用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置流控规则</p><p>簇点链路：byResource 是资源</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel29.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel30.png" alt=""></p><p>表示 1 秒钟内查询次数大于 1，就跑到我们自定义的兜底方法</p><p>测试</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel31.png" alt=""></p><p><strong>额外问题</strong></p><p>此时关闭服务 8401 看看：Sentinel 控制台，流控规则消失了？？？？？临时/持久？</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel32.png" alt=""></p><h4 id="按照-Url-地址限流-后续处理"><a href="#按照-Url-地址限流-后续处理" class="headerlink" title="按照 Url 地址限流+后续处理"></a><strong>按照 Url 地址限流+后续处理</strong></h4><p>通过访问的 URL 来限流，会返回 Sentinel 自带默认的限流处理信息</p><p>RateLimitController 新增</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/byUrl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">byUrl</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;按url限流测试&quot;</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>,<span class="string">&quot;serial002&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>簇点链路：byUrl 是资源</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel33.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel34.png" alt=""></p><p>测试</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel35.png" alt=""></p><h4 id="上面兜底方案面临的问题"><a href="#上面兜底方案面临的问题" class="headerlink" title="上面兜底方案面临的问题"></a>上面兜底方案面临的问题</h4><ul><li>系统默认的，没有体现我们自己的业务要求</li><li><p>依照现有条件，我们自定义的处理方法又和业务代码耦合在一块，不直观</p></li><li><p>每个业务方法都添加一个兜底的，那代码膨胀加剧</p></li><li><p>全局统一的处理方法没有体现</p></li></ul><h4 id="客户自定义限流处理逻辑"><a href="#客户自定义限流处理逻辑" class="headerlink" title="客户自定义限流处理逻辑"></a>客户自定义限流处理逻辑</h4><p>创建 CustomerBlockHandler 类用于自定义限流处理逻辑</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerBlockHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title function_">handlerException1</span><span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">4444</span>,<span class="string">&quot;按用户自定义,global handlerException.......1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title function_">handlerException2</span><span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">4444</span>,<span class="string">&quot;按用户自定义,global handlerException.......2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller 新增</p><p>找 CustomerBlockHandler 类里的 handleException2 方法进行兜底处理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/customerBlockHandler&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;customerBlockHandler&quot;,</span></span><br><span class="line"><span class="meta">             blockHandlerClass = CustomerBlockHandler.class,</span></span><br><span class="line"><span class="meta">             blockHandler = &quot;handlerException2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">customerBlockHandler</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;按用户自定义&quot;</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>,<span class="string">&quot;serial003&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><p>对资源名称流控</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel36.png" alt=""></p><p>对 URL 地址流控</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel37.png" alt=""></p><p>在设置了 URL 地址流控的前提下，设置按资源名称流控无效</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel38.png" alt=""></p><blockquote><p>URL 地址流控优先级大于资源名称流控</p></blockquote><h4 id="更多注解属性说明"><a href="#更多注解属性说明" class="headerlink" title="更多注解属性说明"></a>更多注解属性说明</h4><p>@SentinelResource 注解最主要的两个用法：限流控制和熔断降级的具体使用案例介绍完了。另外，该注解还有一些其他更精细化的配置，比如忽略某些异常的配置、默认降级函数等等，具体可见如下说明：</p><ul><li>value：资源名称，必需项（不能为空）</li><li>entryType：entry 类型，可选项（默认为 EntryType.OUT）</li><li>fallback：fallback 函数名称，可选项，用于在抛出异常的时候提供 fallback 处理逻辑。fallback 函数可以针对所有类型的异常（除了 exceptionsToIgnore 里面排除掉的异常类型）进行处理。fallback 函数签名和位置要求： 返回值类型必须与原函数返回值类型一致；方法参数列表需要和原函数一致，或者可以额外多一个 Throwable 类型的参数用于接收对应的异常。</li><li>fallback 函数默认需要和原方法在同一个类中。若希望使用其他类的函数，则可以指定 fallbackClass 为对应的类的 Class 对象，注意对应的函数必需为 static 函数，否则无法解析。 defaultFallback（since 1.6.0）：默认的 fallback 函数名称，可选项，通常用于通用的 fallback 逻辑（即可以用于很多服务或方法）。默认 fallback 函数可以针对所有类型的异常（除了 exceptionsToIgnore 里面排除掉的异常类型）进行处理。若同时配置了 fallback 和 defaultFallback，则只有 fallback 会生效。defaultFallback 函数签名要求：返回值类型必须与原函数返回值类型一致；</li><li>方法参数列表需要为空，或者可以额外多一个 Throwable 类型的参数用于接收对应的异常。</li><li>defaultFallback 函数默认需要和原方法在同一个类中。若希望使用其他类的函数，则可以指定 fallbackClass 为对应的类的 Class 对象，注意对应的函数必需为 static 函数，否则无法解析。</li><li>exceptionsToIgnore（since 1.6.0）：用于指定哪些异常被排除掉，不会计入异常统计中，也不会进入 fallback 逻辑中，而是会原样抛出。</li></ul><h3 id="7-3、服务熔断功能"><a href="#7-3、服务熔断功能" class="headerlink" title="7-3、服务熔断功能"></a>7-3、服务熔断功能</h3><p>sentinel 整合 ribbon+openFeign+fallback</p><h4 id="Ribbon-系列——提供者-9003-9004"><a href="#Ribbon-系列——提供者-9003-9004" class="headerlink" title="Ribbon 系列——提供者 9003/9004"></a><strong>Ribbon 系列——提供者 9003/9004</strong></h4><p>启动 nacos 和 sentinel，新建 cloudalibaba-provider-payment9003/9004 两个一样的做法</p><h5 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-provider-payment9003<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos 依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- springboot整合Web组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日常通用jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="applition-yml"><a href="#applition-yml" class="headerlink" title="applition.yml"></a><strong>applition.yml</strong></h5><ul><li>9003</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9003</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>9004</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9004</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="主启动类-1"><a href="#主启动类-1" class="headerlink" title="主启动类"></a><strong>主启动类</strong></h5><ul><li>9003</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain9003</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9003</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9003.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>9004</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain9004</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9004</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9004.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="controller-层-1"><a href="#controller-层-1" class="headerlink" title="controller 层"></a><strong>controller 层</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//模拟sql查询</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Long, Payment&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        hashMap.put(<span class="number">1L</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">1L</span>, <span class="string">&quot;xcxcxcxcxcxcxcxcxcxcxcxcxc11111111&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">2L</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2L</span>, <span class="string">&quot;xcxcxcxcggggggggg2222222222222222&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">3L</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">3L</span>, <span class="string">&quot;xcxcxcxccxxcxcfafdgdgdsgdsgds33333&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> hashMap.get(id);</span><br><span class="line">        <span class="type">CommonResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;from mysql, server port : &quot;</span> + serverPort + <span class="string">&quot; ,查询成功&quot;</span>, payment);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Ribbon-系列——消费者-84"><a href="#Ribbon-系列——消费者-84" class="headerlink" title="Ribbon 系列——消费者 84"></a><strong>Ribbon 系列——消费者 84</strong></h4><p>新建 cloudalibaba-consumer-nacos-order84</p><h5 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-consumer-nacos-order84<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--         后续做Sentinel的持久化会用到的依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-transport-simple-http<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos 依赖,Nacos Server 服务注册中心 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springboot整合Web组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日常通用jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a><strong>application.yml</strong></h5><p>如果 8080 端口被占用，sentinel 的端口改成了 8888</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel.jar --server.port=<span class="number">8888</span></span><br><span class="line"></span><br><span class="line">sentinel.transport.dashboard: <span class="number">192.168</span><span class="number">.1</span><span class="number">.159</span>:<span class="number">8888</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">84</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">transport:</span></span><br><span class="line">                <span class="comment">#配置Sentinel dashboard地址</span></span><br><span class="line">                <span class="attr">dashboard:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.159</span><span class="string">:8080</span></span><br><span class="line">                <span class="comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">                <span class="attr">client-ip:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.159</span></span><br><span class="line">            <span class="attr">eager:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br></pre></td></tr></table></figure><h5 id="主启动类-2"><a href="#主启动类-2" class="headerlink" title="主启动类"></a>主启动类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain84</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain84</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain84.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="controller-层-2"><a href="#controller-层-2" class="headerlink" title="controller 层"></a><strong>controller 层</strong></h5><p>fallback 管运行异常、blockHandler 管配置违规</p><h5 id="①-无配置"><a href="#①-无配置" class="headerlink" title="① 无配置"></a><strong>① 无配置</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL=<span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;)</span><span class="comment">//没有配置</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...非法参数异常&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(id &gt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...空指针异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>测试：</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_1_2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_1_3.png" alt=""></p><h5 id="②-只配置-fallback"><a href="#②-只配置-fallback" class="headerlink" title="② 只配置 fallback"></a><strong>② 只配置 fallback</strong></h5><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_2_2.png" alt=""></p><h5 id="③-只配置-blockHandler"><a href="#③-只配置-blockHandler" class="headerlink" title="③ 只配置 blockHandler"></a><strong>③ 只配置 blockHandler</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;)//没有配置</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handleFallback&quot;) //fallback只处理业务异常</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;, blockHandler = &quot;blockHandler&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...非法参数异常&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id &gt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...空指针异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//兜底方法</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleFallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, Throwable e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;---兜底异常handlerFallback,exception内容：&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">blockHandler</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, BlockException e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinel限流,blockException:&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>本例 sentinel 需配置：</p><p>簇点链路：</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3.png" alt=""></p><p>服务降级：</p><p>异常超过 2 次后，断路器打开</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_2.png" alt=""></p><p><strong>测试</strong></p><p>第一次和第二次访问还是报异常：</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_3.png" alt=""></p><p>第三次访问</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_4.png" alt=""></p><p>时间窗口期 10s 过了之后：又恢复异常</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_5.png" alt=""></p><h5 id="④fallback-和-blockHandler-都配置"><a href="#④fallback-和-blockHandler-都配置" class="headerlink" title="④fallback 和 blockHandler 都配置"></a><strong>④fallback 和 blockHandler 都配置</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL=<span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;,fallback = &quot;handleFallback&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...非法参数异常&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(id &gt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...空指针异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//兜底方法</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleFallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id, Throwable e)</span>&#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;---兜底异常handlerFallback,exception内容：&quot;</span>+e.getMessage(),payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">blockHandler</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id, BlockException e)</span>&#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinel限流,blockException:&quot;</span>+e.getMessage(),payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本例 sentinel 需配置：</p><p>簇点链路：</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4.png" alt=""></p><p>服务降级：</p><p>异常超过 2 次后，断路器打开</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4_2.png" alt=""></p><p><strong>测试</strong></p><p>第一次和第二次访问：</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4_3.png" alt=""></p><p>第三次访问</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4_4.png" alt=""></p><p>结论：</p><p>若 blockHandler 和 fallback 都进行了配置，则被限流降级而抛出 BlockException 时只会进入 blockHandler 处理逻辑</p><h5 id="忽略异常"><a href="#忽略异常" class="headerlink" title="忽略异常"></a><strong>忽略异常</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;)//没有配置</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handleFallback&quot;) //fallback只处理业务异常</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;, blockHandler = &quot;blockHandler&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handleFallback&quot;,</span></span><br><span class="line"><span class="meta">            blockHandler = &quot;blockHandler&quot;, exceptionsToIgnore = &#123;IllegalArgumentException.class&#125;)</span></span><br><span class="line">    <span class="comment">//exceptionsToIgnore有这个异常不走兜底方法</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...非法参数异常&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id &gt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...空指针异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//兜底方法</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleFallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, Throwable e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;---兜底异常handlerFallback,exception内容：&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">blockHandler</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, BlockException e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinel限流,blockException:&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>测试：</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_5.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_5_2.png" alt=""></p><h3 id="7-4、全局降级"><a href="#7-4、全局降级" class="headerlink" title="7-4、全局降级"></a>7-4、全局降级</h3><p>上面是单个进行 fallback 和 blockhandler 的测试，下面是整合 openfeign 实现把降级方法解耦。和 Hystrix 几乎一摸一样！</p><p>添加 open-feign 依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>yml 追加如下配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 激活Sentinel对Feign的支持</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>主启动类添加注解 ： @EnableFeignClients 激活 open-feign</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain84</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain84</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain84.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>service：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;,fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>;</span><br><span class="line">    <span class="comment">//方法名也要和provider-payment9003/9004里的一样</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">44444</span>,<span class="string">&quot;服务降级返回,---PaymentFallbackService&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controllert 添加：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">paymentSQL</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> paymentService.paymentSql(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>测试：</strong></p><p>为了模拟异常，在远程调用方添加延时（open-feign 默认延时大于 1 秒才会回调），如下。</p><blockquote><p>测试时发现如果只给一个微服务加延时，另一个不加，会一直调用没有延时的微服务，所以要么两个都加延时或者停掉一个</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> hashMap.get(id);</span><br><span class="line">    <span class="type">CommonResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;from mysql, server port : &quot;</span> + serverPort + <span class="string">&quot; ,查询成功&quot;</span>, payment);</span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_6.png" alt=""></p><h3 id="7-5、持久化"><a href="#7-5、持久化" class="headerlink" title="7-5、持久化"></a>7-5、持久化</h3><p>拿 cloudalibaba-sentinel-service8401 项目操作举例子</p><p>目前的 sentinel 当重启以后，数据都会丢失，和 nacos 类似原理。需要持久化。它可以被持久化到 nacos 的数据库中。</p><p><strong>pom 文件</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">datasource:</span></span><br><span class="line">                <span class="attr">ds1:</span></span><br><span class="line">                    <span class="attr">nacos:</span></span><br><span class="line">                        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">                        <span class="attr">dataId:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">                        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">                        <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">                        <span class="attr">rule-type:</span> <span class="string">flow</span></span><br></pre></td></tr></table></figure><p>去 nacos 上创建一个 dataid ,名字和 yml 配置的一致，json 格式，内容如下：</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_7.png" alt=""></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/rateLimit/byUrl&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;limitApp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;grade&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;controlBehavior&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;clusterMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><ul><li>resource：资源名称</li><li>limitApp：来源应用</li><li>grade：阈值类型，0 表示线程数，1 表示 QPS，</li><li>count：单机阈值，</li><li>strategy：流控模式，0 表示直接，1 表示关联，2 表示链路</li><li>controlBehavior:流控效果，0 表示快速失败，1 表示 Warm Up,2 表示排队等待；</li><li>cIusterM0de 是否集群</li></ul><p>启动应用，发现存在 关于资源 “/rateLimit/byUrl” 的流控规则.</p><blockquote><p>总结: 就是在 sentinel 启动的时候，去 nacos 上读取相关规则配置信息，实际上它规则的持久化，就是第三步，粘贴到 nacos 上保存下来，就算以后在 sentinel 上面修改了，重启应用以后也是无效。</p></blockquote><p>相关链接：<a href="/2023/04/06/Seata%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98/" title="Seata解决分布式事务问题">Seata解决分布式事务问题</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nacos服务注册和配置中心</title>
      <link href="/2023/04/04/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"/>
      <url>/2023/04/04/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/</url>
      
        <content type="html"><![CDATA[<h1 id="Nacos-服务注册和配置中心"><a href="#Nacos-服务注册和配置中心" class="headerlink" title="Nacos 服务注册和配置中心"></a>Nacos 服务注册和配置中心</h1><h2 id="1、SpringCloud-Alibaba-简介"><a href="#1、SpringCloud-Alibaba-简介" class="headerlink" title="1、SpringCloud Alibaba 简介"></a>1、SpringCloud Alibaba 简介</h2><h3 id="1-1、为什么会出现-SpringCloud-alibaba"><a href="#1-1、为什么会出现-SpringCloud-alibaba" class="headerlink" title="1-1、为什么会出现 SpringCloud alibaba"></a>1-1、为什么会出现 SpringCloud alibaba</h3><p>Spring Cloud Netflix 项目进入维护模式：</p><p><a href="https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now">https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now</a><br><img src="https://picbed.jnchan.top/springcloudImages/20springcloud_alibaba.png" alt=""></p><h4 id="什么是维护模式？"><a href="#什么是维护模式？" class="headerlink" title="什么是维护模式？"></a>什么是维护模式？</h4><p>将模块置于维护模式，意味着 Spring Cloud 团队将不会再向模块添加新功能。我们将修复 block 级别的 bug 以及安全问题，我们也会考虑并审查社区的小型 pull request。</p><h4 id="进入维护模式意味着什么呢？"><a href="#进入维护模式意味着什么呢？" class="headerlink" title="进入维护模式意味着什么呢？"></a>进入维护模式意味着什么呢？</h4><p>进入维护模式意味着 Spring Cloud Netflix 将不再开发新的组件，我们都知道 Spring Cloud 版本迭代算是比较快的，因而出现了很多重大 ISSUE 都还来不及 Fix 就又推另一个 Release 了。进入维护模式意思就是目前一直以后一段时间 Spring Cloud Netflix 提供的服务和功能就这么多了，不在开发新的组件和功能了。以后将以维护和 Merge 分支 Full Request 为主。</p><p>新组件功能将以其他替代平代替的方式实现</p><h3 id="1-2、SpringCloud-alibaba-带来了什么"><a href="#1-2、SpringCloud-alibaba-带来了什么" class="headerlink" title="1-2、SpringCloud alibaba 带来了什么"></a>1-2、SpringCloud alibaba 带来了什么</h3><h4 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h4><p>官网：<a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p><p>诞生：2018.10.31，Spring Cloud Alibaba 正式入驻了 Spring Cloud 官方孵化器，并在 Maven 中央库发布了第一个版本</p><p><img src="https://picbed.jnchan.top/springcloudImages/20springcloud_alibaba2.png" alt=""></p><h4 id="能干嘛"><a href="#能干嘛" class="headerlink" title="能干嘛"></a>能干嘛</h4><ul><li>服务限流降级：默认支持 Servlet、Feign、RestTemplate、Dubbo 和 RocketMQ 限流降级功能的接入，可以在运行时通过控制台实时修改限流降级规则，还支持查看限流降级 Metrics 监控。</li><li>服务注册与发现：适配 Spring Cloud 服务注册与发现标准，默认集成了 Ribbon 的支持</li><li>分布式配置管理：支持分布式系统中的外部化配置，配置更改时自动刷新。</li><li>消息驱动能力：基于 Spring Cloud Stream 为微服务应用构建消息驱动能力。</li><li>阿里云对象存储：阿里云提供的海量、安全、低成本、高可靠的云存储服务支持在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li><li>分布式任务调度：提供秒级、精准、高可靠、高可用的定时（基于 Cron 表达式）任务调度服务。同时提供分布式的任务执行模型，如网格任务。网格任务支持海量子任务均匀分配到所有 Worker（schedulerx-client）上执行。</li><li>阿里云短信服务：覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</li></ul><h4 id="去哪下"><a href="#去哪下" class="headerlink" title="去哪下"></a>去哪下</h4><p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p><h4 id="怎么玩"><a href="#怎么玩" class="headerlink" title="怎么玩"></a>怎么玩</h4><p><img src="https://picbed.jnchan.top/springcloudImages/20springcloud_alibaba3.png" alt=""></p><h3 id="1-3、SpringCloud-alibaba-学习资料获取"><a href="#1-3、SpringCloud-alibaba-学习资料获取" class="headerlink" title="1-3、SpringCloud alibaba 学习资料获取"></a>1-3、SpringCloud alibaba 学习资料获取</h3><p>官网：<a href="https://spring.io/projects/spring-cloud-alibaba#overview">https://spring.io/projects/spring-cloud-alibaba#overview</a></p><p>Spring Cloud Alibaba 致力于提供微服务开发的一站式解决方案。此项目包含开发分布式应用微服务的必需组件，方便开发者通过 Spring Cloud 编程模型轻松使用这些组件来开发分布式应用服务。依托 Spring Cloud Alibaba，您只需要添加一些注解和少量配置，就可以将 Spring Cloud 应用接入阿里微服务解决方案，通过阿里中间件来迅速搭建分布式应用系统。</p><p>SpringCloud Alibaba 进入了 SpringCloud 官方孵化器，而且毕业了</p><p>英文：</p><ul><li><p><a href="https://github.com/alibaba/spring-cloud-alibaba">https://github.com/alibaba/spring-cloud-alibaba</a></p></li><li><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html</a></p></li></ul><p>中文：</p><ul><li><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></li></ul><h2 id="2、Nacos-简介"><a href="#2、Nacos-简介" class="headerlink" title="2、Nacos 简介"></a>2、Nacos 简介</h2><h3 id="2-1、为什么叫-Nacos"><a href="#2-1、为什么叫-Nacos" class="headerlink" title="2-1、为什么叫 Nacos"></a>2-1、为什么叫 Nacos</h3><p>前四个字母分别为 Naming 和 Configuration 的前两个字母，最后的 s 为 Service</p><ul><li>Nacos: Dynamic Naming and Configuration Service</li></ul><h3 id="2-2、是什么"><a href="#2-2、是什么" class="headerlink" title="2-2、是什么"></a>2-2、是什么</h3><p>Nacos: Dynamic Naming and Configuration Service 一个更易于构建云原生应用的动态服务发现配置管理和服务管理平台</p><p>Nacos 就是注册中心 + 配置中心的组合 Nacos = Eureka+Config +Bus</p><h3 id="2-3、能干嘛"><a href="#2-3、能干嘛" class="headerlink" title="2-3、能干嘛"></a>2-3、能干嘛</h3><ul><li>替代 Eureka 做服务注册中心</li><li>替代 Config 做服务配置中心</li></ul><h3 id="2-4、去哪下"><a href="#2-4、去哪下" class="headerlink" title="2-4、去哪下"></a>2-4、去哪下</h3><p><a href="https://github.com/alibaba/Nacos">https://github.com/alibaba/Nacos</a></p><p>官网文档：</p><ul><li><a href="https://nacos.io/zh-cn/index.html">https://nacos.io/zh-cn/index.html</a></li><li><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</a></li></ul><h3 id="2-5、各种注册中心比较"><a href="#2-5、各种注册中心比较" class="headerlink" title="2-5、各种注册中心比较"></a>2-5、各种注册中心比较</h3><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_1.png" alt=""></p><p>据说 Nacos 在阿里巴巴内部有超过 10 万的实例运行，已经过了类似双十一等各种大型流量的考验</p><h3 id="2-6、回忆一下-CAP-模型"><a href="#2-6、回忆一下-CAP-模型" class="headerlink" title="2-6、回忆一下 CAP 模型"></a>2-6、回忆一下 CAP 模型</h3><ul><li>C：Consistency（强一致性）</li><li>A：Availability（可用性）</li><li>P：Partition tolerance（分区容错性）</li></ul><p>CAP 理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类：</p><ul><li><p>CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大</p></li><li><p>CP - 满足一致性，分区容忍必的系统，通常性能不是特别高</p></li><li>AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些</li></ul><h4 id="AP-架构-Eureka-Nacos-："><a href="#AP-架构-Eureka-Nacos-：" class="headerlink" title="AP 架构(Eureka/Nacos)："></a>AP 架构(Eureka/Nacos)：</h4><p>当网络分区出现后，为了保证可用性，系统 B 可以返回旧值，保证系统的可用性。</p><p>结论：违背了一致性 C 的要求，只满足可用性和分区容错，即 AP<br><img src="https://picbed.jnchan.top/springcloudImages/20nacos_2.png" alt=""></p><h4 id="CP-Zookeeper-Consul"><a href="#CP-Zookeeper-Consul" class="headerlink" title="CP(Zookeeper/Consul)"></a>CP(Zookeeper/Consul)</h4><p>CP 架构：</p><p>当网络分区出现后，为了保证一致性，就必须拒接请求，否则无法保证一致性</p><p>结论：违背了可用性 A 的要求，只满足一致性和分区容错，即 CP</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_3.png" alt=""></p><h2 id="3、安装并运行-Nacos"><a href="#3、安装并运行-Nacos" class="headerlink" title="3、安装并运行 Nacos"></a>3、安装并运行 Nacos</h2><p>本地 Java8+Maven 环境已经 OK</p><p>先从官网下载 Nacos：<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>解压安装包，启动的时候不能直接双击 bin 目录下的 startup.cmd，我们要通过以下命令</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p>表示是单机启动，不是集群。</p><p>当然也可以在 Windows 下修改/nacos/bin 目录下的 startup.cmd 脚本文件，将其中的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set MODE=<span class="string">&quot;cluster&quot;</span> 修改为 set MODE=<span class="string">&quot;standalone&quot;</span></span><br></pre></td></tr></table></figure><p>即可实现 Nacos 的单机启动，以后直接双击 bin 目录下的 startup.cmd 即可。</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_修改配置文件.png" alt=""></p><p>命令运行成功后直接访问：<a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a> 默认账号密码都是 nacos</p><h2 id="4、Nacos-作为服务注册中心演示"><a href="#4、Nacos-作为服务注册中心演示" class="headerlink" title="4、Nacos 作为服务注册中心演示"></a>4、Nacos 作为服务注册中心演示</h2><h3 id="4-1、基于-Nacos-的服务提供者-9001"><a href="#4-1、基于-Nacos-的服务提供者-9001" class="headerlink" title="4-1、基于 Nacos 的服务提供者 9001"></a>4-1、基于 Nacos 的服务提供者 9001</h3><p>新建 Module：cloudalibaba-provider-payment9001</p><h4 id="父-pom-增加："><a href="#父-pom-增加：" class="headerlink" title="父 pom 增加："></a>父 pom 增加：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>里面定义了接下来你所使用的组件版本号</p><h4 id="本模块-pom："><a href="#本模块-pom：" class="headerlink" title="本模块 pom："></a>本模块 pom：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-provider-payment9001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos 依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入自己定义的api通用包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#nacos地址</span></span><br><span class="line"><span class="comment"># springboot 监控 Actuator 的设置，暴露所有端点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain9001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a>controller 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;nacos registry, serverPort: &quot;</span> + serverPort + <span class="string">&quot;\t id&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>nacos 控制台：</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_test.png" alt=""></p><p>nacos 服务注册中心+服务提供者 9001 都 OK 了</p><p>为了下一章节演示 nacos 的负载均衡，参照 9001 新建 9002，新建 cloudalibaba-provider-payment9002</p><p>或者取巧不想新建重复体力劳动，直接拷贝虚拟端口映射</p><h3 id="4-2、基于-Nacos-的服务消费者-83"><a href="#4-2、基于-Nacos-的服务消费者-83" class="headerlink" title="4-2、基于 Nacos 的服务消费者 83"></a>4-2、基于 Nacos 的服务消费者 83</h3><p>新建 Module：cloudalibaba-consumer-nacos-order83</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-consumer-nacos-order83<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos 依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#nacos地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#消费者将要去访问的微服务名称(注册成功进nacos的微服务提供者)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">    <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><h4 id="主启动类-1"><a href="#主启动类-1" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderNacosMain83</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNacosMain83</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderNacosMain83.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="config-类"><a href="#config-类" class="headerlink" title="config 类"></a>config 类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextBean</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-层-1"><a href="#controller-层-1" class="headerlink" title="controller 层"></a>controller 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.nacos-user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverURL;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverURL + <span class="string">&quot;/payment/nacos/&quot;</span> + id, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><p>可以通过负载均衡的调用 nacos-payment-provider 服务</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_测试1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_测试2.png" alt=""></p><h3 id="4-3、服务注册中心对比-⭐"><a href="#4-3、服务注册中心对比-⭐" class="headerlink" title="4-3、服务注册中心对比 ⭐"></a>4-3、服务注册中心对比 ⭐</h3><p>Nacos 全景图所示</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_全景图.png" alt=""></p><p>Nacos 与其他注册中心特性对比</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_支持类型.png" alt=""></p><p>Nacos 服务发现实例模型</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_实例模型.png" alt=""></p><p><strong>Nacos 支持 AP 和 CP 模式的切换</strong></p><p>C 是所有节点在同一时间看到的数据是一致的；而 A 的定义是所有的请求都会收到响应</p><p><strong>何时选择使用何种模式？</strong></p><p>一般来说，如果不需要存储服务级别的信息且服务实例是通过 nacos-client 注册，并能够保持心跳上报，那么就可以选择 AP 模式。当前主流的服务如 Spring cloud 和 Dubbo 服务，都适用于 AP 模式，AP 模式为了服务的可能性而减弱了一致性，因此<font color='red'><strong>AP 模式下只支持注册临时实例。</strong></font></p><p>如果需要在服务级别编辑或者存储配置信息，那么 CP 是必须，K8S 服务和 DNS 服务则适用于 CP 模式。CP 模式下则支持注册持久化实例，此时则是以 Raft 协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不存在，则会返回错误。</p><p><strong>切换命令：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="5、Nacos-作为服务配置中心演示"><a href="#5、Nacos-作为服务配置中心演示" class="headerlink" title="5、Nacos 作为服务配置中心演示"></a>5、Nacos 作为服务配置中心演示</h2><h3 id="5-1、Nacos-作为配置中心-3377-基础配置"><a href="#5-1、Nacos-作为配置中心-3377-基础配置" class="headerlink" title="5-1、Nacos 作为配置中心 3377-基础配置"></a>5-1、Nacos 作为配置中心 3377-基础配置</h3><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-config-nacos-client3377<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 以 nacos 做服务配置中心的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos 依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springboot整合Web组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>两个 yml，为什么配置两个？</strong></p><p>Nacos 同 springcloud-config 一样，在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置之后，才能保证项目的正常启动。</p><p>springboot 中配置文件的加载是存在优先级顺序的，bootstrap 优先级高于 application</p><h4 id="bootstrap-yml"><a href="#bootstrap-yml" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#Nacos服务注册中心地址</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#Nacos作为配置中心地址</span></span><br><span class="line">                <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#指定yaml格式的配置</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 表示开发环境</span></span><br></pre></td></tr></table></figure><h4 id="主启动类-2"><a href="#主启动类-2" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> NacosConfigMain3377</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigMain3377</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(NacosConfigMain3377.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-层-2"><a href="#controller-层-2" class="headerlink" title="controller 层"></a>controller 层</h4><p>通过 Spring Cloud 原生注解 <code>@RefreshScope</code> 实现配置自动刷新</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.context.config.annotation.RefreshScope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ConfigClientController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">//支持Nacos的动态刷新功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2、在-Nacos-中添加配置信息"><a href="#5-2、在-Nacos-中添加配置信息" class="headerlink" title="5-2、在 Nacos 中添加配置信息"></a>5-2、在 Nacos 中添加配置信息</h3><h4 id="理论"><a href="#理论" class="headerlink" title="理论"></a><strong>理论</strong></h4><p>nacos 中的 dataid 的组成格式及与 springboot 配置文件中的匹配规则：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure><ul><li>prefix 默认为 spring.application.name 的值，也可以通过配置项 spring.cloud.nacos.config.prefix 来配置</li><li>spring.profiles.active 即为当前环境对应的 profile，详情可以参考 Spring Boot 文档。 注意：当 spring.profiles.active 为空时，对应的连接符 - 也将不存在，dataId 的拼接格式变成 ${prefix}.${file-extension}</li><li>file-exetension 为配置内容的数据格式，可以通过配置项 spring.cloud.nacos.config.file-extension 来配置。目前只支持 properties 和 yaml 类型（注意 nacos 里必须使用 yaml）</li></ul><p>最后公式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span><br></pre></td></tr></table></figure><h4 id="实操"><a href="#实操" class="headerlink" title="实操"></a><strong>实操</strong></h4><p>配置新增：nacos-config-client-dev.yaml</p><blockquote><p>config:</p><p>info: “config info for dev,from nacos config center. version=v1.1”</p></blockquote><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos新建配置.png" alt=""></p><p>历史配置：Nacos 会记录配置文件的历史版本默认保留 30 天，此外还有一键回滚功能</p><h4 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a><strong>测试</strong></h4><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_configinfo.png" alt=""></p><p>当修改配置值，会发现 3377 上也已经修改，<font color='red'><strong>Nacos 自带自动刷新功能！</strong></font></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_configinfo2.png" alt=""></p><h3 id="5-3、Nacos-作为配置中心-分类配置"><a href="#5-3、Nacos-作为配置中心-分类配置" class="headerlink" title="5-3、Nacos 作为配置中心-分类配置"></a>5-3、Nacos 作为配置中心-分类配置</h3><h4 id="问题——多环境多项目管理"><a href="#问题——多环境多项目管理" class="headerlink" title="问题——多环境多项目管理"></a>问题——多环境多项目管理</h4><p>问题 1：</p><p>实际开发中，通常一个系统会准备：dev 开发环境、test 测试环境、prod 生产环境，如何保证指定环境启动时服务能正确读取到 Nacos 上相应环境的配置文件呢？</p><p>问题 2：</p><p>一个大型分布式微服务系统会有很多微服务子项目，每个微服务项目又都会有相应的开发环境、测试环境、预发环境、正式环境…那怎么对这些微服务配置进行管理呢？</p><h4 id="Nacos-的图形化管理界面"><a href="#Nacos-的图形化管理界面" class="headerlink" title="Nacos 的图形化管理界面"></a>Nacos 的图形化管理界面</h4><p>命名空间：<br><img src="https://picbed.jnchan.top/springcloudImages/20nacos_命名空间.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_命名空间2.png" alt=""></p><h4 id="Namespace-Group-Data-ID-三者关系？"><a href="#Namespace-Group-Data-ID-三者关系？" class="headerlink" title="Namespace+Group+Data ID 三者关系？"></a><strong>Namespace+Group+Data ID 三者关系？</strong></h4><p>思考：为什么这么设计？</p><p><strong>① 是什么？</strong></p><p>类似 Java 里面的 package 名和类名，最外层的 namespace 是可以用于区分部署环境的，Group 和 DataID 逻辑上区分两个目标对象</p><p><strong>② 三者情况</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_命名空间3.png" alt=""></p><p><strong>③ 默认情况</strong></p><p>Namespace=public，Group=DEFAULT_GROUP，默认 Cluster 是 DEFAULT</p><p>Nacos 默认的命名空间是 public；Namespace 主要用来实现隔离</p><ul><li>比方说我们现在有三个环境：开发、测试、生产环境，我们就可以创建三个 Namespace，不同的 Namespace 之间是隔离的</li></ul><p>Group 默认是 DEFAULT_GROUP，Group 可以把不同的微服务划分到同一个分组里面去</p><p>Service 就是微服务；一个 Service 可以包含多个 Cluster（集群），Nacos 默认 Cluster 是 DEFAULT，Cluster 是对指定微服务的一个虚拟划分。</p><ul><li>比方说为了容灾，将 Service 微服务分别部署在了杭州机房和广州机房，这时就可以给杭州机房的 Service 微服务起一个集群名称（HZ），给广州机房的 Service 微服务起一个集群名称（GZ），还可以尽量让同一个机房的微服务互相调用，以提升性能。</li></ul><p>最后是 Instance，就是微服务的实例</p><h4 id="三种方案加载配置-Case"><a href="#三种方案加载配置-Case" class="headerlink" title="三种方案加载配置 Case"></a>三种方案加载配置 Case</h4><p><strong>① DataID 方案（就是 nacos 的文件名）：</strong></p><ul><li>指定 spring.profile.active 和配置文件的 DataID 来使不同环境下读取不同的配置</li><li>默认空间+默认分组+新建 dev 和 test 两个 DataID</li><li>新建 test 配置 DataID：nacos-config-client-test.yaml</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_config.png" alt=""></p><p><strong>② Group 方案（默认 DEFAULT_GROUP）：</strong></p><ul><li>通过 Group 实现环境区分，新建 Group：TEST_GROUP</li><li>Data ID：nacos-config-client-dev.yaml 不变</li><li>yml 添加分组名称</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_testgroup.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_testgroup_xml.png" alt=""></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#Nacos服务注册中心地址</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#Nacos作为配置中心地址</span></span><br><span class="line">                <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#指定yaml格式的配置</span></span><br><span class="line">                <span class="attr">group:</span> <span class="string">TEST_GROUP</span></span><br><span class="line"><span class="comment">#$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br><span class="line"><span class="comment"># nacos-config-client-dev.yaml</span></span><br></pre></td></tr></table></figure><p><strong>③ Namespace 方案（默认 public）：</strong></p><ul><li>通过 Namespace 实现环境区分，新建 dev/test 的 Namespace</li><li>Data ID：nacos-config-client-dev.yaml 不变，分组默认</li><li>yml 添加命名空间的 id</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_namespace.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_namespace2.png" alt=""></p><h2 id="5、Nacos-集群和持久化配置"><a href="#5、Nacos-集群和持久化配置" class="headerlink" title="5、Nacos 集群和持久化配置"></a>5、Nacos 集群和持久化配置</h2><h3 id="5-1、官网说明"><a href="#5-1、官网说明" class="headerlink" title="5-1、官网说明"></a>5-1、官网说明</h3><p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_集群部署架构图.png" alt=""></p><p>上图官网翻译，真实情况</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_集群部署架构图2.png" alt=""></p><p>官网说明：<a href="https://nacos.io/zh-cn/docs/deployment.html">https://nacos.io/zh-cn/docs/deployment.html</a></p><p>默认 Nacos 使用嵌入式数据库实现数据的存储。所以，如果启动多个默认配置下的 Nacos 节点，数据存储是存在一致性问题的。为了解决这个问题，Nacos 采用了集中式存储的方式来支持集群化部署，目前只支持 MySQL 的存储。</p><p>按照上述，我们需要 mysql 数据库</p><p>Nacos 支持三种部署模式</p><ul><li>单机模式-用于测试和单机试用。</li><li>集群模式-用于生产环境，确保高可用。</li><li>多集群模式-用于多数据中心场景。</li></ul><h3 id="5-2、Nacos-持久化配置解释"><a href="#5-2、Nacos-持久化配置解释" class="headerlink" title="5-2、Nacos 持久化配置解释"></a>5-2、Nacos 持久化配置解释</h3><p>Nacos 默认自带的是嵌入式数据库 derby</p><p>derby 到 mysql 切换配置步骤：</p><ul><li>nacos-server-1.1.4\nacos\conf 目录下找到 sql 脚本，执行 nacos-mysql.sql</li><li>修改 nacos/conf/application.properties 文件(切换数据库)，增加支持 mysql 数据源配置（目前只支持 mysql），添加 mysql 数据源的 url、用户名和密码</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换数据库</span></span><br><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span>=<span class="string">12345</span></span><br></pre></td></tr></table></figure><ul><li>再以单机模式启动 nacos(重启)，nacos 所有写嵌入式数据库的数据都写到了 mysql</li></ul><p>单机的数据库都是独立的，我们得让他们共用一个数据库</p><h3 id="5-3、Nacos-集群配置"><a href="#5-3、Nacos-集群配置" class="headerlink" title="5-3、Nacos 集群配置"></a>5-3、Nacos 集群配置</h3><p>环境准备：</p><ul><li>64 bit OS Linux/Unix/Mac，推荐使用 Linux 系统。</li><li>64 bit JDK 1.8+；</li><li>Maven 3.2.x+；</li><li>3 个或 3 个以上 Nacos 节点才能构成集群。</li></ul><h4 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h4><p>开始配置集群：</p><ul><li>首先对 nacos 进行持久化操作，操作如上面一致。</li><li>修改 nacos/conf 下的 cluster.conf 文件，添加如下内容</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 告诉这3个集群结点是一组的 # 不能写127.0.0.1，必须是linux hostname -i能够识别的ip</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:3333</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:4444</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:5555</span></span><br></pre></td></tr></table></figure><ul><li>修改 nacos/conf/application.properties 文件，添加设置我们的数据库信息</li><li>模拟三台 nacos 服务，编辑 nacos 的 startup.sh 脚本，使他能够支持不同的端口启动多次。</li></ul><p>平时单机版的启动，都是./startup.sh 即可。集群启动，我们希望可以类似其它软件的 shell 命令，传递不同的端口号启动不同的 nacos 实例<br>修改前：</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_集群修改1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_集群修改2.png" alt=""></p><p>修改后：</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_集群修改3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_集群修改4.png" alt=""></p><h4 id="重点修改"><a href="#重点修改" class="headerlink" title="重点修改"></a>重点修改</h4><p>因为目前是测试服务器，内存比较小，而 nacos 默认设置做大 2g 左右，最小 1g 左右，而我们要启动 3 份，所以我们要设置内存限制<br>原设置：<br><code>JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</code><br>修改后：<br><code>JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms300m -Xmx300m -Xmn100m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=160m&quot;</code><br>这里我们设置最大为 300m 最小为 100m。可根据自身情况进行设定。 如果内存大的请忽略该修改。</p><p>依次执行命令启动 3 个 nacos 集群：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./startup.sh -p <span class="number">3333</span> 表示启动端口号为<span class="number">3333</span>的nacos服务器实例</span><br><span class="line">./startup.sh -p <span class="number">4444</span></span><br><span class="line">./startup.sh -p <span class="number">5555</span></span><br></pre></td></tr></table></figure><p>如像我一样出错：idea 运行项目 9002 出错，read time out。则用一下命令运行 nacos 集群</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ./startup.sh -m standalone -p <span class="number">3333</span></span><br><span class="line">sudo ./startup.sh -m standalone -p <span class="number">4444</span></span><br><span class="line">sudo ./startup.sh -m standalone -p <span class="number">5555</span></span><br></pre></td></tr></table></figure><p>修改 nginx 的配置文件，由它作为负载均衡器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ./nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>nginx.conf：</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_nginxconfig修改1.png" alt=""></p><p>按照指定启动</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_nginxconfig修改2.png" alt=""></p><ul><li><pre><code class="lang-java">./nginx -c /usr/local/nginx/conf/nginx.conf</code></pre></li><li><p>通过 nginx 访问：119.3.211.104:8089/nacos/#/login</p></li><li><p>使用 9002 模块注册进 Nacos 集群，并获取它上面配置文件的信息进行测试</p></li></ul><h3 id="5-4、高可用小总结"><a href="#5-4、高可用小总结" class="headerlink" title="5-4、高可用小总结"></a>5-4、高可用小总结</h3><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_end.png" alt=""></p><p>相关链接：<a href="/2023/04/05/Sentinel%E5%AE%9E%E7%8E%B0%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81/" title="Sentinel实现熔断与限流">Sentinel实现熔断与限流</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sleuth分布式请求链路跟踪</title>
      <link href="/2023/04/03/Sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"/>
      <url>/2023/04/03/Sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/</url>
      
        <content type="html"><![CDATA[<h1 id="Sleuth-分布式请求链路跟踪"><a href="#Sleuth-分布式请求链路跟踪" class="headerlink" title="Sleuth 分布式请求链路跟踪"></a>Sleuth 分布式请求链路跟踪</h1><h2 id="1、Sleuth-介绍"><a href="#1、Sleuth-介绍" class="headerlink" title="1、Sleuth 介绍"></a>1、Sleuth 介绍</h2><h3 id="1-1、为什么会出现这个技术？需要解决哪些问题？"><a href="#1-1、为什么会出现这个技术？需要解决哪些问题？" class="headerlink" title="1-1、为什么会出现这个技术？需要解决哪些问题？"></a>1-1、为什么会出现这个技术？需要解决哪些问题？</h3><p>在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的的服务节点调用来协同产生最后的请求结果，每一个前段请求都会形成一条复杂的分布式服务调用链路，链路中的任何一环出现高延时或错误都会引起整个请求最后的失败。</p><p>官网：<a href="https://github.com/spring-cloud/spring-cloud-sleuth">https://github.com/spring-cloud/spring-cloud-sleuth</a></p><h3 id="1-2、是什么"><a href="#1-2、是什么" class="headerlink" title="1-2、是什么"></a>1-2、是什么</h3><p>Spring Cloud Sleuth 提供了一套完整的服务跟踪的解决方案，在分布式系统中提供追踪解决方案并且兼容支持了 zipkin</p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_1.png" alt=""></p><h2 id="2、搭建链路监控步骤"><a href="#2、搭建链路监控步骤" class="headerlink" title="2、搭建链路监控步骤"></a>2、搭建链路监控步骤</h2><h3 id="2-1、zipkin-搭建安装"><a href="#2-1、zipkin-搭建安装" class="headerlink" title="2-1、zipkin 搭建安装"></a>2-1、zipkin 搭建安装</h3><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>SpringCloud 从 F 版起已不需要自己构建 Zipkin Server 了，只需调用 jar 包即可</p><p>zipkin 下载地址：<a href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/zipkin-server-2.12.9-exec.jar">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/zipkin-server-2.12.9-exec.jar</a></p><h4 id="运行-jar"><a href="#运行-jar" class="headerlink" title="运行 jar"></a>运行 jar</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar zipkin-server-<span class="number">2.12</span><span class="number">.9</span>-exec.jar</span><br></pre></td></tr></table></figure><h4 id="运行控制台"><a href="#运行控制台" class="headerlink" title="运行控制台"></a>运行控制台</h4><p>控制台：<a href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a></p><h4 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h4><p>完整的调用链路： 一条链路通过 Trace Id 唯一标识，Span 标识发起的请求信息，各 span 通过 parent id 关联起来</p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_2.png" alt=""></p><p>—条链路通过 Trace ld 唯一标识，Span 标识发起的请求信息，各 span 通过 parent id 关联起来。</p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_4.png" alt=""></p><p>名词解释：</p><ul><li>Trace：类似于树结构的 Span 集合，表示一条调用链路，存在唯一标识</li><li>span：表示调用链路来源，通俗的理解 span 就是一次请求信息</li></ul><h3 id="2-2、服务提供者-cloud-provider-payment8001"><a href="#2-2、服务提供者-cloud-provider-payment8001" class="headerlink" title="2-2、服务提供者 cloud-provider-payment8001"></a>2-2、服务提供者 cloud-provider-payment8001</h3><p>cloud-provider-payment8001</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>改 pom.xml，增加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--包含了sleuth+zipkin--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><p>改 application.yml，添加以下内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">zipkin:</span></span><br><span class="line">        <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span> <span class="comment"># zipkin 地址</span></span><br><span class="line">        <span class="attr">sleuth:</span></span><br><span class="line">            <span class="attr">sampler:</span></span><br><span class="line">                <span class="comment"># 采样率值 介于0-1之间 ，1表示全部采集</span></span><br><span class="line">            <span class="attr">probability:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a>controller 层</h4><p>改业务类 PaymentController 增加：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/zipkin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentZipkin</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hi, i am paymentzipkin server fall back, welcome to ailuoHome, O(n_n)O 哈哈~&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3、服务消费者（调用方）cloud-consumer-order80"><a href="#2-3、服务消费者（调用方）cloud-consumer-order80" class="headerlink" title="2-3、服务消费者（调用方）cloud-consumer-order80"></a>2-3、服务消费者（调用方）cloud-consumer-order80</h2><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>改 pom.xml，增加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--包含了sleuth+zipkin--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><p>改 application.yml，添加以下内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">zipkin:</span></span><br><span class="line">        <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span> <span class="comment"># zipkin 地址</span></span><br><span class="line">        <span class="attr">sleuth:</span></span><br><span class="line">            <span class="attr">sampler:</span></span><br><span class="line">                <span class="comment"># 采样率值 介于0-1之间 ，1表示全部采集</span></span><br><span class="line">            <span class="attr">probability:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="controller-层-1"><a href="#controller-层-1" class="headerlink" title="controller 层"></a>controller 层</h4><p>改业务类 OrderController，增加：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/zipkin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentZipkin</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(PAYMENT_URL+<span class="string">&quot;/payment/zipkin&quot;</span>,String.class);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>访问：localhost/consumer/payment/zipkin</p><p>在控制台查看调用链路</p><p><img src="https://picbed.jnchan.top/springcloudImages/18zipkin.png" alt=""></p><font color='red'>**有分组属性配置，后台打出来了 MQ 上的消息**</font><p>相关链接：<a href="/2023/04/04/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" title="Nacos服务注册和配置中心">Nacos服务注册和配置中心</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Stream消息驱动</title>
      <link href="/2023/04/02/Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"/>
      <url>/2023/04/02/Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Stream-消息驱动"><a href="#Stream-消息驱动" class="headerlink" title="Stream 消息驱动"></a>Stream 消息驱动</h1><h2 id="1、消息驱动-Stream-介绍"><a href="#1、消息驱动-Stream-介绍" class="headerlink" title="1、消息驱动 Stream 介绍"></a>1、消息驱动 Stream 介绍</h2><h3 id="1-1、Stream-为什么被引入"><a href="#1-1、Stream-为什么被引入" class="headerlink" title="1-1、Stream 为什么被引入"></a>1-1、Stream 为什么被引入</h3><p>常见 MQ(消息中间件)：</p><ul><li><p>ActiveMQ</p></li><li><p>RabbitMQ</p></li><li>RocketMQ</li><li>Kafka</li></ul><p>有没有一种新的技术诞生，让我们不再关注具体 MQ 的细节，我们只需要用一种适配绑定的方式，自动的给我们在各种 MQ 内切换。（类似于 Hibernate）</p><p>2、是什么</p><font color='red'>屏蔽底层消息中间件的差异,降低切换成本，统一消息的编程模型。</font><p>官方定义 Spring Cloud Stream 是一个构建消息驱动微服务的框架。</p><font color='red'>**应用程序通过 inputs 或者 outputs 来与 Spring Cloud Stream 中 binder 对象交互。通过我们配置来 binding(绑定)，而 Spring Cloud Stream 的 binder 对象负责与消息中间件交互。**</font>所以，我们只需要搞清楚如何与 Spring Cloud Stream 交互就可以方便使用消息驱动的方式。通过使用 Spring Integration 来连接消息代理中间件以实现消息事件驱动。Spring Cloud Stream 为一些供应商的消息中间件产品提供了个性化的自动化配置实现，引用了<font color='red'>**发布-订阅、消费组、分区**</font>的三个核心概念。目前仅支持 RabbitMQ、 Kafka。### 1-3、设计思想#### 标准 MQ![](https://picbed.jnchan.top/springcloudImages/18stream_1.png)-   生产者/消费者之间靠消息媒介传递信息内容-   消息必须走特定的通道 - 消息通道 Message Channel-   消息通道里的消息如何被消费呢，谁负责收发处理 - 消息通道 MessageChannel 的子接口 SubscribableChannel，由 MessageHandler 消息处理器所订阅。#### **为什么用 Cloud Stream**比方说我们用到了 RabbitMQ 和 Kafka，由于这两个消息中间件的架构上的不同，像 RabbitMQ 有 exchange，kafka 有 Topic 和 Partitions 分区。![](https://picbed.jnchan.top/springcloudImages/18stream_2.png)这些中间件的差异性导致我们实际项目开发给我们造成了一定的困扰，我们如果用了两个消息队列的其中一种，后面的业务需求，我想往另外一种消息队列进行迁移，这时候无疑就是一个灾难性的，一大堆东西都要重新推倒重新做，因为它跟我们的系统耦合了，这时候 Spring Cloud Stream 给我们提供了—种解耦合的方式。#### Stream 凭什么可以统一底层差异？在没有绑定器这个概念的情况下，我们的 SpringBoot 应用要直接与消息中间件进行信息交互的时候，由于各消息中间件构建的初衷不同，它们的实现细节上会有较大的差异性。通过定义绑定器作为中间层，完美地实现了应用程序与消息中间件细节之间的隔离。<font color='red'>**通过向应用程序暴露统一的 Channel 通道，使得应用程序不需要再考虑各种不同的消息中间件实现。**</font><p><strong>一句话：屏蔽底层消息中间件的差异，降低切换成本，统一消息的编程模型。</strong></p><p>Stream 对消息中间件的进一步封装，可以做到代码层面对中间件的无感知，甚至于动态的切换中间件(rabbitmq 切换为 kafka)，使得微服务开发的高度解耦，服务可以关注更多自己的业务流程</p><p>通过定义绑定器 Binder 作为中间层，实现了应用程序与消息中间件细节之间的隔离。</p><h4 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h4><p>Binder 可以生成 Binding，Binding 用来绑定消息容器的生产者和消费者，它有两种类型</p><ul><li><p>INPUT 对应于消费者</p></li><li><p>OUTPUT 对应于生产者</p></li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_3.png" alt=""></p><h4 id="Stream-中的消息通信方式遵循了发布-订阅模式"><a href="#Stream-中的消息通信方式遵循了发布-订阅模式" class="headerlink" title="Stream 中的消息通信方式遵循了发布-订阅模式"></a>Stream 中的消息通信方式遵循了发布-订阅模式</h4><p>Topic 主题进行广播</p><ul><li>在 RabbitMQ 就是 Exchange</li><li>在 Kakfa 中就是 Topic</li></ul><h3 id="1-4、Stream-标准流程套路"><a href="#1-4、Stream-标准流程套路" class="headerlink" title="1-4、Stream 标准流程套路"></a>1-4、Stream 标准流程套路</h3><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_4.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_5.png" alt=""></p><ul><li>Binder：很方便的连接中间件，屏蔽差异</li><li>Channel：通道，是队列 Queue 的一种抽象，在消息通讯系统中就是实现存储和转发的媒介，通过 Channel 对队列进行配置</li><li>Source 和 Sink：简单的可理解为参照对象是 Spring Cloud Stream 自身，从 Stream 发布消息就是输出，接受消息就是输入</li></ul><h3 id="编码-API-和常用注解"><a href="#编码-API-和常用注解" class="headerlink" title="编码 API 和常用注解"></a>编码 API 和常用注解</h3><div class="table-container"><table><thead><tr><th>组成</th><th>说明</th></tr></thead><tbody><tr><td>Middleware</td><td>中间件，目前只支持 RabbitMQ 和 Kafka</td></tr><tr><td>Binder</td><td>Binder 是应用与消息中间件之间的封装，目前实行了 Kafka 和 RabbitMQ 的 Binder，通过 Binder 可以很方便的连接中间件，可以动态的改变消息类型(对应于 Kafka 的 topic,RabbitMQ 的 exchange)，这些都可以通过配置文件来实现</td></tr><tr><td>@Input</td><td>注解标识输入通道，通过该输乎通道接收到的消息进入应用程序</td></tr><tr><td>@Output</td><td>注解标识输出通道，发布的消息将通过该通道离开应用程序</td></tr><tr><td>@StreamListener</td><td>监听队列，用于消费者的队列的消息接收</td></tr><tr><td>@EnableBinding</td><td>指信道 channel 和 exchange 绑定在一起</td></tr></tbody></table></div><h2 id="2、案例说明"><a href="#2、案例说明" class="headerlink" title="2、案例说明"></a>2、案例说明</h2><p>RabbitMQ 环境已经 OK，工程中新建三个子模块</p><ul><li><p>cloud-stream-rabbitmq-provider8801，作为生产者进行发消息模块</p></li><li><p>cloud-stream-rabbitmq-consumer8802，作为消息接收模块</p></li><li>cloud-stream-rabbitmq-consumer8803 作为消息接收模块</li></ul><h3 id="2-1、消息驱动之生产者-provider8801"><a href="#2-1、消息驱动之生产者-provider8801" class="headerlink" title="2-1、消息驱动之生产者 provider8801"></a>2-1、消息驱动之生产者 provider8801</h3><p>cloud-stream-rabbitmq-provider8801</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-stream-rabbitmq-provider8801<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- stream-rabbit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--eureka-client 目前，这个不是必须的--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">stream:</span></span><br><span class="line">            <span class="attr">binders:</span> <span class="comment"># 在此配置要绑定的rabbitMQ的服务信息</span></span><br><span class="line">                <span class="attr">defaultRabbit:</span> <span class="comment"># 表示定义的名称，用于和binding整合</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># 消息组件类型</span></span><br><span class="line">                    <span class="attr">environment:</span> <span class="comment"># 设置rabbitmq的相关环境配置</span></span><br><span class="line">                        <span class="attr">spring:</span></span><br><span class="line">                            <span class="attr">rabbitmq:</span></span><br><span class="line">                                <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">                                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                                <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">                                <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line">            <span class="attr">bindings:</span> <span class="comment"># 服务的整合处理</span></span><br><span class="line">                <span class="attr">output:</span> <span class="comment"># 表示是生产者，向rabbitMQ发送消息</span></span><br><span class="line">                    <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># 表示要使用的Exchange名称</span></span><br><span class="line">                    <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># 设置消息类型，本次是json，文本是 &quot;text/plain&quot;</span></span><br><span class="line">                    <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># 设置要绑定的消息服务的具体配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># 设置心跳时间，默认是30秒</span></span><br><span class="line">        <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># 最大心跳间隔不能超过5秒,默认90秒</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">send-8801.com</span> <span class="comment"># 在信息列表显示主机名称</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 访问路径变为ip地址</span></span><br></pre></td></tr></table></figure><h4 id="特别注意-⭐⭐⭐"><a href="#特别注意-⭐⭐⭐" class="headerlink" title="特别注意:⭐⭐⭐"></a>特别注意:⭐⭐⭐</h4><p>使用了 spring.cloud.stream.binders.defaultRabbit.environment.spring.rabbitmq.xx 来配置 rabbitmq 的环境</p><p>如果你是用的其他服务器上的 rabbitmq，比如我使用的我自己的阿里云服务器然后创建 docker 容器来运行 rabbitmq。<br>按照视频中的配置方式的话，启动时会试图连接两次 rabbitmq 程序<br>第一次试图连接访问的就是 application.yml 中配置的地址，此时已经订阅成功了<br>但是程序还会在之后进行第二次连接，此时访问的地址就是 localhost:5672，在我的环境中，我本地没有 rabbitmq 环境，所以直接报 IOException。</p><p>所以，如果是使用的自己的服务器来配置，则需要修改配置文件，将 rabbitmq 的配置信息移动到 application.yml 中的 spring 节点下<br>修改后的配置如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">stream:</span></span><br><span class="line">            <span class="attr">binders:</span> <span class="comment"># 在此配置要绑定的rabbitMQ的服务信息</span></span><br><span class="line">                <span class="attr">defaultRabbit:</span> <span class="comment"># 表示定义的名称，用于和binding整合</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># 消息组件类型</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">bindings:</span> <span class="comment"># 服务的整合处理</span></span><br><span class="line">                <span class="attr">output:</span> <span class="comment"># 表示是生产者，向rabbitMQ发送消息</span></span><br><span class="line">                    <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># 表示要使用的Exchange名称</span></span><br><span class="line">                    <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># 设置消息类型，本次是json，文本是 &quot;text/plain&quot;</span></span><br><span class="line">                    <span class="attr">binder:</span> &#123; <span class="string">defaultRabbit</span> &#125; <span class="comment"># 设置要绑定的消息服务的具体配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># 设置心跳时间，默认是30秒</span></span><br><span class="line">        <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># 最大心跳间隔不能超过5秒,默认90秒</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">send-8801.com</span> <span class="comment"># 在信息列表显示主机名称</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 访问路径变为ip地址</span></span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamMQMain8801</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(StreamMQMain8801.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-层"><a href="#service-层" class="headerlink" title="service 层"></a>service 层</h4><p>发送消息接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IMessageProvider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发送消息接口实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableBinding(Source.class)</span><span class="comment">//定义消息的推送管道 //不是和controller打交道的service,而是发送消息的推送服务类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessasgeProviderImpl</span> <span class="keyword">implements</span> <span class="title class_">IMessageProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MessageChannel output; <span class="comment">//消息发送管道</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serial</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        output.send(MessageBuilder.withPayload(serial).build());</span><br><span class="line">        System.out.println(<span class="string">&quot;*******serial: &quot;</span>+serial);</span><br><span class="line">        <span class="keyword">return</span> serial;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a>controller 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMessageController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IMessageProvider messageProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/sendMessage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendMessage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> messageProvider.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_exchange.png" alt=""></p><h3 id="2-2、消息驱动之消费者-consumer8802"><a href="#2-2、消息驱动之消费者-consumer8802" class="headerlink" title="2-2、消息驱动之消费者 consumer8802"></a>2-2、消息驱动之消费者 consumer8802</h3><p>cloud-stream-rabbitmq-consumer8802</p><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-stream-rabbitmq-consumer8802<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- stream-rabbit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8802</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">stream:</span></span><br><span class="line">            <span class="attr">binders:</span> <span class="comment"># 配置要绑定的rabbitMQ的服务信息</span></span><br><span class="line">                <span class="attr">defaultRabbit:</span> <span class="comment"># 表示定义的名称，用于和binding整合</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># 消息组件类型</span></span><br><span class="line">            <span class="attr">bindings:</span> <span class="comment"># 服务的整合处理</span></span><br><span class="line">                <span class="attr">input:</span> <span class="comment"># 表示是消费者，这里是唯一和生产者不同的地方，向rabbitMQ发送消息</span></span><br><span class="line">                    <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># 表示要使用的Exchange名称</span></span><br><span class="line">                    <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># 设置消息类型，本次是json，文本是 &quot;text/plain&quot;</span></span><br><span class="line">                    <span class="attr">binder:</span> &#123; <span class="string">defaultRabbit</span> &#125; <span class="comment"># 设置要绑定的消息服务的具体配置</span></span><br><span class="line">                    <span class="attr">group:</span> <span class="string">ailuoA</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># 设置心跳时间，默认是30秒</span></span><br><span class="line">        <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># 最大心跳间隔不能超过5秒,默认90秒</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">receive-8802.com</span> <span class="comment"># 在信息列表显示主机名称</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 访问路径变为ip地址</span></span><br></pre></td></tr></table></figure><h4 id="主启动类-1"><a href="#主启动类-1" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamMQMain8802</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(StreamMQMain8802.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-类"><a href="#controller-类" class="headerlink" title="controller 类"></a>controller 类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableBinding(Sink.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveMessageListenerController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(Sink.INPUT)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">input</span><span class="params">(Message&lt;String&gt; message)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者1号，--------&gt;接收到的消息是： &quot;</span>+message.getPayload()+<span class="string">&quot;\t port: &quot;</span>+serverPort);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_sendMessage2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_getMessage.png" alt=""></p><h3 id="2-3、分组消费与持久化"><a href="#2-3、分组消费与持久化" class="headerlink" title="2-3、分组消费与持久化"></a>2-3、分组消费与持久化</h3><h4 id="消息重复消费"><a href="#消息重复消费" class="headerlink" title="消息重复消费"></a>消息重复消费</h4><p>依照 8802，clone 出来一份运行 8803</p><p>启动</p><ul><li><p>分组消费 RabbitMQ</p></li><li><p>7001：服务注册</p></li><li>8801：消息生产</li><li>8802：消息消费</li><li>8803：消息消费</li></ul><p>运行后有两个问题：</p><ul><li>有重复消费问题</li><li>消息持久化问题</li></ul><p>目前是 8802/8803 同时都收到了，存在重复消费问题<br><img src="https://picbed.jnchan.top/springcloudImages/18stream_重复消费2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_重复消费1.png" alt=""></p><p><strong>生产实际案例：</strong></p><p>比如在如下场景中，订单系统我们做集群部署，都会从 RabbitMQ 中获取订单信息，那如果一个订单同时被两个服务获取到，那么就会造成数据错误，我们得避免这种情况。这时我们就可以使用 Stream 中的消息分组来解决</p><p><img src="https://picbed.jnchan.top/springcloudImages/18 生产实际案例.png" alt=""></p><h4 id="解决消息重复消费"><a href="#解决消息重复消费" class="headerlink" title="解决消息重复消费"></a>解决消息重复消费</h4><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>微服务应用放置于同一个 group 中，就能够保证消息只会被其中一个应用消费一次。</p><p>不同组是可以全面消费的(重复消费)，同一组内会发生竞争关系，只有其中一个可以消费。</p><h5 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h5><p>8002，8003 添加到同一分组即可</p><p>application.yml 中添加分组</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">group:</span> <span class="string">ailuoA</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-stream-provider</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">    port: <span class="number">5672</span></span><br><span class="line">    username: cj</span><br><span class="line">    password: <span class="number">123456</span></span><br><span class="line">  cloud:</span><br><span class="line">    stream:</span><br><span class="line">      binders: # 配置要绑定的rabbitMQ的服务信息</span><br><span class="line">        defaultRabbit: # 表示定义的名称，用于和binding整合</span><br><span class="line">          type: rabbit  # 消息组件类型</span><br><span class="line">      bindings: # 服务的整合处理</span><br><span class="line">        input: # 表示是消费者，这里是唯一和生产者不同的地方，向rabbitMQ发送消息</span><br><span class="line">          destination: studyExchange  # 表示要使用的Exchange名称</span><br><span class="line">          content-type: application/json  # 设置消息类型，本次是json，文本是 <span class="string">&quot;text/plain&quot;</span></span><br><span class="line">          binder: &#123; defaultRabbit &#125;  # 设置要绑定的消息服务的具体配置</span><br><span class="line">          group: ailuoA</span><br></pre></td></tr></table></figure><h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a><strong>持久化</strong></h4><p>通过上述，解决了重复消费问题，再看看持久化</p><ul><li>停止 8802/8803 并去除掉 8802 的分组 group: ailuoA，8803 的分组 group: ailuoA 没有去掉</li><li>8801 先发送 4 条消息到 rabbitmq</li><li>先启动 8802，无分组属性配置，后台没有打出来消息</li><li>再启动 8803，有分组属性配置，后台打出来了 MQ 上的消息(消息持久化体现)</li></ul><p>相关链接：<a href="/2023/04/03/Sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" title="Sleuth分布式请求链路跟踪">Sleuth分布式请求链路跟踪</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bus消息总线</title>
      <link href="/2023/04/01/Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/"/>
      <url>/2023/04/01/Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="Bus-消息总线"><a href="#Bus-消息总线" class="headerlink" title="Bus 消息总线"></a>Bus 消息总线</h1><h2 id="1、SpringCloud-Bus-介绍"><a href="#1、SpringCloud-Bus-介绍" class="headerlink" title="1、SpringCloud Bus 介绍"></a>1、SpringCloud Bus 介绍</h2><h3 id="1-1、消息总线的由来"><a href="#1-1、消息总线的由来" class="headerlink" title="1-1、消息总线的由来"></a>1-1、消息总线的由来</h3><p>回顾上一篇文章 Config 分布式配置中心存在的问题</p><ul><li><p>假如有多个微服务客户端 3355/3366/3377……，每个微服务都要执行一次 post 请求，手动刷新？</p></li><li><p>可否广播，一次通知，处处生效？</p></li><li>我们想大范围的自动刷新，求方法</li></ul><p>以上就是消息总线的产生由来</p><p>Spring Cloud Bus 配合 Spring Cloud Config 使用可以实现配置的动态刷新</p><h3 id="1-2、是什么"><a href="#1-2、是什么" class="headerlink" title="1-2、是什么"></a>1-2、是什么</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_1.png" alt=""></p><p>Spring Cloud Bus 是用来<font color='red'><strong>将分布式系统的节点与轻量级消息系统链接起来的框架</strong></font>，它整合了 Java 的事件处理机制和消息中间件的功能。</p><p>Spring Cloud Bus 目前支持 RabbitMQ 和 Kafka。</p><h3 id="1-3、能干嘛"><a href="#1-3、能干嘛" class="headerlink" title="1-3、能干嘛"></a>1-3、能干嘛</h3><p>Spring Cloud Bus 能管理和传播分布式系统间的消息，就像一个分布式执行器，可用于广播状态更改、事件推送等，也可以当作微服务间的通信通道。<br><img src="https://picbed.jnchan.top/springcloudImages/17bus_2.png" alt=""></p><h3 id="1-4、总线"><a href="#1-4、总线" class="headerlink" title="1-4、总线"></a>1-4、总线</h3><h4 id="什么是总线"><a href="#什么是总线" class="headerlink" title="什么是总线"></a>什么是总线</h4><p>在微服务架构的系统中，<font color='red'><strong>通常会使用轻量级的消息代理来构建一个共用的消息主题，并让系统中所有微服务实例都连接上来。由于该主题中产生的消息会被所有实例监听和消费，所以称它为消息总线。</strong></font></p><p>在总线上的各个实例，都可以方便地广播一些需要让其他连接在该主题上的实例都知道的消息。</p><h4 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h4><p>ConfigClient 实例都监听 MQ 中同一个 topic(默认是 springCloudBus)。<font color='red'><strong>当一个服务刷新数据的时候，它会把这个信息放入到 Topic 中，这样其它监听同一 Topic 的服务就能得到通知，然后去更新自身的配置。</strong></font></p><p>相关链接：<a href="/2023/04/02/Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/" title="Stream消息驱动">Stream消息驱动</a></p><h2 id="2、RabbitMQ-环境配置"><a href="#2、RabbitMQ-环境配置" class="headerlink" title="2、RabbitMQ 环境配置"></a>2、RabbitMQ 环境配置</h2><p>安装 Erlang，下载地址：<a href="http://erlang.org/download/otp_win64_21.3.exe">http://erlang.org/download/otp_win64_21.3.exe</a></p><p>安装 RabbitMQ，下载地址：<a href="https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.14/rabbitmq-server-3.7.14.exe">https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.14/rabbitmq-server-3.7.14.exe</a></p><p>进入 RabbitMQ 安装目录下的 sbin 目录，输入以下命令启动管理功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><p>访问地址查看是否安装成功：<a href="http://localhost:15672/">http://localhost:15672/</a></p><p>输入账号密码并登录：guest guest</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_界面.png" alt=""></p><h2 id="3、动态刷新全局广播"><a href="#3、动态刷新全局广播" class="headerlink" title="3、动态刷新全局广播"></a>3、动态刷新全局广播</h2><h3 id="3-1、搭建客户端微服务-3366"><a href="#3-1、搭建客户端微服务-3366" class="headerlink" title="3-1、搭建客户端微服务 3366"></a>3-1、搭建客户端微服务 3366</h3><p>必须先具备良好的 RabbitMQ 环境先，演示广播效果，增加复杂度，再以 3355 为模板再制作一个 3366</p><p>新建 cloud-config-client-3366</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-config-client-3366<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="bootstrap-yml"><a href="#bootstrap-yml" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3366</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="comment">#Config客户端配置</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">            <span class="attr">label:</span> <span class="string">master</span> <span class="comment">#分支名称</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">config</span> <span class="comment">#配置文件名称</span></span><br><span class="line">            <span class="attr">profile:</span> <span class="string">test</span> <span class="comment">#读取后缀名称   上述3个综合：master分支上config-test.yml的配置文件被读取</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">http://localhost:3344</span> <span class="comment">#配置中心地址</span></span><br><span class="line">            <span class="comment"># 综合上面四个 即读取配置文件地址为： http://config-3344.com:3344/master/config-test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务注册到eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露监控端点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientMain3366</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConfigClientMain3366.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a>controller 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span> <span class="comment">//gitee里的yml文件里的内容</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;serverPort: &quot;</span>+serverPort+<span class="string">&quot;\t\n\n configInfo: &quot;</span>+configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2、设计思想"><a href="#3-2、设计思想" class="headerlink" title="3-2、设计思想"></a>3-2、设计思想</h3><p>（1）利用消息总线触发一个客户端/bus/refresh,而刷新所有客户端的配置</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_3.png" alt=""></p><p>（2）利用消息总线触发一个服务端 ConfigServer 的/bus/refresh 端点，而刷新所有客户端的配置</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_4.png" alt=""></p><p>图二的架构显然更加适合，图一不适合的原因如下：</p><ul><li>打破了微服务的职责单一性，因为微服务本身是业务模块，它本不应该承担配置刷新的职责。</li><li>破坏了微服务各节点的对等性。</li><li>有一定的局限性。例如，微服务在迁移时，它的网络地址常常会发生变化，此时如果想要做到自动刷新，那就会增加更多的修改</li></ul><h3 id="3-3、配置中心-3344-添加消息总线支持"><a href="#3-3、配置中心-3344-添加消息总线支持" class="headerlink" title="3-3、配置中心 3344 添加消息总线支持"></a>3-3、配置中心 3344 添加消息总线支持</h3><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>添加消息总线支持</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--添加消息总线RabbitMQ支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><p>添加以下内容，配置 rabbitmq 并且暴露端点</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="comment">#rabbitmq相关配置 15672是Web管理界面的端口；5672是MQ访问的端口</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露bus刷新配置的端点 actuator刷新配置</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;bus-refresh&#x27;</span> <span class="comment">#Post /bus/refresh 官网架构图</span></span><br></pre></td></tr></table></figure><p>说明：</p><p>因为手动刷新需要自己调用一个类似于健康检查的端点（接口），所以呢，我们需要把这个端点给暴露出来，以便外部可访问。</p><h3 id="3-4、客户端-3355，3366-添加消息总线支持"><a href="#3-4、客户端-3355，3366-添加消息总线支持" class="headerlink" title="3-4、客户端 3355，3366 添加消息总线支持"></a>3-4、客户端 3355，3366 添加消息总线支持</h3><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>添加消息总线支持</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--添加消息总线RabbitMQ支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="bootstrap-yml-1"><a href="#bootstrap-yml-1" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><p>添加 Rabbitmq 相关配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="comment">#rabbitmq相关配置 15672是Web管理界面的端口；5672是MQ访问的端口</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><h3 id="3-5、测试"><a href="#3-5、测试" class="headerlink" title="3-5、测试"></a>3-5、测试</h3><p>修改 Gitee 上配置文件增加版本号</p><p>发送 POST 请求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3344/actuator/bus-refresh&quot;</span></span><br></pre></td></tr></table></figure><p>测试结果：一次修改，广播通知，处处生效</p><h2 id="4、动态刷新定点通知"><a href="#4、动态刷新定点通知" class="headerlink" title="4、动态刷新定点通知"></a>4、动态刷新定点通知</h2><p>不想全部通知，只想定点通知：只通知 3355，不通知 3366</p><p>简单一句话：指定具体某一个实例生效而不是全部</p><p><strong>公式</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost:配置中心的端口号/actuator/bus-refresh/&#123;destination&#125;</span></span><br></pre></td></tr></table></figure><p>/bus-refresh 请求不再发送到具体的服务实例上，而是发给 config server 并通过 destination 参数类指定需要更新配置的服务或实例</p><h3 id="4-1、案例"><a href="#4-1、案例" class="headerlink" title="4-1、案例"></a>4-1、案例</h3><p>我们这里以刷新运行在 3355 端口上的 config-client 为例：只通知 3355，不通知 3366</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3344/actuator/bus-refresh/config-client:3355&quot;</span></span><br></pre></td></tr></table></figure><p>通知总结 All</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_5.png" alt=""></p><h2 id="5、额外内容：Springboot-Actuator-的说明"><a href="#5、额外内容：Springboot-Actuator-的说明" class="headerlink" title="5、额外内容：Springboot Actuator 的说明"></a>5、额外内容：Springboot Actuator 的说明</h2><h3 id="5-1、是什么"><a href="#5-1、是什么" class="headerlink" title="5-1、是什么"></a>5-1、是什么</h3><p>监控中心是针对微服务期间</p><ul><li><p>查看服务器内存变化(对内存,线程,日志管理等)</p></li><li><p>检测服务配置连接池地址是否可用(模拟访问,懒加载)</p></li><li>统计现在有多个 bean(是 Spring 容器中的 bean)</li><li>统计 SpringMVC@RequestMapping(统计 http 接口)</li></ul><p>使用 Actuator 来查看这些信息,它是没有界面的返回的是 json 格式的数据</p><p>AdminUi 底层使用的是 Actuator 实现的,只不过给它加了个可视化界面</p><h3 id="5-2、应用场景"><a href="#5-2、应用场景" class="headerlink" title="5-2、应用场景"></a>5-2、应用场景</h3><p>生产环境</p><p>使用它的原因：它是 springboot 的一个附加功能，可帮助你在应用程序生产环境时<font color='red'><strong>监控和管理应用程序，可使用 Http 的各种请求来监管，审计，收集应用的运行情况，</strong></font>特别对于微服务管理十分有意义。</p><p>建议使用 springboot2.0.5，因为它里面返回的信息更加全面。</p><p>springboot 提供了对项目的监控功能。</p><h3 id="5-3、如何使用"><a href="#5-3、如何使用" class="headerlink" title="5-3、如何使用"></a>5-3、如何使用</h3><h4 id="导入依赖包"><a href="#导入依赖包" class="headerlink" title="导入依赖包"></a>导入依赖包</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置端点"><a href="#配置端点" class="headerlink" title="配置端点"></a>配置端点</h4><p>在 application.properties 中配置端点，</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">暴露部分端点</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">info,health,beans,env</span></span><br><span class="line"></span><br><span class="line"><span class="attr">暴露所有端点</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="attr">不暴露beans端点</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.exclude</span>=<span class="string">beans</span></span><br></pre></td></tr></table></figure><p>在上述配置中，首先使用 management.endpoints.web.exposure.include 暴露所有的端点，接着使用 management.endpoints.web.exposure.exclud 排除 beans 端点，这样就能够暴露除 beans 外的所有 actuator 端点了。</p><h4 id="浏览器访问"><a href="#浏览器访问" class="headerlink" title="浏览器访问"></a>浏览器访问</h4><p>如</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/actuator/health</span><br></pre></td></tr></table></figure><p>访问项目监控需要加前缀 /actuator</p><h3 id="5-4-端点说明"><a href="#5-4-端点说明" class="headerlink" title="5-4.端点说明"></a>5-4.端点说明</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17actuator端点说明.png" alt=""></p><h3 id="5-5、总结"><a href="#5-5、总结" class="headerlink" title="5-5、总结"></a>5-5、总结</h3><p>上面利用 SpringCloud Config 刷新客户端配置，以及消息总线触发服务端 ConfigServer 的/bus-refresh 端点，而刷新所有客户端的配置，利用的就是 actuator 刷新配置文件。</p><p>因为手动刷新需要自己调用一个类似于健康检查的端点（接口），所以呢，我们需要把这个端点给暴露出来，以便外部可访问。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3355/actuator/refresh&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3344/actuator/bus-refresh&quot;</span></span><br></pre></td></tr></table></figure><p>Actuator 参考文章：<a href="https://blog.csdn.net/munangs/article/details/123639480">https://blog.csdn.net/munangs/article/details/123639480</a></p><p>相关链接：<a href="/2023/04/02/Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/" title="Stream消息驱动">Stream消息驱动</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Config分布式配置中心</title>
      <link href="/2023/03/29/Config%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"/>
      <url>/2023/03/29/Config%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/</url>
      
        <content type="html"><![CDATA[<h1 id="Config-分布式配置中心"><a href="#Config-分布式配置中心" class="headerlink" title="Config 分布式配置中心"></a>Config 分布式配置中心</h1><h2 id="1、Config-分布式配置中心介绍"><a href="#1、Config-分布式配置中心介绍" class="headerlink" title="1、Config 分布式配置中心介绍"></a>1、Config 分布式配置中心介绍</h2><h3 id="1-1、分布式系统面临的配置问题"><a href="#1-1、分布式系统面临的配置问题" class="headerlink" title="1-1、分布式系统面临的配置问题"></a>1-1、分布式系统面临的配置问题</h3><p>微服务意味着要将单体应用中的业务拆分成一个个子服务，每个服务的粒度相对较小，因此系统中会出现大量的服务。由于每个服务都需要必要的配置信息才能运行，所以一套集中式的、动态的配置管理设施是必不可少的。</p><p>SpringCloud 提供了 ConfigServer 来解决这个问题，我们每一个微服务自己带着一个 application.yml，上百个配置文件的管理…/(ㄒ o ㄒ)/~~</p><h3 id="1-2、是什么"><a href="#1-2、是什么" class="headerlink" title="1-2、是什么"></a>1-2、是什么</h3><p>SpringCloud Config 为微服务架构中的微服务提供集中化的外部配置支持，配置服务器为各个不同微服务应用的所有环境提供了一个<font color='red'><strong>中心化的外部配置。</strong></font><br><img src="https://picbed.jnchan.top/springcloudImages/17config1.png" alt=""></p><h3 id="1-3、怎么玩"><a href="#1-3、怎么玩" class="headerlink" title="1-3、怎么玩"></a>1-3、怎么玩</h3><p>SpringCloud Config 分为 服务端 和 客户端 两部分。</p><ul><li>服务端也称为分布式配置中心，它是一个独立的微服务应用，用来连接配置服务器并为客户端提供获取配置信息，加密/解密信息等访问接口</li><li>客户端则是通过指定的配置中心来管理应用资源，以及与业务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息配置服务器默认采用 git 来存储配置信息，这样就有助于对环境配置进行版本管理，并且可以通过 git 客户端工具来方便的管理和访问配置内容。</li></ul><h3 id="1-4、能干嘛"><a href="#1-4、能干嘛" class="headerlink" title="1-4、能干嘛"></a>1-4、能干嘛</h3><ul><li>集中管理配置文件</li><li>不同环境不同配置，<strong>动态化的配置更新</strong>，分环境部署比如 dev/test/prod/beta/release</li><li>运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，服务会向配置中心统一拉取配置自己的信息</li><li>当配置发生变动时，服务不需要重启即可感知到配置的变化并应用新的配置</li><li>将配置信息以 REST 接口的形式暴露：post、curl 访问刷新均可…</li></ul><h3 id="1-5、与-GitHub-整合配置"><a href="#1-5、与-GitHub-整合配置" class="headerlink" title="1-5、与 GitHub 整合配置"></a>1-5、与 GitHub 整合配置</h3><p>由于 SpringCloud Config 默认使用 Git 来存储配置文件(也有其它方式，比如支持 SVN 和本地文件)，但最推荐的还是 Git，而且使用的是 http/https 访问的形式</p><p>官网：<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/</a></p><h2 id="2、Config-配置总控中心搭建"><a href="#2、Config-配置总控中心搭建" class="headerlink" title="2、Config 配置总控中心搭建"></a>2、Config 配置总控中心搭建</h2><h3 id="2-1、服务端远程仓库配置"><a href="#2-1、服务端远程仓库配置" class="headerlink" title="2-1、服务端远程仓库配置"></a>2-1、服务端远程仓库配置</h3><p>用你自己的账号在 Gitee 上新建一个名为 springcloud-config 的新 Repository</p><p>由上一步获得刚新建的 git 地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP:https://github.com/***/SpringCloudStudy.git</span><br><span class="line">SSH:git@github.com:***/SpringCloudStudy.git</span><br></pre></td></tr></table></figure><p>在仓库下新建三个文件</p><p>config-dev.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-dev</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><p>config-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-prod</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure><p>config-test.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-test</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure><h3 id="2-2、配置模块-cloud-config-center-3344"><a href="#2-2、配置模块-cloud-config-center-3344" class="headerlink" title="2-2、配置模块 cloud-config-center-3344"></a>2-2、配置模块 cloud-config-center-3344</h3><p>新建 Module 模块 cloud-config-center-3344，它即为 Cloud 的配置中心模块</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-config-center-3344<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- config Server --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--eureka-client config Server也要注册进服务中心--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-config-center</span> <span class="comment">#注册进eurkea服务器的微服务名</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">            <span class="attr">server:</span></span><br><span class="line">                <span class="attr">git:</span></span><br><span class="line">                    <span class="attr">uri:</span> <span class="string">https://github.com/***/SpringCloudStudy.git</span> <span class="comment">#github上面的仓库名 ***为自己的用户名</span></span><br><span class="line">                    <span class="comment"># 搜索目录</span></span><br><span class="line">                    <span class="attr">search-paths:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">springcloud-config</span> <span class="comment">###目录名称</span></span><br><span class="line">                <span class="comment"># 读取分支</span></span><br><span class="line">                <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务注册到eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.config.server.EnableConfigServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ConfigCenterMain3344</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigCenterMain3344</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConfigCenterMain3344.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/17config_测试.png" alt=""></p><h3 id="2-3、文件命名规则"><a href="#2-3、文件命名规则" class="headerlink" title="2-3、文件命名规则"></a>2-3、文件命名规则</h3><p>{application} 是应用名称，对应到配置文件上来，就是配置文件的名称部分。</p><p>{profile} 是配置文件的版本，我们的项目有开发版本、测试环境版本、生产环境版本，对应到配置文件上来就是以 application-{profile}.yml 加以区分，例如 application-dev.yml，application-prod.yml。</p><h3 id="2-4、文件访问规则"><a href="#2-4、文件访问规则" class="headerlink" title="2-4、文件访问规则"></a><strong>2-4、文件访问规则</strong></h3><p><img src="https://picbed.jnchan.top/springcloudImages/17config2.png" alt=""></p><p>不加分支名默认是 master</p><p><img src="https://picbed.jnchan.top/springcloudImages/17config3.png" alt=""></p><p>注意：/{application}/{profile}[/{label}]出的是 json 字符串</p><h2 id="3、Config-客户端配置与测试"><a href="#3、Config-客户端配置与测试" class="headerlink" title="3、Config 客户端配置与测试"></a>3、Config 客户端配置与测试</h2><p>新建 cloud-config-client-3355</p><h3 id="2-1、pom-xml"><a href="#2-1、pom-xml" class="headerlink" title="2-1、pom.xml"></a>2-1、pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-config-client-3355<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2、bootstrap-yml"><a href="#2-2、bootstrap-yml" class="headerlink" title="2-2、bootstrap.yml"></a>2-2、bootstrap.yml</h3><p>appllication.yml 是用户级的资源配置项<br>bootstrap.yml 是系统级的，优先级更加高<br>SpringCloud 会创建一个”Bootstrap Context”作为 Spring 应用的 ApplicationContext 的父上下文。</p><p>初始化的时候，Bootstrap Context 负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的 Environment。</p><p>Bootstrap 属性有高优先级，默认情况下，它们不会被本地配置覆盖。BootstrapContext 和 ApplicationContext、有着不同的约定，所以新增了一个 bootstrap.yml 文件，保证 BootstrapContext 和 ApplicationContext 配置的分离。</p><p>bootstrap.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3355</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="comment">#Config客户端配置</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">            <span class="attr">label:</span> <span class="string">master</span> <span class="comment">#分支名称</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">config</span> <span class="comment">#配置文件名称</span></span><br><span class="line">            <span class="attr">profile:</span> <span class="string">test</span> <span class="comment">#读取后缀名称   上述3个综合：master分支上config-test.yml的配置文件被读取</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">http://localhost:3344</span> <span class="comment">#配置中心地址</span></span><br><span class="line">            <span class="comment"># 综合上面四个 即读取配置文件地址为： http://localhost:3344/master/config-test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务注册到eureka地址</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><h3 id="3、主启动类"><a href="#3、主启动类" class="headerlink" title="3、主启动类"></a>3、主启动类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientMain3355</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(ConfigClientMain3355.class, args);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、controller-层"><a href="#4、controller-层" class="headerlink" title="4、controller 层"></a>4、controller 层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span> <span class="comment">//gitee里的yml文件里的内容</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5、-测试"><a href="#5、-测试" class="headerlink" title="5、 测试"></a>5、 测试</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17config_测试2.png" alt=""></p><h3 id="6、修改远程仓库配置文件内容"><a href="#6、修改远程仓库配置文件内容" class="headerlink" title="6、修改远程仓库配置文件内容"></a>6、修改远程仓库配置文件内容</h3><p>在本地的文件夹下将 springcloud-config 仓库的克隆下来，方便修改文件内容，当然也可以在仓库直接修改。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//gitee.com/用户名/springcloud-config.git</span></span><br></pre></td></tr></table></figure><p>修改 config-dev.yml 文件内容，其余两个类似</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-dev</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">    <span class="attr">info:</span> <span class="string">master</span> <span class="string">branch,</span> <span class="string">springcloud-config/config-dev.yml</span> <span class="string">version=2</span></span><br></pre></td></tr></table></figure><p>使用以下命令在本地修改后提交到远程仓库</p><ul><li>git add .</li><li>git commit . -m “init yml”</li><li>git push origin master</li></ul><h3 id="7、再次测试"><a href="#7、再次测试" class="headerlink" title="7、再次测试"></a>7、再次测试</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17config_测试3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/17config_测试4.png" alt=""></p><h3 id="8、-存在问题"><a href="#8、-存在问题" class="headerlink" title="8、 存在问题"></a><strong>8、 存在问题</strong></h3><p>当远程仓库配置文件被修改后，3344 和 3355 都要变，3344 变了，但是 3355 必须要重启才可以更新。</p><h2 id="4、Config-客户端之动态刷新"><a href="#4、Config-客户端之动态刷新" class="headerlink" title="4、Config 客户端之动态刷新"></a>4、Config 客户端之动态刷新</h2><p>避免每次更新配置都要重启客户端微服务 3355，我们需要它能动态刷新，下面来修改 3355 模块</p><h3 id="4-1、pom-xml-引入-actuator-监控"><a href="#4-1、pom-xml-引入-actuator-监控" class="headerlink" title="4-1、pom.xml 引入 actuator 监控"></a>4-1、pom.xml 引入 actuator 监控</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-2、修改-YML，暴露监控端口"><a href="#4-2、修改-YML，暴露监控端口" class="headerlink" title="4-2、修改 YML，暴露监控端口"></a>4-2、修改 YML，暴露监控端口</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 暴露监控端点 actuator刷新配置</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><p>说明：因为手动刷新需要自己调用一个类似于健康检查的端点（接口），所以呢，我们需要把这个端点给暴露出来，以便外部可访问</p><h3 id="4-3、Controller-类添加-RefreshScope"><a href="#4-3、Controller-类添加-RefreshScope" class="headerlink" title="4-3、Controller 类添加@RefreshScope"></a>4-3、Controller 类添加@RefreshScope</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span> <span class="comment">//gitee里的yml文件里的内容</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4、问题和解决"><a href="#4-4、问题和解决" class="headerlink" title="4-4、问题和解决"></a>4-4、问题和解决</h3><p>此时修改配置文件内容，再测：<a href="http://localhost:3355/configInfo，发现">http://localhost:3355/configInfo，发现</a> 3355 还是没有变化</p><p>需要运维人员发送 Post 请求刷新 3355</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3355/actuator/refresh&quot;</span></span><br></pre></td></tr></table></figure><p>再次请求：<a href="http://localhost:3355/configInfo，成功实现了客户端">http://localhost:3355/configInfo，成功实现了客户端</a> 3355 刷新到最新配置内容，避免了服务重启</p><h3 id="4-5、思考"><a href="#4-5、思考" class="headerlink" title="4-5、思考"></a>4-5、思考</h3><p>想想还有什么问题？</p><ul><li>假如有多个微服务客户端 3355/3366/3377……，每个微服务都要执行一次 post 请求，手动刷新？</li><li>可否广播，一次通知，处处生效？</li><li>我们想大范围的自动刷新，求方法</li></ul><p>于是就有下面的消息总线！</p><p>相关链接：<a href="/2023/04/01/Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" title="Bus消息总线">Bus消息总线</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Gateway网关</title>
      <link href="/2023/03/23/Gateway%E7%BD%91%E5%85%B3/"/>
      <url>/2023/03/23/Gateway%E7%BD%91%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="Gateway-网关"><a href="#Gateway-网关" class="headerlink" title="Gateway 网关"></a>Gateway 网关</h1><h2 id="1、Gateway-简介"><a href="#1、Gateway-简介" class="headerlink" title="1、Gateway 简介"></a>1、Gateway 简介</h2><h3 id="1-1、官网"><a href="#1-1、官网" class="headerlink" title="1-1、官网"></a>1-1、官网</h3><p>上一代 zuul 1.X：<a href="https://github.com/Netflix/zuul/wiki">https://github.com/Netflix/zuul/wiki</a></p><p>当前 gateway：<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</a></p><h3 id="1-2、是什么"><a href="#1-2、是什么" class="headerlink" title="1-2、是什么"></a>1-2、是什么</h3><p>SpringCloud Gateway 是 SpringCloud 的一个全新项目，基于 Spring5.O+Springboot 2.0 和 ProjectReactor 等技术开发的网关，它旨在为微服务架构提供一种简单有效的统一的 API 路由管理方式。</p><p>SpringCloudGateway 作为 SpringCloud 生态系统中的网关，目标是替代 Zuul,在 SpringCloud2.0 以上版本中，没有对新版本的 zuul2.0 以上最新高性能版本进行集成，仍然还是使用的 Zuul 1.x 非 Reactor 模式的老版本。而为了提升网关的性能，<strong>SpringCloud Gateway 是基于 WebFlux 框架实现的，而 webFlux 框架底层则使用了高性能的 Reactor 模式通信框架 Netty。</strong></p><p>springCloudGateway 的目标提供统一的路由方式且基于 Filter 链的方式提供了网关基本的功能，例如：安全，监控/指标，和限流。</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway1.png" alt=""></p><h3 id="1-3、能干嘛"><a href="#1-3、能干嘛" class="headerlink" title="1-3、能干嘛"></a>1-3、能干嘛</h3><ul><li>反向代理</li><li>鉴权</li><li>流量控制</li><li>熔断</li><li>日志监控</li></ul><p>微服务架构中网关在哪里？</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway2.png" alt=""></p><h3 id="1-4、有-Zuul-了怎么又出来了-gateway"><a href="#1-4、有-Zuul-了怎么又出来了-gateway" class="headerlink" title="1-4、有 Zuul 了怎么又出来了 gateway"></a>1-4、有 Zuul 了怎么又出来了 gateway</h3><p>neflix 不太靠谱，zuul2.0 一直跳票，迟迟不发布，一方面因为 Zuul1.0 已经进入了维护阶段，而且 Gateway 是 SpringCloud 团队研发的，是亲儿子产品，值得信赖。而且很多功能 Zuul 都没有用起来也非常的简单便捷。Gateway 是基于异步非阻塞模型上进行开发的，性能方面不需要担心。虽然 Netflix 早就发布了最新的 Zuul 2.x，但 Spring Cloud 貌似没有整合计划。而且 Netflix 相关组件都宣布进入维护期；不知前景如何？多方面综合考虑 Gateway 是很理想的网关选择。</p><h3 id="5、Gateway-特征"><a href="#5、Gateway-特征" class="headerlink" title="5、Gateway 特征"></a>5、Gateway 特征</h3><ul><li>基于 Spring Framework 5, Project Reactor 和 Spring Boot 2.0 进行构建</li><li>动态路由：能够匹配任何请求属性</li><li>可以对路由指定 Predicate（断言）和 Filter（过滤器）</li><li>集成 Hystrix 的断路器功能</li><li>集成 Spring Cloud 服务发现功能</li><li>易于编写的 Predicate（断言）和 Filter（过滤器）</li><li>请求限流功能</li><li>支持路径重写</li></ul><h3 id="1-6、SpringCloudGateway-与-Zuul-的区别："><a href="#1-6、SpringCloudGateway-与-Zuul-的区别：" class="headerlink" title="1-6、SpringCloudGateway 与 Zuul 的区别："></a>1-6、SpringCloudGateway 与 Zuul 的区别：</h3><p>在 SpringCloudFinchley 正式版之前，SpringCloud 推荐的网关是 Netflix 提供的 Zuul：</p><ul><li>Zuul 1.x 是一个基于阻塞 I/O 的 APIGateway</li><li>Zuul 1.x 基于 ServIet2.5 使用阻塞架构，它不支持任何长连接（如 WebSocket)，Zuul 的设计模式和 Nginx 较像，每次 I/O 操作都是从工作线程中选择一个执行，请求线程阻塞到工作线程完成，但是差别是 Nginx 用 C++实现，Zuul 用 Java 实现，而 JVM 本身会有第一次加载较慢的情况，使得 Zuul 的性能相对较差。</li><li>Zuul 2.x 理念更先进想基于 Netty 非阻塞和支持长连接，但 SpringCloud 目前还没有整合。Zuul2.x 的性能较 Zuul1.x 有较大提升。在性能方面，根据官方提供的基准测试，SpringCloudGateway 的 RPS（每秒请求数）是 Zuul 的 1.6 倍。</li><li>SpringCloudGateway 建立在 SpringFramework5、ProjectReactor 和 SpringB00t2．之上，使用非阻塞 API</li><li>SpringCloudGateway 还支持 WebSocket,并且与 Spring 紧密集成拥有更好的开发体验</li></ul><h3 id="1-7、Zuul1-x-模型"><a href="#1-7、Zuul1-x-模型" class="headerlink" title="1-7、Zuul1.x 模型"></a>1-7、Zuul1.x 模型</h3><p>springcloud 中所集成的 zuul 版本，采用的是 tomcat 容器，使用的是传统的 servlet IO 处理模型。</p><p>Servlet 的生命周期？servlet 由 servlet container 进行生命周期管理。</p><ul><li>container 启动时构造 servlet 对象并调用 servlet init()进行初始化，</li><li>container 运行时接受请求，并为每个请求分配一个线程（一般从线程池中获取空闲线程）然后调用 service()</li><li>container 关闭时调用 servlet destory()销毁 servlet</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/15getway3.png" alt=""></p><p><strong>上述模式的缺点</strong><br>servlete—个简单的网络 IO 模型，当请求进入 servlet container 时，servlet container 就会为其绑定一个线程在并发不高的场景下这种模型是适用的。但是一旦高并发（比如抽风用 jemeter 压),线程数量就会上涨，而线程资源代价是昂贵的（上线文切换，内存消耗大）严重影响请求的处理时间。</p><p>在一些简单业务场景下，不希望为每个 request 分配一个线程，只需要 1 个或几个线程就能应对极大并发的请求，这种业务场景下 servlet 模型没有优势。</p><p>所以 Zuul 1.x 是基于 servlet 之上的一个阻塞式处理模型，即 spring 实现了处理所有 request 请求的一个 servlet(DispatcherServlet)并由该 servlet 阻塞式处理处理。所以 springcloudzuul 无法摆脱 servlet 模型的弊端。</p><h3 id="1-8、GateWay-模型"><a href="#1-8、GateWay-模型" class="headerlink" title="1-8、GateWay 模型"></a>1-8、GateWay 模型</h3><p><img src="https://picbed.jnchan.top/springcloudImages/15getway4.png" alt=""></p><p>传统的 Web 框架比如说：struts2,springmvc 等都是基于 Servlet API 与 Servlet 容器基础之上运行的。</p><p>但是，在 Servlet3.1 之后有了异步非阻塞的支持。而<font color='red'><strong>WebFlux 是一个典型非阻塞异步的框架</strong></font>，它的核心是基于 Reactor 的相关 API 实现的。相对于传统的 web 框架来说，它可以运行在诸如 Netty，Undertow 及支持 Servlet3.1 的容器上。非阻塞式+函数式编程(Spring5 必须让你使用 java8)</p><p>SpringWebFlux 是 Spring5.0 引入的新的响应式框架区别于 SpringMVC,它不需要依赖 ServletAPI，它是完全异步非阻塞的，并且基于 Reactor 来实现响应式流规范。</p><h2 id="2、Gateway-工作流程"><a href="#2、Gateway-工作流程" class="headerlink" title="2、Gateway 工作流程"></a>2、Gateway 工作流程</h2><h3 id="2-1、三大核心概念"><a href="#2-1、三大核心概念" class="headerlink" title="2-1、三大核心概念"></a>2-1、三大核心概念</h3><p>（1）Route(路由)<br>路由是构建网关的基本模块，它由 ID，目标 URI，一系列的断言和过滤器组成，如果断言为 true 则匹配该路由</p><p>（2）Predicate(断言)<br>参考的是 Java8 的 java.util.function.Predicate，开发人员可以匹配 HTTP 请求中的所有内容(例如请求头或请求参数)，如果请求与断言相匹配则进行路由</p><p>（3）Filter(过滤)<br>指的是 Spring 框架中 GatewayFilter 的实例，使用过滤器，可以在请求被路由前或者之后对请求进行修改。</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway5.png" alt=""></p><p>web 请求通过一些匹配条件，定位到真正的服务节点。并在这个转发过程的前后，进行一些精细化控制。</p><p>predicate 就是我们的匹配条件；而 filter，就可以理解为一个无所不能的拦截器。有了这两个元素，再加上目标 uri，就可以实现一个具体的路由了。</p><h3 id="2-2、Gateway工作流程"><a href="#2-2、Gateway工作流程" class="headerlink" title="2-2、Gateway工作流程"></a><strong>2-2、Gat</strong>eway<strong>工作流程</strong></h3><p>官网总结</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway6.png" alt=""></p><p>客户端向 Spring Cloud Gateway 发出请求。然后在 Gateway Handler Mapping 中找到与请求相匹配的路由，将其发送到 Gateway Web Handler。</p><p>Handler 再通过指定的过滤器链来将请求发送到我们实际的服务执行业务逻辑，然后返回。</p><p>过滤器之间用虚线分开是因为过滤器可能会在发送代理请求之前（“pre”）或之后（“post”）执行业务逻辑。</p><p>Filter 在“pre”类型的过滤器可以做参数校验、权限校验、流量监控、日志输出、协议转换等，在“post”类型的过滤器中可以做响应内容、响应头的修改，日志的输出，流量监控等有着非常重要的作用。</p><p><strong>核心逻辑</strong>：路由转发+执行过滤器链</p><h2 id="3、入门配置"><a href="#3、入门配置" class="headerlink" title="3、入门配置"></a>3、入门配置</h2><h3 id="3-1、Gateway9527-搭建"><a href="#3-1、Gateway9527-搭建" class="headerlink" title="3-1、Gateway9527 搭建"></a>3-1、Gateway9527 搭建</h3><p>新建 Module：cloud-gateway-gateway9527</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-gateway-gateway9527<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--gateway--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--一般基础配置类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册进 eureka Server # 网关他本身也是一个微服务，也要注册进注册主中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><p>主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> GateWayMain9527</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayMain9527</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GateWayMain9527.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-2、9527-网关如何做路由映射呢？"><a href="#3-2、9527-网关如何做路由映射呢？" class="headerlink" title="3-2、9527 网关如何做路由映射呢？"></a>3-2、9527 网关如何做路由映射呢？</h3><p>我们目前不想暴露 8001 端口，希望在 8001 外面套一层 9527</p><h4 id="YML-新增网关配置"><a href="#YML-新增网关配置" class="headerlink" title="YML 新增网关配置"></a>YML 新增网关配置</h4><p>8001 看 controller 的访问地址，我们目前不想暴露 8001 端口，希望在 8001 外面套一层 9527。这样别人就攻击不了 8001，有网关挡着</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">    <span class="comment">## GateWay配置</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span> <span class="comment">#多个路由</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment"># 路由ID ， 没有固定的规则但要求唯一，建议配合服务名</span></span><br><span class="line"></span><br><span class="line">                  <span class="comment">#uri+predicates  要访问这个路径得先经过9527处理</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span> <span class="comment"># 匹配成功后提供服务的路由地址</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span> <span class="comment"># 断言，路径相匹配的进行路由</span></span><br><span class="line"></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册进 eureka Server # 网关他本身也是一个微服务，也要注册进注册主中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><h3 id="3-3、测试"><a href="#3-3、测试" class="headerlink" title="3-3、测试"></a>3-3、测试</h3><ol><li><p>启动 7001</p></li><li><p>启动 8001：cloud-provider-payment8001</p></li><li><p>启动 9527 网关</p><p> <img src="https://picbed.jnchan.top/springcloudImages/15getway测试_9527.png" alt=""></p></li></ol><p>访问说明：</p><p>加入网关前：<a href="http://localhost:8001/payment/get/1">http://localhost:8001/payment/get/1</a><br>加入网关后：<a href="http://localhost:9527/payment/get/1">http://localhost:9527/payment/get/1</a><br>两者访问成功，返回相同结果</p><h3 id="3-4、Gateway-配置路由的两种方式"><a href="#3-4、Gateway-配置路由的两种方式" class="headerlink" title="3-4、Gateway 配置路由的两种方式"></a>3-4、Gateway 配置路由的两种方式</h3><p>Gateway 网关路由有两种配置方式：</p><ul><li><p>在配置文件 yml 中配置</p></li><li><p>代码中注入 RouteLocator 的 Bean</p></li></ul><p>自己写一个案例：通过 9527 网关访问到外网的腾讯新闻网址：<a href="http://new.qq.com/ch/tech/">http://new.qq.com/ch/tech/</a></p><p>添加配置类</p><p>当访问地址 <a href="http://localhost:9527/ch/tech">http://localhost:9527/ch/tech</a> 时会自动转发到地址：<a href="http://new.qq.com/ch/tech/">http://new.qq.com/ch/tech/</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.RouteLocator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> GateWayConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator</span><span class="params">(RouteLocatorBuilder routeLocatorBuilder)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RouteLocatorBuilder.<span class="type">Builder</span> <span class="variable">routes</span> <span class="operator">=</span> routeLocatorBuilder.routes();</span><br><span class="line"></span><br><span class="line">        routes.route(<span class="string">&quot;path_route_jcvv&quot;</span>,</span><br><span class="line">                r -&gt; r.path(<span class="string">&quot;/ch/tech&quot;</span>)</span><br><span class="line">                        .uri(<span class="string">&quot;http://new.qq.com/ch/tech/&quot;</span>)).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4、通过微服务名实现动态路由"><a href="#4、通过微服务名实现动态路由" class="headerlink" title="4、通过微服务名实现动态路由"></a>4、通过微服务名实现动态路由</h2><h3 id="4-1、以前的配置说明"><a href="#4-1、以前的配置说明" class="headerlink" title="4-1、以前的配置说明"></a>4-1、以前的配置说明</h3><p>路径写死了</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway写死了.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway路由匹配.png" alt=""></p><p>默认情况下 gateway 会根据注册中心注册的服务列表，以注册中心上微服务名为路径创建动态路由进行转发，从而实现动态路由的功能。</p><h3 id="4-2、配置动态路由"><a href="#4-2、配置动态路由" class="headerlink" title="4-2、配置动态路由"></a>4-2、配置动态路由</h3><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a><strong>application.yml</strong></h4><p>对 yml 进行配置：让其先通过 gateway，再通过 gateway 去注册中心找提供者</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_动态路由配置.png" alt=""></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">    <span class="comment">## GateWay配置</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">locator:</span></span><br><span class="line">                    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#开启从注册中心动态创建路由的功能，利用微服务名进行路由</span></span><br><span class="line">            <span class="attr">routes:</span> <span class="comment">#多个路由</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment"># 路由ID ， 没有固定的规则但要求唯一，建议配合服务名</span></span><br><span class="line"></span><br><span class="line">                  <span class="comment">#uri+predicates  要访问这个路径得先经过9527处理</span></span><br><span class="line">                  <span class="comment">#uri: http://localhost:8001  # 匹配成功后提供服务的路由地址</span></span><br><span class="line">                  <span class="comment"># lb 属于GateWay 的关键字，代表是动态uri，即代表使用的是服务注册中心的微服务名，它默认开启使用负载均衡机制</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span> <span class="comment"># 断言，路径相匹配的进行路由</span></span><br><span class="line"></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">                  <span class="comment">#uri: http://localhost:8001</span></span><br><span class="line">                  <span class="comment"># lb 属于GateWay 的关键字，代表是动态uri，即代表使用的是服务注册中心的微服务名，它默认开启使用负载均衡机制</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册进 eureka Server # 网关他本身也是一个微服务，也要注册进注册主中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>启动：一个 eureka7001 + 两个服务提供者 8001/8002</p><p>结果：8001/8002 两个端口切换</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway动态路由_顺序切换.png" alt=""></p><h2 id="5、GateWay-常用的-Predicate"><a href="#5、GateWay-常用的-Predicate" class="headerlink" title="5、GateWay 常用的 Predicate"></a>5、GateWay 常用的 Predicate</h2><h3 id="5-1、Route-Predicate-Factories-是什么"><a href="#5-1、Route-Predicate-Factories-是什么" class="headerlink" title="5-1、Route Predicate Factories 是什么?"></a>5-1、Route Predicate Factories 是什么?</h3><p>启动 idea</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_p.png" alt=""></p><p>Spring Cloud Gateway 将路由匹配作为 Spring WebFlux HandlerMapping 基础架构的一部分</p><p>Spring Cloud Gateway 包括许多内置的 Route Predicate 工厂，所有这些 Predicate 都与 HTTP 请求的不同属性匹配，多个 Route Predicate 工厂可以进行组合。</p><p>Spring Cloud Gateway 创建 Route 对象时，使用 RoutePredicateFactory 创建 Predicate 对象，Predicate 对象可以赋值给 Route。 Spring Cloud Gateway 包含许多内置的 Route Predicate Factories。</p><p>所有这些谓词都匹配 HTTP 请求的不同属性。多种谓词工厂可以组合，并通过逻辑 and。</p><h3 id="5-2、常用的-Route-Predicate"><a href="#5-2、常用的-Route-Predicate" class="headerlink" title="5-2、常用的 Route Predicate"></a>5-2、常用的 Route Predicate</h3><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_predicateFactory.png" alt=""></p><p>接下来讨论几个 Route Predicate Factory</p><h4 id="After-Route-Predicate"><a href="#After-Route-Predicate" class="headerlink" title="After Route Predicate"></a><strong>After Route Predicate</strong></h4><p>在这个时间之后这个路由才生效</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">After=2024-01-03T19:53:19.185+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><p>这个时间通过以下代码产生</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ZonedDateTime</span> <span class="variable">now</span> <span class="operator">=</span> ZonedDateTime.now();</span><br><span class="line">        System.out.println(now);</span><br><span class="line">        <span class="comment">//2022-01-03T18:53:19.185+08:00[Asia/Shanghai]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：访问报错</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_after.png" alt=""></p><h4 id="Before-Route-Predicate"><a href="#Before-Route-Predicate" class="headerlink" title="Before Route Predicate"></a><strong>Before Route Predicate</strong></h4><p>在这个时间之前这个路由才生效</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Before=2024-01-03T19:53:19.185+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><h4 id="Between-Route-Predicate"><a href="#Between-Route-Predicate" class="headerlink" title="Between Route Predicate"></a><strong>Between Route Predicate</strong></h4><p>在这个时间之间路由生效</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Between=2022-01-03T19:53:19.185+08:00[Asia/Shanghai],2022-01-03T19:53:19.185+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><h4 id="Cookie-Route-Predicate"><a href="#Cookie-Route-Predicate" class="headerlink" title="Cookie Route Predicate"></a><strong>Cookie Route Predicate</strong></h4><p>Cookie Route Predicate 需要两个参数，一个是 Cookie name，一个是正则表达式。</p><p>路由规则会通过获取对应的 Cookie name 值和正则表达式去匹配，如果匹配上就会执行路由；如果没有匹配上则不执行</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Cookie=username,jcvv</span></span><br></pre></td></tr></table></figure><p>用 curl 测试，命令行输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9527/payment/get/2 --cookie &quot;username=jcvv&quot;</span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_prdicate_cookie.png" alt=""></p><font color='red'>如果不带 cookie 进行访问，则报错</font><h4 id="Header-Route-Predicate"><a href="#Header-Route-Predicate" class="headerlink" title="Header Route Predicate"></a><strong>Header Route Predicate</strong></h4><p>两个参数：一个是属性名称和一个正则表达式，这个属性值和正则表达式匹配则执行。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><p>配置说明：请求头要有 X-Request-Id 属性并且值为整数的正则表达式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9527/payment/get/2 -H &quot;X-Request-Id:123&quot;</span><br></pre></td></tr></table></figure><h4 id="Host-Route-Predicate"><a href="#Host-Route-Predicate" class="headerlink" title="Host Route Predicate"></a><strong>Host Route Predicate</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Host=**.atguigu.org,**.another.org</span></span><br></pre></td></tr></table></figure><p>Host Route Predicate 接收一组参数，一组匹配的域名列表。</p><p>它通过参数中的主机地址作为匹配规则</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9527/payment/get/2 -H &quot;Host: news.another.org&quot;</span><br></pre></td></tr></table></figure><h4 id="Method-Route-Predicate"><a href="#Method-Route-Predicate" class="headerlink" title="Method Route Predicate"></a><strong>Method Route Predicate</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Method=GET</span></span><br></pre></td></tr></table></figure><h4 id="Path-Route-Predicate"><a href="#Path-Route-Predicate" class="headerlink" title="Path Route Predicate"></a><strong>Path Route Predicate</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br></pre></td></tr></table></figure><h4 id="Query-Route-Predicate"><a href="#Query-Route-Predicate" class="headerlink" title="Query Route Predicate"></a><strong>Query Route Predicate</strong></h4><p>支持传入两个参数，一个是属性名，一个为属性值，属性值可以是正则表达式</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Query=username,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><h2 id="6、Filter-的使用"><a href="#6、Filter-的使用" class="headerlink" title="6、Filter 的使用"></a>6、Filter 的使用</h2><h3 id="6-1、是什么"><a href="#6-1、是什么" class="headerlink" title="6-1、是什么"></a>6-1、是什么</h3><p>路由过滤器可用于修改进入的 HTTP 请求和返回的 HTTP 响应，路由过滤器只能指定路由进行使用。Spring Cloud Gateway 内置了多种路由过滤器，他们都由 GatewayFilter 的工厂类来产生。</p><h3 id="6-2、Spring-Cloud-Gateway-的-Filter"><a href="#6-2、Spring-Cloud-Gateway-的-Filter" class="headerlink" title="6-2、Spring Cloud Gateway 的 Filter"></a>6-2、Spring Cloud Gateway 的 Filter</h3><h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p>pre<br>post</p><h4 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h4><p>具体看官方文档</p><ul><li>GatewayFilter：有 31 种 Spring Cloud Gateway</li><li>GlobalFilter：有 10 种 Spring Cloud Gateway</li></ul><h4 id="常用的-GatewayFilter"><a href="#常用的-GatewayFilter" class="headerlink" title="常用的 GatewayFilter"></a>常用的 GatewayFilter</h4><p>AddRequestParameter</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">filters:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">AddRequestParameter=X-Request-Id,1024</span> <span class="comment">#过滤器工厂会在匹配的请求头加上一对请求头，名称为X-Request-Id值为1024</span></span><br></pre></td></tr></table></figure><h4 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h4><p>2 个主要接口：<code>GlobalFilter,Ordered</code></p><p>能干嘛？</p><ul><li>全局日志记录</li><li>统一网关鉴权</li><li>。。。。</li></ul><p>自定义全局过滤器配置类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogGateWayFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;************com in MyLogGateWayFilter:  &quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        <span class="comment">//合法性检验</span></span><br><span class="line">        <span class="keyword">if</span>(uname==<span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;************用户名为null, 非法用户, o(T~~T)o&quot;</span>);</span><br><span class="line">            <span class="comment">//设置 response 状态码 406</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="comment">//完成请求调用</span></span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回值是加载顺序，一般全局的都是第一位加载</span></span><br><span class="line">    <span class="comment">//这个返回的数值越小，上面的filter优先级就越高</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_filter测试.png" alt=""></p><p>相关链接：<a href="/2023/03/29/Config%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" title="Config分布式配置中心">Config分布式配置中心</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>服务降级——Hystrix断路器</title>
      <link href="/2023/03/22/%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E2%80%94%E2%80%94Hystrix%E6%96%AD%E8%B7%AF%E5%99%A8/"/>
      <url>/2023/03/22/%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E2%80%94%E2%80%94Hystrix%E6%96%AD%E8%B7%AF%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="服务降级——Hystrix-断路器"><a href="#服务降级——Hystrix-断路器" class="headerlink" title="服务降级——Hystrix 断路器"></a>服务降级——Hystrix 断路器</h1><h2 id="1、Hystrix-简述"><a href="#1、Hystrix-简述" class="headerlink" title="1、Hystrix 简述"></a>1、Hystrix 简述</h2><h3 id="1-1、分布式系统面临的问题"><a href="#1-1、分布式系统面临的问题" class="headerlink" title="1-1、分布式系统面临的问题"></a>1-1、分布式系统面临的问题</h3><p>复杂分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免地失败</p><p><img src="https://picbed.jnchan.top/springcloudImages/13hystrix.png" alt=""></p><p><strong>服务雪崩：</strong><br>多个微服务之间调用的时候，假设微服务 A 调用微服务 B 和微服务 C，微服务 B 和微服务 C 又调用其它的微服务，这就是所谓的“扇出”，如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务 A 的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的“雪崩效应”。</p><p>对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源都在几秒钟内饱和，比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加、备份队列、线程和其他系统资源紧张，导致整个系统发生更多的级联故障，这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统，所以，通常当你发现一个模块下的某个实例失败后，这时候这个模块依然还会接收流量，然后这个有问题的模块还调用了其他的模块，这样就会发生级联故障，或者叫雪崩。</p><h3 id="1-2、Hystrix-是什么"><a href="#1-2、Hystrix-是什么" class="headerlink" title="1-2、Hystrix 是什么"></a>1-2、Hystrix 是什么</h3><p>Hystrix 是一个<font color='red'>用于处理分布式系统的延迟和容错的开源库</font>，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix 能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。</p><p>“断路器”本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝），向调用方返回一个符合预期的、可处理的备选响应（FallBack），而不是长时间的等待或者抛出调用方无法处理的异常，这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩。</p><h3 id="1-3、Hystrix-能干嘛"><a href="#1-3、Hystrix-能干嘛" class="headerlink" title="1-3、Hystrix 能干嘛"></a>1-3、Hystrix 能干嘛</h3><blockquote><p>服务降级、服务熔断、接近实时的监控······</p></blockquote><p>官网资料：<a href="https://github.com/Netflix/Hystrix/wiki/How-To-Use">https://github.com/Netflix/Hystrix/wiki/How-To-Use</a></p><p>Hystrix 官宣，停更进维：<a href="https://github.com/Netflix/Hystrix">https://github.com/Netflix/Hystrix</a></p><p>被动修复 bugs、不再接受合并请求、不再发布新版本</p><h2 id="2、Hystrix-重要概念"><a href="#2、Hystrix-重要概念" class="headerlink" title="2、Hystrix 重要概念"></a>2、Hystrix 重要概念</h2><h3 id="2-1、服务降级"><a href="#2-1、服务降级" class="headerlink" title="2-1、服务降级"></a>2-1、服务降级</h3><p>服务器忙，请稍后再试，不让客户端等待并立刻返回一个友好提示，fallback</p><p>哪些情况会出发降级？</p><ul><li>程序运行异常</li><li>超时</li><li>服务熔断触发服务降级</li><li>线程池/信号量打满也会导致服务降级</li></ul><h3 id="2-2、服务熔断"><a href="#2-2、服务熔断" class="headerlink" title="2-2、服务熔断"></a>2-2、服务熔断</h3><p>类比保险丝达到最大服务访问后，直接拒绝访问，拉闸限电，然后调用服务降级的方法并返回友好提示</p><p>就是保险丝：服务的降级-&gt;进而熔断-&gt;恢复调用链路</p><h3 id="2-3、服务限流"><a href="#2-3、服务限流" class="headerlink" title="2-3、服务限流"></a>2-3、服务限流</h3><p>秒杀高并发等操作，严禁一窝蜂的过来拥挤，大家排队，一秒钟 N 个，有序进行</p><h2 id="3、hystrix-案例"><a href="#3、hystrix-案例" class="headerlink" title="3、hystrix 案例"></a>3、hystrix 案例</h2><h3 id="3-1、构建模块-payment8001"><a href="#3-1、构建模块-payment8001" class="headerlink" title="3-1、构建模块 payment8001"></a>3-1、构建模块 payment8001</h3><p>新建 cloud-provider-hystrix-payment8001</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-hystrix-payment8001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-payment</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment">#defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="service-层"><a href="#service-层" class="headerlink" title="service 层"></a>service 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 正常访问，肯定OK</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_OK,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;o(n_n)o哈哈~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">timeNumber</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(timeNumber);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOut,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;o(n_n)o哈哈~&quot;</span> + <span class="string">&quot;  耗时(s):&quot;</span>+ timeNumber + <span class="string">&quot;秒钟&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a>controller 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_OK(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_TimeOut(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="①-正常测试"><a href="#①-正常测试" class="headerlink" title="① 正常测试"></a>① 正常测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/14hystrix正常测试.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/14hystrix正常测试_timeout.png" alt=""></p><h4 id="②-高并发测试"><a href="#②-高并发测试" class="headerlink" title="② 高并发测试"></a>② 高并发测试</h4><p>使用 JMeter 进行压力测试，模拟多个请求</p><p>下载压缩包，解压，双击 /bin/ 下的 jmeter.bat 即可启动</p><p>开启 Jmeter，来 20000 个并发压死 8001，20000 个请求都去访问 paymentInfo_TimeOut 接口</p><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试1.png" alt=""></p><p>ramp up 的值是启动全部线程所需的时间</p><p>200 个线程数，循环 100 次，1 秒钟启动完毕</p><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试2.png" alt=""></p><p>添加 HTTP 请求</p><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试4.png" alt=""></p><p>测试</p><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试5.png" alt=""></p><blockquote><p>从测试可以看出，当模拟的超长请求被高并发以后，访问普通的小请求速率也会被拉低。</p></blockquote><p>两个都在自己转圈圈，为什么会被卡死？</p><p>tomcat 的默认的工作线程数被打满了，没有多余的线程来分解压力和处理<br>上面还是服务提供者 8001 自己测试，假如此时外部的消费者 80 也来访问，那消费者只能干等，最终导致消费端 80 不满意，服务端 8001 直接被拖死</p><p>看热闹不嫌弃事大，80 新建加入</p><h3 id="3-2、构建-hystrix-order80-再压测"><a href="#3-2、构建-hystrix-order80-再压测" class="headerlink" title="3-2、构建 hystrix-order80 再压测"></a>3-2、构建 hystrix-order80 再压测</h3><p>新建模块 cloud-consumer-feign-hystrix-order80</p><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-feign-hystrix-order80<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- hystrix --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># 配置服务中心，openFeign去里面找服务</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderFeignMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="service-层-1"><a href="#service-层-1" class="headerlink" title="service 层"></a>service 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFeignService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentHystrixService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-层-1"><a href="#controller-层-1" class="headerlink" title="controller 层"></a>controller 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentHystrixService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderHystirxController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystirxController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="①-正常测试-1"><a href="#①-正常测试-1" class="headerlink" title="① 正常测试"></a>① 正常测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试6.png" alt=""></p><h4 id="②-高并发测试-1"><a href="#②-高并发测试-1" class="headerlink" title="② 高并发测试"></a><strong>② 高并发测试</strong></h4><p>2W 个线程压 8001，消费端 80 微服务再去访问服务端 8001 地址</p><ul><li>要么转圈圈等待</li><li>要么消费端报超时错误</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试7.png" alt=""></p><h3 id="3-3、故障现象和导致原因"><a href="#3-3、故障现象和导致原因" class="headerlink" title="3-3、故障现象和导致原因"></a>3-3、故障现象和导致原因</h3><p>8001 同一层次的其它接口服务被困死，因为 tomcat 线程池里面的工作线程已经被挤占完毕<br>80 此时调用 8001，客户端访问响应缓慢，转圈圈<br>上述结论：正因为有上述故障或不佳表现，才有我们的降级/容错/限流等技术诞生</p><h3 id="3-4、如何解决？解决的要求"><a href="#3-4、如何解决？解决的要求" class="headerlink" title="3-4、如何解决？解决的要求"></a>3-4、如何解决？解决的要求</h3><p>超时导致服务器变慢(转圈)：超时不再等待<br>出错(宕机或程序运行出错)：出错要有兜底<br>解决：</p><p>对方服务(8001)超时了，调用者(80)不能一直卡死等待，必须有服务降级<br>对方服务(8001)宕机了，调用者(80)不能一直卡死等待，必须有服务降级<br>对方服务(8001)OK，调用者(80)自己出故障或有自我要求（自己的等待时间小于服务提供者）自己处理降级</p><hr><h2 id="4、服务降级"><a href="#4、服务降级" class="headerlink" title="4、服务降级"></a>4、服务降级</h2><h3 id="4-1、服务端降级"><a href="#4-1、服务端降级" class="headerlink" title="4-1、服务端降级"></a>4-1、服务端降级</h3><p>降级配置：在 <code>@HystrixCommand</code>里面指定超时/出错的回调方法，作为兜底方法</p><p>首先 对 8001 的 service 进行配置（对容易超时的方法进行配置) :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 正常访问，肯定OK</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_OK,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;o(n_n)o哈哈~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//降级配置：在里面指定超时/出错的回调方法，作为兜底方法</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;, //超时回调方法</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)//超时时间</span></span><br><span class="line"><span class="meta">            &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// int s =10 /0;</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">timeNumber</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(timeNumber);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOut,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;o(n_n)o哈哈~&quot;</span> + <span class="string">&quot;  耗时(s):&quot;</span> + timeNumber + <span class="string">&quot;秒钟&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOutHandler</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOutHandler,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;/(ㄒoㄒ)/~~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上图故意制造两个异常：</p><p>int s =10 /0; 计算异常<br>我们能接受 3 秒钟，它运行 5 秒钟，超时异常<br><strong>@HystrixCommand 报异常后如何处理？</strong></p><p>一旦调用服务方法失败并抛出了错误信息后，会自动调用@HystrixCommand 标注好的 fallbackMethod 调用类中的指定方法</p><p>主启动类加上 @EnableCircuitBreaker 注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>测试</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/14高并发测试8.png" alt=""></p><h3 id="4-2、消费端降级"><a href="#4-2、消费端降级" class="headerlink" title="4-2、消费端降级"></a>4-2、消费端降级</h3><p>上面的案例是服务端降级，现在我们服务端处理 3s，然后返回。但是消费端等 1s 就等不住了，这时候就需要消费端也有降级方法。</p><p>80 的降级，原理是一样的，上面的 @HystrixCommand 降级可以放在服务端，也可以放在消费端。但一般放在消费端。</p><p>主启动类加上@EnableHystrix</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.EnableHystrix;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderFeignMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># 配置服务中心，openFeign去里面找服务</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"><span class="comment"># 用于服务降级 在注解@FeignClient 中添加 fallback 属性值</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">    <span class="attr">hystrix:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>然后对 80 进行服务降级：很明显 service 层是接口，所以我们对消费者，在它的 controller 层进行降级。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentHystrixService;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderHystirxController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystirxController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,</span></span><br><span class="line"><span class="meta">                            value = &quot;5000&quot;)&#125;)</span><span class="comment">//只等1.5s</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是消费者80,对方支付系统繁忙请10秒钟后再试 或者 自己运行出错请检查自己,o(╥﹏╥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="然后出现了问题，消费端兜底失败⭐"><a href="#然后出现了问题，消费端兜底失败⭐" class="headerlink" title="然后出现了问题，消费端兜底失败⭐"></a><font color='red'><strong>然后出现了问题，消费端兜底失败</strong></font>⭐</h5><p>controller 中超时时间配置不生效原因：<br>关键在于 feign:hystrix:enabled: true 的作用，官网解释“Feign 将使用断路器包装所有方法”，也就是将@FeignClient 标记的那个 service 接口下所有的方法进行了 hystrix 包装（类似于在这些方法上加了一个@HystrixCommand），这些方法会应用一个默认的超时时间为 1s，所以你的 service 方法也有一个 1s 的超时时间，service1s 就会报异常，controller 立马进入备用方法，controller 上那个 3 秒那超时时间就没有效果了。</p><p>修改如下</p><blockquote><p>feign:<br>hystrix:<br>enabled: true # 在 feign 中开启 hystrix<br>client:<br>config:<br>default:<br>connect-timeout: 5000<br>read-timeout: 5000</p><p>hystrix:<br>command:<br>default:<br>execution:<br>isolation:<br>thread:<br>timeoutInMilliseconds: 5000</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    service-url: # 配置服务中心，openFeign去里面找服务</span><br><span class="line">      defaultZone: http://eureka7001.com:7001/eureka/</span><br><span class="line"># 用于服务降级 在注解@FeignClient 中添加 fallback 属性值</span><br><span class="line">feign:</span><br><span class="line">  hystrix:</span><br><span class="line">    enabled: true # 在feign中开启 hystrix</span><br><span class="line">  client:</span><br><span class="line">    config:</span><br><span class="line">      default:</span><br><span class="line">        connect-timeout: 5000</span><br><span class="line">        read-timeout: 5000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hystrix:</span><br><span class="line">  command:</span><br><span class="line">    default:</span><br><span class="line">      execution:</span><br><span class="line">        isolation:</span><br><span class="line">          thread:</span><br><span class="line">            timeoutInMilliseconds: 5000</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ps:配置文件这里的 timeoutInMilliseconds 并不是覆盖注解中的设置，而是两者取较低值，<br>同时也会算上 feign： ReadTimeout 的值，也就是三者取最低值。</p><h4 id="EnableHystrix-和-EnableCircuitBreaker-区别"><a href="#EnableHystrix-和-EnableCircuitBreaker-区别" class="headerlink" title="@EnableHystrix 和@EnableCircuitBreaker 区别"></a>@EnableHystrix 和@EnableCircuitBreaker 区别</h4><p>在学习服务降级中，发现了@EnableHystrix 和@EnableCircuitBreaker 的功能类似，研究后特此记录一下。</p><p>查看@EnableHystrix 的源码可以发现，它继承了@EnableCircuitBreaker，并对它进行了在封装</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line">        <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">        <span class="meta">@Documented</span></span><br><span class="line">        <span class="meta">@Inherited</span></span><br><span class="line">        <span class="meta">@EnableCircuitBreaker</span></span><br><span class="line">        <span class="keyword">public</span> <span class="meta">@interface</span> EnableHystrix &#123;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>这两个注解都是激活 hystrix 的功能，我们根据上面代码得出来结论，<font color='red'>只需要在服务启动类加入@EnableHystrix 注解即可，无须增加@EnableCircuitBreaker 注解</font>，本身@EnableHystrix 注解已经涵盖了 EnableCircuitBreaker 的功能。</p><h3 id="4-3、目前问题"><a href="#4-3、目前问题" class="headerlink" title="4-3、目前问题"></a>4-3、目前问题</h3><h4 id="每个业务方法对应一个兜底的方法，代码膨胀"><a href="#每个业务方法对应一个兜底的方法，代码膨胀" class="headerlink" title="每个业务方法对应一个兜底的方法，代码膨胀"></a>每个业务方法对应一个兜底的方法，代码膨胀</h4><p>同样和自定义分开<br>我们定义一个全局的兜底方法，这样就不用每个方法都得写兜底方法了。</p><p>全局兜底 @DefaultProperties</p><p>加了@DefaultProperties 属性注解：</p><ul><li>加了@HystrixCommand 属性注解，并且没有写具体回调方法的，就用统一全局的</li><li>加了@HystrixCommand 属性注解，写了具体回调方法的，就用自己的</li></ul><p>OrderHystirxController 头注解添加</p><blockquote><p>@DefaultProperties(defaultFallback = “payment_Global_FallbackMethod”)</p></blockquote><p>OrderHystirxController 方法添加</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 下面是全局fallback方法</span><br><span class="line">public String payment_Global_FallbackMethod() &#123;</span><br><span class="line"> return &quot;Global异常处理信息，请稍后再试，/(ㄒoㄒ)/~~&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//哪些需要默认出错调用需要添加：@HystrixCommand</span><br><span class="line"> @GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span><br><span class="line"> @HystrixCommand</span><br><span class="line"> public String paymentInfo_OK(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">     int i = 1 / 0;</span><br><span class="line">     String result = paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">     return result;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentHystrixService;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.DefaultProperties;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderHystirxController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@DefaultProperties(defaultFallback = &quot;payment_Global_FallbackMethod&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystirxController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,</span></span><br><span class="line"><span class="meta">                            value = &quot;5000&quot;)&#125;)</span><span class="comment">//只等1.5s</span></span><br><span class="line">    <span class="comment">//@HystrixCommand</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是消费者80,对方支付系统繁忙请10秒钟后再试 或者 自己运行出错请检查自己,o(╥﹏╥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面是全局fallback方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">payment_Global_FallbackMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Global异常处理信息，请稍后再试，/(ㄒoㄒ)/~~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="业务逻辑混乱在一起的问题（解耦）"><a href="#业务逻辑混乱在一起的问题（解耦）" class="headerlink" title="业务逻辑混乱在一起的问题（解耦）"></a><strong>业务逻辑混乱在一起的问题（解耦）</strong></h4><p>我们改在 service 层进行服务降级</p><p>根据 cloud-consumer-feign-hystrix-order80 已经有的 PaymentHystrixService 接口，重新新建一个类 PaymentFallbackService 实现该接口，统一为接口里面的方法进行异常处理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFallbackService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentHystrixService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----PaymentFallbackService fall back-paymentInfo_OK ,o(╥﹏╥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----PaymentFallbackService fall back-paymentInfo_TimeOut ,o(╥﹏╥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将 controller 中添加的 @HystrixCommand 和 @DefaultProperties 两个注解去掉，在@FelignClient 添加回调类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFeignService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;, fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentHystrixService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试</p><p><img src="https://picbed.jnchan.top/springcloudImages/14目前问题.png" alt=""></p><h2 id="5、服务熔断"><a href="#5、服务熔断" class="headerlink" title="5、服务熔断"></a>5、服务熔断</h2><p>断路器：一句话就是家里的保险丝</p><p>作者文章：<a href="https://martinfowler.com/bliki/CircuitBreaker.html">https://martinfowler.com/bliki/CircuitBreaker.html</a></p><h3 id="5-1、熔断是什么"><a href="#5-1、熔断是什么" class="headerlink" title="5-1、熔断是什么"></a>5-1、熔断是什么</h3><p>熔断机制是应对雪崩效应的一种微服务链路保护机制，当扇出链路的某个微服务出错不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的调用，快速返回错误的响应信息，当检测到该节点微服务调用响应正常后，恢复调用链路。</p><p>在 Spring Cloud 框架里，熔断机制通过 Hystrix 实现。Hystrix 会监控微服务间调用的状况，当失败的调用到一定阈值，缺省是 5 秒内 20 次调用失败，就会启动熔断机制。</p><p>熔断机制的注解是@HystrixCommand</p><h3 id="5-2、实操"><a href="#5-2、实操" class="headerlink" title="5-2、实操"></a>5-2、实操</h3><p>修改 cloud-provider-hystrix-payment8001</p><h4 id="PaymentService"><a href="#PaymentService" class="headerlink" title="PaymentService"></a>PaymentService</h4><p>在 PaymentService 里添加熔断方法</p><blockquote><p>//=====服务熔断<br>@HystrixCommand(fallbackMethod = “paymentCircuitBreaker_fallback”,commandProperties = {<br>@HystrixProperty(name = “circuitBreaker.enabled”,value = “true”),// 是否开启断路器<br>@HystrixProperty(name = “circuitBreaker.requestVolumeThreshold”,value = “10”),// 请求次数<br>@HystrixProperty(name = “circuitBreaker.sleepWindowInMilliseconds”,value = “10000”), // 时间窗口期<br>@HystrixProperty(name = “circuitBreaker.errorThresholdPercentage”,value = “60”),// 失败率达到多少后跳闸<br>})<br>public String paymentCircuitBreaker(@PathVariable(“id”) Integer id)<br>{<br>if(id &lt; 0)<br>{<br>throw new RuntimeException(“<strong>**</strong>id 不能负数”);<br>}<br>String serialNumber = IdUtil.simpleUUID();</p><p>return Thread.currentThread().getName()+”\t”+”调用成功，流水号: “ + serialNumber;<br>}<br>public String paymentCircuitBreaker_fallback(@PathVariable(“id”) Integer id)<br>{<br>return “id 不能负数，请稍后再试，/(ㄒ o ㄒ)/~~ id: “ +id;<br>}</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 正常访问，肯定OK</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_OK,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;o(n_n)o哈哈~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//降级配置：在里面指定超时/出错的回调方法，作为兜底方法</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;, //超时回调方法</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;5000&quot;)//超时时间</span></span><br><span class="line"><span class="meta">            &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// int s =10 /0;</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOut,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;o(n_n)o哈哈~&quot;</span> + <span class="string">&quot;  耗时(s):&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOutHandler</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;线程池:  &quot;</span>+Thread.currentThread().getName()+</span><br><span class="line">                <span class="string">&quot;  8001系统繁忙或者运行报错，请稍后再试,id:  &quot;</span>+id+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;o(╥﹏╥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//=====服务熔断</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),// 是否开启断路器</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),// 请求次数</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;), // 时间窗口期</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;),// 失败率达到多少后跳闸</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(id &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;******id 不能负数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serialNumber</span> <span class="operator">=</span> IdUtil.simpleUUID();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;调用成功，流水号: &quot;</span> + serialNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker_fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;id 不能负数，请稍后再试，/(ㄒoㄒ)/~~   id: &quot;</span> +id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-层-2"><a href="#controller-层-2" class="headerlink" title="controller 层"></a>controller 层</h4><blockquote><p>//====服务熔断<br>@GetMapping(“/payment/circuit/{id}”)<br>public String paymentCircuitBreaker(@PathVariable(“id”) Integer id) {<br>String result = paymentService.paymentCircuitBreaker(id);<br>log.info(“****result: “ + result);<br>return result;<br>}</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_OK(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_TimeOut(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//====服务熔断</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/circuit/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentCircuitBreaker(id);</span><br><span class="line">        log.info(<span class="string">&quot;****result: &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>如何测试，输入一个地址 <a href="http://localhost:8001//payment/circuit/-1，带负数。疯狂请求">http://localhost:8001//payment/circuit/-1，带负数。疯狂请求</a> 6 次以上，</p><p>然后快速把地址改为正数：<a href="http://localhost:8001//payment/circuit/1。此时，发现请求失败">http://localhost:8001//payment/circuit/1。此时，发现请求失败</a></p><p>说明熔断器开启</p><p><img src="https://picbed.jnchan.top/springcloudImages/14服务熔断.png" alt=""></p><p>实验效果为，多次出错调用 fallback 后，调用正常的也出错调用 fallback。过了一会又自己恢复了。</p><h3 id="5-3、熔断类型"><a href="#5-3、熔断类型" class="headerlink" title="5-3、熔断类型"></a>5-3、熔断类型</h3><ul><li><p>熔断打开：请求不再进行调用当前服务，内部设置时钟一半为 MTTR(平均故障处理时间),当打开时长达到所设时钟则进行半熔断状态</p></li><li><p>熔断关闭：熔断关闭不会对服务进行熔断</p></li><li>熔断半开：部分请求根据规则调用当前服务，如果请求成功且符合规则则认为当前服务恢复正常，关闭熔断</li></ul><h4 id="5-4、断路器在什么情况下开始起作用"><a href="#5-4、断路器在什么情况下开始起作用" class="headerlink" title="5-4、断路器在什么情况下开始起作用"></a>5-4、断路器在什么情况下开始起作用</h4><p>涉及到断路器的三个重要参数快照时间窗、请求总数阀值、错误百分比阀值</p><ul><li>快照时间窗：断路器确定是否打开需要统计一些请求和错误数据，而统计的时间范围就是快照时间窗，默认为最近的 10 秒。</li><li>请求总数阀值：在快照时间窗内，必须满足请求总数阀值才有资格熔断。默认为 20，意味着在 10 秒内，如果该 hystrix 命令的调用次数不足 20 次，即使所有的请求都超时或具他原因失败，断路器都不会打开。</li><li>错误百分比阀值：当请求总数在快照时间窗内超过了阀值，假设发生了 30 次调用，在这 30 次调用中，有 15 次发生了超时异常，也就是超过 50％的错误百分比，在默认设定 50％阀值情况，这时候就会将断路器打开。</li></ul><h4 id="5-5、断路器开启或者关闭的条件"><a href="#5-5、断路器开启或者关闭的条件" class="headerlink" title="5-5、断路器开启或者关闭的条件"></a>5-5、断路器开启或者关闭的条件</h4><ul><li>当满足一定的阀值的时候（默认 10 秒内超过 20 个请求次数）</li><li>当失败率达到一定的时候（默认 10 秒内超过 50%的请求失败）</li><li>到达以上阀值，断路器将会开启</li><li>当开启的时候，所有请求都不会进行转发</li><li>一段时间之后（默认是 5 秒），这个时候断路器是半开状态，会让其中一个请求进行转发；如果成功，断路器会关闭；若失败，继续开启。重复 4 和 5</li></ul><h4 id="5-6、断路器打开之后"><a href="#5-6、断路器打开之后" class="headerlink" title="5-6、断路器打开之后"></a>5-6、断路器打开之后</h4><p>再有请求调用的时候，将不会调用主逻辑，而是直接调用降级 fallback，通过断路器，实现了自动地发现错误并将降级逻辑切换为主逻辑，减少响应延迟的效果</p><h4 id="5-7、原来的主逻辑如何恢复"><a href="#5-7、原来的主逻辑如何恢复" class="headerlink" title="5-7、原来的主逻辑如何恢复"></a>5-7、原来的主逻辑如何恢复</h4><p>对于这一问题，hystrix 也为我们实现了自动恢复功能。</p><p>当断路器打开，对主逻辑进行熔断之后，hystrix 会启动一个休眠时间窗，在这个时间窗内，降级逻辑是临时的成为主逻辑，当休眠时间窗到期，断路器将进入半开状态，释放一次请求到原来的主逻辑上，如果此次请求正常返回，那么断路器将继续闭合，主逻辑恢复；如果这次请求依然有问题，断路器继续进入打开状态，休眠时间窗重新计时。</p><h4 id="5-8、-HystrixCommand-所有配置"><a href="#5-8、-HystrixCommand-所有配置" class="headerlink" title="5-8、@HystrixCommand 所有配置"></a>5-8、@HystrixCommand 所有配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;str_fallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">        groupKey = &quot;strGroupCommand&quot;,</span></span><br><span class="line"><span class="meta">        commandKey = &quot;strCommand&quot;,</span></span><br><span class="line"><span class="meta">        threadPoolKey = &quot;strThreadPool&quot;,</span></span><br><span class="line"><span class="meta">        commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                // 设置隔离策略，THREAD 表示线程池 SEMAPHORE：信号池隔离</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.strategy&quot;, value = &quot;THREAD&quot;),</span></span><br><span class="line"><span class="meta">                // 当隔离策略选择信号池隔离的时候，用来设置信号池的大小（最大并发数）</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.semaphore.maxConcurrentRequests&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // 配置命令执行的超时时间</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.timeoutinMilliseconds&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // 是否启用超时时间</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.timeout.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // 执行超时的时候是否中断</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.interruptOnTimeout&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // 执行被取消的时候是否中断</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.interruptOnCancel&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // 允许回调方法执行的最大并发数</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;fallback.isolation.semaphore.maxConcurrentRequests&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // 服务降级是否启用，是否执行回调函数</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;fallback.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // 是否启用断路器</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置在滚动时间窗中，断路器熔断的最小请求数。例如，默认该值为 20 的时候，</span></span><br><span class="line"><span class="meta">                // 如果滚动时间窗（默认10秒）内仅收到了19个请求， 即使这19个请求都失败了，断路器也不会打开。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;, value = &quot;20&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置在滚动时间窗中，表示在滚动时间窗中，在请求数量超过</span></span><br><span class="line"><span class="meta">                // circuitBreaker.requestVolumeThreshold 的情况下，如果错误请求数的百分比超过50,</span></span><br><span class="line"><span class="meta">                // 就把断路器设置为 &quot;打开&quot; 状态，否则就设置为 &quot;关闭&quot; 状态。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;50&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置当断路器打开之后的休眠时间窗。 休眠时间窗结束之后，</span></span><br><span class="line"><span class="meta">                // 会将断路器置为 &quot;半开&quot; 状态，尝试熔断的请求命令，如果依然失败就将断路器继续设置为 &quot;打开&quot; 状态，</span></span><br><span class="line"><span class="meta">                // 如果成功就设置为 &quot;关闭&quot; 状态。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.sleepWindowinMilliseconds&quot;, value = &quot;5000&quot;),</span></span><br><span class="line"><span class="meta">                // 断路器强制打开</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.forceOpen&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // 断路器强制关闭</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.forceClosed&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // 滚动时间窗设置，该时间用于断路器判断健康度时需要收集信息的持续时间</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingStats.timeinMilliseconds&quot;, value = &quot;10000&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置滚动时间窗统计指标信息时划分&quot;桶&quot;的数量，断路器在收集指标信息的时候会根据</span></span><br><span class="line"><span class="meta">                // 设置的时间窗长度拆分成多个 &quot;桶&quot; 来累计各度量值，每个&quot;桶&quot;记录了一段时间内的采集指标。</span></span><br><span class="line"><span class="meta">                // 比如 10 秒内拆分成 10 个&quot;桶&quot;收集这样，所以 timeinMilliseconds 必须能被 numBuckets 整除。否则会抛异常</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingStats.numBuckets&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置对命令执行的延迟是否使用百分位数来跟踪和计算。如果设置为 false, 那么所有的概要统计都将返回 -1。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.enabled&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置百分位统计的滚动窗口的持续时间，单位为毫秒。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.timeInMilliseconds&quot;, value = &quot;60000&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置百分位统计滚动窗口中使用 “ 桶 ”的数量。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.numBuckets&quot;, value = &quot;60000&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置在执行过程中每个 “桶” 中保留的最大执行次数。如果在滚动时间窗内发生超过该设定值的执行次数，</span></span><br><span class="line"><span class="meta">                // 就从最初的位置开始重写。例如，将该值设置为100, 滚动窗口为10秒，若在10秒内一个 “桶 ”中发生了500次执行，</span></span><br><span class="line"><span class="meta">                // 那么该 “桶” 中只保留 最后的100次执行的统计。另外，增加该值的大小将会增加内存量的消耗，并增加排序百分位数所需的计算时间。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.bucketSize&quot;, value = &quot;100&quot;),</span></span><br><span class="line"><span class="meta">                // 该属性用来设置采集影响断路器状态的健康快照（请求的成功、 错误百分比）的间隔等待时间。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.healthSnapshot.intervalinMilliseconds&quot;, value = &quot;500&quot;),</span></span><br><span class="line"><span class="meta">                // 是否开启请求缓存</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;requestCache.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // HystrixCommand的执行和事件是否打印日志到 HystrixRequestLog 中</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;requestLog.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        &#125;,</span></span><br><span class="line"><span class="meta">        threadPoolProperties = &#123;</span></span><br><span class="line"><span class="meta">                // 该参数用来设置执行命令线程池的核心线程数，该值也就是命令执行的最大并发量</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;coreSize&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // 该参数用来设置线程池的最大队列大小。当设置为 -1 时，线程池将使用 SynchronousQueue 实现的队列，</span></span><br><span class="line"><span class="meta">                // 否则将使用 LinkedBlockingQueue 实现的队列。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;maxQueueSize&quot;, value = &quot;-1&quot;),</span></span><br><span class="line"><span class="meta">                // 该参数用来为队列设置拒绝阈值。 通过该参数， 即使队列没有达到最大值也能拒绝请求。</span></span><br><span class="line"><span class="meta">                // 该参数主要是对 LinkedBlockingQueue 队列的补充,因为 LinkedBlockingQueue</span></span><br><span class="line"><span class="meta">                // 队列不能动态修改它的对象大小，而通过该属性就可以调整拒绝请求的队列大小了。</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;queueSizeRejectionThreshold&quot;, value = &quot;5&quot;),</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><h2 id="6、服务限流"><a href="#6、服务限流" class="headerlink" title="6、服务限流"></a>6、服务限流</h2><p>后面高级篇讲解 alibaba 的 Sentinel 说明</p><h2 id="7、服务监控-hystrixDashboard"><a href="#7、服务监控-hystrixDashboard" class="headerlink" title="7、服务监控 hystrixDashboard"></a>7、服务监控 hystrixDashboard</h2><h3 id="7-1、概述"><a href="#7-1、概述" class="headerlink" title="7-1、概述"></a>7-1、概述</h3><p>除了隔离依赖服务的调用以外，Hystrix 还提供了准实时的调用监控（Hystrix Dashboard）</p><p>Hystrix 会持续地记录所有通过 Hystrix 发起的请求的执行信息，并以统计报表和图形的形式展示给用户，包括每秒执行多少请求多少成功，多少失败等。Netflix 通过 hystrix-metrics-event-stream 项目实现了对以上指标的监控。Spring Cloud 也提供了 Hystrix Dashboard 的整合，对监控内容转化成可视化界面。</p><h3 id="7-2、仪表盘-9001"><a href="#7-2、仪表盘-9001" class="headerlink" title="7-2、仪表盘 9001"></a>7-2、仪表盘 9001</h3><p>新建 cloud-consumer-hystrix-dashboard9001</p><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-hystrix-dashboard9001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9001</span></span><br></pre></td></tr></table></figure><h4 id="主启动类-1"><a href="#主启动类-1" class="headerlink" title="主启动类"></a>主启动类</h4><p>加上这个注解：@EnableHystrixDashboard</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> HystrixDashboardMain9001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HystrixDashboardMain9001</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HystrixDashboardMain9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/15服务监控.png" alt=""></p><h3 id="7-3、监控实战"><a href="#7-3、监控实战" class="headerlink" title="7-3、监控实战"></a>7-3、监控实战</h3><p>所有 Provider 微服务提供类(8001/8002/8003)都需要监控依赖配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- actuator监控信息完善 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此外还要有主启动类上加 <code>@EnableCircuitBreaker</code>，用于对豪猪熔断机制的支持</p><p>8001 主启动类</p><p>此配置是为了服务监控而配置，与服务容错无关</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启动 1 个 eureka 或者 3 个 eureka 集群均可</p><p>9001 监控 8001，填写监控地址：<a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a></p><p>注意：SpringCloud 版本过高会导致一直 loading，需要降版本。</p><h4 id="错误"><a href="#错误" class="headerlink" title="错误"></a><strong>错误</strong></h4><p><img src="https://picbed.jnchan.top/springcloudImages/15服务监控_错误.png" alt=""></p><h4 id="处理方式"><a href="#处理方式" class="headerlink" title="处理方式"></a>处理方式</h4><p>在 8001 主启动类加上一下方法</p><blockquote><p>/** &gt; <em>此配置是为了服务监控而配置，与服务容错本身无关，springcloud 升级后的坑</em>ServletRegistrationBean 因为 springboot 的默认路径不是”/hystrix.stream”，<br><em>只要在自己的项目里配置上下面的 servlet 就可以了</em>/<br>@Bean<br>public ServletRegistrationBean getServlet() {<br>HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();<br>ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);<br>registrationBean.setLoadOnStartup(1);<br>registrationBean.addUrlMappings(“/hystrix.stream”);<br>registrationBean.setName(“HystrixMetricsStreamServlet”);<br>return registrationBean;<br>}</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *此配置是为了服务监控而配置，与服务容错本身无关，springcloud升级后的坑</span></span><br><span class="line"><span class="comment">     *ServletRegistrationBean因为springboot的默认路径不是&quot;/hystrix.stream&quot;，</span></span><br><span class="line"><span class="comment">     *只要在自己的项目里配置上下面的servlet就可以了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">getServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HystrixMetricsStreamServlet</span> <span class="variable">streamServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HystrixMetricsStreamServlet</span>();</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(streamServlet);</span><br><span class="line">        registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        registrationBean.addUrlMappings(<span class="string">&quot;/hystrix.stream&quot;</span>);</span><br><span class="line">        registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="再测试"><a href="#再测试" class="headerlink" title="再测试"></a>再测试</h4><p><img src="https://picbed.jnchan.top/springcloudImages/15服务监控_输入.png" alt=""></p><p>打开新网页，输入 <a href="http://localhost:8001//payment/circuit/1，再切回">http://localhost:8001//payment/circuit/1，再切回</a> hystrix dashboard，测试成功</p><p><img src="https://picbed.jnchan.top/springcloudImages/15服务监控_测试成功.png" alt=""></p><p>相关链接：<a href="/2023/03/23/Gateway%E7%BD%91%E5%85%B3/" title="Gateway网关">Gateway网关</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OpenFeign服务接口调用😐😐</title>
      <link href="/2023/03/21/OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/"/>
      <url>/2023/03/21/OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/</url>
      
        <content type="html"><![CDATA[<h1 id="OpenFeign-服务接口调用-😐😐"><a href="#OpenFeign-服务接口调用-😐😐" class="headerlink" title="OpenFeign 服务接口调用 😐😐"></a>OpenFeign 服务接口调用 😐😐</h1><h2 id="1、OpenFeign-简介"><a href="#1、OpenFeign-简介" class="headerlink" title="1、OpenFeign 简介"></a>1、OpenFeign 简介</h2><h3 id="1-1、OpenFeign-是什么"><a href="#1-1、OpenFeign-是什么" class="headerlink" title="1-1、OpenFeign 是什么"></a>1-1、OpenFeign 是什么</h3><p>Feign 是一个声明式 WebService 客户端，使用 Feign 能让编写 Web Service 客户端更加简单。</p><p>它的使用方法是定义一个服务接口然后在上面添加注解，Feign 也支持可拔插式的编码器和解码器，Spring Cloud 对 Feign 进行了封装，使其支持了 Spring MVC 标准注解和 HttpMessageConverters，Feign 可以与 Eureka 和 Ribbon 组合使用以支持负载均衡。</p><p>GitHub：<a href="https://github.com/spring-cloud/spring-cloud-openfeign">https://github.com/spring-cloud/spring-cloud-openfeign</a></p><p>官网解释：<br><a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign">https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign</a></p><h3 id="1-2、能干嘛"><a href="#1-2、能干嘛" class="headerlink" title="1-2、能干嘛"></a>1-2、能干嘛</h3><p>Feign 旨在使编写 Java Http 客户端变得更容易，前面在使用 Ribbon+RestTemplate 时，利用 RestTemplate 对 http 请求的封装处理，形成了一套模版化的调用方法。但是在实际开发中，由于对服务依赖的调用可能不止一处，往往一个接口会被多处调用，所以通常都会针对每个微服务自行封装一些客户端类来包装这些依赖服务的调用。所以，Feign 在此基础上做了进一步封装，由他来帮助我们定义和实现依赖服务接口的定义。</p><p>在 Feign 的实现下，我们只需创建一个接口并使用注解的方式来配置它(以前是 Dao 接口上面标注 Mapper 注解，现在是一个微服务接口上面标注一个 Feign 注解即可)，即可完成对服务提供方的接口绑定，简化了使用 Spring cloud Ribbon 时，自动封装服务调用客户端的开发量。</p><p>Feign 集成了 Ribbon，利用 Ribbon 维护了 Payment 的服务列表信息，并且通过轮询实现了客户端的负载均衡。而与 Ribbon 不同的是，通过 feign 只需要定义服务绑定接口且以声明式的方法，优雅而简单的实现了服务调用</p><h3 id="1-3、Feign-和-OpenFeign-两者区别"><a href="#1-3、Feign-和-OpenFeign-两者区别" class="headerlink" title="1-3、Feign 和 OpenFeign 两者区别"></a>1-3、Feign 和 OpenFeign 两者区别</h3><p>Feign：</p><p>Feign 是 Spring Cloud 组件中的一个轻量级 RESTful 的 HTTP 服务客户端<br>Feign 内置了 Ribbon，用来做客户端负载均衡，去调用服务注册中心的服务<br>Feign 的使用方式是：使用 Feign 的注解定义接口，调用这个接口，就可以调用服务注册中心的服务</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>OpenFeign：</p><p>OpenFeign 是 Spring Cloud 在 Feign 的基础上支持了 SpringMVC 的注解，如@RequesMapping 等等<br>OpenFeign 的 @FeignClient 可以解析 SpringMVC 的 @RequestMapping 注解下的接口，并通过动态代理的方式产生实现类，实现类中做负载均衡并调用其他服务</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、OpenFeign-使用步骤"><a href="#2、OpenFeign-使用步骤" class="headerlink" title="2、OpenFeign 使用步骤"></a>2、OpenFeign 使用步骤</h2><blockquote><p><strong>接口+注解：微服务调用接口+@FeignClient</strong></p></blockquote><h3 id="2-1、新建-cloud-consumer-feign-order80"><a href="#2-1、新建-cloud-consumer-feign-order80" class="headerlink" title="2-1、新建 cloud-consumer-feign-order80"></a>2-1、新建 cloud-consumer-feign-order80</h3><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-feign-order80<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Open Feign，他里面也有ribbon，所以有负载均衡 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- eureka Client --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a><strong>application.yml</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># 配置服务中心，openFeign去里面找服务</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a><strong>主启动类</strong></h4><blockquote><p>@EnableFeignClients</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderFeginMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="service-层"><a href="#service-层" class="headerlink" title="service 层"></a><strong>service 层</strong></h4><p>新建 service 接口并新增注解 @FeignClient，别忘了添加 @Component</p><p>@RequestMapping 对应调用服务端的访问地址</p><p>@FeignClient 对应调用的服务端名称</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> feign.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFeignService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-层"><a href="#controller-层" class="headerlink" title="controller 层"></a><strong>controller 层</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeginController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeginService paymentFeginService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeginService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a><strong>测试</strong></h4><p><img src="https://picbed.jnchan.top/springcloudImages/12feign测试.png" alt=""></p><h2 id="3、OpenFeign-超时控制"><a href="#3、OpenFeign-超时控制" class="headerlink" title="3、OpenFeign 超时控制"></a>3、OpenFeign 超时控制</h2><p>超时设置，故意设置超时演示出错情况：</p><ul><li>服务提供方 8001 故意写暂停程序</li><li>服务消费方 80 添加超时方法 PaymentFeignService</li><li>服务消费方 80 添加超时方法 OrderFeignControIIer</li></ul><h3 id="3-1、服务消费方-80-添加超时方法"><a href="#3-1、服务消费方-80-添加超时方法" class="headerlink" title="3-1、服务消费方 80 添加超时方法"></a>3-1、服务消费方 80 添加超时方法</h3><h4 id="service-层-1"><a href="#service-层-1" class="headerlink" title="service 层"></a>service 层</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/feign/timeout&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">paymentFeignTimeout</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentFeignTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//openfeign-ribbon ,客户端默认等待一秒钟</span></span><br><span class="line">    <span class="keyword">return</span> paymentFeignService.paymentFeignTimeout();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2、服务提供端-8001-添加超时方法"><a href="#3-2、服务提供端-8001-添加超时方法" class="headerlink" title="3-2、服务提供端 8001 添加超时方法"></a>3-2、服务提供端 8001 添加超时方法</h3><p>controller 层，对应服务端的调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentFeignTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3、测试"><a href="#3-3、测试" class="headerlink" title="3-3、测试"></a>3-3、测试</h3><p>超时</p><p><img src="https://picbed.jnchan.top/springcloudImages/12openfeign超时.png" alt=""></p><blockquote><p>Openfeign 默认超时等待为一秒，在消费方 80 配置超时时间</p></blockquote><p>设置超时时限</p><blockquote><h1 id="设置-feign-客户端超时时间-OpenFeign-默认支持-ribbon"><a href="#设置-feign-客户端超时时间-OpenFeign-默认支持-ribbon" class="headerlink" title="设置 feign 客户端超时时间(OpenFeign 默认支持 ribbon)"></a>设置 feign 客户端超时时间(OpenFeign 默认支持 ribbon)</h1><p>ribbon: #指的是建立连接所用的时间，适用于网络状况正常的情况下,两端连接所用的时间<br>ReadTimeout: 5000 #指的是建立连接后从服务器读取到可用资源所用的时间<br>ConnectTimeout: 5000</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># 配置服务中心，openFeign去里面找服务</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置feign客户端超时时间(OpenFeign默认支持ribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">    <span class="comment">#指的是建立连接所用的时间，适用于网络状况正常的情况下,两端连接所用的时间</span></span><br><span class="line">    <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">    <span class="comment">#指的是建立连接后从服务器读取到可用资源所用的时间</span></span><br><span class="line">    <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure><h2 id="4、OpenFeign-开启日志打印"><a href="#4、OpenFeign-开启日志打印" class="headerlink" title="4、OpenFeign 开启日志打印"></a>4、OpenFeign 开启日志打印</h2><p>Feign 提供了日志打印功能，我们可以通过配置来调整日志级别，从而了解 Feign 中 Http 请求的细节。</p><p>说白了就是对 Feign 接口的调用情况进行监控和输出</p><p>日志级别</p><ul><li>NONE：默认的，不显示任何日志</li><li>BASIC：仅记录请求方法、URL、响应状态码及执行时间</li><li>HEADERS：除了 BASIC 中定义的信息之外，还有请求和响应的头信息</li><li>FULL：除了 HEADERS 中定义的信息之外，还有请求和响应的正文及元数据</li></ul><h3 id="4-1、添加-config-配置类"><a href="#4-1、添加-config-配置类" class="headerlink" title="4-1、添加 config 配置类"></a>4-1、添加 config 配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> FeginConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeginConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-2、application-yml-配置"><a href="#4-2、application-yml-配置" class="headerlink" title="4-2、application.yml 配置"></a>4-2、application.yml 配置</h3><p>application.yml 中开启日志打印</p><blockquote><p>logging:<br>level:</p><h1 id="feign-日志以什么级别监控哪个接口"><a href="#feign-日志以什么级别监控哪个接口" class="headerlink" title="feign 日志以什么级别监控哪个接口"></a>feign 日志以什么级别监控哪个接口</h1><p>​ com.jcvv.springcloud.service.PaymentFeignService: debug</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># 配置服务中心，openFeign去里面找服务</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置feign客户端超时时间(OpenFeign默认支持ribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">    <span class="comment">#指的是建立连接所用的时间，适用于网络状况正常的情况下,两端连接所用的时间</span></span><br><span class="line">    <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">    <span class="comment">#指的是建立连接后从服务器读取到可用资源所用的时间</span></span><br><span class="line">    <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">    <span class="attr">level:</span></span><br><span class="line">        <span class="comment"># feign日志以什么级别监控哪个接口</span></span><br><span class="line">        <span class="attr">com.jcvv.springcloud.service.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><h3 id="4-3、测试"><a href="#4-3、测试" class="headerlink" title="4-3、测试"></a>4-3、测试</h3><p>访问地址：<a href="http://localhost/consumer/payment/get/1">localhost/consumer/payment/get/1</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/13feign日志输出.png" alt=""></p><p>相关链接：<a href="/2023/03/22/%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E2%80%94%E2%80%94Hystrix%E6%96%AD%E8%B7%AF%E5%99%A8/" title="服务降级——Hystrix断路器">服务降级——Hystrix断路器</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ribbon负载均衡服务调用😐😐</title>
      <link href="/2023/03/19/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/"/>
      <url>/2023/03/19/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Ribbon负载均衡服务调用😐😐"><a href="#Ribbon负载均衡服务调用😐😐" class="headerlink" title="Ribbon负载均衡服务调用😐😐"></a>Ribbon负载均衡服务调用😐😐</h1><h2 id="1、Ribbon简介"><a href="#1、Ribbon简介" class="headerlink" title="1、Ribbon简介"></a>1、Ribbon简介</h2><h3 id="1-1、是什么"><a href="#1-1、是什么" class="headerlink" title="1-1、是什么"></a>1-1、是什么</h3><p>Spring Cloud Ribbon是基于Netflix Ribbon实现的一套客户端负载均衡的工具。</p><p>简单的说，Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软件负载均衡算法和服务调用。Ribbon客户端组件提供一系列完善的配置项如连接超时，重试等。简单的说，就是在配置文件中列出Load Balancer（简称LB）后面所有的机器，Ribbon会自动的帮助你基于某种规则（如简单轮询，随机连接等）去连接这些机器。我们很容易使用Ribbon实现自定义的负载均衡算法。</p><h3 id="2-2、官网资料"><a href="#2-2、官网资料" class="headerlink" title="2-2、官网资料"></a>2-2、官网资料</h3><p><a href="https://github.com/Netflix/ribbon/wiki/Getting-Started">https://github.com/Netflix/ribbon/wiki/Getting-Started</a></p><p>Ribbon目前也进入维护模式 <a href="https://github.com/Netflix/ribbon">https://github.com/Netflix/ribbon</a><br><img src="https://picbed.jnchan.top/springcloudImages/11Ribbon.png" alt=""></p><p>未来替换方案</p><p><img src="https://picbed.jnchan.top/springcloudImages/11ribbon替代方案.png" alt=""></p><h3 id="1-3、能干吗"><a href="#1-3、能干吗" class="headerlink" title="1-3、能干吗"></a>1-3、能干吗</h3><p><strong>LB负载均衡(Load Balance)是什么？</strong></p><p>简单的说就是将用户的请求平摊的分配到多个服务上，从而达到系统的HA（高可用），常见的负载均衡有软件Nginx，LVS，硬件 F5等</p><p>Ribbon本地负载均衡客户端 VS Nginx服务端负载均衡区别？</p><p>Nginx是服务器负载均衡，客户端所有请求都会交给nginx，然后由nginx实现转发请求。即负载均衡是由服务端实现的<br>Ribbon是本地负载均衡，在调用微服务接口时候，会在注册中心上获取注册信息服务列表之后缓存到JVM本地，从而在本地实现RPC远程服务调用技术<br><strong>集中式LB</strong></p><p>即在服务的消费方和提供方之间使用独立的LB设施(可以是硬件，如F5, 也可以是软件，如nginx), 由该设施负责把访问请求通过某种策略转发至服务的提供方</p><p><strong>进程内LB</strong></p><p>将LB逻辑集成到消费方，消费方从服务注册中心获知有哪些地址可用，然后自己再从这些地址中选择出一个合适的服务器。Ribbon就属于进程内LB，它只是一个类库，集成于消费方进程，消费方通过它来获取到服务提供方的地址<br><strong>一句话</strong></p><blockquote><p>负载均衡+RestTemplate调用</p></blockquote><h2 id="2、Ribbon负载均衡演示"><a href="#2、Ribbon负载均衡演示" class="headerlink" title="2、Ribbon负载均衡演示"></a>2、Ribbon负载均衡演示</h2><h3 id="2-1、架构说明"><a href="#2-1、架构说明" class="headerlink" title="2-1、架构说明"></a>2-1、架构说明</h3><p>Ribbon在工作时分成两步：</p><p>第一步先选择 EurekaServer ,它优先选择在同一个区域内负载较少的server</p><p>第二步再根据用户指定的策略，从server取到的服务注册列表中选择一个地址；其中Ribbon提供了多种策略：比如轮询、随机和根据响应时间加权<br><img src="https://picbed.jnchan.top/springcloudImages/11负载均衡.png" alt=""></p><p>总结：Ribbon其实就是一个软负载均衡的客户端组件，他可以和其他所需请求的客户端结合使用，和eureka结合只是其中的一个实例。</p><h3 id="2-2、pom说明"><a href="#2-2、pom说明" class="headerlink" title="2-2、pom说明"></a>2-2、pom说明</h3><p>之前写样例时候没有引入spring-cloud-starter-ribbon也可以使用ribbon</p><p>猜测spring-cloud-starter-netflix-eureka-client自带了spring-cloud-starter-ribbon引用，</p><p>证明如下： 可以看到spring-cloud-starter-netflix-eureka-client 确实引入了Ribbon</p><p><img src="https://picbed.jnchan.top/springcloudImages/11eureka存在ribbon.png" alt=""></p><h3 id="2-3、二说RestTemplate的使用"><a href="#2-3、二说RestTemplate的使用" class="headerlink" title="2-3、二说RestTemplate的使用"></a>2-3、二说RestTemplate的使用</h3><p>官网</p><p><a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p><p>getForObject方法：返回对象为响应体中数据转化成的对象，基本上可以理解为Json</p><p>getForEntity方法：返回对象为ResponseEntity对象，包含了响应中的一些重要信息，比如响应头、响应状态码、响应体 </p><p><img src="https://picbed.jnchan.top/springcloudImages/11getForObject与getForEtity.png" alt="区别"></p><h3 id="2-4、修改cloud-consumer-order80中controller类"><a href="#2-4、修改cloud-consumer-order80中controller类" class="headerlink" title="2-4、修改cloud-consumer-order80中controller类"></a>2-4、修改cloud-consumer-order80中controller类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForObject/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment2</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForEntity/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment3</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity = restTemplate.</span><br><span class="line">            getForEntity(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        log.info(entity.getStatusCode()+<span class="string">&quot;\t&quot;</span>+entity);</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;操作失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5、测试"><a href="#2-5、测试" class="headerlink" title="2-5、测试"></a>2-5、测试</h3><p><img src="https://picbed.jnchan.top/springcloudImages/11ribbon测试.png" alt=""></p><h2 id="3、Ribbon核心组件IRule⭐⭐⭐"><a href="#3、Ribbon核心组件IRule⭐⭐⭐" class="headerlink" title="3、Ribbon核心组件IRule⭐⭐⭐"></a>3、Ribbon核心组件IRule⭐⭐⭐</h2><h3 id="3-1、IRule接口实现类说明⭐"><a href="#3-1、IRule接口实现类说明⭐" class="headerlink" title="3-1、IRule接口实现类说明⭐"></a>3-1、IRule接口实现类说明⭐</h3><p>IRule：根据特定算法中从服务列表中选取一个要访问的服务</p><p><img src="https://picbed.jnchan.top/springcloudImages/11ribbo_rule.png" alt=""></p><ul><li><p>com.netflix.loadbalancer.RoundRobinRule：轮询</p></li><li><p>com.netflix.loadbalancer.RandomRule：随机</p></li><li><p>com.netflix.loadbalancer.RetryRule：先按照RoundRobinRule的策略获取服务，如果获取服务失败则在指定时间内会进行重试，获取可用的服务</p></li><li><p>WeightedResponseTimeRule：对RoundRobinRule的扩展，响应速度越快的实例选择权重越大，越容易被选择</p></li><li><p>BestAvailableRule：会先过滤掉由于多次访问故障而处于断路器跳闸状态的服务，然后选择一个并发量最小的服务</p></li><li><p>AvailabilityFilteringRule：先过滤掉故障实例，再选择并发较小的实例</p></li><li><p>ZoneAvoidanceRule：默认规则,复合判断server所在区域的性能和server的可用性选择服务器</p><p>​            </p></li></ul><h3 id="3-2、Ribbon负载规则替换⭐"><a href="#3-2、Ribbon负载规则替换⭐" class="headerlink" title="3-2、Ribbon负载规则替换⭐"></a>3-2、Ribbon负载规则替换⭐</h3><p>修改cloud-consumer-order80</p><p><strong>注意配置细节</strong>⭐</p><p>官方文档明确给出了警告：</p><blockquote><p>这个自定义配置类<font color='red'>不能放在@ComponentScan所扫描的当前包下以及子包下</font>，否则我们自定义的这个配置类就会被所有的Ribbon客户端所共享，达不到特殊化定制的目的了。</p></blockquote><p><strong>新建package</strong></p><p>com.jcvv.myrule</p><p>新建MySelfRule规则类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyselfRule</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();<span class="comment">//定义为随机</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>主启动类添加<font color='red'>@RibbonClient</font></strong></p><p><font color='red'><strong>注意：</strong></font>@RibbonClient(name = “CLOUD-PAYMENT-SERVICE”,configuration = MyselfRule.class)中<strong>name</strong>必须<strong>和controller中的名字一致，如controller类中的PAYMENT_URL名字是大写，则为大写</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.myrule.MyselfRule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.ribbon.RibbonClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;CLOUD-PAYMENT-SERVICE&quot;,configuration = MyselfRule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、Ribbon负载均衡算法"><a href="#4、Ribbon负载均衡算法" class="headerlink" title="4、Ribbon负载均衡算法"></a>4、Ribbon负载均衡算法</h2><h3 id="4-1、原理"><a href="#4-1、原理" class="headerlink" title="4-1、原理"></a>4-1、原理</h3><p>负载均衡算法：rest接口第几次请求数 % 服务器集群总数量 = 实际调用服务器位置下标 ，每次服务重启动后rest接口计数从1开始。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">instances</span> <span class="operator">=</span> discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br></pre></td></tr></table></figure><p>如： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List [<span class="number">0</span>] instances = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span></span><br><span class="line">List [<span class="number">1</span>] instances = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8001</span></span><br></pre></td></tr></table></figure><p>8001+ 8002 组合成为集群，它们共计2台机器，集群总数为2， 按照轮询算法原理：</p><p>当总请求数为1时： 1 % 2 =1 对应下标位置为1 ，则获得服务地址为127.0.0.1:8001</p><p>当总请求数位2时： 2 % 2 =0 对应下标位置为0 ，则获得服务地址为127.0.0.1:8002</p><p>当总请求数位3时： 3 % 2 =1 对应下标位置为1 ，则获得服务地址为127.0.0.1:8001</p><h3 id="4-2、ribbon源码"><a href="#4-2、ribbon源码" class="headerlink" title="4-2、ribbon源码"></a>4-2、ribbon源码</h3><p>com.netflix.loadbalancer.RoundRobinRule类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (server == <span class="literal">null</span> &amp;&amp; count++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        List&lt;Server&gt; reachableServers = lb.getReachableServers();</span><br><span class="line">        List&lt;Server&gt; allServers = lb.getAllServers();</span><br><span class="line">        <span class="type">int</span> <span class="variable">upCount</span> <span class="operator">=</span> reachableServers.size();</span><br><span class="line">        <span class="type">int</span> <span class="variable">serverCount</span> <span class="operator">=</span> allServers.size();</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> <span class="variable">nextServerIndex</span> <span class="operator">=</span> incrementAndGetModulo(serverCount);</span><br><span class="line">        server = allServers.get(nextServerIndex);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">/* Transient. */</span></span><br><span class="line">            Thread.<span class="keyword">yield</span>();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (server.isAlive() &amp;&amp; (server.isReadyToServe())) &#123;</span><br><span class="line">            <span class="keyword">return</span> (server);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Next.</span></span><br><span class="line">        server = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (count &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;No available alive servers after 10 tries from load balancer: &quot;</span>  + lb);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> server;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">incrementAndGetModulo</span><span class="params">(<span class="type">int</span> modulo)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> nextServerCyclicCounter.get();<span class="comment">//获取原子的值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> (current + <span class="number">1</span>) % modulo;</span><br><span class="line">        <span class="keyword">if</span> (nextServerCyclicCounter.compareAndSet(current, next)) <span class="comment">//CAS</span></span><br><span class="line">            <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3、手写负载均衡器"><a href="#4-3、手写负载均衡器" class="headerlink" title="4-3、手写负载均衡器"></a><strong>4-3、手写负载均衡器</strong></h3><p>80端实现轮询</p><p>接口：从服务列表选出一台机器进行访问</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从服务列表选出一台机器进行访问</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceInstances 服务列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLB</span> <span class="keyword">implements</span> <span class="title class_">LoadBalancer</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> current;</span><br><span class="line">        <span class="type">int</span> next;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            current = <span class="built_in">this</span>.atomicInteger.get();</span><br><span class="line">            next = current &gt;= Integer.MAX_VALUE ? <span class="number">0</span> : current+<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">while</span> (!<span class="built_in">this</span>.atomicInteger.compareAndSet(current,next));</span><br><span class="line">        <span class="comment">//atomicInteger.compareAndSet(expect, update),</span></span><br><span class="line">        <span class="comment">//比较except和update，如果相等返回true，否则返回fasle</span></span><br><span class="line">        System.out.println(<span class="string">&quot;*********第&quot;</span>+next+<span class="string">&quot;次访问&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> getAndIncrement() % serviceInstances.size();</span><br><span class="line">        <span class="keyword">return</span> serviceInstances.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消费方80controller类加上自己实现的轮询方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancer loadBalancer;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/lb&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获得服务列表</span></span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(instances == <span class="literal">null</span> || instances.size()&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> loadBalancer.instances(instances);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> serviceInstance.getUri();</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">&quot; &quot;</span>+uri);</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(uri+<span class="string">&quot;/payment/lb&quot;</span>,String.class);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>服务提供者8001，8002controller加上80端调用的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/lb&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：测试的时候注释掉这两个注释，不然 restTemplate.getForObject不知道调用哪个服务，报错如下，从报错描述可知没有合适的调用对象。 </p><p><img src="https://picbed.jnchan.top/springcloudImages/12ribbon手写轮询注释1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/12ribbon手写轮询注释2.png" alt=""></p><p>相关链接：<a href="/2023/03/21/OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/" title="OpenFeign服务接口调用😐😐">OpenFeign服务接口调用😐😐</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>三个注册中心异同点⭐⭐⭐</title>
      <link href="/2023/03/18/%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%BC%82%E5%90%8C%E7%82%B9%E2%AD%90%E2%AD%90%E2%AD%90/"/>
      <url>/2023/03/18/%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%BC%82%E5%90%8C%E7%82%B9%E2%AD%90%E2%AD%90%E2%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="三个注册中心异同点-⭐⭐⭐"><a href="#三个注册中心异同点-⭐⭐⭐" class="headerlink" title="三个注册中心异同点 ⭐⭐⭐"></a>三个注册中心异同点 ⭐⭐⭐</h1><p><img src="https://picbed.jnchan.top/springcloudImages/10三个注册中心的异同点.png" alt=""></p><h2 id="1、CAP"><a href="#1、CAP" class="headerlink" title="1、CAP"></a>1、CAP</h2><p>C：Consistency（强一致性）</p><p>A：Availability（可用性）</p><p>P：Partition tolerance（分区容错性）</p><p>CAP 理论关注粒度是数据，而不是整体系统设计的策略</p><h2 id="2、经典-CAP-图"><a href="#2、经典-CAP-图" class="headerlink" title="2、经典 CAP 图"></a>2、经典 CAP 图</h2><p>最多只能同时较好的满足两个。</p><p>CAP 理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求。</p><p>因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类：</p><p>CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大<br>CP - 满足一致性，分区容忍性的系统，通常性能不是特别高<br>AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些<br><img src="https://picbed.jnchan.top/springcloudImages/10cap.png" alt=""></p><h3 id="AP-Eureka-："><a href="#AP-Eureka-：" class="headerlink" title="AP(Eureka)："></a>AP(Eureka)：</h3><p>AP 架构：</p><p>当网络分区出现后，为了保证可用性，系统 B 可以返回旧值，保证系统的可用性。</p><p>结论：违背了一致性 C 的要求，只满足可用性和分区容错，即 AP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10ap.png" alt=""></p><h3 id="CP-Zookeeper-Consul"><a href="#CP-Zookeeper-Consul" class="headerlink" title="CP(Zookeeper/Consul)"></a><strong>CP(Zookeeper/Consul)</strong></h3><p>CP 架构：</p><p>当网络分区出现后，为了保证一致性，就必须拒接请求，否则无法保证一致性</p><p>结论：违背了可用性 A 的要求，只满足一致性和分区容错，即 CP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10cp.png" alt=""></p><p>相关链接：<a href="/2023/03/19/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/" title="Ribbon负载均衡服务调用😐😐">Ribbon负载均衡服务调用😐😐</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Consul服务注册与发现😶</title>
      <link href="/2023/03/16/Consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%F0%9F%98%B6/"/>
      <url>/2023/03/16/Consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%F0%9F%98%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="Consul-服务注册与发现-😶"><a href="#Consul-服务注册与发现-😶" class="headerlink" title="Consul 服务注册与发现 😶"></a>Consul 服务注册与发现 😶</h1><h2 id="1、Consul-简介"><a href="#1、Consul-简介" class="headerlink" title="1、Consul 简介"></a>1、Consul 简介</h2><h3 id="1-1、是什么"><a href="#1-1、是什么" class="headerlink" title="1-1、是什么"></a>1-1、是什么</h3><p>Consul 是一套开源的分布式服务发现和配置管理系统，由 HashiCorp 公司用 Go 语言开发。</p><p>提供了微服务系统中的服务治理、配置中心、控制总线等功能。这些功能中的每一个都可以根据需要单独使用，也可以一起使用以构建全方位的服务网格，总之 Consul 提供了一种完整的服务网格解决方案。</p><p>它具有很多优点。包括： 基于 raft 协议，比较简洁； 支持健康检查, 同时支持 HTTP 和 DNS 协议 支持跨数据中心的 WAN 集群 提供图形界面 跨平台，支持 Linux、Mac、Windows。</p><h3 id="1-2、能干嘛"><a href="#1-2、能干嘛" class="headerlink" title="1-2、能干嘛"></a>1-2、能干嘛</h3><ul><li>服务发现：提供 HTTP 和 DNS 两种发现方式</li><li>健康监测：支持多种方式，HTTP、TCP、Docker、Shell 脚本定制化监控</li><li>KV 存储：Key、Value 的存储方式</li><li>多数据中心：Consul 支持多数据中心</li><li>可视化 Web 界面</li></ul><h3 id="1-3、去哪下"><a href="#1-3、去哪下" class="headerlink" title="1-3、去哪下"></a>1-3、去哪下</h3><p><a href="https://www.consul.io/downloads.html">https://www.consul.io/downloads.html</a></p><h3 id="1-4、使用方法"><a href="#1-4、使用方法" class="headerlink" title="1-4、使用方法"></a>1-4、使用方法</h3><p><a href="https://zhuanlan.zhihu.com/p/330373440">consul 安装教程（linux 系统） - 知乎 (zhihu.com)</a></p><h2 id="2、服务提供者注册进-Consul"><a href="#2、服务提供者注册进-Consul" class="headerlink" title="2、服务提供者注册进 Consul"></a>2、服务提供者注册进 Consul</h2><p>新建 Module 支付服务 cloud-providerconsul-payment8006</p><p>pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8006<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springcloud consul server--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springboot整合Web组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日常通用jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">consul:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8006</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8006</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8006.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>controller 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/payment/consul&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentzk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with consul: &quot;</span> + serverPort + <span class="string">&quot;\t&quot;</span> + UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试</p><p><img src="https://picbed.jnchan.top/springcloudImages/9consul.png" alt=""></p><h2 id="3、服务消费者注册进-consul"><a href="#3、服务消费者注册进-consul" class="headerlink" title="3、服务消费者注册进 consul"></a>3、服务消费者注册进 consul</h2><p><strong>新建 Module 消费服务 cloud-consumerconsul-order80</strong></p><p><strong>pom，yml，主启动类参考服务提供者</strong></p><p><strong>config 类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Controller 类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://consul-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/consul&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL+<span class="string">&quot;/payment/consul&quot;</span>,String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h1 id="六、三个注册中心异同点-⭐⭐⭐"><a href="#六、三个注册中心异同点-⭐⭐⭐" class="headerlink" title="六、三个注册中心异同点 ⭐⭐⭐"></a>六、三个注册中心异同点 ⭐⭐⭐</h1><p><img src="https://picbed.jnchan.top/springcloudImages/10三个注册中心的异同点.png" alt=""></p><h2 id="1、CAP"><a href="#1、CAP" class="headerlink" title="1、CAP"></a>1、CAP</h2><p>C：Consistency（强一致性）</p><p>A：Availability（可用性）</p><p>P：Partition tolerance（分区容错性）</p><p>CAP 理论关注粒度是数据，而不是整体系统设计的策略</p><h2 id="2、经典-CAP-图"><a href="#2、经典-CAP-图" class="headerlink" title="2、经典 CAP 图"></a>2、经典 CAP 图</h2><p>最多只能同时较好的满足两个。</p><p>CAP 理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求。</p><p>因此，根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三大类：</p><p>CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大<br>CP - 满足一致性，分区容忍性的系统，通常性能不是特别高<br>AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些<br><img src="https://picbed.jnchan.top/springcloudImages/10cap.png" alt=""></p><h3 id="AP-Eureka-："><a href="#AP-Eureka-：" class="headerlink" title="AP(Eureka)："></a>AP(Eureka)：</h3><p>AP 架构：</p><p>当网络分区出现后，为了保证可用性，系统 B 可以返回旧值，保证系统的可用性。</p><p>结论：违背了一致性 C 的要求，只满足可用性和分区容错，即 AP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10ap.png" alt=""></p><h3 id="CP-Zookeeper-Consul"><a href="#CP-Zookeeper-Consul" class="headerlink" title="CP(Zookeeper/Consul)"></a><strong>CP(Zookeeper/Consul)</strong></h3><p>CP 架构：</p><p>当网络分区出现后，为了保证一致性，就必须拒接请求，否则无法保证一致性</p><p>结论：违背了可用性 A 的要求，只满足一致性和分区容错，即 CP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10cp.png" alt=""></p><p>相关链接：<a href="/2023/03/18/%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%BC%82%E5%90%8C%E7%82%B9%E2%AD%90%E2%AD%90%E2%AD%90/" title="三个注册中心异同点⭐⭐⭐">三个注册中心异同点⭐⭐⭐</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>zookeeper服务注册中心😶</title>
      <link href="/2023/03/15/zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/"/>
      <url>/2023/03/15/zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="zookeeper-服务注册中心-😶"><a href="#zookeeper-服务注册中心-😶" class="headerlink" title="zookeeper 服务注册中心 😶"></a>zookeeper 服务注册中心 😶</h1><h2 id="1、SpringCloud-整合-Zookeeper-代替-Eureka"><a href="#1、SpringCloud-整合-Zookeeper-代替-Eureka" class="headerlink" title="1、SpringCloud 整合 Zookeeper 代替 Eureka"></a>1、SpringCloud 整合 Zookeeper 代替 Eureka</h2><h3 id="1-1、注册中心-Zookeeper"><a href="#1-1、注册中心-Zookeeper" class="headerlink" title="1-1、注册中心 Zookeeper"></a>1-1、注册中心 Zookeeper</h3><p>zookeeper 是一个分布式协调工具，可以实现注册中心功能<br>关闭 Linux 服务器防火墙后动 zookeeper 服务器<br>zookeeper 服务器取代 Eureka 服务器，zk 作为服务注册中心</p><h2 id="2、服务提供者"><a href="#2、服务提供者" class="headerlink" title="2、服务提供者"></a>2、服务提供者</h2><h3 id="2-1、新建模块-cloud-provider-payment8004"><a href="#2-1、新建模块-cloud-provider-payment8004" class="headerlink" title="2-1、新建模块 cloud-provider-payment8004"></a>2-1、新建模块 cloud-provider-payment8004</h3><p>如果 zookeeper 的版本和导入的 jar 包版本不一致，启动就会报错，由于 zk-discovery 和 zk 之间的 jar 包冲突的问题。</p><p>下图给出的是 spring-cloud-starter-zookeeper-discovery 所引入的 zookeeper jar 包版本，可在父 pom 中找到，如果自己的 zoookeeper 版本和其一致，可不用修改。</p><p>pom.xml</p><p>解决这种冲突，需要在 pom 文件中，排除掉引起冲突的 jar 包，添加和服务器 zookeeper 版本一致的 jar 包，但是新导入的 zookeeper jar 包 又有 slf4j 冲突问题，于是再次排除引起冲突的 jar 包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8004<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springcloud 整合 zookeeper 组件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 排除与zookeeper版本不一致导致 冲突的 jar包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加对应版本的jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 排除和 slf4j 冲突的 jar包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--热部署--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-provider-payment</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">zookeeper:</span></span><br><span class="line">            <span class="attr">connect-string:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:2181</span> <span class="comment"># zk地址 119.3.211.104是linux地址</span></span><br></pre></td></tr></table></figure><p>主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">//该注解用于向使用consul或者zookeeper作为注册中心时注册服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8004</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8004.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/payment/zk&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentzk</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with zookeeper: &quot;</span>+serverPort+<span class="string">&quot;\t&quot;</span>+ UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试</p><p>然后就能在 zk 里查到注册的服务信息了。</p><p><img src="https://picbed.jnchan.top/springcloudImages/9zookeeper.png" alt=""></p><h3 id="2-2、新建消费者模块-cloud-consumerzk-order80"><a href="#2-2、新建消费者模块-cloud-consumerzk-order80" class="headerlink" title="2-2、新建消费者模块 cloud-consumerzk-order80"></a>2-2、新建消费者模块 cloud-consumerzk-order80</h3><p>pom.xml，application.yml，主启动类与服务提供者类似</p><p>config 类，注入 RestTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextBean</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller 层也是和之前类似：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderZKController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://cloud-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/zk&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL+<span class="string">&quot;/payment/zk&quot;</span>,String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相关链接：<a href="/2023/03/16/Consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%F0%9F%98%B6/" title="Consul服务注册与发现😶">Consul服务注册与发现😶</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Eureka服务注册中心😶</title>
      <link href="/2023/03/14/Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/"/>
      <url>/2023/03/14/Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="Eureka-服务注册中心-😶"><a href="#Eureka-服务注册中心-😶" class="headerlink" title="Eureka 服务注册中心 😶"></a>Eureka 服务注册中心 😶</h1><p><strong>什么是服务治理：</strong></p><p>SpringCloud 封装了 Netflix 公司开发的 Eureka 模块来实现服务治理</p><p>在传统的 rpc 远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理比较复杂，所以需要使用服务治理，管理服务于服务之间依赖关系，可以实现服务调用、负载均衡、容错等，实现服务发现与注册。</p><p><strong>什么是服务注册与发现</strong>：</p><p>Eureka 采用了 CS 的设计结构，Eureka Server 服务注册功能的服务器，它是服务注册中心。而系统中的其他微服务，使用 Eureka 的客户端连接到 Eureka Server 并维持心跳连接。这样系统的维护人员就可以通过 Eureka Server 来监控系统中各个微服务是否正常运行。这点和 zookeeper 很相似</p><p>在服务注册与发现中，有一个注册中心。当服务器启动时候，会把当前自己服务器的信息 比如服务地址 通讯地址等以别名方式注册到注册中心上。另一方（消费者服务提供者），以该别名的方式去注册中心上获取到实际的服务通讯地址，然后再实现本地 RPC 调用。RPC 远程调用框架核心设计思想：在于注册中心，因为便用注册中心管理每个服务与服务之间的一个依赖关系（服务治理概念)。在任何 rpc 远程框架中，都会有一个注册中心（存放服务地址相关信息（接口地址））</p><p><img src="https://picbed.jnchan.top/springcloudImages/8da648937c52bff1a3690b6520c3f540.png" alt=""></p><p><strong>Eureka 包含两个组件：Eureka Server 和 Eureka Client</strong></p><blockquote><p>Eureka 官方停更不停用，以后可能用的越来越少。</p><p>Eureka 是 Netflix 开发的，一个基于 REST 服务的，服务注册与发现的组件，以实现中间层服务器的负载平衡和故障转移。</p><p>Eureka 分为 Eureka Server 和 Eureka Client 及服务端和客户端。</p><p><strong>Eureka Server 为注册中心，是服务端，而服务提供者和消费者即为客户端，消费者也可以是服务者，服务者也可以是消费者</strong>。同时 Eureka Server 在启动时默认会注册自己，成为一个服务，所以 Eureka Server 也是一个客户端，这是搭建 Eureka 集群的基础。</p><p><strong>Eureka Client：</strong>一个 Java 客户端，用于简化与 Eureka Server 的交互（通常就是微服务中的客户端和服务端）。通过注册中心进行访问。是一个 Java 客户端，用于简化 Eureka Server 的交互，客户端同时也具备一个内置的、使用轮询（roundrobin）负载算法的负载均衡器在应用启动后，将会向 Eureka Server 发送心跳（默认周期为 30 秒）。如果 Eureka Server 在多个心跳周期内没有接收到某个节点的心跳，Eureka Server 将会从服务注册表中把这个服务节点移除（默认 90 秒）</p><p><strong>Eureka Server：</strong>提供服务注册服务，各个微服务节，通过配置启动后，会在 Eureka Serverc 中进行注册，这样 Eureka Server 中的服务注册表中将会存储所有可用服务节点信息，服务节点的信息可以在界面中直观看到。<br>服务在 Eureka 上注册，然后每隔 30 秒发送心跳来更新它们的租约。如果客户端不能多次续订租约，那么它将在大约 90 秒内从服务器注册表中剔除。注册信息和更新被复制到集群中的所有 eureka 节点。来自任何区域的客户端都可以查找注册表信息（每 30 秒发生一次）来定位它们的服务（可能在任何区域）并进行远程调用</p><p>服务<strong>提供者</strong>向注册中心注册服务，并<strong>每隔 30 秒发送一次心跳</strong>，就如同人还活着存在的信号一样，如果 Eureka 在 90 秒后还未收到服务提供者发来的心跳时，那么它就会认定该服务已经死亡就会注销这个服务。这里注销并不是立即注销，而是会在 60 秒以后对在这个之间段内“死亡”的服务集中注销，如果立即注销，势必会对 Eureka 造成极大的负担。这些时间参数都可以人为配置。</p><p>Eureka 还有自我保护机制，如果在 15 分钟内超过 85%的节点都没有正常的心跳，那么 Eureka 就认为客户端与注册中心出现了网络故障，所以不会再接收心跳，也不会删除服务。</p><p>客户端消费者会向注册中心拉取服务列表，因为一个服务器的承载量是有限的，所以同一个服务会部署在多个服务器上，每个服务器上的服务都会去注册中心注册服务，他们会有相同的服务名称但有不同的实例 id，所以拉取的是服务列表。我们最终通过负载均衡来获取一个服务，这样可以均衡各个服务器上的服务。</p></blockquote><h2 id="1、单机-Eureka-构建步骤"><a href="#1、单机-Eureka-构建步骤" class="headerlink" title="1、单机 Eureka 构建步骤"></a>1、单机 Eureka 构建步骤</h2><p>消费者端口 80，提供者端口 8001，Eureka 端口 7001</p><p>1、创建单机 Eureka 模块 cloud-eureka-server7001</p><p>2、编写 pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-eureka-server7001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支持Entity--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka-server--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、编写 application.yml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7001</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: localhost  # eureka 服务端的实例名称</span><br><span class="line"></span><br><span class="line">  client:</span><br><span class="line">    # false 代表不向服务注册中心注册自己，因为它本身就是服务中心</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    # false 代表自己就是服务注册中心，自己的作用就是维护服务实例，并不需要去检索服务</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # 设置与 Eureka Server 交互的地址，查询服务 和 注册服务都依赖这个地址 http://localhost:7001/eureka/</span><br><span class="line">      defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></pre></td></tr></table></figure><p>4、编写主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> EurekaMain7001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span><span class="comment">//注册中心</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaMain7001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5、运行 localhost:7001，验证是否成功</p><h4 id="1-1、8001-注册进-Eureka-成为提供者"><a href="#1-1、8001-注册进-Eureka-成为提供者" class="headerlink" title="1-1、8001 注册进 Eureka 成为提供者"></a>1-1、8001 注册进 Eureka 成为提供者</h4><ul><li><p>改 pom 添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>写 YML</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># 注册进 Eureka 的服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 检索服务中心的其它服务</span></span><br><span class="line">        <span class="comment"># 单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br></pre></td></tr></table></figure></li><li><p>改主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>测试</p><p><img src="https://picbed.jnchan.top/springcloudImages/8测试eureka.png" alt=""></p></li></ul><h4 id="1-2、80-注册进-Eureka-成为消费者"><a href="#1-2、80-注册进-Eureka-成为消费者" class="headerlink" title="1-2、80 注册进 Eureka 成为消费者"></a>1-2、80 注册进 Eureka 成为消费者</h4><ul><li><p>改 pom 文件 导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>写 YML</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br></pre></td></tr></table></figure></li><li><p>编写主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2、Eureka-集群构建步骤"><a href="#2、Eureka-集群构建步骤" class="headerlink" title="2、Eureka 集群构建步骤"></a>2、Eureka 集群构建步骤</h2><p><strong>集群原理说明</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/8Eureka集群原理.png" alt=""></p><h4 id="2-1、创建模块-cloud-eureka-server7002"><a href="#2-1、创建模块-cloud-eureka-server7002" class="headerlink" title="2-1、创建模块 cloud-eureka-server7002"></a>2-1、创建模块 cloud-eureka-server7002</h4><p>与 7001 类似，就不多叙述了</p><p>第一步</p><p>找到 C:\Windows\System32\drivers\etc 路径下的 hosts 文件，修改映射配置添加进 hosts 文件，因为浏览器不识别 eureka7001.com，不添加会导致后面的服务找不到注册中心的地址。</p><p><img src="https://picbed.jnchan.top/springcloudImages/8hosts修改.png" alt=""></p><p>修改 hosts 内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#####springcloud2023项目试玩#########</span><br><span class="line">127.0.0.1       eureka7001.com</span><br><span class="line">127.0.0.1       eureka7002.com</span><br><span class="line">127.0.0.1       eureka7003.com</span><br><span class="line">####结束操作 springcloud2023项目试玩########</span><br></pre></td></tr></table></figure><p>第二步：修改 yml</p><p>7001yml</p><blockquote><p>主要配置 defaultZone: <a href="http://eureka7002.com:7002/eureka/">http://eureka7002.com:7002/eureka/</a></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eureka 服务端的实例名称</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># false 代表不向服务注册中心注册自己，因为它本身就是服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># false 代表自己就是服务注册中心，自己的作用就是维护服务实例，并不需要去检索服务</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址，查询服务 和 注册服务都依赖这个地址 http://eureka7002.com:7002/eureka/</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><p>7002yml</p><blockquote><p>主要配置 defaultZone: <a href="http://eureka7001.com:7001/eureka/">http://eureka7001.com:7001/eureka/</a></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">7002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eureka 服务端的实例名称</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># false 代表不向服务注册中心注册自己，因为它本身就是服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># false 代表自己就是服务注册中心，自己的作用就是维护服务实例，并不需要去检索服务</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址，查询服务 和 注册服务都依赖这个地址 http://eureka7001.com:7001/eureka/</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><p>8001yml</p><blockquote><p>主要配置 defaultZone: <a href="http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</a></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># 项目名,也是注册的名字</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#当前数据源操作类型</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysql驱动包</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># 注册进 Eureka 的服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 检索服务中心的其它服务</span></span><br><span class="line">        <span class="comment"># 单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># 所有Entity 别名类所在包</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><h4 id="2-2、创建模块-cloud-provider-payment8002"><a href="#2-2、创建模块-cloud-provider-payment8002" class="headerlink" title="2-2、创建模块 cloud-provider-payment8002"></a>2-2、创建模块 cloud-provider-payment8002</h4><ul><li><p>pom 文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8002<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入自己定义的api通用包，可以使用Payment支持Entity--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 图形化显示--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  devtools--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8002</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8002</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8002.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># 项目名,也是注册的名字</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#当前数据源操作类型</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysql驱动包</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># 注册进 Eureka 的服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 检索服务中心的其它服务</span></span><br><span class="line">        <span class="comment"># 单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># 所有Entity 别名类所在包</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure></li></ul><p>2、其余于 8001 类似，请参中 8001 模块</p><p>3、修改 8001/8002 中的 controller 类</p><p>主要代码</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">private String serverPort;</span><br></pre></td></tr></table></figure></blockquote><p>controller 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;*******插入结果&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;插入数据成功!&quot;</span>+serverPort,result);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;插入数据失败&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;*******插入结果&quot;</span> + payment + <span class="string">&quot;哈哈哈！！！&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (payment != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;查询成功!&quot;</span>+serverPort, payment);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;查询失败，没有对应记录&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4、对 cloud-consumer-order80 模块进行修改</p><p><strong>controller 类</strong></p><p>主要代码</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static final String PAYMENT_URL = &quot;http://CLOUD-PAYMENT-SERVICE&quot;;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="comment">//public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payment</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="comment">//payment 参数,CommonResult.class返回类型</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ApplicationContextConfig 类</p><p>主要代码：使用 LoadBalanced 注解赋予 RestTemplate 负载均衡的能力</p><blockquote><p>//使用 LoadBalanced 注解赋予 RestTemplate 负载均衡的能力<br>@LoadBalanced</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//使用LoadBalanced注解赋予RestTemplate负载均衡的能力</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3、actuator微服务信息完善"><a href="#3、actuator微服务信息完善" class="headerlink" title="3、actuator微服务信息完善"></a>3、<a href="https://so.csdn.net/so/search?q=actuator&amp;spm=1001.2101.3001.7020">actuator</a>微服务信息完善</h2><p><strong>含有主机名称设置</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/主机名称.png" alt=""></p><p>修改 8001 和 8002 yml 文件</p><p>8001 同理</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">instance</span>:</span></span><br><span class="line"><span class="class">  <span class="keyword">instance</span>-id: payment8002 # 每个提供者的id不同，显示的不再是默认的项目名</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># 项目名,也是注册的名字</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#当前数据源操作类型</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysql驱动包</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># 注册进 Eureka 的服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 检索服务中心的其它服务</span></span><br><span class="line">        <span class="comment"># 单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">payment8002</span> <span class="comment"># 每个提供者的id不同，显示的不再是默认的项目名</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># 所有Entity 别名类所在包</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><p><strong>访问信息 P 信息提示配置</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/ip信息提示.png" alt=""></p><p>为了在微服务 Eureka 控制台能看到我们的某个具体服务是在哪台服务器上部署的，我们需要配置一些内容</p><p>修改 8001 和 8002 YAML 文件</p><p>主要代码</p><blockquote><p>prefer-ip-address: true # 可以显示 ip 地址</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># 项目名,也是注册的名字</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#当前数据源操作类型</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysql驱动包</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># 注册进 Eureka 的服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 检索服务中心的其它服务</span></span><br><span class="line">        <span class="comment"># 单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">payment8001</span> <span class="comment"># 每个提供者的id不同，显示的不再是默认的项目名</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 可以显示ip地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># 所有Entity 别名类所在包</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><h2 id="4、服务发现-Discovery"><a href="#4、服务发现-Discovery" class="headerlink" title="4、服务发现 Discovery"></a>4、服务发现 Discovery</h2><p>对于注册进 eureka 里面的微服务，可以通过服务发现来获得该服务的信息。</p><h3 id="4-1、修改-8001-和-8002-的-Controller"><a href="#4-1、修改-8001-和-8002-的-Controller" class="headerlink" title="4-1、修改 8001 和 8002 的 Controller"></a><strong>4-1、修改 8001 和 8002 的 Controller</strong></h3><p>添加以下内容</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.DiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;*******插入结果&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;插入数据成功!&quot;</span>+serverPort,result);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;插入数据失败&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;*******插入结果&quot;</span> + payment + <span class="string">&quot;哈哈哈！！！&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (payment != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;查询成功!&quot;</span>+serverPort, payment);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;查询失败，没有对应记录&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/discovery&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获得服务清单列表</span></span><br><span class="line">        List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">        <span class="keyword">for</span> (String service : services) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;*****element:&quot;</span> + service);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据具体服务进一步获得该微服务的信息</span></span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (ServiceInstance instance : instances) &#123;</span><br><span class="line">            log.info(instance.getServiceId() + <span class="string">&quot;\t&quot;</span> + instance.getHost() + <span class="string">&quot;\t&quot;</span> + instance.getPort() + <span class="string">&quot;\t&quot;</span> + instance.getUri());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.discoveryClient;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-2、主启动类"><a href="#4-2、主启动类" class="headerlink" title="4-2、主启动类"></a><strong>4-2、主启动类</strong></h3><p>主启动类上添加注解：@EnableDiscoveryClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ps：在这里自己项目漏了一个东西，导致 cloud-consumer-order 为 unknow</strong></p><p>修改 cloud-consumer-order80 模块中的 application.yaml</p><p>主要遗漏代码：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">application:</span><br><span class="line"> name: cloud-consumer-order # 项目名,也是注册的名字</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-consumer-order</span> <span class="comment"># 项目名,也是注册的名字</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><h2 id="5、Eureka-自我保护"><a href="#5、Eureka-自我保护" class="headerlink" title="5、Eureka 自我保护"></a>5、Eureka 自我保护</h2><h3 id="5-1、故障现象"><a href="#5-1、故障现象" class="headerlink" title="5-1、故障现象"></a><strong>5-1、故障现象</strong></h3><p><strong>概述</strong></p><p>保护模式主要用于一组客户端和 Eureka Server 之间存在网络分区场景下的保护。一旦进入保护模式，Eureka Server 将会尝试保护其服务注册表中的信息，不再删除服务注册表中的数据，也就是不会注销任何微服务。</p><p>如果在 Eureka Server 的首页看到以下这段提示，则说明 Eureka 进入了保护模式：</p><blockquote><p>EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEY’RE NOT.</p><p>RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE</p></blockquote><h3 id="5-2、什么是自我保护模式？"><a href="#5-2、什么是自我保护模式？" class="headerlink" title="5-2、什么是自我保护模式？"></a>5-2、什么是自我保护模式？</h3><p>默认情况下，如果 EurekaServer 在一定时间内没有接收到某个微服务实例的心跳，EurekaServer 将会注销该实例（默认 90 秒）。但是当网络分区故障发生(延时、卡顿、拥挤)时，微服务与 EurekaServer 之间无法正常通信，以上行为可能变得非常危险了——因为微服务本身其实是健康的，此时本不应该注销这个微服务。Eureka 通过“自我保护模式”来解决这个问题——当 EurekaServer 节点在短时间内丢失过多客户端时（可能发生了网络分区故障），那么这个节点就会进入自我保护模式。</p><p>在自我保护模式中，Eureka Server 会保护服务注册表中的信息，不再注销任何服务实例。</p><p>综上，自我保护模式是一种应对网络异常的安全保护措施。它的架构哲学是宁可同时保留所有微服务（健康的微服务和不健康的微服务都会保留）也不盲目注销任何健康的微服务。使用自我保护模式，可以让 Eureka 集群更加的健壮、稳定。</p><blockquote><p>一句话：某时刻某一个微服务不可用了，Eureka 不会立刻清理，依旧会对该微服务的信息进行保存</p><p>属于 CAP 里面的 AP 分支</p></blockquote><h3 id="5-3、怎么禁止自我保护"><a href="#5-3、怎么禁止自我保护" class="headerlink" title="5-3、怎么禁止自我保护"></a>5-3、怎么禁止自我保护</h3><p>现在可以不用集群版了，只用开一个。</p><p>注册中心 eureakeServer 端 7001</p><p>出厂默认，自我保护机制是开启的 eureka.server.enable-self-preservation=true，使用 eureka.server.enable-self-preservation = false 可以禁用自我保护模式</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="comment"># 关闭自我保护机制，保证不可用该服务被及时剔除</span></span><br><span class="line">  <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"> <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"> <span class="attr">instance:</span></span><br><span class="line">   <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>  <span class="comment"># eureka 服务端的实例名称</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">client:</span></span><br><span class="line">   <span class="comment"># false 代表不向服务注册中心注册自己，因为它本身就是服务中心</span></span><br><span class="line">   <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">   <span class="comment"># false 代表自己就是服务注册中心，自己的作用就是维护服务实例，并不需要去检索服务</span></span><br><span class="line">   <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">service-url:</span></span><br><span class="line">     <span class="comment"># 设置与 Eureka Server 交互的地址，查询服务 和 注册服务都依赖这个地址</span></span><br><span class="line">     <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"> <span class="attr">server:</span></span><br><span class="line">   <span class="comment"># 关闭自我保护机制，保证不可用该服务被及时剔除</span></span><br><span class="line">   <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure><p><strong>生产者客户端 eureakeClient 端 8001</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Eureka客户端像服务端发送心跳的时间间隔，单位s，默认30s</span></span><br><span class="line"><span class="attr">least-renewal-interval-in-seconds:</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># Rureka服务端在收到最后一次心跳后等待时间上线，单位为s，默认90s，超时将剔除服务</span></span><br><span class="line"><span class="attr">least-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># 项目名,也是注册的名字</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#当前数据源操作类型</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysql驱动包</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># 注册进 Eureka 的服务中心</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 检索 服务中心 的其它服务</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># 设置与 Eureka Server 交互的地址</span></span><br><span class="line">            <span class="comment"># 提供者注册到多个eureka中</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="comment">#      defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">payment8001</span> <span class="comment"># 每个提供者的id不同，显示的不再是默认的项目名</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span></span><br><span class="line">            <span class="literal">true</span> <span class="comment"># 可以显示ip地址</span></span><br><span class="line">            <span class="comment"># Eureka客户端像服务端发送心跳的时间间隔，单位s，默认30s</span></span><br><span class="line">        <span class="attr">least-renewal-interval-in-seconds:</span></span><br><span class="line">            <span class="number">1</span></span><br><span class="line">            <span class="comment"># Rureka服务端在收到最后一次心跳后等待时间上线，单位为s，默认90s，超时将剔除服务</span></span><br><span class="line">        <span class="attr">least-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.atguigu.springcloud.entities</span> <span class="comment"># 所有Entity 别名类所在包</span></span><br></pre></td></tr></table></figure><p>测试</p><p>先启动 7001 再启动 8001，关闭 8001，马上被删除了</p><p><strong>Eureka 停更说明：2.0 后停更了。</strong><br>相关链接：<a href="/2023/03/15/zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/" title="zookeeper服务注册中心😶">zookeeper服务注册中心😶</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>微服务架构编码构建</title>
      <link href="/2023/03/12/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA/"/>
      <url>/2023/03/12/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="微服务架构编码构建"><a href="#微服务架构编码构建" class="headerlink" title="微服务架构编码构建"></a>微服务架构编码构建</h1><font color='red' >**约定>配置>编码**</font><h2 id="1、构建父工程"><a href="#1、构建父工程" class="headerlink" title="1、构建父工程"></a>1、构建父工程</h2><h4 id="1-1、创建项目"><a href="#1-1、创建项目" class="headerlink" title="1-1、创建项目"></a>1-1、创建项目</h4><p><img src="https://picbed.jnchan.top/springcloudImages/QQ截图20230713154102.png" alt=""></p><h4 id="1-2、字符编码"><a href="#1-2、字符编码" class="headerlink" title="1-2、字符编码"></a>1-2、字符编码</h4><p><img src="https://picbed.jnchan.top/springcloudImages/QQ截图20230713154759.png" alt=""></p><h4 id="1-3、注解生效激活"><a href="#1-3、注解生效激活" class="headerlink" title="1-3、注解生效激活"></a>1-3、注解生效激活</h4><p><img src="https://picbed.jnchan.top/springcloudImages/微信图片_20230713154955.png" alt=""></p><h4 id="1-4、java编译版本选择：java8"><a href="#1-4、java编译版本选择：java8" class="headerlink" title="1-4、java编译版本选择：java8"></a>1-4、java编译版本选择：java8</h4><p><img src="https://picbed.jnchan.top/springcloudImages/QQ截图20230713155247.png" alt=""></p><h4 id="1-5、父工程pom文件"><a href="#1-5、父工程pom文件" class="headerlink" title="1-5、父工程pom文件"></a>1-5、父工程pom文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 统一管理 jar 包版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 子块基础之后，提供作用：锁定版本 + 子module不用写 groupId 和 version --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 下面三个基本是微服务架构的标配 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring cloud 阿里巴巴--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- druid--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--log4j--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="1-5-1、技术问题"><a href="#1-5-1、技术问题" class="headerlink" title="1-5-1、技术问题"></a>1-5-1、技术问题</h5><blockquote><p>问题一、</p><p>当导入完父类的pom文件时，会导入依赖失败</p><p>原因：maven仓库中不存在该依赖，dependencyManagement附庸于已存在的依赖</p><p>解决方案：把   <dependencyManagement>标签去掉之后，填写依赖版本，下载完成后，在重新添加<dependencyManagement>标签</p><p>问题二、</p><p><fork>true</fork>爆红</p><p>解决方案：给pluin添加版本号  <version>2.3.7.RELEASE</version></p></blockquote><hr><h2 id="2、Rest微服务工程构建"><a href="#2、Rest微服务工程构建" class="headerlink" title="2、Rest微服务工程构建"></a>2、Rest微服务工程构建</h2><h3 id="2-1、创建支付模块moudle-8001"><a href="#2-1、创建支付模块moudle-8001" class="headerlink" title="2-1、创建支付模块moudle 8001"></a>2-1、创建支付模块moudle 8001</h3><p><img src="https://picbed.jnchan.top/springcloudImages/cloud-provider-payment8001.png" alt=""></p><p>父pom变化</p><p><img src="https://picbed.jnchan.top/springcloudImages/QQ截图20230713165722.png" alt=""></p><p>第一步:编写pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 图形化显示--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二步：编写application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># 项目名,也是注册的名字</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>  <span class="comment">#当前数据源操作类型</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span>    <span class="comment">#mysql驱动包</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="comment"># 所有Entity 别名类所在包</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><p>第三步:编写主启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>第四步：业务实现</p><p>1、建立SQL表(payment)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS springcloud2023</span><br><span class="line">CREATE DATABASE springcloud2023;</span><br><span class="line">USE springcloud2023;</span><br><span class="line">CREATE TABLE `payment`(</span><br><span class="line">    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ID&#x27;,</span><br><span class="line">    `serial` VARCHAR(200) DEFAULT &#x27;&#x27;,</span><br><span class="line">    PRIMARY KEY (`id`)</span><br><span class="line">)ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line">SELECT * FROM payment;</span><br></pre></td></tr></table></figure><p>2、创建实体entities</p><p><a id='entites'>抽取entities实体类到该模块中</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CommonResult</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonResult</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonResult</span><span class="params">(Integer code,String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(code, message,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3、编写dao层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.dao;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentDao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span><span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编写mybatis映射文件PaymentMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jcvv.springcloud.dao.PaymentDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;create&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Payment&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into payment(serial)</span><br><span class="line">        values (#&#123;serial&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.jcvv.springcloud.entities.Payment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">property</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPaymentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Long&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from payment</span><br><span class="line">        where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4、编写service层</p><p>4.1、编写PaymentService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span><span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.2、编写PaymentServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.dao.PaymentDao;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentDao paymentDao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.create(payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5、编写controller层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;*******插入结果&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;插入数据成功!&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;插入数据失败&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;*******插入结果&quot;</span> + payment);</span><br><span class="line">        <span class="keyword">if</span> (payment !=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;查询成功!&quot;</span>, payment);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;查询失败，没有对应记录&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>6、接口测试</p><p><img src="https://picbed.jnchan.top/springcloudImages/接口测试8001.png" alt=""></p><h3 id="2-2、热加载"><a href="#2-2、热加载" class="headerlink" title="2-2、热加载"></a>2-2、热加载</h3><h4 id="1、方式一、DevTools"><a href="#1、方式一、DevTools" class="headerlink" title="1、方式一、DevTools"></a>1、方式一、DevTools</h4><p>1、导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2、方式二、热加载之JRebel"><a href="#2、方式二、热加载之JRebel" class="headerlink" title="2、方式二、热加载之JRebel"></a>2、方式二、热加载之JRebel</h4><p><strong>安装JRebel</strong></p><p>1、在IDEA中一次点击 File-&gt;Settings-&gt;Plugins-&gt;Brows Repositories<br>2、在搜索框中输入JRebel进行搜索<br>3、找到JRebel for intellij<br>4、install<br>5、安装好之后需要restart IDEA</p><p><img src="https://picbed.jnchan.top/springcloudImages/1安装JRebel.png" alt=""></p><p><strong>激活</strong></p><p>JRebel并非免费的插件，需要激活之后才能使用。<br>1、首先到github上去下载一个反向代理软件，我下载的是windows x64版本。</p><p><a href="https://github.com/ilanyu/ReverseProxy/releases/tag/v1.4">下载地址</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/2JRebel代理.png" alt=""></p><p>2、双击运行我们下载的程序</p><p><img src="https://picbed.jnchan.top/springcloudImages/3双击打开JRebel代理.png" alt=""></p><p>3、激活JRebel配置信息</p><p>第一行输入 <a href="http://127.0.0.1:8888/d3545f42-7b88-4a77-a2da-5242c46d4bc2">http://127.0.0.1:8888/d3545f42-7b88-4a77-a2da-5242c46d4bc2</a><br>第二行输入正确的邮箱格式，例如： test@123.com<br>勾选同意协议，再点击Activate JRebel 按钮验证激活<br>提示：d3545f42-7b88-4a77-a2da-5242c46d4bc2为UUID,可以自己生成，并且必须是UUID才能通过验证</p><p><img src="https://picbed.jnchan.top/springcloudImages/4激活jrebel配置信息.png" alt=""></p><p>4、之后还会弹出来页面，相信你能应付。最后别忘了把JRebel设置为offline模式 点一下work offline</p><p><img src="https://picbed.jnchan.top/springcloudImages/6点击work offline.png" alt=""></p><h4 id="3、进行系统设置"><a href="#3、进行系统设置" class="headerlink" title="3、进行系统设置"></a>3、进行系统设置</h4><p>1、settings配置打勾</p><p><img src="https://picbed.jnchan.top/springcloudImages/QQ截图20230713202601.png" alt=""></p><p>2、打开父类pom文件</p><p>按ctrl+alt+shift+/ 弹出窗口，然后进入Registry ，勾选自动编译 -&gt; compiler.automake.allow.when.app.running</p><p><img src="https://picbed.jnchan.top/springcloudImages/devtools热部署.png" alt=""></p><p>3、重启IDEA</p><h3 id="2-3、创建消费者订单模块moudle"><a href="#2-3、创建消费者订单模块moudle" class="headerlink" title="2-3、创建消费者订单模块moudle"></a>2-3、创建消费者订单模块moudle</h3><h4 id="第一步：创建模块"><a href="#第一步：创建模块" class="headerlink" title="第一步：创建模块"></a>第一步：创建模块</h4><p>创建模块cloud-consumer-order80</p><h4 id="第二步-：导入依赖"><a href="#第二步-：导入依赖" class="headerlink" title="第二步 ：导入依赖"></a>第二步 ：导入依赖</h4><p>导入依赖（此处俺被坑了，没有用到的mybatis和数据库依赖不到导入，不然运行会出错）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-order80<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 图形化显示--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  devtools--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;scope&gt;runtime&lt;/scope&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;optional&gt;true&lt;/optional&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="第三步：编写application-yml"><a href="#第三步：编写application-yml" class="headerlink" title="第三步：编写application.yml"></a>第三步：编写application.yml</h4><p>编写application.yml文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h4 id="第四步：编写主启动类"><a href="#第四步：编写主启动类" class="headerlink" title="第四步：编写主启动类"></a>第四步：编写主启动类</h4><p>编写主启动类</p><p>com.jcvv.springcloud.OrderMain80</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="第五步业务实现"><a href="#第五步业务实现" class="headerlink" title="第五步业务实现"></a>第五步业务实现</h4><p>业务实现</p><h5 id="1、编写实体类"><a href="#1、编写实体类" class="headerlink" title="1、编写实体类"></a>1、编写实体类</h5><p>Payment</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Payment</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Payment</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  Long id;</span><br><span class="line">    <span class="keyword">private</span> String serial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CommonResult</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CommonResult</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonResult</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonResult</span><span class="params">(Integer code,String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(code, message,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2、controller层"><a href="#2、controller层" class="headerlink" title="2、controller层"></a>2、controller层</h5><h5 id="3、RestTemplate介绍"><a href="#3、RestTemplate介绍" class="headerlink" title="3、RestTemplate介绍"></a>3、<a href="https://so.csdn.net/so/search?q=RestTemplate&amp;spm=1001.2101.3001.7020">RestTemplate</a>介绍</h5><p>RestTemplate提供了多种便捷访问远程Http服务的方法， 是一种简单便捷的访问restful服务模板类，是Spring提供的用于访问Rest服务的客户端模板工具集。</p><p>官方网址：<a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p><p><strong>使用</strong></p><p>使用restTemplate访问restful接口非常的简单粗暴无脑。(url, requestMap, ResponseBean.class)这三个参数分别代表 REST请求地址、请求参数、HTTP响应转换被转换成的对象类型。</p><p>config配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="4、controller类"><a href="#4、controller类" class="headerlink" title="4、controller类"></a>4、controller类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8001&quot;</span>;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payment</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="comment">//payment 参数,CommonResult.class返回类型</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-4、使用Run-Dashboard"><a href="#2-4、使用Run-Dashboard" class="headerlink" title="2-4、使用Run Dashboard"></a>2-4、使用Run Dashboard</h3><p>第一步:</p><p><img src="https://picbed.jnchan.top/springcloudImages/7配置RunDashboard_1.png" alt=""></p><p>第二步:</p><p><img src="https://picbed.jnchan.top/springcloudImages/8配置rundashboard_2.png" alt=""></p><p>第三步:选择springboot即可</p><p>ps：如果上述列表找不到Run Dashboard,则可以在工程目录下找到.idea文件夹下的workspace.xml，在其中相应位置加入以下代码（替换）即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;RunDashboard&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;configurationTypes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;SpringBootApplicationConfigurationType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;ruleStates&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ConfigurationTypeDashboardGroupingRule&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;StatusDashboardGroupingRule&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-5、工程重构"><a href="#2-5、工程重构" class="headerlink" title="2-5、工程重构"></a>2-5、工程重构</h3><p>1、创建模块cloud-api-common</p><p>2、导入pom文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  devtools--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;scope&gt;runtime&lt;/scope&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;optional&gt;true&lt;/optional&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    工具包，功能有时间转换...--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、<a href='#entites'>抽取entities实体类到该模块中</a></p><p>相关链接：<a href="/2023/03/14/Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/" title="Eureka服务注册中心😶">Eureka服务注册中心😶</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springcloud介绍</title>
      <link href="/2023/03/12/springcloud%E4%BB%8B%E7%BB%8D/"/>
      <url>/2023/03/12/springcloud%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="一、springcloud-介绍"><a href="#一、springcloud-介绍" class="headerlink" title="一、springcloud 介绍"></a>一、springcloud 介绍</h1><h2 id="1、什么是-springcloud"><a href="#1、什么是-springcloud" class="headerlink" title="1、什么是 springcloud"></a>1、什么是 springcloud</h2><p>SpringCloud 是微服务一站式服务解决方案，微服务全家桶。它是微服务开发的主流技术栈。它采用了名称，而非数字版本号。</p><p>SpringCloud 和 springCloud Alibaba 目前是最主流的微服务框架组合。</p><h2 id="2、SpringCloud-版本选择"><a href="#2、SpringCloud-版本选择" class="headerlink" title="2、SpringCloud 版本选择"></a>2、SpringCloud 版本选择</h2><p>选用 springboot 和 springCloud 版本有约束，不按照它的约束会有冲突。</p><div class="table-container"><table><thead><tr><th><strong>Cloud Release Train</strong></th><th><strong>Boot Version</strong></th></tr></thead><tbody><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Hoxton-Release-Notes">Hoxton</a></td><td>2.2.x, 2.3.x (Starting with SR5)</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Greenwich-Release-Notes">Greenwich</a></td><td>2.1.x</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td><td>2.0.x</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td><td>1.5.x</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Dalston-Release-Notes">Dalston</a></td><td>1.5.x</td></tr></tbody></table></div><p>查看版本对应关系：<a href="https://start.spring.io/actuator/info">https://start.spring.io/actuator/info</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;git&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;986e72b4a38a4dd320be9bf55b47e54f7ccc0095&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;commit&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;986e72b&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-07-12T18:06:05Z&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.1-SNAPSHOT&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;artifact&quot;</span><span class="punctuation">:</span> <span class="string">&quot;start-site&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;versions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;spring-boot&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;initializr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.20.1-SNAPSHOT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;start.spring.io website&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-07-12T18:08:16.738Z&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;io.spring.start&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;bom-ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;codecentric-spring-boot-admin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2.6.8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;2.7.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.0.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.1.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.1.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;hilla&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2.1.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;solace-spring-boot&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;1.2.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;2.0.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;solace-spring-cloud&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2.3.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.0.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;spring-cloud&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2021.0.8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;2022.0.3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;spring-cloud-azure&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;4.9.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;5.3.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;spring-cloud-gcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;3.5.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;4.5.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;spring-cloud-services&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;3.4.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.5.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;4.0.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.1.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;spring-modulith&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;1.0.0-M1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;spring-shell&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2.1.11&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.0.6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.1.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.1.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;vaadin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;23.2.15&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;23.3.16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;24.0.9&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.1.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;24.1.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;wavefront&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2.2.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;2.3.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.0.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.1.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dependency-ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;okta&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2.1.6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.0.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;mybatis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;2.2.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;2.3.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.0.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;pulsar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;0.2.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;pulsar-reactive&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;0.2.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;camel&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;3.17.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;3.20.6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0.M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;4.0.0-RC1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;picocli&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;4.7.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.1.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;open-service-broker&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;3.5.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong><font color='red'>Ps：cloud 版本决定了 boot 版本</font></strong></p><h2 id="3、微服务停更说明"><a href="#3、微服务停更说明" class="headerlink" title="3、微服务停更说明"></a>3、微服务停更说明</h2><p>以前：</p><p><img src="https://picbed.jnchan.top/springcloudImages/20230713143610.png" alt=""></p><p>现在：</p><p>1、Eureka 停用,可以使用 zk 作为服务注册中心</p><p>2、服务调用,Ribbon 准备停更,代替为 LoadBalance</p><p>3、Feign 改为 OpenFeign</p><p>4、Hystrix 停更,改为 resilence4j,或者阿里巴巴的 sentienl</p><p>5、Zuul 改为 gateway</p><p>6、服务配置 Config 改为 Nacos</p><p>7、服务总线 Bus 改为 Nacos</p><h2 id="4、要学点"><a href="#4、要学点" class="headerlink" title="4、要学点"></a>4、要学点</h2><p><img src="https://picbed.jnchan.top/springcloudImages/QQ截图20230713151804.png" alt=""></p><p>参考资料：<a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/">springcloud</a> <a href="https://www.bookstack.cn/read/spring-cloud-docs/docs-index.md">springcloud 中文文档</a> <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/htmlsingle/">springboot v2.2.2</a></p><h2 id="5、课程所用软件版本"><a href="#5、课程所用软件版本" class="headerlink" title="5、课程所用软件版本"></a>5、课程所用软件版本</h2><div class="table-container"><table><thead><tr><th>cloud</th><th>Hoxton.SR1</th></tr></thead><tbody><tr><td>boot</td><td>2.2.2.RELEASE</td></tr><tr><td>cloud alibaba</td><td>2.1.0.RELEASE</td></tr><tr><td>java</td><td>java8</td></tr><tr><td>maven</td><td>3.5 及以上</td></tr><tr><td>mysql</td><td>5.7 及以上</td></tr></tbody></table></div><p>相关链接：<a href="/2023/03/12/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA/" title="微服务架构编码构建">微服务架构编码构建</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>maven中遇到依赖下载失败问题</title>
      <link href="/2023/01/12/maven/"/>
      <url>/2023/01/12/maven/</url>
      
        <content type="html"><![CDATA[<h3 id="依赖下载失败错误"><a href="#依赖下载失败错误" class="headerlink" title="依赖下载失败错误"></a>依赖下载失败错误</h3><p>maven 中加入<code>&lt;dependencyManagement&gt;</code>报错不能下载依赖，去掉该标签后，即可下载依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>过来看电影呀</title>
      <link href="/2023/01/12/%E8%BF%87%E6%9D%A5%E7%9C%8B%E5%8A%A8%E6%BC%AB%E5%91%80/"/>
      <url>/2023/01/12/%E8%BF%87%E6%9D%A5%E7%9C%8B%E5%8A%A8%E6%BC%AB%E5%91%80/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>redis的使用</title>
      <link href="/2022/01/12/Redis%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/01/12/Redis%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><hr><h2 id="1、Nosql-概述"><a href="#1、Nosql-概述" class="headerlink" title="1、Nosql 概述"></a>1、Nosql 概述</h2><hr><h3 id="1-1、为什么使用-nosql"><a href="#1-1、为什么使用-nosql" class="headerlink" title="1.1、为什么使用 nosql"></a>1.1、为什么使用 nosql</h3><hr><p><strong>单机 Mysql 时代</strong></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516220238091.png" alt="image-20210516220238091"></p><p>90 年代,一个网站的访问量一般不会太大，单个数据库完全够用。随着用户增多，网站出现以下问题</p><ol><li>数据量增加到一定程度，单机数据库就放不下了</li><li>数据的索引（B+ Tree）,一个机器内存也存放不下</li><li>访问量变大后（读写混合），一台服务器承受不住。</li></ol><p><strong>Memcached(缓存) + Mysql + 垂直拆分（读写分离）</strong></p><p>网站 80%的情况都是在读，每次都要去查询数据库的话就十分的麻烦！所以说我们希望减轻数据库的压力，我们可以使用缓存来保证效率！</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516220519407.png" alt="image-20210516220519407"></p><p>优化过程经历了以下几个过程：</p><ol><li>优化数据库的数据结构和索引(难度大)</li><li>文件缓存，通过 IO 流获取比每次都访问数据库效率略高，但是流量爆炸式增长时候，IO 流也承受不了</li><li>MemCache,当时最热门的技术，通过在数据库和数据库访问层之间加上一层缓存，第一次访问时查询数据库，将结果保存到缓存，后续的查询先检查缓存，若有直接拿去使用，效率显著提升。</li></ol><p><strong>分库分表 + 水平拆分 + Mysql 集群</strong></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516220720755.png" alt="image-20210516220720755"></p><p><strong>如今最近的年代</strong></p><p>如今信息量井喷式增长，各种各样的数据出现（用户定位数据，图片数据等），大数据的背景下关系型数据库（RDBMS）无法满足大量数据要求。Nosql 数据库就能轻松解决这些问题。</p><p><strong>目前一个基本的互联网项目</strong></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516220816818.png" alt="image-20210516220816818"></p><p><strong>为什么要用 NoSQL ？</strong></p><p>用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！<br>这时候我们就需要使用 NoSQL 数据库的，Nosql 可以很好的处理以上的情况！</p><h3 id="1-2、什么是-NoSql"><a href="#1-2、什么是-NoSql" class="headerlink" title="1.2、什么是 NoSql"></a>1.2、什么是 NoSql</h3><p>NoSQL = Not Only SQL（不仅仅是 SQL）</p><p>Not Only Structured Query Language</p><p>关系型数据库：列+行，同一个表下数据的结构是一样的。</p><p>非关系型数据库：数据存储没有固定的格式，并且可以进行横向扩展。</p><p>NoSQL 泛指非关系型数据库，随着 web2.0 互联网的诞生，传统的关系型数据库很难对付 web2.0 时代！尤其是超大规模的高并发的社区，暴露出来很多难以克服的问题，NoSQL 在当今大数据环境下发展的十分迅速，Redis 是发展最快的。</p><h3 id="1-3、Nosql-特点"><a href="#1-3、Nosql-特点" class="headerlink" title="1.3、Nosql 特点"></a>1.3、Nosql 特点</h3><ol><li><p>方便扩展（数据之间没有关系，很好扩展！）</p></li><li><p>大数据量高性能（Redis 一秒可以写 8 万次，读 11 万次，NoSQL 的缓存记录级，是一种细粒度的缓存，性能会比较高！）</p></li><li><p>数据类型是多样型的！（不需要事先设计数据库，随取随用）</p></li><li><p>传统的 RDBMS 和 NoSQL</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">传统的 RDBMS(关系型数据库)</span><br><span class="line">- 结构化组织</span><br><span class="line">- SQL</span><br><span class="line">- 数据和关系都存在单独的表中 row col</span><br><span class="line">- 操作，数据定义语言</span><br><span class="line">- 严格的一致性</span><br><span class="line">- 基础的事务</span><br></pre></td></tr></table></figure></li><li><p>```bush<br>Nosql</p><ul><li>不仅仅是数据</li><li>没有固定的查询语言</li><li>键值对存储，列存储，文档存储，图形数据库（社交关系）</li><li>最终一致性</li><li>CAP定理和BASE</li><li>高性能，高可用，高扩展</li><li>..<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**了解：3V + 3 高**</span><br><span class="line"></span><br><span class="line">大数据时代的 3V ：主要是描述问题的</span><br><span class="line"></span><br><span class="line">1. 海量 Velume</span><br><span class="line">2. 多样 Variety</span><br><span class="line">3. 实时 Velocity</span><br><span class="line"></span><br><span class="line">大数据时代的 3 高 ： 主要是对程序的要求</span><br><span class="line"></span><br><span class="line">1. 高并发</span><br><span class="line">2. 高可扩</span><br><span class="line">3. 高性能</span><br><span class="line"></span><br><span class="line">真正在公司中的实践：NoSQL + RDBMS 一起使用才是最强的。</span><br><span class="line"></span><br><span class="line">### 1.4、阿里巴巴演进分析</span><br><span class="line"></span><br><span class="line">推荐阅读：阿里云的这群疯子https://yq.aliyun.com/articles/653511</span><br><span class="line"></span><br><span class="line">![1](https://img-blog.csdnimg.cn/20200820103829446.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RERERlbmdf,size_16,color_FFFFFF,t_70#pic_center)</span><br><span class="line"></span><br><span class="line">![在这里插入图片描述](https://img-blog.csdnimg.cn/20200820103851613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RERERlbmdf,size_16,color_FFFFFF,t_70#pic_center)</span><br><span class="line"></span><br><span class="line">```bush</span><br><span class="line"># 商品信息</span><br><span class="line">- 一般存放在关系型数据库：Mysql,阿里巴巴使用的Mysql都是经过内部改动的。</span><br><span class="line"></span><br><span class="line"># 商品描述、评论(文字居多)</span><br><span class="line">- 文档型数据库：MongoDB</span><br><span class="line"></span><br><span class="line"># 图片</span><br><span class="line">- 分布式文件系统 FastDFS</span><br><span class="line">- 淘宝：TFS</span><br><span class="line">- Google: GFS</span><br><span class="line">- Hadoop: HDFS</span><br><span class="line">- 阿里云: oss</span><br><span class="line"></span><br><span class="line"># 商品关键字 用于搜索</span><br><span class="line">- 搜索引擎：solr,elasticsearch</span><br><span class="line">- 阿里：Isearch 多隆</span><br><span class="line"></span><br><span class="line"># 商品热门的波段信息</span><br><span class="line">- 内存数据库：Redis，Memcache</span><br><span class="line"></span><br><span class="line"># 商品交易，外部支付接口</span><br><span class="line">- 第三方应用</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="1-5、Nosql-的四大分类"><a href="#1-5、Nosql-的四大分类" class="headerlink" title="1.5、Nosql 的四大分类"></a>1.5、Nosql 的四大分类</h3><p><strong>KV 键值对</strong></p><ul><li>新浪：Redis</li><li>美团：Redis + Tair</li><li>阿里、百度：Redis + Memcache</li></ul><p><strong>文档型数据库（bson 数据格式）：</strong></p><ul><li>MongoDB(掌握)<ul><li>基于分布式文件存储的数据库。C++编写，用于处理大量文档。</li><li>MongoDB 是 RDBMS 和 NoSQL 的中间产品。MongoDB 是非关系型数据库中功能最丰富的，NoSQL 中最像关系型数据库的数据库。</li></ul></li><li>ConthDB</li></ul><p><strong>列存储数据库</strong></p><ul><li>HBase(大数据必学)</li><li>分布式文件系统</li></ul><p><strong>图关系数据库</strong></p><p>用于广告推荐，社交网络</p><ul><li>Neo4j、InfoGrid</li></ul><div class="table-container"><table><thead><tr><th>分类</th><th>Examples 举例</th><th>典型应用场景</th><th>数据模型</th><th>优点</th><th style="text-align:center">缺点</th></tr></thead><tbody><tr><td>键值对（key-value）</td><td>Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td><td>内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。</td><td>Key 指向 Value 的键值对，通常用 hash table 来实现</td><td>查找速度快</td><td style="text-align:center">数据无结构化，通常只被当作字符串或者二进制数据</td></tr><tr><td>列存储数据库</td><td>Cassandra, HBase, Riak</td><td>分布式的文件系统</td><td>以列簇式存储，将同一列数据存在一起</td><td>查找速度快，可扩展性强，更容易进行分布式扩展</td><td style="text-align:center">功能相对局限</td></tr><tr><td>文档型数据库</td><td>CouchDB, MongoDb</td><td>Web 应用（与 Key-Value 类似，Value 是结构化的，不同的是数据库能够了解 Value 的内容）</td><td>Key-Value 对应的键值对，Value 为结构化数据</td><td>数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td><td style="text-align:center">查询性能不高，而且缺乏统一的查询语法。</td></tr><tr><td>图形(Graph)数据库</td><td>Neo4J, InfoGrid, Infinite Graph</td><td>社交网络，推荐系统等。专注于构建关系图谱</td><td>图结构</td><td>利用图结构相关算法。比如最短路径寻址，N 度关系查找等</td><td style="text-align:center">很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群</td></tr></tbody></table></div><h2 id="2、Redis-入门"><a href="#2、Redis-入门" class="headerlink" title="2、Redis 入门"></a>2、Redis 入门</h2><hr><h3 id="2-1、概述"><a href="#2-1、概述" class="headerlink" title="2.1、概述"></a>2.1、概述</h3><blockquote><p>Redis 是什么？</p></blockquote><p>Redis（Remote Dictionary Server )，即远程字典服务。</p><p>是一个开源的使用 ANSI C 语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value 数据库，并提供多种语言的 API。</p><p>与 memcached 一样，为了保证效率，数据都是缓存在内存中。区别的是 redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 master-slave(主从)同步。</p><blockquote><p>Redis 能该干什么？</p></blockquote><ol><li>内存存储、持久化，内存是断电即失的，所以需要持久化（RDB、AOF）</li><li>高效率、用于高速缓冲</li><li>发布订阅系统</li><li>地图信息分析</li><li>计时器、计数器(eg：浏览量)</li><li>。。。</li></ol><blockquote><p>特性</p></blockquote><ol><li><p>多样的数据类型</p></li><li><p>持久化</p></li><li><p>集群</p></li><li><p>事务</p><p> …</p></li></ol><h3 id="2-2、环境搭建"><a href="#2-2、环境搭建" class="headerlink" title="2.2、环境搭建"></a>2.2、环境搭建</h3><p>官网：<a href="https://redis.io/">https://redis.io/</a></p><p>推荐使用 Linux 服务器学习。</p><p>windows 版本的 Redis 已经停更很久了…</p><h4 id="2-2-1、Linux-安装"><a href="#2-2-1、Linux-安装" class="headerlink" title="2.2.1、Linux 安装"></a>2.2.1、Linux 安装</h4><ol><li>下载安装包！<code>redis-5.0.8.tar.gz</code></li><li>解压 Redis 的安装包！程序一般放在 <code>/opt</code> 目录下</li></ol><p><img src="https://picbed.jnchan.top/redisImages/image-20210516221633789.png" alt="image-20210516221633789"></p><p>​ 3.基本环境安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br><span class="line"># 然后进入redis目录下执行</span><br><span class="line">make</span><br><span class="line"># 然后执行</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/redisImages/image-20210516221849467.png" alt="image-20210516221849467"></p><p>4.redis 默认安装路径 <code>/usr/local/bin</code></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516221928738.png" alt="image-20210516221928738"></p><p>5.将 redis 的配置文件复制到 程序安装目录 <code>/usr/local/bin/huangconfig</code>下</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516222019691.png" alt="image-20210516222019691"></p><p>6.redis 默认不是后台启动的，需要修改配置文件！</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516222100044.png" alt="image-20210516222100044"></p><p>7.通过制定的配置文件启动 redis 服务</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516222117568.png" alt="image-20210516222117568"></p><p>8.使用 redis-cli 连接指定的端口号测试，Redis 的默认端口 6379</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516222345701.png" alt="image-20210516222345701"></p><p>9.查看 redis 进程是否开启</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516222451085.png" alt="image-20210516222451085"></p><p>10.关闭 Redis 服务 <code>shutdown</code></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516222514046.png" alt="image-20210516222514046"></p><p>11.再次查看进程</p><p>12.后面我们会使用单机多 Redis 启动集群测试</p><h3 id="2-3-测试性能"><a href="#2-3-测试性能" class="headerlink" title="2.3 测试性能"></a>2.3 测试性能</h3><p><strong>redis-benchmark：</strong>Redis 官方提供的性能测试工具，参数选项如下：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210516222701671.png" alt="image-20210516222701671"></p><p><strong>简单测试：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试：100个并发连接 100000请求</span></span><br><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 100000</span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/redisImages/image-20210517111003925.png" alt="image-20210517111003925"></p><p><strong>基础知识</strong></p><blockquote><p>redis 默认有 16 个数据库</p></blockquote><p><img src="https://picbed.jnchan.top/redisImages/image-20210517111019576.png" alt="image-20210517111019576"></p><p>默认使用的第 0 个;</p><p>16 个数据库为：DB 0~DB 15<br>默认使用 DB 0 ，可以使用<code>select n</code>切换到 DB n，<code>dbsize</code>可以查看当前数据库的大小，与 key 数量相关。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get databases <span class="comment"># 命令行查看数据库数量databases</span></span><br><span class="line">1) <span class="string">&quot;databases&quot;</span></span><br><span class="line">2) <span class="string">&quot;16&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="keyword">select</span> 8 <span class="comment"># 切换数据库 DB 8</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[8]&gt; dbsize <span class="comment"># 查看数据库大小</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><p># 不同数据库之间 数据是不能互通的，并且 dbsize 是根据库中 key 的个数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name sakura</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SELECT 8</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[8]&gt; get name <span class="comment"># db8中并不能获取db0中的键值对。</span></span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379[8]&gt; DBSIZE</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379[8]&gt; SELECT 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;counter:__rand_int__&quot;</span></span><br><span class="line">2) <span class="string">&quot;mylist&quot;</span></span><br><span class="line">3) <span class="string">&quot;name&quot;</span></span><br><span class="line">4) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">5) <span class="string">&quot;myset:__rand_int__&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; DBSIZE <span class="comment"># size和key个数相关</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure><p><code>keys *</code> ：查看当前数据库中所有的 key。</p><p><code>flushdb</code>：清空当前数据库中的键值对。</p><p><code>flushall</code>：清空所有数据库的键值对。</p><blockquote><p>Redis 是单线程的，Redis 是基于内存操作的。</p></blockquote><p>所以 Redis 的性能瓶颈不是 CPU,而是机器内存和网络带宽。</p><p>那么为什么 Redis 的速度如此快呢，性能这么高呢？QPS 达到 10W+</p><blockquote><p>Redis 为什么单线程还这么快？</p></blockquote><ul><li>误区 1：高性能的服务器一定是多线程的？</li><li>误区 2：多线程（CPU 上下文会切换！）一定比单线程效率高！</li></ul><p>核心：Redis 是将所有的数据放在内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU 上下文会切换：耗时的操作！），对于内存系统来说，如果没有上下文切换效率就是最高的，多次读写都是在一个 CPU 上的，在内存存储数据情况下，单线程就是最佳的方案。</p><h2 id="3、五大数据类型"><a href="#3、五大数据类型" class="headerlink" title="3、五大数据类型"></a>3、五大数据类型</h2><hr><p>Redis 是一个开源（BSD 许可），内存存储的数据结构服务器，可用作数据库，高速缓存和消息队列代理。它支持<a href="https://www.redis.net.cn/tutorial/3508.html">字符串</a>、<a href="https://www.redis.net.cn/tutorial/3509.html">哈希表</a>、<a href="https://www.redis.net.cn/tutorial/3510.html">列表</a>、<a href="https://www.redis.net.cn/tutorial/3511.html">集合</a>、<a href="https://www.redis.net.cn/tutorial/3512.html">有序集合</a>，<a href="https://www.redis.net.cn/tutorial/3508.html">位图</a>，<a href="https://www.redis.net.cn/tutorial/3513.html">hyperloglogs</a>等数据类型。内置复制、<a href="https://www.redis.net.cn/tutorial/3516.html">Lua 脚本</a>、LRU 收回、<a href="https://www.redis.net.cn/tutorial/3515.html">事务</a>以及不同级别磁盘持久化功能，同时通过 Redis Sentinel 提供高可用，通过 Redis Cluster 提供自动<a href="https://www.redis.net.cn/tutorial/3524.html">分区</a>。</p><h3 id="3-1、Redis-key"><a href="#3-1、Redis-key" class="headerlink" title="3.1、Redis-key"></a>3.1、Redis-key</h3><blockquote><p>在 redis 中无论什么数据类型，在数据库中都是以 key-value 形式保存，通过进行对 Redis-key 的操作，来完成对数据库中数据的操作。</p></blockquote><p>下面学习的命令：</p><ul><li><code>exists key</code>：判断键是否存在</li><li><code>del key</code>：删除键值对</li><li><code>move key db</code>：将键值对移动到指定数据库</li><li><code>expire key second</code>：设置键值对的过期时间</li><li><code>type key</code>：查看 value 的数据类型</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys * <span class="comment"># 查看当前数据库所有key</span></span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name qinjiang <span class="comment"># set key</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 20</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line">2) <span class="string">&quot;name&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; move age 1 <span class="comment"># 将键值对移动到指定数据库</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; EXISTS age <span class="comment"># 判断键是否存在</span></span><br><span class="line">(<span class="built_in">integer</span>) 0 <span class="comment"># 不存在</span></span><br><span class="line">127.0.0.1:6379&gt; EXISTS name</span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># 存在</span></span><br><span class="line">127.0.0.1:6379&gt; SELECT 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[1]&gt; keys *</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line">127.0.0.1:6379[1]&gt; del age <span class="comment"># 删除键值对</span></span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># 删除个数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 20</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; EXPIRE age 15 <span class="comment"># 设置键值对的过期时间</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># 设置成功 开始计数</span></span><br><span class="line">127.0.0.1:6379&gt; ttl age <span class="comment"># 查看key的过期剩余时间</span></span><br><span class="line">(<span class="built_in">integer</span>) 13</span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 11</span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 9</span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -2 <span class="comment"># -2 表示key过期，-1表示key未设置过期时间</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; get age <span class="comment"># 过期的key 会被自动delete</span></span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> name <span class="comment"># 查看value的数据类型</span></span><br><span class="line">string</span><br></pre></td></tr></table></figure><p>关于<code>TTL</code>命令</p><p>Redis 的 key，通过 TTL 命令返回 key 的过期时间，一般来说有 3 种：</p><ol><li>当前 key 没有设置过期时间，所以会返回-1.</li><li>当前 key 有设置过期时间，而且 key 已经过期，所以会返回-2.</li><li>当前 key 有设置过期时间，且 key 还没有过期，故会返回 key 的正常剩余时间.</li></ol><p>关于重命名<code>RENAME</code>和<code>RENAMENX</code></p><ul><li><code>RENAME key newkey</code>修改 key 的名称</li><li><code>RENAMENX key newkey</code>仅当 newkey 不存在时，将 key 改名为 newkey 。</li></ul><p>更多命令学习：<a href="https://www.redis.net.cn/order/">https://www.redis.net.cn/order/</a></p><h3 id="3-2、String-字符串"><a href="#3-2、String-字符串" class="headerlink" title="3.2、String(字符串)"></a>3.2、String(字符串)</h3><p>普通的 set、get 直接略过。</p><div class="table-container"><table><thead><tr><th style="text-align:left">命令</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td style="text-align:left"><code>APPEND key value</code></td><td>向指定的 key 的 value 后追加字符串</td><td>127.0.0.1:6379&gt; set msg hello OK 127.0.0.1:6379&gt; append msg “ world” (integer) 11 127.0.0.1:6379&gt; get msg “hello world”</td></tr><tr><td style="text-align:left"><code>DECR/INCR key</code></td><td>将指定 key 的 value 数值进行+1/-1(仅对于数字)</td><td>127.0.0.1:6379&gt; set age 20 OK 127.0.0.1:6379&gt; incr age (integer) 21 127.0.0.1:6379&gt; decr age (integer) 20</td></tr><tr><td style="text-align:left"><code>INCRBY/DECRBY key n</code></td><td>按指定的步长对数值进行加减</td><td>127.0.0.1:6379&gt; INCRBY age 5 (integer) 25 127.0.0.1:6379&gt; DECRBY age 10 (integer) 15</td></tr><tr><td style="text-align:left"><code>INCRBYFLOAT key n</code></td><td>为数值加上浮点型数值</td><td>127.0.0.1:6379&gt; INCRBYFLOAT age 5.2 “20.2”</td></tr><tr><td style="text-align:left"><code>STRLEN key</code></td><td>获取 key 保存值的字符串长度</td><td>127.0.0.1:6379&gt; get msg “hello world” 127.0.0.1:6379&gt; STRLEN msg (integer) 11</td></tr><tr><td style="text-align:left"><code>GETRANGE key start end</code></td><td>按起止位置获取字符串（闭区间，起止位置都取）</td><td>127.0.0.1:6379&gt; get msg “hello world” 127.0.0.1:6379&gt; GETRANGE msg 3 9 “lo worl”</td></tr><tr><td style="text-align:left"><code>SETRANGE key offset value</code></td><td>用指定的 value 替换 key 中 offset 开始的值</td><td>127.0.0.1:6379&gt; SETRANGE msg 2 hello (integer) 7 127.0.0.1:6379&gt; get msg “tehello”</td></tr><tr><td style="text-align:left"><code>GETSET key value</code></td><td>将给定 key 的值设为 value ，并返回 key 的旧值(old value)。</td><td>127.0.0.1:6379&gt; GETSET msg test “hello world”</td></tr><tr><td style="text-align:left"><code>SETNX key value</code></td><td>仅当 key 不存在时进行 set</td><td>127.0.0.1:6379&gt; SETNX msg test (integer) 0 127.0.0.1:6379&gt; SETNX name sakura (integer) 1</td></tr><tr><td style="text-align:left"><code>SETEX key seconds value</code></td><td>set 键值对并设置过期时间</td><td>127.0.0.1:6379&gt; setex name 10 root OK 127.0.0.1:6379&gt; get name (nil)</td></tr><tr><td style="text-align:left"><code>MSET key1 value1 [key2 value2..]</code></td><td>批量 set 键值对</td><td>127.0.0.1:6379&gt; MSET k1 v1 k2 v2 k3 v3 OK</td></tr><tr><td style="text-align:left"><code>MSETNX key1 value1 [key2 value2..]</code></td><td>批量设置键值对，仅当参数中所有的 key 都不存在时执行</td><td>127.0.0.1:6379&gt; MSETNX k1 v1 k4 v4 (integer) 0</td></tr><tr><td style="text-align:left"><code>MGET key1 [key2..]</code></td><td>批量获取多个 key 保存的值</td><td>127.0.0.1:6379&gt; MGET k1 k2 k3 1) “v1” 2) “v2” 3) “v3”</td></tr><tr><td style="text-align:left"><code>PSETEX key milliseconds value</code></td><td>和 SETEX 命令相似，但它以毫秒为单位设置 key 的生存时间，</td><td></td></tr><tr><td style="text-align:left"><code>getset key value</code></td><td>如果不存在值，则返回 nil，如果存在值，获取原来的值，并设置新的值</td></tr></tbody></table></div><p>如果不存在值，则返回 nil，如果存在值，获取原来的值，并设置新的值</p><p>String 类似的使用场景：value 除了是字符串还可以是数字，用途举例：</p><ul><li>计数器</li><li>统计多单位的数量：uid:123666：follow 0</li><li>粉丝数</li><li>对象存储缓存</li></ul><h3 id="3-3、List-列表"><a href="#3-3、List-列表" class="headerlink" title="3.3、List(列表)"></a>3.3、List(列表)</h3><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）</p><p>一个列表最多可以包含 232 - 1 个元素 (4294967295, 每个列表超过 40 亿个元素)。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210517194417732.png" alt="image-20210517194417732"></p><p>正如图 Redis 中 List 是可以进行双端操作的，所以命令也就分为了 LXXX 和 RLLL 两类，有时候 L 也表示 List 例如 LLEN</p><div class="table-container"><table><thead><tr><th>命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td><code>LPUSH/RPUSH key value1[value2..]</code></td><td style="text-align:center">从左边/右边向列表中 PUSH 值(一个或者多个)。</td></tr><tr><td><code>LRANGE key start end</code></td><td style="text-align:center">获取 list 起止元素==（索引从左往右 递增）==</td></tr><tr><td><code>LPUSHX/RPUSHX key value</code></td><td style="text-align:center">向已存在的列名中 push 值（一个或者多个）</td></tr><tr><td>`LINSERT key BEFORE</td><td style="text-align:center">AFTER pivot value`</td><td>在指定列表元素的前/后 插入 value</td></tr><tr><td><code>LLEN key</code></td><td style="text-align:center">查看列表长度</td></tr><tr><td><code>LINDEX key index</code></td><td style="text-align:center">通过索引获取列表元素</td></tr><tr><td><code>LSET key index value</code></td><td style="text-align:center">通过索引为元素设值</td></tr><tr><td><code>LPOP/RPOP key</code></td><td style="text-align:center">从最左边/最右边移除值 并返回</td></tr><tr><td><code>RPOPLPUSH source destination</code></td><td style="text-align:center">将列表的尾部(右)最后一个值弹出，并返回，然后加到另一个列表的头部</td></tr><tr><td><code>LTRIM key start end</code></td><td style="text-align:center">通过下标截取指定范围内的列表</td></tr><tr><td><code>LREM key count value</code></td><td style="text-align:center">List 中是允许 value 重复的 <code>count &gt; 0</code>：从头部开始搜索 然后删除指定的 value 至多删除 count 个 <code>count &lt; 0</code>：从尾部开始搜索… <code>count = 0</code>：删除列表中所有的指定 value。</td></tr><tr><td><code>BLPOP/BRPOP key1[key2] timout</code></td><td style="text-align:center">移出并获取列表的第一个/最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td><code>BRPOPLPUSH source destination timeout</code></td><td style="text-align:center">和<code>RPOPLPUSH</code>功能相同，如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr></tbody></table></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">---------------------------LPUSH---RPUSH---LRANGE--------------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LPUSH mylist k1 <span class="comment"># LPUSH mylist=&gt;&#123;1&#125;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; LPUSH mylist k2 <span class="comment"># LPUSH mylist=&gt;&#123;2,1&#125;</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; RPUSH mylist k3 <span class="comment"># RPUSH mylist=&gt;&#123;2,1,3&#125;</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; get mylist <span class="comment"># 普通的get是无法获取list值的</span></span><br><span class="line">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 4 <span class="comment"># LRANGE 获取起止位置范围内的元素</span></span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line">3) <span class="string">&quot;k3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 2</span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line">3) <span class="string">&quot;k3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 1</span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1 <span class="comment"># 获取全部元素</span></span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line">3) <span class="string">&quot;k3&quot;</span></span><br><span class="line"></span><br><span class="line">---------------------------LPUSHX---RPUSHX-----------------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LPUSHX list v1 <span class="comment"># list不存在 LPUSHX失败</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; LPUSHX list v1 v2</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; LPUSHX mylist k4 k5 <span class="comment"># 向mylist中 左边 PUSH k4 k5</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;k5&quot;</span></span><br><span class="line">2) <span class="string">&quot;k4&quot;</span></span><br><span class="line">3) <span class="string">&quot;k2&quot;</span></span><br><span class="line">4) <span class="string">&quot;k1&quot;</span></span><br><span class="line">5) <span class="string">&quot;k3&quot;</span></span><br><span class="line"></span><br><span class="line">---------------------------LINSERT--LLEN--LINDEX--LSET----------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LINSERT mylist after k2 ins_key1 <span class="comment"># 在k2元素后 插入ins_key1</span></span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;k5&quot;</span></span><br><span class="line">2) <span class="string">&quot;k4&quot;</span></span><br><span class="line">3) <span class="string">&quot;k2&quot;</span></span><br><span class="line">4) <span class="string">&quot;ins_key1&quot;</span></span><br><span class="line">5) <span class="string">&quot;k1&quot;</span></span><br><span class="line">6) <span class="string">&quot;k3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LLEN mylist <span class="comment"># 查看mylist的长度</span></span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">127.0.0.1:6379&gt; LINDEX mylist 3 <span class="comment"># 获取下标为3的元素</span></span><br><span class="line"><span class="string">&quot;ins_key1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LINDEX mylist 0</span><br><span class="line"><span class="string">&quot;k5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LSET mylist 3 k6 <span class="comment"># 将下标3的元素 set值为k6</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;k5&quot;</span></span><br><span class="line">2) <span class="string">&quot;k4&quot;</span></span><br><span class="line">3) <span class="string">&quot;k2&quot;</span></span><br><span class="line">4) <span class="string">&quot;k6&quot;</span></span><br><span class="line">5) <span class="string">&quot;k1&quot;</span></span><br><span class="line">6) <span class="string">&quot;k3&quot;</span></span><br><span class="line"></span><br><span class="line">---------------------------LPOP--RPOP--------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LPOP mylist <span class="comment"># 左侧(头部)弹出</span></span><br><span class="line"><span class="string">&quot;k5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; RPOP mylist <span class="comment"># 右侧(尾部)弹出</span></span><br><span class="line"><span class="string">&quot;k3&quot;</span></span><br><span class="line"></span><br><span class="line">---------------------------RPOPLPUSH--------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;k4&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k6&quot;</span></span><br><span class="line">4) <span class="string">&quot;k1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; RPOPLPUSH mylist newlist <span class="comment"># 将mylist的最后一个值(k1)弹出，加入到newlist的头部</span></span><br><span class="line"><span class="string">&quot;k1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE newlist 0 -1</span><br><span class="line">1) <span class="string">&quot;k1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;k4&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k6&quot;</span></span><br><span class="line"></span><br><span class="line">---------------------------LTRIM--------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LTRIM mylist 0 1 <span class="comment"># 截取mylist中的 0~1部分</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) <span class="string">&quot;k4&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始 mylist: k2,k2,k2,k2,k2,k2,k4,k2,k2,k2,k2</span></span><br><span class="line">---------------------------LREM--------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LREM mylist 3 k2 <span class="comment"># 从头部开始搜索 至多删除3个 k2</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"><span class="comment"># 删除后：mylist: k2,k2,k2,k4,k2,k2,k2,k2</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LREM mylist -2 k2 <span class="comment">#从尾部开始搜索 至多删除2个 k2</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"><span class="comment"># 删除后：mylist: k2,k2,k2,k4,k2,k2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---------------------------BLPOP--BRPOP--------------------------</span><br><span class="line"></span><br><span class="line">mylist: k2,k2,k2,k4,k2,k2</span><br><span class="line">newlist: k1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; BLPOP newlist mylist 30 <span class="comment"># 从newlist中弹出第一个值，mylist作为候选</span></span><br><span class="line">1) <span class="string">&quot;newlist&quot;</span> <span class="comment"># 弹出</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; BLPOP newlist mylist 30</span><br><span class="line">1) <span class="string">&quot;mylist&quot;</span> <span class="comment"># 由于newlist空了 从mylist中弹出</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; BLPOP newlist 30</span><br><span class="line">(30.10s) <span class="comment"># 超时了</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; BLPOP newlist 30 <span class="comment"># 我们连接另一个客户端向newlist中push了test, 阻塞被解决。</span></span><br><span class="line">1) <span class="string">&quot;newlist&quot;</span></span><br><span class="line">2) <span class="string">&quot;test&quot;</span></span><br><span class="line">(12.54s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>小结</p></blockquote><ul><li>list 实际上是一个链表，before Node after , left, right 都可以插入值</li><li><strong>如果 key 不存在，则创建新的链表</strong></li><li>如果 key 存在，新增内容</li><li>如果移除了所有值，空链表，也代表不存在</li><li>在两边插入或者改动值，效率最高！修改中间元素，效率相对较低</li></ul><p><strong>应用：</strong></p><p><strong>消息排队！消息队列（Lpush Rpop）,栈（Lpush Lpop）</strong></p><h3 id="3-4、Set-集合"><a href="#3-4、Set-集合" class="headerlink" title="3.4、Set(集合)"></a>3.4、Set(集合)</h3><p>Redis 的 Set 是<strong>string 类型</strong>的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。</p><p>Redis 中 集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。</p><p>集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储 40 多亿个成员)。</p><div class="table-container"><table><thead><tr><th>命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td><code>SADD key member1[member2..]</code></td><td style="text-align:center">向集合中无序增加一个/多个成员</td></tr><tr><td><code>SCARD key</code></td><td style="text-align:center">获取集合的成员数</td></tr><tr><td><code>SMEMBERS key</code></td><td style="text-align:center">返回集合中所有的成员</td></tr><tr><td><code>SISMEMBER key member</code></td><td style="text-align:center">查询 member 元素是否是集合的成员,结果是无序的</td></tr><tr><td><code>SRANDMEMBER key [count]</code></td><td style="text-align:center">随机返回集合中 count 个成员，count 缺省值为 1</td></tr><tr><td><code>SPOP key [count]</code></td><td style="text-align:center">随机移除并返回集合中 count 个成员，count 缺省值为 1</td></tr><tr><td><code>SMOVE source destination member</code></td><td style="text-align:center">将 source 集合的成员 member 移动到 destination 集合</td></tr><tr><td><code>SREM key member1[member2..]</code></td><td style="text-align:center">移除集合中一个/多个成员</td></tr><tr><td><code>SDIFF key1[key2..]</code></td><td style="text-align:center">返回所有集合的差集 key1- key2 - …</td></tr><tr><td><code>SDIFFSTORE destination key1[key2..]</code></td><td style="text-align:center">在 SDIFF 的基础上，将结果保存到集合中==(覆盖)==。不能保存到其他类型 key 噢！</td></tr><tr><td><code>SINTER key1 [key2..]</code></td><td style="text-align:center">返回所有集合的交集</td></tr><tr><td><code>SINTERSTORE destination key1[key2..]</code></td><td style="text-align:center">在 SINTER 的基础上，存储结果到集合中。覆盖</td></tr><tr><td><code>SUNION key1 [key2..]</code></td><td style="text-align:center">返回所有集合的并集</td></tr><tr><td><code>SUNIONSTORE destination key1 [key2..]</code></td><td style="text-align:center">在 SUNION 的基础上，存储结果到及和张。覆盖</td></tr><tr><td><code>SSCAN KEY [MATCH pattern] [COUNT count]</code></td><td style="text-align:center">在大量数据环境下，使用此命令遍历集合中元素，每次遍历部分</td></tr></tbody></table></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">---------------SADD--SCARD--SMEMBERS--SISMEMBER--------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SADD myset m1 m2 m3 m4 <span class="comment"># 向myset中增加成员 m1~m4</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; SCARD myset <span class="comment"># 获取集合的成员数目</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; smembers myset <span class="comment"># 获取集合中所有成员</span></span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line">3) <span class="string">&quot;m2&quot;</span></span><br><span class="line">4) <span class="string">&quot;m1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER myset m5 <span class="comment"># 查询m5是否是myset的成员</span></span><br><span class="line">(<span class="built_in">integer</span>) 0 <span class="comment"># 不是，返回0</span></span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER myset m2</span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># 是，返回1</span></span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER myset m3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">---------------------SRANDMEMBER--SPOP----------------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 3 <span class="comment"># 随机返回3个成员</span></span><br><span class="line">1) <span class="string">&quot;m2&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line">3) <span class="string">&quot;m4&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset <span class="comment"># 随机返回1个成员</span></span><br><span class="line"><span class="string">&quot;m3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SPOP myset 2 <span class="comment"># 随机移除并返回2个成员</span></span><br><span class="line">1) <span class="string">&quot;m1&quot;</span></span><br><span class="line">2) <span class="string">&quot;m4&quot;</span></span><br><span class="line"><span class="comment"># 将set还原到&#123;m1,m2,m3,m4&#125;</span></span><br><span class="line"></span><br><span class="line">---------------------SMOVE--SREM----------------------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SMOVE myset newset m3 <span class="comment"># 将myset中m3成员移动到newset集合</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset</span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">2) <span class="string">&quot;m2&quot;</span></span><br><span class="line">3) <span class="string">&quot;m1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS newset</span><br><span class="line">1) <span class="string">&quot;m3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SREM newset m3 <span class="comment"># 从newset中移除m3元素</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS newset</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面开始是多集合操作,多集合操作中若只有一个参数默认和自身进行运算</span></span><br><span class="line"><span class="comment"># setx=&gt;&#123;m1,m2,m4,m6&#125;, sety=&gt;&#123;m2,m5,m6&#125;, setz=&gt;&#123;m1,m3,m6&#125;</span></span><br><span class="line"></span><br><span class="line">-----------------------------SDIFF------------------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SDIFF setx sety setz <span class="comment"># 等价于setx-sety-setz</span></span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SDIFF setx sety <span class="comment"># setx - sety</span></span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">2) <span class="string">&quot;m1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SDIFF sety setx <span class="comment"># sety - setx</span></span><br><span class="line">1) <span class="string">&quot;m5&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-------------------------SINTER---------------------------------------</span><br><span class="line"><span class="comment"># 共同关注（交集）</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SINTER setx sety setz <span class="comment"># 求 setx、sety、setx的交集</span></span><br><span class="line">1) <span class="string">&quot;m6&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SINTER setx sety <span class="comment"># 求setx sety的交集</span></span><br><span class="line">1) <span class="string">&quot;m2&quot;</span></span><br><span class="line">2) <span class="string">&quot;m6&quot;</span></span><br><span class="line"></span><br><span class="line">-------------------------SUNION---------------------------------------</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SUNION setx sety setz <span class="comment"># setx sety setz的并集</span></span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">2) <span class="string">&quot;m6&quot;</span></span><br><span class="line">3) <span class="string">&quot;m3&quot;</span></span><br><span class="line">4) <span class="string">&quot;m2&quot;</span></span><br><span class="line">5) <span class="string">&quot;m1&quot;</span></span><br><span class="line">6) <span class="string">&quot;m5&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; SUNION setx sety <span class="comment"># setx sety 并集</span></span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">2) <span class="string">&quot;m6&quot;</span></span><br><span class="line">3) <span class="string">&quot;m2&quot;</span></span><br><span class="line">4) <span class="string">&quot;m1&quot;</span></span><br><span class="line">5) <span class="string">&quot;m5&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-5、Hash（哈希）"><a href="#3-5、Hash（哈希）" class="headerlink" title="3.5、Hash（哈希）"></a>3.5、Hash（哈希）</h3><p>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象。</p><p>Set 就是一种简化的 Hash,只变动 key,而 value 使用默认值填充。可以将一个 Hash 表作为一个对象进行存储，表中存放对象的信息。</p><div class="table-container"><table><thead><tr><th>命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td><code>HSET key field value</code></td><td style="text-align:center">将哈希表 key 中的字段 field 的值设为 value 。重复设置同一个 field 会覆盖,返回 0</td></tr><tr><td><code>HMSET key field1 value1 [field2 value2..]</code></td><td style="text-align:center">同时将多个 field-value (域-值)对设置到哈希表 key 中。</td></tr><tr><td><code>HSETNX key field value</code></td><td style="text-align:center">只有在字段 field 不存在时，设置哈希表字段的值。</td></tr><tr><td><code>HEXISTS key field</code></td><td style="text-align:center">查看哈希表 key 中，指定的字段是否存在。</td></tr><tr><td><code>HGET key field value</code></td><td style="text-align:center">获取存储在哈希表中指定字段的值</td></tr><tr><td><code>HMGET key field1 [field2..]</code></td><td style="text-align:center">获取所有给定字段的值</td></tr><tr><td><code>HGETALL key</code></td><td style="text-align:center">获取在哈希表 key 的所有字段和值</td></tr><tr><td><code>HKEYS key</code></td><td style="text-align:center">获取哈希表 key 中所有的字段</td></tr><tr><td><code>HLEN key</code></td><td style="text-align:center">获取哈希表中字段的数量</td></tr><tr><td><code>HVALS key</code></td><td style="text-align:center">获取哈希表中所有值</td></tr><tr><td><code>HDEL key field1 [field2..]</code></td><td style="text-align:center">删除哈希表 key 中一个/多个 field 字段</td></tr><tr><td><code>HINCRBY key field n</code></td><td style="text-align:center">为哈希表 key 中的指定字段的整数值加上增量 n，并返回增量后结果 一样只适用于整数型字段</td></tr><tr><td><code>HINCRBYFLOAT key field n</code></td><td style="text-align:center">为哈希表 key 中的指定字段的浮点数值加上增量 n。</td></tr><tr><td><code>HSCAN key cursor [MATCH pattern] [COUNT count]</code></td><td style="text-align:center">迭代哈希表中的键值对。</td></tr></tbody></table></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">------------------------HSET--HMSET--HSETNX----------------</span><br><span class="line">127.0.0.1:6379&gt; HSET studentx name sakura <span class="comment"># 将studentx哈希表作为一个对象，设置name为sakura</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; HSET studentx name gyc <span class="comment"># 重复设置field进行覆盖，并返回0</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; HSET studentx age 20 <span class="comment"># 设置studentx的age为20</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; HMSET studentx sex 1 tel 15623667886 <span class="comment"># 设置sex为1，tel为15623667886</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; HSETNX studentx name gyc <span class="comment"># HSETNX 设置已存在的field</span></span><br><span class="line">(<span class="built_in">integer</span>) 0 <span class="comment"># 失败</span></span><br><span class="line">127.0.0.1:6379&gt; HSETNX studentx email 12345@qq.com</span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># 成功</span></span><br><span class="line"></span><br><span class="line">----------------------HEXISTS--------------------------------</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS studentx name <span class="comment"># name字段在studentx中是否存在</span></span><br><span class="line">(<span class="built_in">integer</span>) 1 <span class="comment"># 存在</span></span><br><span class="line">127.0.0.1:6379&gt; HEXISTS studentx addr</span><br><span class="line">(<span class="built_in">integer</span>) 0 <span class="comment"># 不存在</span></span><br><span class="line"></span><br><span class="line">-------------------HGET--HMGET--HGETALL-----------</span><br><span class="line">127.0.0.1:6379&gt; HGET studentx name <span class="comment"># 获取studentx中name字段的value</span></span><br><span class="line"><span class="string">&quot;gyc&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HMGET studentx name age tel <span class="comment"># 获取studentx中name、age、tel字段的value</span></span><br><span class="line">1) <span class="string">&quot;gyc&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br><span class="line">3) <span class="string">&quot;15623667886&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HGETALL studentx <span class="comment"># 获取studentx中所有的field及其value</span></span><br><span class="line"> 1) <span class="string">&quot;name&quot;</span></span><br><span class="line"> 2) <span class="string">&quot;gyc&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;age&quot;</span></span><br><span class="line"> 4) <span class="string">&quot;20&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;sex&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;1&quot;</span></span><br><span class="line"> 7) <span class="string">&quot;tel&quot;</span></span><br><span class="line"> 8) <span class="string">&quot;15623667886&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;email&quot;</span></span><br><span class="line">10) <span class="string">&quot;12345@qq.com&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------HKEYS--HLEN--HVALS--------------</span><br><span class="line">127.0.0.1:6379&gt; HKEYS studentx <span class="comment"># 查看studentx中所有的field</span></span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">3) <span class="string">&quot;sex&quot;</span></span><br><span class="line">4) <span class="string">&quot;tel&quot;</span></span><br><span class="line">5) <span class="string">&quot;email&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HLEN studentx <span class="comment"># 查看studentx中的字段数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; HVALS studentx <span class="comment"># 查看studentx中所有的value</span></span><br><span class="line">1) <span class="string">&quot;gyc&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br><span class="line">3) <span class="string">&quot;1&quot;</span></span><br><span class="line">4) <span class="string">&quot;15623667886&quot;</span></span><br><span class="line">5) <span class="string">&quot;12345@qq.com&quot;</span></span><br><span class="line"></span><br><span class="line">-------------------------HDEL--------------------------</span><br><span class="line">127.0.0.1:6379&gt; HDEL studentx sex tel <span class="comment"># 删除studentx 中的sex、tel字段</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; HKEYS studentx</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">3) <span class="string">&quot;email&quot;</span></span><br><span class="line"></span><br><span class="line">-------------HINCRBY--HINCRBYFLOAT------------------------</span><br><span class="line">127.0.0.1:6379&gt; HINCRBY studentx age 1 <span class="comment"># studentx的age字段数值+1</span></span><br><span class="line">(<span class="built_in">integer</span>) 21</span><br><span class="line">127.0.0.1:6379&gt; HINCRBY studentx name 1 <span class="comment"># 非整数字型字段不可用</span></span><br><span class="line">(error) ERR <span class="built_in">hash</span> value is not an <span class="built_in">integer</span></span><br><span class="line">127.0.0.1:6379&gt; HINCRBYFLOAT studentx weight 0.6 <span class="comment"># weight字段增加0.6</span></span><br><span class="line"><span class="string">&quot;90.8&quot;</span></span><br></pre></td></tr></table></figure><p>Hash 变更的数据 user name age，尤其是用户信息之类的，经常变动的信息！<strong>Hash 更适合于对象的存储，Sring 更加适合字符串存储！</strong></p><h3 id="3-6、Zset（有序集合）"><a href="#3-6、Zset（有序集合）" class="headerlink" title="3.6、Zset（有序集合）"></a>3.6、Zset（有序集合）</h3><p>不同的是每个元素都会关联一个 double 类型的分数（score）。redis 正是通过分数来为集合中的成员进行从小到大的排序。</p><p>score 相同：按字典顺序排序</p><p>有序集合的成员是唯一的,但分数(score)却可以重复。</p><div class="table-container"><table><thead><tr><th>命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td><code>ZADD key score member1 [score2 member2]</code></td><td style="text-align:center">向有序集合添加一个或多个成员，或者更新已存在成员的分数</td></tr><tr><td><code>ZCARD key</code></td><td style="text-align:center">获取有序集合的成员数</td></tr><tr><td><code>ZCOUNT key min max</code></td><td style="text-align:center">计算在有序集合中指定区间 score 的成员数</td></tr><tr><td><code>ZINCRBY key n member</code></td><td style="text-align:center">有序集合中对指定成员的分数加上增量 n</td></tr><tr><td><code>ZSCORE key member</code></td><td style="text-align:center">返回有序集中，成员的分数值</td></tr><tr><td><code>ZRANK key member</code></td><td style="text-align:center">返回有序集合中指定成员的索引</td></tr><tr><td><code>ZRANGE key start end</code></td><td style="text-align:center">通过索引区间返回有序集合成指定区间内的成员</td></tr><tr><td><code>ZRANGEBYLEX key min max</code></td><td style="text-align:center">通过字典区间返回有序集合的成员</td></tr><tr><td><code>ZRANGEBYSCORE key min max</code></td><td style="text-align:center">通过分数返回有序集合指定区间内的成员==-inf 和 +inf 分别表示最小最大值，只支持开区间()==</td></tr><tr><td><code>ZLEXCOUNT key min max</code></td><td style="text-align:center">在有序集合中计算指定字典区间内成员数量</td></tr><tr><td><code>ZREM key member1 [member2..]</code></td><td style="text-align:center">移除有序集合中一个/多个成员</td></tr><tr><td><code>ZREMRANGEBYLEX key min max</code></td><td style="text-align:center">移除有序集合中给定的字典区间的所有成员</td></tr><tr><td><code>ZREMRANGEBYRANK key start stop</code></td><td style="text-align:center">移除有序集合中给定的排名区间的所有成员</td></tr><tr><td><code>ZREMRANGEBYSCORE key min max</code></td><td style="text-align:center">移除有序集合中给定的分数区间的所有成员</td></tr><tr><td><code>ZREVRANGE key start end</code></td><td style="text-align:center">返回有序集中指定区间内的成员，通过索引，分数从高到底</td></tr><tr><td><code>ZREVRANGEBYSCORRE key max min</code></td><td style="text-align:center">返回有序集中指定分数区间内的成员，分数从高到低排序</td></tr><tr><td><code>ZREVRANGEBYLEX key max min</code></td><td style="text-align:center">返回有序集中指定字典区间内的成员，按字典顺序倒序</td></tr><tr><td><code>ZREVRANK key member</code></td><td style="text-align:center">返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td></tr><tr><td><code>ZINTERSTORE destination numkeys key1 [key2 ..]</code></td><td style="text-align:center">计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中，numkeys：表示参与运算的集合数，将 score 相加作为结果的 score</td></tr><tr><td><code>ZUNIONSTORE destination numkeys key1 [key2..]</code></td><td style="text-align:center">计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中</td></tr><tr><td><code>ZSCAN key cursor [MATCH pattern\] [COUNT count]</code></td><td style="text-align:center">迭代有序集合中的元素（包括元素成员和元素分值）</td></tr></tbody></table></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">-------------------ZADD--ZCARD--ZCOUNT--------------</span><br><span class="line">127.0.0.1:6379&gt; ZADD myzset 1 m1 2 m2 3 m3 <span class="comment"># 向有序集合myzset中添加成员m1 score=1 以及成员m2 score=2..</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; ZCARD myzset <span class="comment"># 获取有序集合的成员数</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; ZCOUNT myzset 0 1 <span class="comment"># 获取score在 [0,1]区间的成员数量</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ZCOUNT myzset 0 2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line">----------------ZINCRBY--ZSCORE--------------------------</span><br><span class="line">127.0.0.1:6379&gt; ZINCRBY myzset 5 m2 <span class="comment"># 将成员m2的score +5</span></span><br><span class="line"><span class="string">&quot;7&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZSCORE myzset m1 <span class="comment"># 获取成员m1的score</span></span><br><span class="line"><span class="string">&quot;1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZSCORE myzset m2</span><br><span class="line"><span class="string">&quot;7&quot;</span></span><br><span class="line"></span><br><span class="line">--------------ZRANK--ZRANGE-----------------------------------</span><br><span class="line">127.0.0.1:6379&gt; ZRANK myzset m1 <span class="comment"># 获取成员m1的索引，索引按照score排序，score相同索引值按字典顺序顺序增加</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; ZRANK myzset m2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE myzset 0 1 <span class="comment"># 获取索引在 0~1的成员</span></span><br><span class="line">1) <span class="string">&quot;m1&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGE myzset 0 -1 <span class="comment"># 获取全部成员</span></span><br><span class="line">1) <span class="string">&quot;m1&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line">3) <span class="string">&quot;m2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#testset=&gt;&#123;abc,add,amaze,apple,back,java,redis&#125; score均为0</span></span><br><span class="line">------------------ZRANGEBYLEX---------------------------------</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYLEX testset - + <span class="comment"># 返回所有成员</span></span><br><span class="line">1) <span class="string">&quot;abc&quot;</span></span><br><span class="line">2) <span class="string">&quot;add&quot;</span></span><br><span class="line">3) <span class="string">&quot;amaze&quot;</span></span><br><span class="line">4) <span class="string">&quot;apple&quot;</span></span><br><span class="line">5) <span class="string">&quot;back&quot;</span></span><br><span class="line">6) <span class="string">&quot;java&quot;</span></span><br><span class="line">7) <span class="string">&quot;redis&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYLEX testset - + LIMIT 0 3 <span class="comment"># 分页 按索引显示查询结果的 0,1,2条记录</span></span><br><span class="line">1) <span class="string">&quot;abc&quot;</span></span><br><span class="line">2) <span class="string">&quot;add&quot;</span></span><br><span class="line">3) <span class="string">&quot;amaze&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYLEX testset - + LIMIT 3 3 <span class="comment"># 显示 3,4,5条记录</span></span><br><span class="line">1) <span class="string">&quot;apple&quot;</span></span><br><span class="line">2) <span class="string">&quot;back&quot;</span></span><br><span class="line">3) <span class="string">&quot;java&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYLEX testset (- [apple <span class="comment"># 显示 (-,apple] 区间内的成员</span></span><br><span class="line">1) <span class="string">&quot;abc&quot;</span></span><br><span class="line">2) <span class="string">&quot;add&quot;</span></span><br><span class="line">3) <span class="string">&quot;amaze&quot;</span></span><br><span class="line">4) <span class="string">&quot;apple&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYLEX testset [apple [java <span class="comment"># 显示 [apple,java]字典区间的成员</span></span><br><span class="line">1) <span class="string">&quot;apple&quot;</span></span><br><span class="line">2) <span class="string">&quot;back&quot;</span></span><br><span class="line">3) <span class="string">&quot;java&quot;</span></span><br><span class="line"></span><br><span class="line">-----------------------ZRANGEBYSCORE---------------------</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE myzset 1 10 <span class="comment"># 返回score在 [1,10]之间的的成员</span></span><br><span class="line">1) <span class="string">&quot;m1&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line">3) <span class="string">&quot;m2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE myzset 1 5</span><br><span class="line">1) <span class="string">&quot;m1&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line"></span><br><span class="line">--------------------ZLEXCOUNT-----------------------------</span><br><span class="line">127.0.0.1:6379&gt; ZLEXCOUNT testset - +</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line">127.0.0.1:6379&gt; ZLEXCOUNT testset [apple [java</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line"></span><br><span class="line">------------------ZREM--ZREMRANGEBYLEX--ZREMRANGBYRANK--ZREMRANGEBYSCORE--------------------------------</span><br><span class="line">127.0.0.1:6379&gt; ZREM testset abc <span class="comment"># 移除成员abc</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ZREMRANGEBYLEX testset [apple [java <span class="comment"># 移除字典区间[apple,java]中的所有成员</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; ZREMRANGEBYRANK testset 0 1 <span class="comment"># 移除排名0~1的所有成员</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; ZREMRANGEBYSCORE myzset 0 3 <span class="comment"># 移除score在 [0,3]的成员</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># testset=&gt; &#123;abc,add,apple,amaze,back,java,redis&#125; score均为0</span></span><br><span class="line"><span class="comment"># myzset=&gt; &#123;(m1,1),(m2,2),(m3,3),(m4,4),(m7,7),(m9,9)&#125;</span></span><br><span class="line">----------------ZREVRANGE--ZREVRANGEBYSCORE--ZREVRANGEBYLEX-----------</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE myzset 0 3 <span class="comment"># 按score递减排序，然后按索引，返回结果的 0~3</span></span><br><span class="line">1) <span class="string">&quot;m9&quot;</span></span><br><span class="line">2) <span class="string">&quot;m7&quot;</span></span><br><span class="line">3) <span class="string">&quot;m4&quot;</span></span><br><span class="line">4) <span class="string">&quot;m3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE myzset 2 4 <span class="comment"># 返回排序结果的 索引的2~4</span></span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line">3) <span class="string">&quot;m2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGEBYSCORE myzset 6 2 <span class="comment"># 按score递减顺序 返回集合中分数在[2,6]之间的成员</span></span><br><span class="line">1) <span class="string">&quot;m4&quot;</span></span><br><span class="line">2) <span class="string">&quot;m3&quot;</span></span><br><span class="line">3) <span class="string">&quot;m2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGEBYLEX testset [java (add <span class="comment"># 按字典倒序 返回集合中(add,java]字典区间的成员</span></span><br><span class="line">1) <span class="string">&quot;java&quot;</span></span><br><span class="line">2) <span class="string">&quot;back&quot;</span></span><br><span class="line">3) <span class="string">&quot;apple&quot;</span></span><br><span class="line">4) <span class="string">&quot;amaze&quot;</span></span><br><span class="line"></span><br><span class="line">-------------------------ZREVRANK------------------------------</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANK myzset m7 <span class="comment"># 按score递减顺序，返回成员m7索引</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANK myzset m2</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mathscore=&gt;&#123;(xm,90),(xh,95),(xg,87)&#125; 小明、小红、小刚的数学成绩</span></span><br><span class="line"><span class="comment"># enscore=&gt;&#123;(xm,70),(xh,93),(xg,90)&#125; 小明、小红、小刚的英语成绩</span></span><br><span class="line">-------------------ZINTERSTORE--ZUNIONSTORE-----------------------------------</span><br><span class="line">127.0.0.1:6379&gt; ZINTERSTORE sumscore 2 mathscore enscore <span class="comment"># 将mathscore enscore进行合并 结果存放到sumscore</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE sumscore 0 -1 withscores <span class="comment"># 合并后的score是之前集合中所有score的和</span></span><br><span class="line">1) <span class="string">&quot;xm&quot;</span></span><br><span class="line">2) <span class="string">&quot;160&quot;</span></span><br><span class="line">3) <span class="string">&quot;xg&quot;</span></span><br><span class="line">4) <span class="string">&quot;177&quot;</span></span><br><span class="line">5) <span class="string">&quot;xh&quot;</span></span><br><span class="line">6) <span class="string">&quot;188&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ZUNIONSTORE lowestscore 2 mathscore enscore AGGREGATE MIN <span class="comment"># 取两个集合的成员score最小值作为结果的</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE lowestscore 0 -1 withscores</span><br><span class="line">1) <span class="string">&quot;xm&quot;</span></span><br><span class="line">2) <span class="string">&quot;70&quot;</span></span><br><span class="line">3) <span class="string">&quot;xg&quot;</span></span><br><span class="line">4) <span class="string">&quot;87&quot;</span></span><br><span class="line">5) <span class="string">&quot;xh&quot;</span></span><br><span class="line">6) <span class="string">&quot;93&quot;</span></span><br></pre></td></tr></table></figure><p>应用案例：</p><ul><li>set 排序 存储班级成绩表 工资表排序！</li><li>普通消息，1.重要消息 2.带权重进行判断</li><li>排行榜应用实现，取 Top N 测试</li></ul><h2 id="4、三种特殊数据类型"><a href="#4、三种特殊数据类型" class="headerlink" title="4、三种特殊数据类型"></a>4、三种特殊数据类型</h2><hr><h3 id="4-1、Geospatial-地理位置"><a href="#4-1、Geospatial-地理位置" class="headerlink" title="4.1、Geospatial(地理位置)"></a>4.1、Geospatial(地理位置)</h3><p>使用经纬度定位地理坐标并用一个<strong>有序集合 zset 保存</strong>，所以 zset 命令也可以使用</p><div class="table-container"><table><thead><tr><th>命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td><code>geoadd key longitud(经度) latitude(纬度) member [..]</code></td><td style="text-align:center">将具体经纬度的坐标存入一个有序集合</td></tr><tr><td><code>geopos key member [member..]</code></td><td style="text-align:center">获取集合中的一个/多个成员坐标</td></tr><tr><td><code>geodist key member1 member2 [unit]</code></td><td style="text-align:center">返回两个给定位置之间的距离。默认以米作为单位。</td></tr><tr><td>`georadius key longitude latitude radius m</td><td style="text-align:center">km</td><td>mi</td><td>ft [WITHCOORD][WITHDIST] [WITHHASH] [COUNT count]`</td><td>以给定的经纬度为中心， 返回集合包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</td></tr><tr><td><code>GEORADIUSBYMEMBER key member radius...</code></td><td style="text-align:center">功能与 GEORADIUS 相同，只是中心位置不是具体的经纬度，而是使用结合中已有的成员作为中心点。</td></tr><tr><td><code>geohash key member1 [member2..]</code></td><td style="text-align:center">返回一个或多个位置元素的 Geohash 表示。使用 Geohash 位置 52 点整数编码。</td></tr></tbody></table></div><p><strong>有效经纬度</strong></p><blockquote><ul><li>有效的经度从-180 度到 180 度。</li><li>有效的纬度从-85.05112878 度到 85.05112878 度。</li></ul></blockquote><p>指定单位的参数 <strong>unit</strong> 必须是以下单位的其中一个：</p><ul><li><strong>m</strong> 表示单位为米。</li><li><strong>km</strong> 表示单位为千米。</li><li><strong>mi</strong> 表示单位为英里。</li><li><strong>ft</strong> 表示单位为英尺。</li></ul><p><strong>关于 GEORADIUS 的参数</strong></p><blockquote><p>通过<code>georadius</code>就可以完成 <strong>附近的人</strong>功能</p><p>withcoord:带上坐标</p><p>withdist:带上距离，单位与半径单位相同</p><p>COUNT n : 只显示前 n 个(按距离递增排序)</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">----------------georadius---------------------</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 120 30 500 km withcoord withdist <span class="comment"># 查询经纬度(120,30)坐标500km半径内的成员</span></span><br><span class="line">1) 1) <span class="string">&quot;hangzhou&quot;</span></span><br><span class="line">   2) <span class="string">&quot;29.4151&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;120.20000249147415&quot;</span></span><br><span class="line">      2) <span class="string">&quot;30.199999888333501&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;shanghai&quot;</span></span><br><span class="line">   2) <span class="string">&quot;205.3611&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;121.40000134706497&quot;</span></span><br><span class="line">      2) <span class="string">&quot;31.400000253193539&quot;</span></span><br><span class="line"></span><br><span class="line">------------geohash---------------------------</span><br><span class="line">127.0.0.1:6379&gt; geohash china:city yichang shanghai <span class="comment"># 获取成员经纬坐标的geohash表示</span></span><br><span class="line">1) <span class="string">&quot;wmrjwbr5250&quot;</span></span><br><span class="line">2) <span class="string">&quot;wtw6ds0y300&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4-2、Hyperloglog-基数统计"><a href="#4-2、Hyperloglog-基数统计" class="headerlink" title="4.2、Hyperloglog(基数统计)"></a>4.2、Hyperloglog(基数统计)</h3><blockquote><p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。</p><p>花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。</p><p>因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p><p>其底层使用 string 数据类型</p></blockquote><p>什么是基数？</p><blockquote><p>数据集中不重复的元素的个数。</p></blockquote><p>应用场景：</p><p>网页的访问量（UV）：一个用户多次访问，也只能算作一个人。</p><blockquote><p>传统实现，存储用户的 id,然后每次进行比较。当用户变多之后这种方式及其浪费空间，而我们的目的只是计数，Hyperloglog 就能帮助我们利用最小的空间完成。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">----------PFADD--PFCOUNT---------------------</span><br><span class="line">127.0.0.1:6379&gt; PFADD myelemx a b c d e f g h i j k # 添加元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; type myelemx # hyperloglog底层使用String</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT myelemx # 估算myelemx的基数</span><br><span class="line">(integer) 11</span><br><span class="line">127.0.0.1:6379&gt; PFADD myelemy i j k z m c b v p q s</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT myelemy</span><br><span class="line">(integer) 11</span><br><span class="line"></span><br><span class="line">----------------PFMERGE-----------------------</span><br><span class="line">127.0.0.1:6379&gt; PFMERGE myelemz myelemx myelemy # 合并myelemx和myelemy 成为myelemz</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT myelemz # 估算基数</span><br><span class="line">(integer) 17</span><br></pre></td></tr></table></figure><p>如果允许容错，那么一定可以使用 Hyperloglog !</p><p>如果不允许容错，就使用 set 或者自己的数据类型即可 ！</p><h3 id="4-3、BitMaps-位图"><a href="#4-3、BitMaps-位图" class="headerlink" title="4.3、BitMaps(位图)"></a>4.3、BitMaps(位图)</h3><blockquote><p>使用位存储，信息状态只有 0 和 1</p><p>Bitmap 是一串连续的 2 进制数字（0 或 1），每一位所在的位置为偏移(offset)，在 bitmap 上可执行 AND,OR,XOR,NOT 以及其它位操作。</p></blockquote><p><strong>应用场景</strong></p><p>签到统计、状态统计</p><div class="table-container"><table><thead><tr><th>命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td><code>setbit key offset value</code></td><td style="text-align:center">为指定 key 的 offset 位设置值</td></tr><tr><td><code>getbit key offset</code></td><td style="text-align:center">获取 offset 位的值</td></tr><tr><td><code>bitcount key [start end]</code></td><td style="text-align:center">统计字符串被设置为 1 的 bit 数，也可以指定统计范围按字节</td></tr><tr><td><code>bitop operration destkey key[key..]</code></td><td style="text-align:center">对一个或多个保存二进制位的字符串 key 进行位元操作，并将结果保存到 destkey 上。</td></tr><tr><td><code>BITPOS key bit [start] [end]</code></td><td style="text-align:center">返回字符串里面第一个被设置为 1 或者 0 的 bit 位。start 和 end 只能按字节,不能按位</td></tr></tbody></table></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">------------setbit--getbit--------------</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 0 1 <span class="comment"># 设置sign的第0位为 1</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 1 <span class="comment"># 设置sign的第2位为 1  不设置默认 是0</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 3 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 5 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> sign</span><br><span class="line">string</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; getbit sign 2 <span class="comment"># 获取第2位的数值</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; getbit sign 3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; getbit sign 4 <span class="comment"># 未设置默认是0</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line"></span><br><span class="line">-----------bitcount----------------------------</span><br><span class="line">127.0.0.1:6379&gt; BITCOUNT sign <span class="comment"># 统计sign中为1的位数</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure><p><strong>bitmaps 的底层</strong></p><p>这样设置以后你能 get 到的值是：<strong>\xA2\x80</strong>，所以 bitmaps 是一串从左到右的二进制串</p><h2 id="5、事务"><a href="#5、事务" class="headerlink" title="5、事务"></a>5、事务</h2><hr><p>Redis 的单条命令是保证原子性的，但是 redis 事务不能保证原子性</p><blockquote><p>Redis 事务本质：一组命令的集合。</p><p>————————- 队列 set set set 执行 —————————-</p><p>事务中每条命令都会被序列化，执行过程中按顺序执行，不允许其他命令进行干扰。</p><ul><li>一次性</li><li>顺序性</li><li>排他性</li></ul><hr><ol><li>Redis 事务没有隔离级别的概念</li><li>Redis 单条命令是保证原子性的，但是事务不保证原子性！</li></ol></blockquote><p><strong>Redis 事务操作过程</strong></p><ul><li>开启事务（<code>multi</code>）</li><li>命令入队</li><li>执行事务（<code>exec</code>）</li></ul><p>所以事务中的命令在加入时都没有被执行，直到提交时才会开始执行(Exec)一次性完成。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi <span class="comment"># 开启事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1 <span class="comment"># 命令入队</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2 <span class="comment"># ..</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> <span class="comment"># 事务执行</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) <span class="string">&quot;v1&quot;</span></span><br><span class="line">4) OK</span><br><span class="line">5) 1) <span class="string">&quot;k3&quot;</span></span><br><span class="line">   2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">   3) <span class="string">&quot;k1&quot;</span></span><br></pre></td></tr></table></figure><p>取消事务(<code>discurd</code>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; DISCARD <span class="comment"># 放弃事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(error) ERR EXEC without MULTI <span class="comment"># 当前未开启事务</span></span><br><span class="line">127.0.0.1:6379&gt; get k1 <span class="comment"># 被放弃事务中命令并未执行</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><p><strong>事务错误</strong></p><blockquote><p>代码语法错误（编译时异常）所有的命令都不执行</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; error k1 # 这是一条语法错误命令</span><br><span class="line">(error) ERR unknown command `error`, with args beginning with: `k1`, # 会报错但是不影响后续命令入队</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors. # 执行报错</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">(nil) # 其他命令并没有被执行</span><br></pre></td></tr></table></figure><p>代码逻辑错误 (运行时异常) <strong>其他命令可以正常执行 </strong> &gt;&gt;&gt; 所以不保证事务原子性</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCR k1 <span class="comment"># 这条命令逻辑错误（对字符串进行增量）</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) (error) ERR value is not an <span class="built_in">integer</span> or out of range <span class="comment"># 运行时报错</span></span><br><span class="line">4) <span class="string">&quot;v2&quot;</span> <span class="comment"># 其他命令正常执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 虽然中间有一条命令报错了，但是后面的指令依旧正常执行成功了。</span></span><br><span class="line"><span class="comment"># 所以说Redis单条指令保证原子性，但是Redis事务不能保证原子性。</span></span><br></pre></td></tr></table></figure><p><strong>监控</strong></p><p>悲观锁：</p><ul><li>很悲观，认为什么时候都会出现问题，无论做什么都会加锁</li></ul><p>乐观锁：</p><ul><li>很乐观，认为什么时候都不会出现问题，所以不会上锁！更新数据的时候去判断一下，在此期间是否有人修改过这个数据</li><li>获取 version</li><li>更新的时候比较 version</li></ul><p>使用<code>watch key</code>监控指定数据，相当于乐观锁加锁。</p><p>正常执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100 <span class="comment"># 设置余额:100</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> use 0 <span class="comment"># 支出使用:0</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money <span class="comment"># 监视money (上锁)</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY use 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> <span class="comment"># 监视值没有被中途修改，事务正常执行</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure><blockquote><p>测试多线程修改值，使用 watch 可以当做 redis 的乐观锁操作（相当于 getversion）</p></blockquote><p>我们启动另外一个客户端模拟插队线程。</p><p>线程 1：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; watch money <span class="comment"># money上锁</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY use 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt;     <span class="comment"># 此时事务并没有执行</span></span><br></pre></td></tr></table></figure><p>模拟线程插队，线程 2：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; INCRBY money 500 <span class="comment"># 修改了线程一中监视的money</span></span><br><span class="line">(<span class="built_in">integer</span>) 600</span><br></pre></td></tr></table></figure><p>回到线程 1，执行事务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; EXEC <span class="comment"># 执行之前，另一个线程修改了我们的值，这个时候就会导致事务执行失败</span></span><br><span class="line">(nil) <span class="comment"># 没有结果，说明事务执行失败</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; get money <span class="comment"># 线程2 修改生效</span></span><br><span class="line"><span class="string">&quot;600&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get use <span class="comment"># 线程1事务执行失败，数值没有被修改</span></span><br><span class="line"><span class="string">&quot;0&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>解锁获取最新值，然后再加锁进行事务。</p><p><code>unwatch</code>进行解锁。</p></blockquote><p>注意：每次提交执行 exec 后都会自动释放锁，不管是否成功</p><h2 id="6、Jedis"><a href="#6、Jedis" class="headerlink" title="6、Jedis"></a>6、Jedis</h2><hr><p>使用 Java 来操作 Redis，Jedis 是 Redis 官方推荐使用的 Java 连接 redis 的客户端。</p><ol><li>导入依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入jredis的包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.70<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.编码测试</p><ul><li><p>连接数据库</p><ol><li>修改 redis 的配置文件</li></ol><p><img src="https://picbed.jnchan.top/redisImages/image-20210519210942712.png" alt="image-20210519210942712"></p><p>将只绑定本地注释</p><p>保护模式改为 no</p></li></ul><p><img src="https://picbed.jnchan.top/redisImages/image-20210519210805714.png" alt="image-20210519210805714"></p><p>​ 开放端口 6379</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=6379/tcp --permanet</span><br></pre></td></tr></table></figure><p>​ 重启防火墙服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart firewalld.service</span><br></pre></td></tr></table></figure><p>​ 重启 redis-server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server huangconfig/redis.conf</span><br></pre></td></tr></table></figure><p>​ 操作命令</p><p>​ TestPing.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPing</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.xx.xxx&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">        System.out.println(response); <span class="comment">// PONG</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​ 事务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTX</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;39.99.xxx.xx&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;kuangshen&quot;</span>);</span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jsonObject.toJSONString();</span><br><span class="line">        <span class="comment">// jedis.watch(result)</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            multi.set(<span class="string">&quot;user1&quot;</span>, result);</span><br><span class="line">            multi.set(<span class="string">&quot;user2&quot;</span>, result);</span><br><span class="line">            <span class="comment">// 执行事务</span></span><br><span class="line">            multi.exec();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="comment">// 放弃事务</span></span><br><span class="line">            multi.discard();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭连接</span></span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;user1&quot;</span>));</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;user2&quot;</span>));</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7、SpringBoot-整合"><a href="#7、SpringBoot-整合" class="headerlink" title="7、SpringBoot 整合"></a>7、SpringBoot 整合</h2><hr><p>1.导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>springboot 2.x 后 ，原来使用的 Jedis 被 lettuce 替换。</p><blockquote><p>jedis：采用的直连，多个线程操作的话，是不安全的。如果要避免不安全，使用 jedis pool 连接池！更像 BIO 模式</p><p>lettuce：采用 netty，实例可以在多个线程中共享，不存在线程不安全的情况！可以减少线程数据了，更像 NIO 模式</p></blockquote><p>我们在学习 SpringBoot 自动配置的原理时，整合一个组件并进行配置一定会有一个自动配置类 xxxAutoConfiguration,并且在 spring.factories 中也一定能找到这个类的完全限定名。Redis 也不例外。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212123458.png" alt="image-20210519212123458"></p><p>那么就一定还存在一个 RedisProperties 类</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212159624.png" alt="image-20210519212159624"></p><p>之前我们说 SpringBoot2.x 后默认使用 Lettuce 来替换 Jedis，现在我们就能来验证了。</p><p>先看 Jedis:</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212229658.png" alt="image-20210519212229658"></p><p>@ConditionalOnClass 注解中有两个类是默认不存在的，所以 Jedis 是无法生效的</p><p>然后再看 Lettuce：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212252762.png" alt="image-20210519212252762"></p><p>完美生效。</p><p>现在我们回到 RedisAutoConfiguratio</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212322212.png" alt="image-20210519212322212"></p><p>只有两个简单的 Bean</p><ul><li>RedisTemplate</li><li>StringRedisTemplate</li></ul><p>当看到 xxTemplate 时可以对比 RestTemplat、SqlSessionTemplate,通过使用这些 Template 来间接操作组件。那么这俩也不会例外。分别用于操作 Redis 和 Redis 中的 String 数据类型。</p><p>在 RedisTemplate 上也有一个条件注解，说明我们是可以对其进行定制化的</p><p>说完这些，我们需要知道如何编写配置文件然后连接 Redis，就需要阅读 RedisProperties</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212404385.png" alt="image-20210519212404385"></p><p>这是一些基本的配置属性。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212449770.png" alt="image-20210519212449770"></p><p>还有一些连接池相关的配置。注意使用时一定使用 Lettuce 的连接池。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212510909.png" alt="image-20210519212510909"></p><p>编写配置文件</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Springboot所有的配置类，都有一个自动配置类</span></span><br><span class="line"><span class="comment">#自动配置类都会绑定一个properties</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">192.168.222.130</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br></pre></td></tr></table></figure><p>使用 RedisTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Redis02SpringbootApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// redisTemplate 操作不同的数据类型，api和我们的指令是一样的</span></span><br><span class="line">        <span class="comment">// opsForValue 操作字符串 类似String</span></span><br><span class="line">        <span class="comment">// opsForList 操作List 类似List</span></span><br><span class="line">        <span class="comment">// opsForHah</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 除了基本的操作，我们常用的方法都可以直接通过redisTemplate操作，比如事务和基本的CRUD</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取连接对象</span></span><br><span class="line">        <span class="comment">//RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span></span><br><span class="line">        <span class="comment">//connection.flushDb();</span></span><br><span class="line">        <span class="comment">//connection.flushAll();</span></span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;mykey&quot;</span>,<span class="string">&quot;kuangshen&quot;</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;mykey&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：</p><p>此时我们回到 Redis 查看数据时候，惊奇发现全是乱码，可是程序中可以正常输出：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212735113.png" alt="image-20210519212735113"></p><p>这时候就关系到存储对象的序列化问题，在网络中传输的对象也是一样需要序列化，否者就全是乱码。</p><p>我们转到看那个默认的 RedisTemplate 内部什么样子：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212822958.png" alt="image-20210519212822958"></p><p>在最开始就能看到几个关于序列化的参数。</p><p>默认的序列化器是采用 JDK 序列化器</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212838577.png" alt="image-20210519212838577"></p><p>而默认的 RedisTemplate 中的所有序列化器都是使用这个序列化器：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519212904729.png" alt="image-20210519212904729"></p><p>后续我们定制 RedisTemplate 就可以对其进行修改。</p><p><code>RedisSerializer</code>提供了多种序列化方案：</p><ol><li><ul><li>直接调用 RedisSerializer 的静态方法来返回序列化器，然后 set</li><li><img src="https://picbed.jnchan.top/redisImages/image-20210519212934410.png" alt="image-20210519212934410"></li><li>自己 new 相应的实现类，然后 set</li><li><img src="https://picbed.jnchan.top/redisImages/image-20210519213011690.png" alt="image-20210519213011690"></li></ul></li><li><p>定制 RedisTemplate 的模板：</p></li><li><p>我们创建一个 Bean 加入容器，就会触发 RedisTemplate 上的条件注解使默认的 RedisTemplate 失效。</p></li><li><p>```java<br>@Configuration<br>public class RedisConfig {</p><p>   @Bean</p><pre><code>public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException &#123;    // 将template 泛型设置为 &lt;String, Object&gt;    RedisTemplate&lt;String, Object&gt; template = new RedisTemplate();    // 连接工厂，不必修改    template.setConnectionFactory(redisConnectionFactory);    /*     * 序列化设置     */    // key、hash的key 采用 String序列化方式    template.setKeySerializer(RedisSerializer.string());    template.setHashKeySerializer(RedisSerializer.string());    // value、hash的value 采用 Jackson 序列化方式    template.setValueSerializer(RedisSerializer.json());    template.setHashValueSerializer(RedisSerializer.json());    template.afterPropertiesSet();    return template;&#125;</code></pre><p>}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 8、自定义 Redis 工具类</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">使用 RedisTemplate 需要频繁调用`.opForxxx`然后才能进行对应的操作，这样使用起来代码效率低下，工作中一般不会这样使用，而是将这些常用的公共 API 抽取出来封装成为一个工具类，然后直接使用工具类来间接操作 Redis,不但效率高并且易用。</span><br><span class="line"></span><br><span class="line">工具类参考博客：</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/zeng1994/p/03303c805731afc9aa9c60dbbd32a323.html</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/zhzhlong/p/11434284.html</span><br><span class="line"></span><br><span class="line">RedisUtils</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">package com.huang.Utils;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.data.redis.connection.DataType;</span><br><span class="line">import org.springframework.data.redis.core.Cursor;</span><br><span class="line">import org.springframework.data.redis.core.ScanOptions;</span><br><span class="line">import org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line">import org.springframework.data.redis.core.ZSetOperations.TypedTuple;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Map.Entry;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author 黄远林</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Date: Created in 7:50 2021/5/19</span><br><span class="line"> * @Modified By:</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Redis工具类*/</span><br><span class="line">@Component</span><br><span class="line">public class RedisUtils &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    public void setRedisTemplate(StringRedisTemplate redisTemplate) &#123;</span><br><span class="line">        this.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public StringRedisTemplate getRedisTemplate() &#123;</span><br><span class="line">        return this.redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** -------------------key相关操作--------------------- */</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除key</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     */</span><br><span class="line">    public void delete(String key) &#123;</span><br><span class="line">        redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量删除key</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     */</span><br><span class="line">    public void delete(Collection&lt;String&gt; keys) &#123;</span><br><span class="line">        redisTemplate.delete(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 序列化key</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public byte[] dump(String key) &#123;</span><br><span class="line">        return redisTemplate.dump(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 是否存在key</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean hasKey(String key) &#123;</span><br><span class="line">        return redisTemplate.hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置过期时间</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param timeout</span><br><span class="line">     * @param unit</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean expire(String key, long timeout, TimeUnit unit) &#123;</span><br><span class="line">        return redisTemplate.expire(key, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置过期时间</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param date</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean expireAt(String key, Date date) &#123;</span><br><span class="line">        return redisTemplate.expireAt(key, date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查找匹配的key</span><br><span class="line">     *</span><br><span class="line">     * @param pattern</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; keys(String pattern) &#123;</span><br><span class="line">        return redisTemplate.keys(pattern);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将当前数据库的 key 移动到给定的数据库 db 当中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param dbIndex</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean move(String key, int dbIndex) &#123;</span><br><span class="line">        return redisTemplate.move(key, dbIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除 key 的过期时间，key 将持久保持</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean persist(String key) &#123;</span><br><span class="line">        return redisTemplate.persist(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回 key 的剩余的过期时间</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param unit</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long getExpire(String key, TimeUnit unit) &#123;</span><br><span class="line">        return redisTemplate.getExpire(key, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回 key 的剩余的过期时间</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long getExpire(String key) &#123;</span><br><span class="line">        return redisTemplate.getExpire(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从当前数据库中随机返回一个 key</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String randomKey() &#123;</span><br><span class="line">        return redisTemplate.randomKey();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 修改 key 的名称</span><br><span class="line">     *</span><br><span class="line">     * @param oldKey</span><br><span class="line">     * @param newKey</span><br><span class="line">     */</span><br><span class="line">    public void rename(String oldKey, String newKey) &#123;</span><br><span class="line">        redisTemplate.rename(oldKey, newKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 仅当 newkey 不存在时，将 oldKey 改名为 newkey</span><br><span class="line">     *</span><br><span class="line">     * @param oldKey</span><br><span class="line">     * @param newKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean renameIfAbsent(String oldKey, String newKey) &#123;</span><br><span class="line">        return redisTemplate.renameIfAbsent(oldKey, newKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回 key 所储存的值的类型</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public DataType type(String key) &#123;</span><br><span class="line">        return redisTemplate.type(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** -------------------string相关操作--------------------- */</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置指定 key 的值</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     */</span><br><span class="line">    public void set(String key, String value) &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取指定 key 的值</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object get(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回 key 中字符串值的子字符</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getRange(String key, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().get(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将给定 key 的值设为 value ，并返回 key 的旧值(old value)</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String getAndSet(String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().getAndSet(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 对 key 所储存的字符串值，获取指定偏移量上的位(bit)</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param offset</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean getBit(String key, long offset) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().getBit(key, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量获取</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;String&gt; multiGet(Collection&lt;String&gt; keys) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().multiGet(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置ASCII码, 字符串&#x27;a&#x27;的ASCII码是97, 转为二进制是&#x27;01100001&#x27;, 此方法是将二进制第offset位值变为value</span><br><span class="line">     *</span><br><span class="line">     * @param key 位置</span><br><span class="line">     * @param value</span><br><span class="line">     *            值,true为1, false为0</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean setBit(String key, long offset, boolean value) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().setBit(key, offset, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将值 value 关联到 key ，并将 key 的过期时间设为 timeout</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param timeout</span><br><span class="line">     *            过期时间</span><br><span class="line">     * @param unit</span><br><span class="line">     *            时间单位, 天:TimeUnit.DAYS 小时:TimeUnit.HOURS 分钟:TimeUnit.MINUTES</span><br><span class="line">     *            秒:TimeUnit.SECONDS 毫秒:TimeUnit.MILLISECONDS</span><br><span class="line">     */</span><br><span class="line">    public void setEx(String key, String value, long timeout, TimeUnit unit) &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 只有在 key 不存在时设置 key 的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return 之前已经存在返回false,不存在返回true</span><br><span class="line">     */</span><br><span class="line">    public boolean setIfAbsent(String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().setIfAbsent(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 用 value 参数覆写给定 key 所储存的字符串值，从偏移量 offset 开始</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param offset</span><br><span class="line">     *            从指定位置开始覆写</span><br><span class="line">     */</span><br><span class="line">    public void setRange(String key, String value, long offset) &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取字符串的长度</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long size(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量添加</span><br><span class="line">     *</span><br><span class="line">     * @param maps</span><br><span class="line">     */</span><br><span class="line">    public void multiSet(Map&lt;String, String&gt; maps) &#123;</span><br><span class="line">        redisTemplate.opsForValue().multiSet(maps);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在</span><br><span class="line">     *</span><br><span class="line">     * @param maps</span><br><span class="line">     * @return 之前已经存在返回false,不存在返回true</span><br><span class="line">     */</span><br><span class="line">    public boolean multiSetIfAbsent(Map&lt;String, String&gt; maps) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().multiSetIfAbsent(maps);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 增加(自增长), 负数则为自减</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long incrBy(String key, long increment) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().increment(key, increment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Double incrByFloat(String key, double increment) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().increment(key, increment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 追加到末尾</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Integer append(String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().append(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** -------------------hash相关操作------------------------- */</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取存储在哈希表中指定字段的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object hGet(String key, String field) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().get(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取所有给定字段的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Map&lt;Object, Object&gt; hGetAll(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取所有给定字段的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param fields</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;Object&gt; hMultiGet(String key, Collection&lt;Object&gt; fields) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().multiGet(key, fields);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void hPut(String key, String hashKey, String value) &#123;</span><br><span class="line">        redisTemplate.opsForHash().put(key, hashKey, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void hPutAll(String key, Map&lt;String, String&gt; maps) &#123;</span><br><span class="line">        redisTemplate.opsForHash().putAll(key, maps);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 仅当hashKey不存在时才设置</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param hashKey</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean hPutIfAbsent(String key, String hashKey, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().putIfAbsent(key, hashKey, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除一个或多个哈希表字段</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param fields</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hDelete(String key, Object... fields) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().delete(key, fields);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查看哈希表 key 中，指定的字段是否存在</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean hExists(String key, String field) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().hasKey(key, field);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 为哈希表 key 中的指定字段的整数值加上增量 increment</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param increment</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hIncrBy(String key, Object field, long increment) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().increment(key, field, increment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 为哈希表 key 中的指定字段的整数值加上增量 increment</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param field</span><br><span class="line">     * @param delta</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Double hIncrByFloat(String key, Object field, double delta) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().increment(key, field, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取所有哈希表中的字段</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;Object&gt; hKeys(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().keys(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取哈希表中字段的数量</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long hSize(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取哈希表中所有值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;Object&gt; hValues(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().values(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 迭代哈希表中的键值对</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param options</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Cursor&lt;Entry&lt;Object, Object&gt;&gt; hScan(String key, ScanOptions options) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().scan(key, options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** ------------------------list相关操作---------------------------- */</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过索引获取列表中的元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param index</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lIndex(String key, long index) &#123;</span><br><span class="line">        return redisTemplate.opsForList().index(key, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取列表指定范围内的元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     *            开始位置, 0是开始位置</span><br><span class="line">     * @param end</span><br><span class="line">     *            结束位置, -1返回所有</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;String&gt; lRange(String key, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 存储在list头部</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lLeftPush(String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPush(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lLeftPushAll(String key, String... value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPushAll(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lLeftPushAll(String key, Collection&lt;String&gt; value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPushAll(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当list存在的时候才加入</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lLeftPushIfPresent(String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPushIfPresent(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 如果pivot存在,再pivot前面添加</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param pivot</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lLeftPush(String key, String pivot, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPush(key, pivot, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lRightPush(String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lRightPushAll(String key, String... value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lRightPushAll(String key, Collection&lt;String&gt; value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 为已存在的列表添加值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lRightPushIfPresent(String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPushIfPresent(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 在pivot元素的右边添加值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param pivot</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lRightPush(String key, String pivot, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPush(key, pivot, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过索引设置列表元素的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param index</span><br><span class="line">     *            位置</span><br><span class="line">     * @param value</span><br><span class="line">     */</span><br><span class="line">    public void lSet(String key, long index, String value) &#123;</span><br><span class="line">        redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移出并获取列表的第一个元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return 删除的元素</span><br><span class="line">     */</span><br><span class="line">    public String lLeftPop(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param timeout</span><br><span class="line">     *            等待时间</span><br><span class="line">     * @param unit</span><br><span class="line">     *            时间单位</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lBLeftPop(String key, long timeout, TimeUnit unit) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPop(key, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除并获取列表最后一个元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return 删除的元素</span><br><span class="line">     */</span><br><span class="line">    public String lRightPop(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param timeout</span><br><span class="line">     *            等待时间</span><br><span class="line">     * @param unit</span><br><span class="line">     *            时间单位</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lBRightPop(String key, long timeout, TimeUnit unit) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPop(key, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除列表的最后一个元素，并将该元素添加到另一个列表并返回</span><br><span class="line">     *</span><br><span class="line">     * @param sourceKey</span><br><span class="line">     * @param destinationKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lRightPopAndLeftPush(String sourceKey, String destinationKey) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPopAndLeftPush(sourceKey,</span><br><span class="line">                destinationKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</span><br><span class="line">     *</span><br><span class="line">     * @param sourceKey</span><br><span class="line">     * @param destinationKey</span><br><span class="line">     * @param timeout</span><br><span class="line">     * @param unit</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String lBRightPopAndLeftPush(String sourceKey, String destinationKey,</span><br><span class="line">                                        long timeout, TimeUnit unit) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPopAndLeftPush(sourceKey,</span><br><span class="line">                destinationKey, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除集合中值等于value得元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param index</span><br><span class="line">     *            index=0, 删除所有值等于value的元素; index&gt;0, 从头部开始删除第一个值等于value的元素;</span><br><span class="line">     *            index&lt;0, 从尾部开始删除第一个值等于value的元素;</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lRemove(String key, long index, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().remove(key, index, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 裁剪list</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     */</span><br><span class="line">    public void lTrim(String key, long start, long end) &#123;</span><br><span class="line">        redisTemplate.opsForList().trim(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取列表长度</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long lLen(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForList().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** --------------------set相关操作-------------------------- */</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * set添加元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param values</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sAdd(String key, String... values) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().add(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * set移除元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param values</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sRemove(String key, Object... values) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除并返回集合的一个随机元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String sPop(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().pop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将元素value从一个集合移到另一个集合</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean sMove(String key, String value, String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().move(key, value, destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合的大小</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sSize(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断集合是否包含value</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean sIsMember(String key, Object value) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取两个集合的交集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; sIntersect(String key, String otherKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().intersect(key, otherKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取key集合与多个集合的交集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; sIntersect(String key, Collection&lt;String&gt; otherKeys) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().intersect(key, otherKeys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * key集合与otherKey集合的交集存储到destKey集合中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKey</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sIntersectAndStore(String key, String otherKey, String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().intersectAndStore(key, otherKey,</span><br><span class="line">                destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * key集合与多个集合的交集存储到destKey集合中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sIntersectAndStore(String key, Collection&lt;String&gt; otherKeys,</span><br><span class="line">                                   String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().intersectAndStore(key, otherKeys,</span><br><span class="line">                destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取两个集合的并集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; sUnion(String key, String otherKeys) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().union(key, otherKeys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取key集合与多个集合的并集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; sUnion(String key, Collection&lt;String&gt; otherKeys) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().union(key, otherKeys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * key集合与otherKey集合的并集存储到destKey中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKey</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sUnionAndStore(String key, String otherKey, String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().unionAndStore(key, otherKey, destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * key集合与多个集合的并集存储到destKey中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sUnionAndStore(String key, Collection&lt;String&gt; otherKeys,</span><br><span class="line">                               String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().unionAndStore(key, otherKeys, destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取两个集合的差集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; sDifference(String key, String otherKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().difference(key, otherKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取key集合与多个集合的差集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; sDifference(String key, Collection&lt;String&gt; otherKeys) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().difference(key, otherKeys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * key集合与otherKey集合的差集存储到destKey中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKey</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sDifference(String key, String otherKey, String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().differenceAndStore(key, otherKey,</span><br><span class="line">                destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * key集合与多个集合的差集存储到destKey中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long sDifference(String key, Collection&lt;String&gt; otherKeys,</span><br><span class="line">                            String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().differenceAndStore(key, otherKeys,</span><br><span class="line">                destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合所有元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; setMembers(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().members(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 随机获取集合中的一个元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String sRandomMember(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().randomMember(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 随机获取集合中count个元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param count</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;String&gt; sRandomMembers(String key, long count) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().randomMembers(key, count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 随机获取集合中count个元素并且去除重复的</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param count</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; sDistinctRandomMembers(String key, long count) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().distinctRandomMembers(key, count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param options</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Cursor&lt;String&gt; sScan(String key, ScanOptions options) &#123;</span><br><span class="line">        return redisTemplate.opsForSet().scan(key, options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**------------------zSet相关操作--------------------------------*/</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加元素,有序集合是按照元素的score值由小到大排列</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param score</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Boolean zAdd(String key, String value, double score) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().add(key, value, score);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param values</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zAdd(String key, Set&lt;TypedTuple&lt;String&gt;&gt; values) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().add(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param values</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zRemove(String key, Object... values) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().remove(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 增加元素的score值，并返回增加后的值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param delta</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Double zIncrementScore(String key, String value, double delta) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().incrementScore(key, value, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回元素在集合的排名,有序集合是按照元素的score值由小到大排列</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return 0表示第一位</span><br><span class="line">     */</span><br><span class="line">    public Long zRank(String key, Object value) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().rank(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回元素在集合的排名,按元素的score值由大到小排列</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zReverseRank(String key, Object value) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().reverseRank(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合的元素, 从小到大排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     *            开始位置</span><br><span class="line">     * @param end</span><br><span class="line">     *            结束位置, -1查询所有</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; zRange(String key, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().range(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合元素, 并且把score值也获取</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;TypedTuple&lt;String&gt;&gt; zRangeWithScores(String key, long start,</span><br><span class="line">                                                    long end) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().rangeWithScores(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据Score值查询集合元素</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     *            最小值</span><br><span class="line">     * @param max</span><br><span class="line">     *            最大值</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; zRangeByScore(String key, double min, double max) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().rangeByScore(key, min, max);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据Score值查询集合元素, 从小到大排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     *            最小值</span><br><span class="line">     * @param max</span><br><span class="line">     *            最大值</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;TypedTuple&lt;String&gt;&gt; zRangeByScoreWithScores(String key,</span><br><span class="line">                                                           double min, double max) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().rangeByScoreWithScores(key, min, max);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     * @param max</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;TypedTuple&lt;String&gt;&gt; zRangeByScoreWithScores(String key,</span><br><span class="line">                                                           double min, double max, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().rangeByScoreWithScores(key, min, max,</span><br><span class="line">                start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合的元素, 从大到小排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; zReverseRange(String key, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().reverseRange(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合的元素, 从大到小排序, 并返回score值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;TypedTuple&lt;String&gt;&gt; zReverseRangeWithScores(String key,</span><br><span class="line">                                                           long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().reverseRangeWithScores(key, start,</span><br><span class="line">                end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据Score值查询集合元素, 从大到小排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     * @param max</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; zReverseRangeByScore(String key, double min,</span><br><span class="line">                                            double max) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().reverseRangeByScore(key, min, max);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据Score值查询集合元素, 从大到小排序</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     * @param max</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;TypedTuple&lt;String&gt;&gt; zReverseRangeByScoreWithScores(</span><br><span class="line">            String key, double min, double max) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().reverseRangeByScoreWithScores(key,</span><br><span class="line">                min, max);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     * @param max</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; zReverseRangeByScore(String key, double min,</span><br><span class="line">                                            double max, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().reverseRangeByScore(key, min, max,</span><br><span class="line">                start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据score值获取集合元素数量</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     * @param max</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zCount(String key, double min, double max) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().count(key, min, max);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合大小</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zSize(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合大小</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zZCard(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().zCard(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取集合中value元素的score值</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Double zScore(String key, Object value) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().score(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除指定索引位置的成员</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param start</span><br><span class="line">     * @param end</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zRemoveRange(String key, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().removeRange(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据指定的score值的范围来移除成员</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param min</span><br><span class="line">     * @param max</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zRemoveRangeByScore(String key, double min, double max) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().removeRangeByScore(key, min, max);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取key和otherKey的并集并存储在destKey中</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKey</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zUnionAndStore(String key, String otherKey, String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().unionAndStore(key, otherKey, destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zUnionAndStore(String key, Collection&lt;String&gt; otherKeys,</span><br><span class="line">                               String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet()</span><br><span class="line">                .unionAndStore(key, otherKeys, destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKey</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zIntersectAndStore(String key, String otherKey,</span><br><span class="line">                                   String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().intersectAndStore(key, otherKey,</span><br><span class="line">                destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 交集</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param otherKeys</span><br><span class="line">     * @param destKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Long zIntersectAndStore(String key, Collection&lt;String&gt; otherKeys,</span><br><span class="line">                                   String destKey) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().intersectAndStore(key, otherKeys,</span><br><span class="line">                destKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param options</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Cursor&lt;TypedTuple&lt;String&gt;&gt; zScan(String key, ScanOptions options) &#123;</span><br><span class="line">        return redisTemplate.opsForZSet().scan(key, options);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="9、Redis-conf"><a href="#9、Redis-conf" class="headerlink" title="9、Redis.conf"></a>9、Redis.conf</h2><hr><p>容量单位不区分大小写，G 和 GB 有区别</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213425110.png" alt="image-20210519213425110"></p><p>可以使用 include 组合多个配置问题</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213443138.png" alt="image-20210519213443138"></p><p>网络配置</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213513686.png" alt="image-20210519213513686"></p><p>日志输出级别</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213546237.png" alt="image-20210519213546237"></p><p>日志输出文件</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213610291.png" alt="image-20210519213610291"></p><p>持久化规则</p><p>由于 Redis 是基于内存的数据库，需要将数据由内存持久化到文件中</p><p>持久化方式：</p><ul><li>RDB</li><li>AOF</li></ul><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213637622.png" alt="image-20210519213637622"></p><p>RDB 文件相关</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213704099.png" alt="image-20210519213704099"></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213715249.png" alt="image-20210519213715249"></p><p>主从复制</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213754740.png" alt="image-20210519213754740"></p><p>Security 模块中进行密码设置</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519213819778.png" alt="image-20210519213819778"></p><p>客户端连接相关</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000  最大客户端数量</span><br><span class="line">maxmemory &lt;bytes&gt; 最大内存限制</span><br><span class="line">maxmemory-policy noeviction <span class="comment"># 内存达到限制值的处理策略</span></span><br></pre></td></tr></table></figure><p>redis 中的默认的过期策略是 volatile-lru 。</p><p>设置方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> maxmemory-policy volatile-lru</span><br></pre></td></tr></table></figure><p><strong>maxmemory-policy 六种方式</strong></p><p><strong>1、volatile-lru：</strong>只对设置了过期时间的 key 进行 LRU（默认值）</p><p>2、allkeys-lru ： 删除 lru 算法的 key</p><p><strong>3、volatile-random：</strong>随机删除即将过期 key</p><p><strong>4、allkeys-random：</strong>随机删除</p><p>5、volatile-ttl ： 删除即将过期的</p><p>6、noeviction ： 永不过期，返回错误</p><p><strong>AOF 相关部分</strong></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519214136461.png" alt="image-20210519214136461"></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519214150106.png" alt="image-20210519214150106"></p><h2 id="10、持久化—RDB"><a href="#10、持久化—RDB" class="headerlink" title="10、持久化—RDB"></a>10、持久化—RDB</h2><hr><p><strong>RDB：Redis Databases</strong></p><p><strong>什么是 RDB</strong></p><hr><p>在指定时间间隔后，将内存中的数据集快照写入数据库 ；在恢复时候，直接读取快照文件，进行数据的恢复 ；</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519214507636.png" alt="image-20210519214507636"></p><p>默认情况下， Redis 将数据库快照保存在名字为 dump.rdb 的二进制文件中。文件名可以在配置文件中进行自定义。</p><p><strong>工作原理</strong></p><hr><p>在进行 <code>RDB</code> 的时候，<code>redis</code> 的主线程是不会做 <code>io</code> 操作的，主线程会 <code>fork</code> 一个子线程来完成该操作；</p><ol><li>Redis 调用 forks。同时拥有父进程和子进程。</li><li>子进程将数据集写入到一个临时 RDB 文件中。</li><li>当子进程完成对新 RDB 文件的写入时，Redis 用新 RDB 文件替换原来的 RDB 文件，并删除旧的 RDB 文件。</li></ol><p>这种工作方式使得 Redis 可以从写时复制（copy-on-write）机制中获益(因为是使用子进程进行写操作，而父进程依然可以接收来自客户端的请求。)</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519214731117.png" alt="image-20210519214731117"></p><p><strong>触发机制</strong></p><hr><ol><li>save 的规则满足的情况下，会自动触发 rdb 原则</li><li>执行 flushall 命令，也会触发我们的 rdb 原则</li><li>退出 redis，也会自动产生 rdb 文件</li></ol><p><strong>save</strong></p><p>使用 <code>save</code> 命令，会立刻对当前内存中的数据进行持久化 ,但是会阻塞，也就是不接受其他操作了；</p><blockquote><p>由于 <code>save</code> 命令是同步命令，会占用 Redis 的主进程。若 Redis 数据非常多时，<code>save</code>命令执行速度会非常慢，阻塞所有客户端的请求。</p></blockquote><p><img src="https://picbed.jnchan.top/redisImages/image-20210519214827262.png" alt="image-20210519214827262"></p><p><strong>flushall 命令</strong></p><p><code>flushall</code> 命令也会触发持久化 ；</p><p><strong>触发持久化规则</strong></p><p>满足配置条件中的触发条件 ；</p><blockquote><p>可以通过配置文件对 Redis 进行设置， 让它在“ N 秒内数据集至少有 M 个改动”这一条件被满足时， 自动进行数据集保存操作。</p></blockquote><p><img src="https://picbed.jnchan.top/redisImages/image-20210519214902012.png" alt="image-20210519214902012"></p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519214912343.png" alt="image-20210519214912343"></p><p><strong>bgsave</strong></p><p><code>bgsave</code> 是异步进行，进行持久化的时候，<code>redis</code> 还可以将继续响应客户端请求 ；</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519215422300.png" alt="image-20210519215422300"></p><p>bgsave 和 save 对比</p><div class="table-container"><table><thead><tr><th>命令</th><th style="text-align:center">save</th><th style="text-align:center">bgsave</th></tr></thead><tbody><tr><td>IO 类型</td><td style="text-align:center">同步</td><td style="text-align:center">异步</td></tr><tr><td>阻塞？</td><td style="text-align:center">是</td><td style="text-align:center">是（阻塞发生在 fock()，通常非常快）</td></tr><tr><td>复杂度</td><td style="text-align:center">O(n)</td><td style="text-align:center">O(n)</td></tr><tr><td>优点</td><td style="text-align:center">不会消耗额外的内存</td><td style="text-align:center">不阻塞客户端命令</td></tr><tr><td>缺点</td><td style="text-align:center">阻塞客户端命令</td><td style="text-align:center">需要 fock 子进程，消耗内存</td></tr></tbody></table></div><p><strong>优缺点</strong></p><p>优点：</p><ol><li>适合大规模的数据恢复</li><li>对数据的完整性要求不高</li></ol><p>缺点：</p><ol><li>需要一定的时间间隔进行操作，如果 redis 意外宕机了，这个最后一次修改的数据就没有了。</li><li>fork 进程的时候，会占用一定的内容空间。</li></ol><h2 id="11、持久化-AOF"><a href="#11、持久化-AOF" class="headerlink" title="11、持久化 AOF"></a>11、持久化 AOF</h2><hr><p>Append Only File</p><p>将我们所有的命令都记录下来，history，恢复的时候就把这个文件全部再执行一遍</p><blockquote><p>以日志的形式来记录每个写的操作，将 Redis 执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis 启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p></blockquote><p><strong>什么是 AOF</strong></p><p>快照功能（RDB）并不是非常耐久（durable）： 如果 Redis 因为某些原因而造成故障停机， 那么服务器将丢失最近写入、以及未保存到快照中的那些数据。 从 1.1 版本开始， Redis 增加了一种完全耐久的持久化方式： AOF 持久化。</p><p>如果要使用 AOF，需要修改配置文件：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519215758086.png" alt="image-20210519215758086"></p><p><code>appendonly no yes</code>则表示启用 AOF</p><p>默认是不开启的，我们需要手动配置，然后重启 redis，就可以生效了！</p><p>如果这个 aof 文件有错位，这时候 redis 是启动不起来的，我需要修改这个 aof 文件</p><p>redis 给我们提供了一个工具<code>redis-check-aof --fix</code></p><p><strong>优点和缺点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appendonly <span class="built_in">yes</span>  <span class="comment"># 默认是不开启aof模式的，默认是使用rdb方式持久化的，在大部分的情况下，rdb完全够用</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always # 每次修改都会sync 消耗性能</span></span><br><span class="line">appendfsync everysec <span class="comment"># 每秒执行一次 sync 可能会丢失这一秒的数据</span></span><br><span class="line"><span class="comment"># appendfsync no # 不执行 sync ,这时候操作系统自己同步数据，速度最快</span></span><br></pre></td></tr></table></figure><p>优点</p><ol><li>每一次修改都会同步，文件的完整性会更加好</li><li>没秒同步一次，可能会丢失一秒的数据</li><li>从不同步，效率最高</li></ol><p>缺点</p><ol><li>相对于数据文件来说，aof 远远大于 rdb，修复速度比 rdb 慢！</li><li>Aof 运行效率也要比 rdb 慢，所以我们 redis 默认的配置就是 rdb 持久化</li></ol><h2 id="12、RDB-和-AOP-选择"><a href="#12、RDB-和-AOP-选择" class="headerlink" title="12、RDB 和 AOP 选择"></a>12、RDB 和 AOP 选择</h2><p><strong>RDB 和 AOF 对比</strong></p><div class="table-container"><table><thead><tr><th>RDB</th><th>AOF</th><th></th></tr></thead><tbody><tr><td>启动优先级</td><td>低</td><td>高</td></tr><tr><td>体积</td><td>小</td><td>大</td></tr><tr><td>恢复速度</td><td>快</td><td>慢</td></tr><tr><td>数据安全性</td><td>丢数据</td><td>根据策略决定</td></tr></tbody></table></div><p><strong>如何选择使用哪种持久化方式？</strong></p><p>一般来说， 如果想达到足以媲美 PostgreSQL 的数据安全性， 你应该同时使用两种持久化功能。</p><p>如果你非常关心你的数据， 但仍然可以承受数分钟以内的数据丢失， 那么你可以只使用 RDB 持久化。</p><p>有很多用户都只使用 AOF 持久化， 但并不推荐这种方式： 因为定时生成 RDB 快照（snapshot）非常便于进行数据库备份， 并且 RDB 恢复数据集的速度也要比 AOF 恢复的速度要快。</p><h2 id="13、Redis-发布与订阅"><a href="#13、Redis-发布与订阅" class="headerlink" title="13、Redis 发布与订阅"></a>13、Redis 发布与订阅</h2><hr><p>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。</p><p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519220239569.png" alt="image-20210519220239569"></p><p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519220301300.png" alt="image-20210519220301300"></p><p><strong>命令</strong></p><div class="table-container"><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center"><code>PSUBSCRIBE pattern [pattern..]</code></td><td style="text-align:center">订阅一个或多个符合给定模式的频道。</td></tr><tr><td style="text-align:center"><code>PUNSUBSCRIBE pattern [pattern..]</code></td><td style="text-align:center">退订一个或多个符合给定模式的频道。</td></tr><tr><td style="text-align:center"><code>PUBSUB subcommand [argument[argument]]</code></td><td style="text-align:center">查看订阅与发布系统状态。</td></tr><tr><td style="text-align:center"><code>PUBLISH channel message</code></td><td style="text-align:center">向指定频道发布消息</td></tr><tr><td style="text-align:center"><code>SUBSCRIBE channel [channel..]</code></td><td style="text-align:center">订阅给定的一个或多个频道。</td></tr><tr><td style="text-align:center"><code>SUBSCRIBE channel [channel..]</code></td><td style="text-align:center">退订一个或多个频道</td></tr></tbody></table></div><p><strong>示例</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">------------订阅端----------------------</span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE sakura <span class="comment"># 订阅sakura频道</span></span><br><span class="line">Reading messages... (press Ctrl-C to quit) <span class="comment"># 等待接收消息</span></span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span> <span class="comment"># 订阅成功的消息</span></span><br><span class="line">2) <span class="string">&quot;sakura&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line">1) <span class="string">&quot;message&quot;</span> <span class="comment"># 接收到来自sakura频道的消息 &quot;hello world&quot;</span></span><br><span class="line">2) <span class="string">&quot;sakura&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello world&quot;</span></span><br><span class="line">1) <span class="string">&quot;message&quot;</span> <span class="comment"># 接收到来自sakura频道的消息 &quot;hello i am sakura&quot;</span></span><br><span class="line">2) <span class="string">&quot;sakura&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello i am sakura&quot;</span></span><br><span class="line"></span><br><span class="line">--------------消息发布端-------------------</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH sakura <span class="string">&quot;hello world&quot;</span> <span class="comment"># 发布消息到sakura频道</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH sakura <span class="string">&quot;hello i am sakura&quot;</span> <span class="comment"># 发布消息</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">-----------------查看活跃的频道------------</span><br><span class="line">127.0.0.1:6379&gt; PUBSUB channels</span><br><span class="line">1) <span class="string">&quot;sakura&quot;</span></span><br></pre></td></tr></table></figure><p><strong>原理</strong></p><p>每个 Redis 服务器进程都维持着一个表示服务器状态的 redis.h/redisServer 结构， 结构的 pubsub_channels 属性是一个字典， 这个字典就用于保存订阅频道的信息，其中，字典的键为正在被订阅的频道， 而字典的值则是一个链表， 链表中保存了所有订阅这个频道的客户端。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519220430971.png" alt="image-20210519220430971"></p><p>客户端订阅，就被链接到对应频道的链表的尾部，退订则就是将客户端节点从链表中移除。</p><p><strong>缺点</strong></p><ol><li>如果一个客户端订阅了频道，但自己读取消息的速度却不够快的话，那么不断积压的消息会使 redis 输出缓冲区的体积变得越来越大，这可能使得 redis 本身的速度变慢，甚至直接崩溃。</li><li>这和数据传输可靠性有关，如果在订阅方断线，那么他将会丢失所有在短线期间发布者发布的消息。</li></ol><p><strong>应用</strong></p><ol><li>消息订阅：公众号订阅，微博关注等等（起始更多是使用消息队列来进行实现）</li><li>多人在线聊天室。</li></ol><p>稍微复杂的场景，我们就会使用消息中间件 MQ 处理。</p><h2 id="14、Redis-主从复制"><a href="#14、Redis-主从复制" class="headerlink" title="14、Redis 主从复制"></a>14、Redis 主从复制</h2><hr><p><strong>概念</strong></p><p>主从复制，是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。前者称为主节点（Master/Leader）,后者称为从节点（Slave/Follower）， 数据的复制是单向的！只能由主节点复制到从节点（主节点以写为主、从节点以读为主）。</p><p>默认情况下，每台 Redis 服务器都是主节点，一个主节点可以有 0 个或者多个从节点，但每个从节点只能由一个主节点。</p><p><strong>作用</strong></p><ol><li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余的方式。</li><li>故障恢复：当主节点故障时，从节点可以暂时替代主节点提供服务，是一种服务冗余的方式</li><li>负载均衡：在主从复制的基础上，配合读写分离，由主节点进行写操作，从节点进行读操作，分担服务器的负载；尤其是在多读少写的场景下，通过多个从节点分担负载，提高并发量。</li><li>高可用基石：主从复制还是哨兵和集群能够实施的基础。</li></ol><p><strong>为什么使用集群</strong></p><ol><li>单台服务器难以负载大量的请求</li><li>单台服务器故障率高，系统崩坏概率大</li><li>单台服务器内存容量有限。</li></ol><p><strong>环境配置</strong></p><p>我们在讲解配置文件的时候，注意到有一个<code>replication</code>模块 (见 Redis.conf 中第 8 条)</p><p>查看当前库的信息：<code>info replication</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master <span class="comment"># 角色</span></span><br><span class="line">connected_slaves:0 <span class="comment"># 从机数量</span></span><br><span class="line">master_replid:3b54deef5b7b7b7f7dd8acefa23be48879b4fcff</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure><p>既然需要启动多个服务，就需要多个配置文件。每个配置文件对应修改以下信息：</p><ul><li>端口号</li><li>pid 文件名</li><li>日志文件名</li><li>rdb 文件名</li></ul><p>启动单机多服务集群：<img src="https://picbed.jnchan.top/redisImages/image-20210519220614194.png" alt="image-20210519220614194"></p><p><strong>一主二从配置</strong></p><p>==默认情况下，每台 Redis 服务器都是主节点；==我们一般情况下只用配置从机就好了！</p><p>认老大！一主（79）二从（80，81）</p><p>使用<code>SLAVEOF host port</code>就可以为从机配置主机了。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519220728586.png" alt="image-20210519220728586"></p><p>然后主机上也能看到从机的状态：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519220749402.png" alt="image-20210519220749402"></p><p>我们这里是使用命令搭建，是暂时的，==真实开发中应该在从机的配置文件中进行配置，==这样的话是永久的。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210519220807550.png" alt="image-20210519220807550"></p><p><strong>使用规则</strong></p><ol><li>从机只能读，不能写，主机可读可写但是多用于写。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> 127.0.0.1:6381&gt; <span class="built_in">set</span> name sakura <span class="comment"># 从机6381写入失败</span></span><br><span class="line">(error) READONLY You can<span class="string">&#x27;t write against a read only replica.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">127.0.0.1:6380&gt; set name sakura # 从机6380写入失败</span></span><br><span class="line"><span class="string">(error) READONLY You can&#x27;</span>t write against a <span class="built_in">read</span> only replica.</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name sakura</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;sakura&quot;</span></span><br></pre></td></tr></table></figure><ol><li><p>当主机断电宕机后，默认情况下从机的角色不会发生变化 ，集群中只是失去了写操作，当主机恢复以后，又会连接上从机恢复原状。</p></li><li><p>当从机断电宕机后，若不是使用配置文件配置的从机，再次启动后作为主机是无法获取之前主机的数据的，若此时重新配置称为从机，又可以获取到主机的所有数据。这里就要提到一个同步原理。</p></li><li>第二条中提到，默认情况下，主机故障后，不会出现新的主机，有两种方式可以产生新的主机：<ul><li>从机手动执行命令<code>slaveof no one</code>,这样执行以后从机会独立出来成为一个主机</li><li>使用哨兵模式（自动选举）</li></ul></li></ol><p><strong>如果没有老大了，这个时候能不能选择出来一个老大呢？手动！</strong></p><p>如果主机断开了连接，我们可以使用<code>SLAVEOF no one</code>让自己变成主机！其他的节点就可以手动连接到最新的主节点（手动）！如果这个时候老大修复了，那么久重新连接！</p><h2 id="15、哨兵模式"><a href="#15、哨兵模式" class="headerlink" title="15、哨兵模式"></a>15、哨兵模式</h2><hr><p>更多信息参考博客：<a href="https://www.jianshu.com/p/06ab9daf921d">https://www.jianshu.com/p/06ab9daf921d</a></p><p><strong>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。</strong>这不是一种推荐的方式，更多时候，我们优先考虑<strong>哨兵模式</strong>。</p><p>单机单个哨兵</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210520105113999.png" alt="image-20210520105113999"></p><p>哨兵的作用：</p><ul><li>通过发送命令，让 Redis 服务器返回监控其运行状态，包括主服务器和从服务器。</li><li>当哨兵监测到 master 宕机，会自动将 slave 切换成 master，然后通过发布订阅模式通知其他的从服务器，修改配置文件，让它们切换主机。</li></ul><p>多哨兵模式</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210520105205914.png" alt="image-20210520105205914"></p><p>哨兵的核心配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure><ul><li>数字 1 表示 ：当一个哨兵主观认为主机断开，就可以客观认为主机故障，然后开始选举新的主机。</li></ul><blockquote><p>测试</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel xxx/sentinel.conf</span><br></pre></td></tr></table></figure><p>成功启动哨兵模式</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210520105238999.png" alt="image-20210520105238999"></p><p>此时哨兵监视着我们的主机 6379，当我们断开主机后：</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210520105258393.png" alt="image-20210520105258393"></p><blockquote><p>哨兵模式优缺点</p></blockquote><p>优点：</p><ol><li>哨兵集群，基于主从复制模式，所有主从复制的优点，它都有</li><li>主从可以切换，故障可以转移，系统的可用性更好</li><li>哨兵模式是主从模式的升级，手动到自动，更加健壮</li></ol><p>缺点：</p><ol><li>Redis 不好在线扩容，集群容量一旦达到上限，在线扩容就十分麻烦</li><li>实现哨兵模式的配置其实是很麻烦的，里面有很多配置项</li></ol><blockquote><p>哨兵模式的全部配置</p></blockquote><p>完整的哨兵模式配置文件 sentinel.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example sentinel.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 哨兵sentinel实例运行的端口 默认26379</span></span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"><span class="comment"># 哨兵sentinel的工作目录</span></span><br><span class="line"><span class="built_in">dir</span> /tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 哨兵sentinel监控的redis主节点的 ip port</span></span><br><span class="line"><span class="comment"># master-name  可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符&quot;.-_&quot;组成。</span></span><br><span class="line"><span class="comment"># quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了</span></span><br><span class="line"><span class="comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span></span><br><span class="line"><span class="comment"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></span><br><span class="line"><span class="comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span></span><br><span class="line"><span class="comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span></span><br><span class="line">这个数字越小，完成failover所需的时间就越长，</span><br><span class="line">但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</span><br><span class="line">可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span><br><span class="line"><span class="comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span></span><br><span class="line"><span class="comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span><br><span class="line"><span class="comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span><br><span class="line"><span class="comment">#3.当想要取消一个正在进行的failover所需要的时间。</span></span><br><span class="line"><span class="comment">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span></span><br><span class="line"><span class="comment"># 默认三分钟</span></span><br><span class="line"><span class="comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"></span><br><span class="line"><span class="comment"># SCRIPTS EXECUTION</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span><br><span class="line"><span class="comment">#对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span></span><br><span class="line"><span class="comment">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，</span></span><br><span class="line"><span class="comment">#这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，</span></span><br><span class="line"><span class="comment">#一个是事件的类型，</span></span><br><span class="line"><span class="comment">#一个是事件的描述。</span></span><br><span class="line"><span class="comment">#如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span></span><br><span class="line"><span class="comment">#通知脚本</span></span><br><span class="line"><span class="comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">  sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span></span><br><span class="line"><span class="comment"># 以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="comment"># 目前&lt;state&gt;总是“failover”,</span></span><br><span class="line"><span class="comment"># &lt;role&gt;是“leader”或者“observer”中的一个。</span></span><br><span class="line"><span class="comment"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span></span><br><span class="line"><span class="comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br></pre></td></tr></table></figure><h2 id="16、缓存穿透与雪崩"><a href="#16、缓存穿透与雪崩" class="headerlink" title="16、缓存穿透与雪崩"></a>16、缓存穿透与雪崩</h2><h3 id="16-1、缓存穿透（查不到）"><a href="#16-1、缓存穿透（查不到）" class="headerlink" title="16.1、缓存穿透（查不到）"></a>16.1、缓存穿透（查不到）</h3><blockquote><p>概念</p></blockquote><p>在默认情况下，用户请求数据时，会先在缓存(Redis)中查找，若没找到即缓存未命中，再在数据库中进行查找，数量少可能问题不大，可是一旦大量的请求数据（例如秒杀场景）缓存都没有命中的话，就会全部转移到数据库上，造成数据库极大的压力，就有可能导致数据库崩溃。网络安全中也有人恶意使用这种手段进行攻击被称为洪水攻击。</p><blockquote><p>解决方案</p></blockquote><p>布隆过滤器</p><p>对所有可能查询的参数以 Hash 的形式存储，以便快速确定是否存在这个值，在控制层先进行拦截校验，校验不通过直接打回，减轻了存储系统的压力。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210520105357970.png" alt="image-20210520105357970"></p><p>缓存空对象</p><p>一次请求若在缓存和数据库中都没找到，就在缓存中方一个空对象用于处理后续这个请求。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210520105412195.png" alt="image-20210520105412195"></p><p>这样做有一个缺陷：存储空对象也需要空间，大量的空对象会耗费一定的空间，存储效率并不高。解决这个缺陷的方式就是设置较短过期时间</p><p>即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p><h3 id="16-2、缓存击穿（量太大，缓存过期）"><a href="#16-2、缓存击穿（量太大，缓存过期）" class="headerlink" title="16.2、缓存击穿（量太大，缓存过期）"></a>16.2、缓存击穿（量太大，缓存过期）</h3><blockquote><p>概念</p></blockquote><p>相较于缓存穿透，缓存击穿的目的性更强，一个存在的 key，在缓存过期的一刻，同时有大量的请求，这些请求都会击穿到 DB，造成瞬时 DB 请求量大、压力骤增。这就是缓存被击穿，只是针对其中某个 key 的缓存不可用而导致击穿，但是其他的 key 依然可以使用缓存响应。</p><p>比如热搜排行上，一个热点新闻被同时大量访问就可能导致缓存击穿。</p><blockquote><p>解决方案</p></blockquote><ol><li><p>设置热点数据永不过期</p><p> 这样就不会出现热点数据过期的情况，但是当 Redis 内存空间满的时候也会清理部分数据，而且此种方案会占用空间，一旦热点数据多了起来，就会占用部分空间。</p></li><li><p>加互斥锁(分布式锁)</p><p> 在访问 key 之前，采用 SETNX（set if not exists）来设置另一个短期 key 来锁住当前 key 的访问，访问结束再删除该短期 key。保证同时刻只有一个线程访问。这样对锁的要求就十分高。</p></li></ol><h3 id="16-3、缓存雪崩"><a href="#16-3、缓存雪崩" class="headerlink" title="16.3、缓存雪崩"></a>16.3、缓存雪崩</h3><blockquote><p>概念</p></blockquote><p>大量的 key 设置了相同的过期时间，导致在缓存在同一时刻全部失效，造成瞬时 DB 请求量大、压力骤增，引起雪崩。</p><p><img src="https://picbed.jnchan.top/redisImages/image-20210520105514023.png" alt="image-20210520105514023"></p><blockquote><p>解决方案</p></blockquote><ul><li><p>redis 高可用</p><p>这个思想的含义是，既然 redis 有可能挂掉，那我多增设几台 redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群</p></li><li><p>限流降级</p><p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个 key 只允许一个线程查询数据和写缓存，其他线程等待。</p></li><li><p>数据预热</p><p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的 key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux笔记</title>
      <link href="/2020/03/30/linux%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/03/30/linux%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="cf091403931894ec0a33e53ebf16800c51167f6df40300630b6690b7a9bd5810">b55082ff7ac8ae3c8d91f4bf8c798b5888e54ab1fdcaa567918bb7ce3881eb7ef3de059776b63d1230d385ff0dda8fc1d014c82a5883f544fa6cb574ab2303aed7230d46cdf79f4042b7d6fa21a5288d3f8c9563471983972ab05d2c2d4a4d0d8fae4f08005e8ae12574d8d42e70b6bd7662a4c1bc61c952c3e97b36435f1265ade8a4fe588d713660697465f52a69a44f5af948e0c280364537044a5d0a5458c5eec9abb72b0212bab36584ab61f3acb7a067c65013bb8d28bc6064decbaa0fd0cfe56bfa5ad1e76a4f582c44098f30e3b97be56bb4dfcd3f0f590f4bcf76aaac7f668a41c0326410ceec38297fb8176426231d9d2247cf6f5dbcc7894a3fd9008b82dec1fc4c602d8faf68af7b27832e52448b275c88f88302166a5b8e13a770848f1a3afc371c015c005d978080ccd5ffc6db34e3df15f1c0c7fc6d0765400a6ed2a2e11aa73273ceeb9bb467fad0ddd9fb4718748a6141ac77e7d922e8c691a5dcd5f2861ca8e2bce7412318004a45be0a36c717160eb9023f48dc67d508f6d34067552f4c246039d60cce5dae7930ceb038fe45c976c8c672ef034001388b8d5e49e273abdc647d9dc3ae2c48418e7ce9269600a65fefb25ea242806e58a939dc68f170c4d40923a009d81f3985cd941313d508d0c90824c7ef05afa1d63767bfbb311eb5d8ff5058812ca14565a949e9731db202c9720b432fb30fb971eafb488aa3cdd206861cc590a5a33a8c8fdd91b3c66103e1955553406df39b632060b4b334e672a21e91917d81349827ee9c406c3ec2609993af980af2448760e50b17abd67bce338f436f6703bd86bf8ebdd1d1233118e5b3ab00e49ba3d87d33a5e9150be5ce6006fd4c7f7513a095b1baeef56f73d18ab5960fc60c354247c6a1bda334ca2720db6036807a98a43fc520a13a4187a7b4b94546ed733116595e92c21bc0313727cf6d7d6f88b9431c1659ed03113383592683871079f300aaafb1df6e1fa42d7c44a1caee5abe36b6ea42945f9ffb40977fde6f23b7dffa2d2b0dd4cc4181f8ab961bc815ca4b7f3209ae03c16910b45a114e9fa0c249f57968f0f1562bd0cb40586fbbba8ef03e19c2de8035345dfc39affee59748cd4601dcdc2a6bad46b0304e77bb8f0e94130cfaa82ba5ba2fafefb2b4bbb202086b2e0d2d056e2c98c9f57b6767b7c68f6adc2ad502c75de500c9d6b54923773c8b2cee5f5cb5b39c812594cee42d0eb8c9637101e1394f6b283bb795e7a31d06f6844ac2d29cde8fde6284ea45f2fc322474e7543ff10aa24ff57b5b7b855d457f43df47abbebbcace33cf73415c49eb2be7864a7b8e68f583f6b9bf26c8ba748603f8e7f6f9d8cb48985525181ea02d4512eb42ad2e25d4e16f48e9423cd17dcfb5ca470c8fcc3635f1475147d2cc788ebe12f7012aca9cf8406a519531a686296da6498411e5e84f3b18042830822d1d612a159c1fa76308628217067362f4ad4a4b18c809d02c9a1210c93cfadc407d764c5ede21c0edf642e5ae6f00771c504a576b227c04a0168aa1afdb9f90dc262c2ee1eb95a34228f4688b9a4e3fc0eaf480a03d635fdeb27d3a41dc2baad421c59a77947aac213ba7d0b1110371df66d2ab1afd7dfdfc0426e8c0ff25ba7398d153dcca9f6b63b70387e9268f8970efc2ea491e84a1ed49b22cf6e03d30776245fabe288fb09db2f986bee6ec228deff402bc313ff87b655556a0a73aa3a1967423e4ba09f66dd525378bb759b533d79f06781851ac93d4125143414bf65c5cf32db89ae8ea71d665bab3866bcad634c3e3805aa528c6fddbf23f0e8e3904644fb5d421770a9618e6214fd0acb9ad5656c18d3569463dd788d0e05be1079aa628309df520a1f1fb02186a59c3bf27c32b02e58b6a6544e7b83e1ca763cb23a0abbb90cb5aadae091f5a29f85b74f8eaee7836e0f77d1beddcdb8eeda6d841d04124f8d68e65eb2fb4720ed66d7dae772fe00a3c98e14729c56aea6cdde729fe04cd56ee96c02680dbdc26cd5773887fbf46b75de372f8225c7a34dba884ecdab5157d2558f834cc2dda2db8d3cc649e80d1dbe8faf801d8edf860f7234c28ed30f8fdc435ad4258434ddbd8ec6fc6d6931aef2583de23d30401ce82b64a07bc212441ab020182b2a5b120bb03dd781caa0451d8c26292c80bd74c1e4da20b2b8966f8c1d685760a02934c93fc595c6b79177cba46907b9457da6098580263d29d2b5a8d18dcf8bf5c2055e91efd8ccb20ae8c103d960de6a7d626f47d053f722e2183d17de7e3830f8ceca7733971ce6cdb0071dbeb6c250162f27acbc13e7ad163daf30aa511292251f0faf3e2c397e3d65b1d2977944a30ceb5cb899c2e78c4f0b50ff74bd1f9403cdd06bdec567a660f2f8e526aa0f9522b86ec578b7a4aef6c63f8a36aaa53218d324a49f7bf894c496e5672af148a7790e1efd1b64e54c5d576a01e97caa4d01d3b93d169f8e7a3a3be4c8982c8830bf4af9544cba0d1c47d9072d7b11c95985cdb3fa8656f429964a378460cf2d190ec9c277edae8ebb0219a12f8d031dbc3c2462a5c3a9a1370e33fd5b93d51a897591430c90b9c3f070af91655ee725d7ce88f1ba5fe96226c82a38b891e785934ab2890426a769f2960b41931d3afa7226ca83d59f3819f45c3c890023dcd030691a2ab099fa8b35523b4fdb04d634fbfb1028a67765e1637de58f5585062b51e6fbf2ac1813fb6453ea651a8325305226afa760eca2e0f65e942ce69bf2cd083cc7e23f3073e9cd51441e15591fcf104274158354874a17da2540f6b005f6a3ee4e905a86217d10cd5a67223084d1fa53386de7ad8c203be3b8a3449ade8d7b2c1f3c309f03735ccb66e83ea40253e835196bf719fcdff5254d3350710224aad3828c26122e4679047192ae114cff4c006e894fbe4d68f7072bcab6effc0c04c23cdd1e9e6ca8350dbc0d06ae3dd571cf645df40af2456bd97f11a0a1f94dbeb04627e70d624ae63d2a3fa9c9c483df8373c62ceb4e86114181153093def3964dd2eba3e3ecfccc2767c9e61028ffd962f50469889388145818a4b25fd09c17e59d9930ea3acc78917781feb6e74e49db6ebdb26ed0ddb768f6dfae31740ccce17e2c2a24a8763ba8ad44bc124f3765485b99604a7ed002892de387e1517a8997208778ceac3435ff3c43f10bd304a8fae2d34f316a9d26438084b742c811ed8df1a69d077b9a114ee787262ddc0d3c5a3273ebc75a44062480bd4f3f921b6eb794882d1b3231181cd63934d339920dc3ed6f68f7bf7f1c84a4218d895c5e4ddeb0243db8ab21ff6ff73ef5438c97763928d429c4f098129c183505bdc2218b9e0a2b6d47de7270df0e6af0b6df360e9e355d1cee587af8def0e0bc5d56ef4fa206d39ec42e041a0f4a996cc3ac831e7772eef11c44d40bc840f75d0e3b592db2754f205c5cb6fdc57e176a86976b800b2a6de9e4cde11678b4f52a170300fd8b0dcb3033f97c52432302bcb56dfdeac637fb9bae6a97689051fceb8165df7509bd752989927639c57cf1b580e15e08e43e45c05a6da5fdccd71597e7c8c90ef5c8d3ef6fd4c26fce2c9b807736f9e03633abeac7396a3d72c31e5ebb24f2791196b9e6638bf7480e1503f681ac768bff94c42ed39c545f37eba520cf953cb367b98b0558d0162f836b651220b20efc3501ad0a807c04611dacbeb58c5cbd458b815ef9c67e78912a4d8db9a7ff34de48d377dede35c1f0a847fa5c64a8c485664cfbc70d8b5b352ce5f99ff00c6b283a6a078ba6ee779eb685e0cd67ab1dcb64c0892a4fe202a7b0b23faee71454cab1e28b8ff5519e95fbdaea5f469af67c5804fb811878d79b9d8f33bdf32f56653798bd8e64de0df1e8d922da07bd4e89c2c013beb970713cf2d97c94291fdedfd13395cdc3d8c3463f76521aab4724d75e1132b0e7957d1d17692d4b6ba89ac16f0e5d46ef2ba7d04a081dd2930b6a1675875cf769625fc862a76b0c7c4de9751d7172e92a52cefb2beea3e2303c11bbe30f8e1a8d5b5da3be5f1d91d4e7c087c251092b7b4d90e169522469fb1f6a8cf8557ab2d88ddd5eb415f888fec73e5ed3721b20a5a5ced3eb702f1af864c777e29ba166b306152896f61e20fea5f053ad255325b1156b307a61c67a76fd39e20913b79b21836d86b86d2d28d277a15c39a2140d0b9a9eae174280253bdfe37731beb177863683b16a79694b5e8998772acd32a69479fcfc59125d1ebb587d9b6635baf35dc43e9b131e7a86aa2d056393616e27bdfbcce57132c147bd28abcb423563a8a87626c97ed032b9410e3e6163075223d0e45d06a0b91f4618e48bab796b46047263d38f56305d78dea13c6b2a07a504692754ba7afb46211b7d192c93eeee42898159e3e6ea98870bac1838d9cad2a482952520245f425538cd7726a26503b9ae0cb2e3303a9a6d79777e968900cab88af765734b5460f0c02d81483af9aeab906d0db4b7ba960bd3cbd7b6ea899519a87e644d29b179d9f3ccca7ec7062d633f00da9e2459067ba072d0cb6188aaf77f4a87179c222ee4ed43d15de78773686e3d0fb8b927227c8dad2b51439e8967d993ae2473995041e8c2e6b3afc4c06465a7c8412953bb59249a88711331b0632737e7b4f0e225299a9f89d814dd0874dda00d68c67c7f3540e7c8f60f7c4bcae4dd9bc7da4bfe5fecfee092279bf25ca2ac02b56fb346b2f653c8899efb8e3421e76c20bf06869ea31f30d36a2c7900ad74219f19751dc562dd2d00065457e2a9680dbbaa9609f527966078e53e57bb2e3e5c42917012cefb2eaaa2bc64b2be45ed715baa412ec17af2a3a6cefaef171d28a64f076b4ca482102f5bdde04ae222ac1d0721c7af5a3650402d4feaba71b81f7065a4d0b7b55e196a8e636e259de365d6409d34b924e5211c4e5b55b96d4a3d6543ee0fd333f6fe17217b29d131d425567b721dcca7e675e711d77f61a95527ed9475872ab9e5361642ecbfd51fbeab08629c36144a479387b368afc913938c9eeba7bd340986306aa4072c5e26de1ae866f3681810f2aff44524b54b999849049a0155ebeb12677417a379df52ad257fd7153073ac5025791dade44d29f341130a669756f806f71c4ea5574f6c9e9690a9d5cfb02ddf05d9eb614737b4f27ff309fcb2e1a8561491f3a12b302428c02dd562e48fc1f4655f8cb278637de4fce479e86dd2d8754cbe4f333929bc65802aba2fb501ddcc35e83351f163dad4f3e8fa9d6a377096c517eab6ec82c3c19a4c5ab7ab9a80e8e1dfcbc2e422d972a6b9baaabcdacffae7737c9119f1ca23d6a7e1bed22903984cc627daa86113e0aaaca72430ba2391a794451bac12f33bb5b4cda550339e7d5105044a736e86bbe04f2c61acd781794e472797191eedbd049295d09480f34558451220c1d01d532a6c995ec38048385ac2bfcb6b4cb77a452c28ff107f4b50fc0be63b037a6829fa39cf4b512c741cb41f14424ea9d3445cd11209ee92f791b1f1088dcd9c4dfd9bce23867238b6c2c425f6a7e37d1263bfdf663a54ed622e7e05214f478a4fda29207fbb0b7661aa34ca3732a088e0430bab17de6b28e9440f10fcb662bf49b5db20e38be62f481146a6b1b308ca107ac089e88d5854bb2ac154e0a298f700d21653d7aef4a61b3ca4b8ad14c244a937d23a8f685a897d3168684e88600ba9edcf0526442f03df5d33291f027a38c4dc488e8da3d26ebcdcab4f2d705e9ac0d4fb08e88b815f9c126f511c7ed268e2e6678f0ed5edd4f0e0f2c46704054ad0e6cf185a2b5bdc6b8391ad00c1c8868afab438b588d5141b2868298e9022fff8cd5938e2e77e2762c4cd7a60332608c34ffabdf5faa319a7f0a7dfe2ec300afb35de49f067e3e5990eb3381303def7eb667b6c8059f22c134895c7cdc359e4247c6d3f270434bc3388f9c5fe7259c0bac18afe54ceaf0e60532d916e360e38db01db870291af786afc56c4c327f21afd8c8cbe433ea037e01e983d8006ed789a6e5ccc5bd4199bb6988de24ae06d414d0fb421385ef6cd901d4ea52b30f667a567be87cf6a89798d89e3b274c7f9565f831b6191a2b1e1549fb8be01e1f6aca08193b66dede61f1a1b9122163ac600b2f263f5c0b9c3555a7970541886f6498e75585d2e50ac2a90ed7a5423f24fb76748a1ba5516c38d54c6725675a83f3f64e158353ab573aa84ffdff3ff48a0c31f72dc522292715d491b0e7a010d7ef0c473252b110d5fb4a737f5fe9904b298bca9d22f335014d6bbeeaba429a7e180d8b264634ee86376639c62826969eda8973dac7d926401e01af11b475d2086118d033cff15d04ab06a6c89274a7466a7cea60636b35b9c8990a8008a02dccbe9439272f727e05881ae878d86d36d97eecfa5d9edb02b97e029ef098d2c81f493fc6e6b86dc71aed18afec6c77d684bfa364781fe819b52331cbf8bedceb01e1c9193d8231627a649a31d599599946e6ccaf681f710927e01aa1cb4c026925d48c022480c452ff8be703beb432dcc28b7da7ae43de31fb8d0322041c92a2c849515171252334bbd5b0f27a7200fd3602188a95d3da7fd40c00a16bc93140ef50a63d427d9b2f707100bdbd762499c19ed7e5a5ef768e729f8cfb4d31cb4b101c9726e5ab0e193bb47963931786865e7d8d474f4343f8c51e5767abc239c8531450f6ab87b724b11ffce1403bb7e47faad15f8f5dd0f8eb051a811b193aa7abe924e858a3575a884ff55c9048f126c53df4c1bb8259aad17b89bedea0bb6a730f015fb971d1e01cb9a86a01b1e2e62f8ead934a31641f7ad0f68ebf3b7b46241366a6f52f6d9619672b94f0f359fbfc08d44ba9c598b8d4b2f64bec97be9c7416fb6ddc2fbb5901be9d1398a629e525397a6f919127022e3ef71385449d99391b8ae53a18f276e786946420f039f0b7d94d2b57d023e9fedde4348ccd689b42b553a65fa9aa2f2dcc78daf8cd3e29eb8cf719fdb48e1848a3589a94e10c2f70c5a85b09f4202e2d2f61e464989c10737b1a5e21994397945917b682584d76de23a54b50998d7b3f627e37aed76a0159984c51e4c55fbe50af30f2d3e99f5de4833fdd2a65fbe9c14633be4398b66513d5d0df6ed1828cb7c341a9ace5e809cd22e084c0f9dd3c1a2009fea52d519af52447efde80e237941e55fa0a1f684e6426be11dda241f34978fcdf86ad537bd8e460616a2594f2cf0721770b2083ec2ee995a72f3d89328c9db0d4c210c59cd6422812f72ced8af55607b3d95e533bfb4810177fc6b8c34e8bda591b5a1dd5459c071c543f12f6a93e139fe1553b88a2e2a9811c8cb555ee284e5dd4e98012eae87c5a83db058ea0015f64f2ad0c275321a2508912939b416040fc51d593156d1e1c6461db26994fcfcc944a88fb00ae17528e7bc3ea81b7dd2f937dd406df9c534cfd776d564ff4d3f0ba0de144eb0501c2231c0ce70f500bbc8e9efd21035acb6dd9b5414ce955b22d4ff30f024ae3c08370793e6b6025c47fe5bb5b80d4e8734122f2850f7fb8c2b71f961fd456c0b505cc6fbe1b54d4c73212e369da833722b58e6674c97296bf9e0745ec23b4d7021c96f51fd389c65c77c8c08a6b6ca670922346ab4d16b36b844b83cdde8eb561e3d6983876cbadea6b9e9b26bf0fc51805a1d3589c214eef8c457c3926a985b208890ac00e8f0b42d8f8b302ed3fd31247f61061b34996db0e34bd28020ff93756aa5224d0b9665797d124b0793c045c6becbac4916824695cf4d92219c0fb66a370c23126ea54e2da738c2f1c20c6cfa4556e7c7078c327825281cb1078142efe9dab026334b24fd2e95120f0e90662c27eadceb938ddb1b7af9d5112b24b22798dc1bcbf61001411a6563eb5fba255e7465b76f73122994c7cbc27419af85a4e601583a3783b9c9c6f1a907024a20f1480accd3b554f19b770703120bc759eff5444df22fd29b650493e96bad63a03ced1397faf71c7eac7d73202944dfee893ff69cbdde211c1824d1cd50dab1658a476fe324d5b8610c03aa1dae5818bae45c93967082f2664ca13121bb59ce82dc392677d61e705d5aebbaf9089febc71a7f1750835580e16738ac924e6ff83e8dba7c937cbb4f778aa902ef2cfdfec7398b014f14e7b1070a03a4888113b93370a16d95fd3551202485470dc497da5275717e2ab409d3695417a722c436da40a919809c77c9954a172fd4803a9cf1318eddec5484fdfd97e55af55f19017d4637f9e1ac16e3631f7b961612d24e7533e563c0a77da64e84dd7f2abb304a1c77728d18fa2d65e0328041c524b3a484888984ac2136db4b3cfb4426d1511b131ad2947dcdacf8ba5739e168ccd158b5f434157e63fb426ca01b95a15df00c863a3c38f67338f3e2d6d674bd78644af7e9d6a91249e12ac2acb98071272693c054be2cb1996c25b9256aa9388838dc504315c15b81d340e11162e452a24c45e869694d14112a6e87c85a100fa2ebb0047b5217d087d5fa2fcb2da53b701577c1f55281b1a5339ebae8a262376d0d0fd0bf9673cfa25afa8cd1aaf806269e658072e49436a5850831d74a690e8554ad46262b59a0d2662bb45a12ad29f111ed9c6d1e4d9aabd4e68a1f667c918fdfae671b806d5eb59dafae09ce7933336b08f3328c7cd145bb5c3091aecfdd3fbfb53fdcbb9d906ba5943c529a4d0ec73dc91f73cd6230cf30ec6af3833affa9f4a4ed955844da42f816beedc5f43cf5fff9f8f2775f040907310e3f61a317653bd487e144e3882a7e7dd2c9c344d1ac13c7a18029d69cca06e42487dc2474beec056c4a8163cf9f8f87c5427592a5e92ac9d97caf26539b5e36528167c637fd29b2671930d1510af8d6417a40ceec2f12221c365e9818231408470480f4687a448f94a02047e7b5e35b1a1f8eebe2edf28c5c1acacec1c6be7fd45dd6c5334550bf76e940424766c6a399787c699159f50de40693a168e2a2f0e0c41326839585e741411831895b170e50243baf9d562129bef2698d8005a98ecdc49db94607548c20496946e04828c7146aedc1c6226a76919bba7fe9ccaa2e69ce7fa848c18e6cef43b3eb9a67312d17c3738f54105b10dffe0c34d9389aa3a0a80d9b0827be9f2c26b1a68f1b54a677bc78b71b0c8e713bf6fba6cf31a143b95dec73ece86878f309982c487be7a76b48e0c0035be3464f9efe8dbd7ffb5f723c22bcd85dc86a876cbf4f69873d5330a9fe63398aefd9aed7ab5bf95f4f162a85fabe6c36955877527c03888cfaee2100a98a350431ccf296981cd85e4e12d65e759d92ae8487aefe032c6378fb75e0cf67f1de65ed529797238eedbdf28778638cf7cb2da590f6ddc25e6ff16d910a1f13de5aca6400b193654822223404b43eb2e681ebe4fb7f2eda48b3db1c15f077fa3acb9b8909a0366f735221991d047f753ff477d8638b0d9f0dd93557f7c23aa4141e14f44cb1e7c3019533a033952380bbfc409e7cd2a7c92863f57a140da965ab6c98526848e20aba99607ddb171b9662f69a255d173024044d9a8e04f8adc02e5d39ba962ed0642f17cd26d867daf1a9ce7dac62a60341988689bbec3ccc165b75370a96061545dfdfd1af048d5f42b7149d5a4c1547e41bd9a087f6593655b2df26db5cb4403f06e1bb95d08a86fdefa8d54a87b35720a424d4b32504f17dfb3d7f3ceb05450d92561532f31e86ad44a7362e468b799e5f1010310ca48f07596ccf6a88d1551eba2ec100ad9d103898b9d2f2c9b8e094d6c9b0e6c5af38ced64bd42d12ba7b81f4406714fb310a170696fb67b6fc403f4bfeb98535125fce6c1eba6f9327b9f482b68da76d7202ca0b9f4d1e9f72f0612093a722d2864f3fdef6beadcc355ce12db4133c3c700ff9c9d0192eb5478c183c280c7c65ebe6e9678a80dacee1ba188684e65964a5f0be46f48af75a6d6a68ff83c24040ce701297fd85b51415dd41a26c83322fcaaf527b1bc5cf30118abe60cd0d29c042aad5eda6e088dfac212e9f085e9c0ef53466f405974b9c20d62c42d95eb9eb19787e7025ec7275e0ac4b46a5eab38e7c9afc9069ee0eaa9c5c800e0e37052e09bb5c8453a21446bbe3d1b40b0beda7a2d34a7f1e1e59b2df243772519c8b4af75e6ff583b82bdac3f66b1001f0477f9ec156cd7059b6a247378e11068b59d55bd4b2f68235bb9896a1afe62abbb9195b8d2b8b2be1965571bf8faab4960f4d1ca457781e4d69fec1d72dec8b61c809ce1686533b899fcc05cd6bea0db4800c1ab45b78730063daf8c70572eed704561d55281bccfae4372caadc0b640d00f54a4b3c691a6a10d15b31a2aaa2abb83df74ee1d6d592f0446d5006af2a9824700f1607309cb5d2348eecf142fbd5eb95b7bed0a14e0d4e89645f4d3a39ec8e65b063d4096b1e3b7c161ef7c26775ac700df1a2784864f78b2720c02ced78a05032fae05266e71e44c79297c2e3aa34aaa8068cf845b15630d6f7acd777feb1cbf5cd4573856add9a4df11d44adf8f80f62cefd8eff52cc81ee86a7ba2b022ac498cf9192e828fe4a88033bf9c33e965db1ae1a40e4af78d25b6a1fecf716dce11a73a5e4a3c79bb96600dd5d2b7a2803de3524b707e87b83b0cc072e5b23c547a17a7fb3978ba8829fc66c1a8fafc657594cb9b0bf8a5fd069c19980ed98a77d45cea0bd5c0782c48a6acb35682839de8c73188680a5032e945ab035a2a115d8963bce24b44af801e38d36cabfc52710fb59eec0f02f6f31611bb3654b789b8b877f150e014e72b01cef2d76bd52559bee36114d2734ff6d0b22d06a48635dd86ebaa67283efb17278a815ef7f1ba42f15fd3e389f30fbad2fe9b5c02f39e1d56ab0a338e80fb290911374c08301d59264491e4b9cd4c23f8fa3e37a23ceebe5de042a5d44c200bc108f63a1520bbf6e4e3100980c64b8fec8f48ae01692bdaa9d7578aaea079cf89b50be1bc8d186f14cabc5e49829731cccaecc7fee66a2b88b5100172c7476ce8562533691ffef470b4636ef375d7fd99ffe46e6ef0f228c38c639088b2253527d01001b1db48f004be72fc8f0e4b94be644e5520062b3ed869238fb97a2695e8907f934c1f8453316fe5b27761b9e64d37d7d2d08b2bff89d0c46145c93dec6d5fa0dda18eddb0f22f1b50d2946d24927eca591a47bd95ae3d813563deea66d7bd5e3c259f52e34d7b2efeb335993edc81a391d2c0be9f435838e63ab8992978d0499db3c67807f2f651aa916ae3f78dba0602bad918c106a8a92d63729bf1eea8fa5b283b2cede23ff5df66e44641ae1565a415ed087ed85766884eab452d5b3bf0c257d28971b36a8c5e2cff0278cc616221594aac831f47cd47e557c67e67ae61560802269e227fff6dcc6802e65cbdd5f6a2b479d2494b49e3bb0699e25343926f27268f3748b820faae8ac0b63002a751da15c22faed33dc3106f533b3af06f0c9a34f5739d49aaac4e3359cdb6da0a818b18f34bdf6d5bb721be7dcbb2c688b138b426d24d49eae1f656f784fba658d740822992d752feb9de635270679265d7d73a835baf31f43bca3cd8a0127d0ea4333d52c2a424d3f590641ea4ec82c7ce2dc2f6b7cf7d20c0ae257280ecb5ff70bf096239c0fe9889f412bc43eecdef2cd38141cd227426ad26c300f4ee388a488ca797d4c6eb6d6366d65283b953e28c92f1420159fe33af6e135b0d9bc055deb0cb74964ba84aeb65cbd3f71a574a4072069310740559b14290d96821b3f5abf08a40159a3ee7978cc03a443ac1a1d35e7a616c9b6e9166dee1d6d93de70be7041381d8ec34134578cbf4ca5e6256159a281e11d45b8c30d65b3f64a9747189c037e0a1d31ef7799996467bd941b2a2ab33db57f4512a547cce02b0b621f58c651298eaab9d8157234cfb6a692a0926363286f1e8fd7bfad7318f9769aecde5353558d46ee18781dd9d4246f1d5888e364a49c3eeb4b1de2c913fc40dec52dd38d19cbf173cd733b944af20b46c8cc19391fb4679c866f1e488d327c27ce622e695d27ade7a36dd9cb2287a53e7967cc3087bae9a63600795982e7abc4097956518c779024e33b7107b6e950561f0cbaae06fe14eb9ace8e73ded4059a0bdbb4a656929697098b60144c4518609452a386e4e0a12bb7d5c367c232175167e3a57a9d0524e6c805cd110c79cabe48d4e7b8af129837fd31f4e4f71354c1c62cd0db76770b820991a856d83b240b7e14ff263d50d1fd66e5d90f815cbdcb5e4b17197481b643385235c4d2da1192da398893326c13c6c95b5a2ec1d7fca869f77609f2665f96fb9c5958e4aa3e21837c9ff67b3982d13dec8d43633a815c20667d9982972efb20f34d80a79d8023087ea289db8ee5d1c25b68443466545c1f78ae15d850438c93321d25383c2cc599e49eb9ea125f5b8b615a0c09e3c8a171259d7b34e845450306998a13a32e7518b39ea3ec3e6508e3f258c94500ff2527abe9c169a75bf1a31095c4723b698815592f43497ac3cd6c03603ef0169452bc3a6b5ae984e8c59b8d1490a3d0698af006b1f49f322b7770e2b33cdad1221eae73620e9183be578be0b2cb61ff7485b5ceebbdaa6199d8fa913ee5b51dd198e391be4df8a1767ac077d52bf0f49cbabac1a1c652d9c51d4873c65474bd94537a9c0eea86b3639e21449ef02f95d324114e82d4ecdfed66a3eb5ef26065cd3de2e197d7ca25d841258c597d261670d1109bb5aeedc4951cb1b1a79cef7c7d8375fff9f8b25d8d427a3b4388250ce17b4d0823ea0dd5a336472b95b2f5728a9357404c3dac340bc49661c03a864b4d68aaad59c1d3cce8e1b54515f65091c522783f8489b0bd131400ab8a437445dadca241811622b0d16977d514b796703ccbff9bc164f3a48a5064c991b3ee1f8c6289c0f9a523a1b4f5293aa20be8be90944f78c193eca4046c7bcd13aec7367a7ef19ed4c349242f9ecc9cd78717cc684dda5b4db6fca1ebecd6c2fcd96eb0ace64b45b8c1b78c0b5106977d5bce6c9b0fa84752e912f049e5fd44483c8b4275074a052b74960bba0df9a4db4ddbb44c0a59d65d114312740d72e21dc2fbcf23b1ff005a3aaa0bf4d21c926543af335e31947e9f930c5519172494d320bcb2612eaa37ebd1c7db12327e6e7eb70d30c1766468a5ba92470eb293f04154ee90fcec256c37f753666bce4cdc4a646272a878cb76c8fbd466a4f3b8f189ebc8a81048e6278859fb39477f9e2bfc067bf4a6cab96a5b3e899e0e9aae3c5a166062cb59c2628028ed95b9285fe330e329a4416f824e9e37759eb3e647746aaa466ba7c5aa6e67f72636ab1250fde5aba3ebbebaaf651d3ba2d156c9237e4377213b4ac2c67d47ac7291cee02486fafa45764ed57798dc28b951d8c2bd8f1e4e8adacfce9f3133a48e32e55456921242fdc3b0d2962151b8a3062521699c6374398ee96e4bd39d3c9c2b91f3ae09122e00533522ba95e9081409a4c4c225d829280c1b849d85457336abecb6e55da9169d64bf4df9126c9d16840a9c7e85f87d2e7f35d6d2781e3f0449e8b68e52f5e1ec36df2a477df8b1c8da52dd12a89c2f71bb25932f9898b99cb944b870dac77c9ad91ff5f4a7de22562ea8041179a76f7902acbb668811158148c27bece051d6517b6e5757376b8f924d0ef2b775938ea67ef7c5ea331d81255f075a2552cf1b0f48abda2ac90a9c76bc745178121ecb5a0d7e970e4284a584d7e6324b7addbb388ca02d33332a631c34877dd6f4ff5252f42369ca5c67a9353ad3d581b0b48dd2ab1782993b97cfca993b5a2d0e4f1a4523e3ba2be95391b701f7c3659a1b6019232fe7aa1b6cf2b7cd0eef7477333413768f36469685f7021f22fbe4d259e1726c42f2b74a187c3713896fba38c81a9d4f902a28c407ab71502c98d4d1cfc1ae3fd8424d00cf56c33661bdce3759e082c427b2c12ae8b2eaa6c9aa88f55195389401117bc2413b51c3af8fb737aa1f4254aa1b3af1c8e5d3b37bcce9d19b4b22723effd0a1bd76db527a82a4f40890be8dd9b43a8a7e469d11390637581ee3388acb318d5505ab2608fa7ec4fb72a0b43fd3aac895a6c76e6b35ce7c96b5e32b47f333173d1112d2581aaf2804a0829f6fb10519a60468effcf0b553b5070ebfbda8f241e7a11f6cd4e49dafd568064d09693db98163e4034139a767fc517bd7cbc48b81b97dd9498f83168aaf519785df73ca036fb52d28fb93954f813576566adb84ca04e3c65522939c287da56e721cad0269a526cc1a64ecf081ffc1e94b2c5f40192816eb2034120917c2a93bbfcb93ee7da158a219e052e7757da7c2bff024197d5ddf5fc1ae9487a7f70732ec6cbc0d1f27630c88bb4b1323617961d9fb314937f31c7a24e47a2ba382b03afe40b1569787750731399f3453398cd12cb227fa0a30353fe979d2a786763c594ebd27e3811b5517b25cc6c0ddc270ac05da95334e1fac0fad4c4cb95c54201f93a709d3bb96d0fa674f498b105192c4080167ca095186803c62d20f9c9821c31b4b8ef0a7880c8a7d9f92e5da8ebe77d40f1864b9616f3e8b2fde2815ae0906d3b97e8d05f7ba7d87dff0ae28b09febd1a5b630286c4328e7118c7d44ffab53bfd0e602a48bcc5e728f71c8d578be7462f70724655a30fc99b6e925ea6c4e72748d257446566a8b489fda718b82a4cb39d80149211126dd1639744f859283a22a670bdff516a7439a685c915c3b60274715f773769dd4ac0f10d17752fae41a7377b5f148d72a329bcb74cfd8a9a69ab59aaeb29396f485bcc347692e63e1bfc25d0d3316e403641d0d464f727cd9183875c357c441b7df7ac26f8b59bb60844bf892fa54b720cd879d69681dc9e8f2284ed677dade7c25fe685d21ee85b1744aab952a22112c8c8e952089a8afcd86efef165d10db892e7c949fca3f1d1a076a82143283291e1f80106ed38eb16695ffeea15499b5550b0ef8237616d22b88824f17fcd1e225fd758318b2565b5a60cd7960c1dfd9fbb30a677ec081aaf629f4599ee955fa7b358dcd13325199e8489d2c139c2373158ba09de01468974f6690267f850c305d74b2c58ac33f8721d2b135bc91424ed084c209e03ec323cbb187e1b6e8911e8e915dd0d70769471f235fb4e745166426acad563231b7b8a4abd9b05291211ab5df3a667fa3dc050d410aa602cb005b7b9ccf1ee5583566996199279f6f94f97ce54300f1698b82bc7870c0524a3921ddb65e09d39a5ff2584c31ebfab731be449c53658dd285adddb1a7a1cefdf873bdc23c63092701d80a8e2ae6ab5acb87264aee349b517955dd03e45a93f7c3d55a0ec111d641a6f273e09731b7c165a57002f5cde007f98d0ab3e47320cf654030597f8f5eef55c2e49972f389a0353134a1d63defc15d6604399b6be1ad8a38d570e34f19cc14483943dc3c01658e77b82bbc50b72bb267b423bbe04916907a3253463744fc73f923550e10ece9094edb14cf0cdd58313f792bee0fd5210c95c435418704f8c9bf32f86a6f9af8782f4708e5596d0d1474f0167585d9e0e12e6fb7985a77d016b8da6ea5507b714115ccc6a272fcd08bfefb5ba4745cc9da2473c383e45f01a01f0a3ead273616cb7be51ae52646d6919b01a43fcdc2e42770a6f874c6014e5cb57d9d27d6221676e71e4e200a0340343df8efb4d905598d1985c61d97293fb3d5892786e53541938466770c46a439bd5cc92113392471a8497a93cbe23fca95e177c8f6fc33fbbc8a2e21091f3b71afd351b012995cd4bb052636316357809e57908114b16ed199acc4821f19da419572eb198929074ff541fda8414d7369aa9d17b158f1b8bb67c58a1c375cbf14247755a8ef374eb68fda70c5cf6fac5c36dc991caaf6d90532ca7b3cc9f0c2d745482cf74f2f8593359fe6ef40646d6cedfafaab1a9d5fb6e2e3283fa51ea009d5290ec5da26b3b88ada4dc9b49ea7d59169409954372a00b1be40d6305fa65c5b03c88b1892d7181846e1e055b2b21eed165b01d93bb13a16946c20e119f6eb6bf67bf0198ed2749ce23e8c8bb20a86c93c9e2ba8923ee0aa3191e908f3adb24d03eed1f01526953d98fb832eb20ffd0802ac39eddb0ceb8a62c6d47d764de14cc7791e74a5b9b7344f9d79384c1b489254b3cc02139e23b597de79c9459abd759dfc950092072068b5f074e2e18e7bc3c3b8c9c0e00b73ec028acc3805797308cac295b668b28052fb135c4de260a0a856f881f3f640248b3d2a77ffa77be4f8bace63d8dd15a629ec18491d1074493c64e1d73cd2c637232c96349d406d712bde2f37e172dac910f9ea96e97f26c4d7446a1a0ea00647b3529a700775ef96bfd4d907af630c234fb6b579db3f6055746d5f63fe16e246b11920c6feff58232a87a15c778208a31c24575db64d3a5272508995ea33dfd1ac8dd6408e3c33f8f88181a652eaeba51646fc6675de03c202e6e03e1b9151ee8ed91ba0e3e39e086a81e60d1e9d03afdce616470651bfbb90dcb3ac09be567bc25e5d6203b8886ee36500ef8dd43df7f442faaa28df4ff8a7b81443fb661f06322a3f1996747fb8c9d7c523853fc4f4c5ee553e8fe48bd48906cc31877eebe47c58aa091c2be2b4b25b2f3cfc3deccae68f2630a6d512f57033b40d909752978274f2ca4a7a5520c2327d0e58d6dd6fefe6d56e47ce974e328070b7024b06976bccaf3d93be8a6a24425282d6b8d88a6801984e3c772fe4a362d1aaadbc25ec85d60ee8cfe8144e907e550b7bb3e886226b3ab2ab458dc8ec8d1d0f3d4645483b40730874eabc61ad81ec2acdca90029db7e7eaf54aa6143b804f4001d59d055f08cdf96380a6b7bff897b5510cbc1572e25184e0dbc63554bb78f7c143502c553a0a525e7d368ab06bd2ad3a8f47706aae96861fb0f0fcb0b78d990283c828db2323c4c48d2d6ebd38fd5cd115e6257ce1700ec3ac271f88c698cc94f4b0a1a18fd1281cee062170227faa397a4ad44256cc7a50f055bbfd2f84c281aa2b66502271bcb85fe64649163af9609e76db4eca03b33f71230055504d189bfb5044f384f5d2268307b649974550328a6bf30d83b7cc3b093753fc7beed4d85d2df47783483437c734dc576d575ebd78f63ac07269c858e3020a0c183eba7a4e365ac71de1d1a58af79cc513a109ef92364e7e5946c6607ab1a558dbe48a7b20d7063a2a0c769c2a0738d497c6387d194d91966e77d3415fc7522f2a3ea85535fd4a36628a8687fc449f27c99e1489002ebc40c08bde3050c652c43f9fa8b0ae61d2d1ffa1b46278c1b29a8694abfd639a275e415bedb92d7b903e7700fed1db55a3183de07ed0effc43cef8b7405d968a2f0848df8aac39da4dc3614cde237f504b1a087beec8ada4e11e954ae6a996a007bc17bca48d1984a3b10fcbbdb586752a4a8291fc4a227981876679cd160e1533c8d8568509051e3af283d95d2f35195e217109486f2d4a75083add793e69a7e505b9a05f37717f8403b6f3b024fb0ef3566bb45b96a804a9487f5d33c7ac27ad2576bb8ed9e287f28be85b5472c6d4ef1911a4b844c2f4365bd667bedce53ed437c65784ea4ba4ddae421c4fe02f2516ab38a7ec3f3586d54c1a31a550d231ecf0ac0834219f76424ba5193e34dac4c27ef0c8824071b4aa949d1f1a31b7bcd53fb3d42e15c1fb8f426bada79900fadacc08ef01310e0a36b8ef6aaee90d90a9fc86515e520662f69d1ea2d7a735c4f217fb94525cbbac8f72a2deec8138b93e581dbe375e2f0e9b65b9f4e71b232227ec06282a4e5fe4f1948d1b092abe4ad2ff70c9c0d4c0b927fb59aa6d11912eac335764ca0faeec8442fefd16305e9462a6f20136bc3d95a8fee538e28382cdbf40a3075d7a6df7674a73630d73c5b60409a032ea840e0954b1afe8ca76419372f3c13683dd50af4f15446196a9173a980b49654b882a2a222e8119333c711aad52b7cde62da94d3763c01c2fe1e764ae6ec22fdf7364f6388865fc2e5cf6a5c0053d13b6a97dcab60c770f4b2a6f372910aa4f098f0123e06fb9ef568be6543cee8f4a6a9481ab4b3f514c9d294a7ab37af8fd53d4e29d3530c0d6d62c238fdac1efab20ac3e0d9470f1cacdd3d26ac90ef08c0b83692b1568a5bef11bc18b87f74ba139d2be33a11149cd247c6cb3c9204859f1970cf8afc040a777e1dc6c666d800cbbb6d54f41be4c0b3da02c9b996233f422e2bfe089d2f422016f97177dcde087667953b72da7a350f043ec2525c4aeb4e16631a387f1fe7f156fccfe59a01dd4e912824294349fe421795aeca373451b7375fad6adabff86496a0af65def9f572dc618a3be17145036dd1a0ed40dfc337bc6c2e2ea50e6eb45e80d5ab7cc49e77fe79dfcbfb90e9e8b8bf60851fc44ff73e8e72cb9e33ec6de309a432f1a27ccbadb5c7c02623a9afe90319dcd411603a37234e598eb7418fdf4b996fc47550f5021c4be12cd46114922917ca2e9d396e38a357822b2e1cb34766e8b140603a6f0b9187633f25c19c381c3e78c004ab34c15f4bc77361b7bded7f0e5c81b68f395b0328d7580e6662c638a86af60df51e290d17587f7c27a278145915226e1f98b329a85b5f9b8ad47d4dd94599759cface02eb71708fd907ed124b12b55068c9812006d33ec971d12ccf7f65e9b09b40517d6c6a8a027e353594e5416505586dc6bc04fc6abf68df484d0e038e602a797ee7b2f1c6326ae29a3c61706777a73b03f614d0ce0cbdd4035e50a7cda0a5ec7eff2c0d06a98d500d86c9011aafa95e3fd8116f31fc4ad5083b87d025b19d16a2547bed38259f3dfdac4db9460aac98176b317cdb3e2b5e077d074be0078a0d1647467a6df3e32aff3c6def45435928acd44ce8e56cf11133b52b59e4282ad3c5270cd8bb44d1a1c3d5f7cfe6130818fe93185dd290023accb49d981db817a3cdd161e0ec34a25411f7f4e6aeab2e78ebf2f63869e99d54324782a52978e9d6019ac78a48beabc41032da40b55d3e6da38e3b175fdda5e6ed994099f4d6288692e077558d29757e8a57574e786f28e4d84f1cd3c150de5b9745bd081790b5620e0523d806ae8a4ce8428b3059f7cfac299a274c070ae69a67c7e8bcf612e074126154aaa3b450de8ff672ac20f9af3118999201640eb31581d04812be674a2878113e1395dd689c7c25810b66f8a86a3b534d6845ccd9f7007455da7419a4d9ca564ca2e0f6e028c9ee4e9f9676fd7838f1611f13bb80b03fc961441a04a85cefddf749f46ecb226870112466992b6dbaf4923c07c5bf9a7aee4975c87734a8cbd0c79505f62f4099e6db8a4eadf1a2d38a66addfdd820fd99859062a5be3e3e3a82fbc0b98787eb5f00dafd4a04975fddb878ddd047f5ce8cff488652d48e7d2474669cdcd69cae10210a86a1afd41b41abf829017d840bff92ccb8743ac7e3646be4f87d8cba582f12c62f3847300cc13f810d8e300b7e7718ea35fc5063eb5bcb123b0e431c0ba4923fbea39ff50c1302aae894c42e0be2ed5f9d46518c4947a4e59e92074404b5cc5a663bc0ab5e14e8f4762b383b677da523eedfa3301d4346965475c74b2eb0d9aafc707e79c1e3eb64666cd713412181a07a774081b638e2416f33c4b237cca1652fbb3b518a94ce3667d8bb0a1c75ca46f685a9dea9b6fd30c6f60793fd493469c659d223d91ca914152047b3a74f894ebc2b27551de17ec77f26e3464b92830d5f0d6c9dd78a723e1e1fb47fe0ebda56e2d68dd2c76ade913be922a604917cd106b6e298f3900d5a27161c3192d64095c6debe22814583328a4732cbe555eb3297a05e7a3d2241145a8efa9b39b8be155dd3d0f8623c96801676789fb4a95973bcefbb8198c583ae6eb4311936341b438324afc65de7c9d328a71ab982fd3d509075adb44fd1b53f4722ef5fbc7754285bd181589caf3089c24812ef208fbd52ce1c3dbf1c9d5be79e81eced2bb8ec59ad7df4a746d00d33a5b9001f6be120c37fea9412f352f872387761ab15d63b318235f845407dd72c088f043d5deb41b9ba5a81b4253eab10180e1ed83cf740c6588f8cd81febae6ef35486efe9cbdf3e6675e60bb0a62427ee828bb3a51296427470af2606a39f78393bef84b3e856ae771128d9e9d00d29940e611ee5a350b8a51396fc1e2be1ac2027fd8724b85afdf99a4bd30a76059928e0d01d90d09ac456f867f4b23bdef76d34c3b605fb80222c007758aeaed8fd06d1214a8f4a12675220c77caec9ecb7742fff80e804539336718f318fa6f9c74bd65b2cb224d1ced475930d81095aa35f33b7cbd98903ffd18921f3547852581f6b064f7d3310c211674b7b76cb46efee9d002d14cdc8e413ad8d8822ee73d0cef5da63a227a5d89765c9607237154591567e274921dc1b4662a9c78e43cc214beff35d9f9c6b9b4a5b37da2ea8b9861e5e9808a63c24d4ec9ebadb011d4f5af42686ae04945a5f24f5670f515debd9bea29186377da4473120955694ecda4725fb299675e01ee99a6fe6d47d3a877f1066ffd4ca7dd1f72ad58342c780b419f1e501981715f863d78d309401e63ff57641966d4187351abe85cace5a8a20116e5001a07dc5fc8fedd81c2e7e4bdb1b3d79b90a75e40d4fbf5bdfc7a25d437eb8d37f5d626bff4d50e2704dd418fd80e1b97cd058f1206848eeb46d4cad0b3d53a0c3fba2a3c077914116fa4005fbe45e106cf2b9c78510b668f9f08d94d13a2d2c6d4b4671d6cb972097117337aaf46f216333f5ecca6026b8928ed4ad57960d6a26e5e003919f77bb49ba1f7d8105104b5203a33cf4c9cbbfa8bfb934fc63b21e605ab7795a7d85d9d8248d2143c57c7a6583ef926a6ae0644494bc579cf92cb11a52ad50fa686d4345c0aa827b27a29cf3653e005ffa97eb5d1818728076a672b58f403d073d5845b1dafc83dee469dd72d77ad9180bfe43f1a92135f42cdbc5319cf754dab66b2430c4f4d6bec1e3506df027231272aaa35916d251258d6ef1587446e8f7fd938b03dedc49b4cf2cb2e3918c4be86b6c30be8462029eacf76de11c4c13f2b056bcc5999a4e12d6f005106ff023cffa20a932f49afc52179f06965ea174152a8a398120161cf9d0616e945284e02b750714583c3a15688c125fefc7edabb675edf893763daf5a2b25654d9f92e51576f1e108d5a43bb012ec596ab5c01c0223b4869f6d87f3b75f65c27f9b9964e988d7fbbb21b57c54f577a6c274c4f63e0033c869d5a50361aaeee7cdc3406ae15ec9b0a6379db42ef00dcc1476c1779b3cfb15dede27e66156ab14b5e5db7a098d57baf7fcb91aede6ab8611cdccb7344e32627996c5b69f44d049464264aed7a12f1aa0a749adf552bcf411e5775a5062a996009849e89830b6f1a71eee333153e54d1f2250755048fb1786ef63e48cd95d3dbbc88d1d0db390cdfb8d564c9513a88781c7453bf5b608991995ca59a7458113e0e9d8e4e8becc75f2821b8a4c8cd92e601aad8dce0dee7aa7ccf0e4e32ad69b0d367739777379f410b4b5e90564a84ba28a662a477aa3286024ab116230f09c30e37def512d823e604db533ab3d6e7bc222bf8f1d95b162855317009d494e00c57c00b107db9abd37dc53f06ef3e9c237608b28b781aff725ba8fe3a1a282f69a201ca0659ba41fd143ff3e2c66af6bffd66beff1ee278ec31ac830b613dc1eed82ec01ad34f4fbc75ac914b2ec1638d3518b5e8a9cb230a2151cd289769ffd0283a4c808796eab7e6ae6fd553dba31a8ab842784e68574a54d4aa8dd10b9c0c1d83593778f36b5359ddd70846238bcaa436174301a6aa4a0bb26b3887533f4bf265df82397816601cb9fef59c3d633611881163c0f1ea863ac8b937e1f8432b405db8feb202983cdd25a528d94467886f968cb723d49194caa159b785c66d0caecb64975edecfd9c4c483dc39c7bc8bdb947e4571462fc79f238a91393fd135568e91896e4e886ab1762741fc866354071a781c99bb0cf4044a638748ae57bbab4d4660b8511c0fee2ba5091e2a02f3f74db56888b5838e399c39a25ae9cc8460d2b828c2ab7bf3e30c481a29a65f1ae7dfdce662af5875126361f8b420767cf740c2c3af342afb14495a085c17c7cd4b97238f0e7a55c9c47fde8e31b4a0ae1cb10bdb9958b9f65b57b03c8fa9fc424bf70db803eaf4ab47dd39ab9835a6db6487f0a900b953cbe22ec60405a7df93f91e6b618b11562297b91bcf0ccc4a69bf6517f4caea0f45bda39050ee34c32a6c0e84f8ae2fa1aab18acf65d1bfc8d24e691ac1d17e218c6b91ff62fc0df010760ee6ee52f570ce9767b4bc3a2ef9b583b1f0b5df9d182572473b1bd2fc3fb574411774578adc2be8f580d69b8864dedc87e4ccf0e979eb74f37b58ccc69c7537856775e0e74a79795e37d64dfba46ae86312ed3c4d59b9550c99fb5843dec6479964dab579ccf88522c89fa1635ba62aea5c142e029231996c8df253b69f0b4748c6a9223dd030627e0ffc5a4779ed982df28e2b91bcb7075fea6d53ac33108fb1af2edec1186fed9fc00e196d44ec1751309ee156a44bc00a0d0e00c601a0af9ef2e19ab57909085b2c35a0d0ed9fb3e996c78cf56f0ae1f3f408d4bbf58ed20139f860a2028152c7c2c3ec364e20898d3dfd95d5f6f7a59153f4114fd89ae05d17b21465501951e9db0d4ee445c7e23a11d8d6bb1ad43425dfc620629afa4400ce43c3ced352629cfca5098d7e1fb0770f634fb9a96840706b10de67aaa523bc190c004ed2183d9c200309d475a2b65061188febe362fddd9e7ad3b694e243b4f7d59ed583b15e32d6e2708bf6d4fc32ff41721ff51491d208f6aba76557206e26d6d460bf46c8faf1a3c90ffde13860e013d2eb10a7145d15704fd761f512ca36952029a1fe14490a0f9cdfa484b49210147abf4b8545db87f8a41d8d50dea04c7f2f4e4ce13b42470dc5bc9e60aec0d0916ef66014830f3fbe65af62dd83b0cd82825957332c2a20fcf7960ba9abb35ade2fabda0c908ec519a5163b5df5922e06a789847d6134adb16502da0f4bd3df3a78ae307055df89d76fc789c72829714041605d74fcd957e4f31eceee2d02e14f2710d711cad199e014a2aae0cfbb63d49c68899e924123f4276e1b077f6945749d5b8b6adcea81e37d7f4abad8cc385dc93d2eeeea410affc22d0997b6fff46769b59f9ee49b1405ca8f11029c964e5a286ebf5622ae4084f2f022a4a57dcc81ce29cac85a210396a753c79b5a75f0bbbdaf3454bcd5fae536c97151bcd56f6efebf8c2fbe3586454f00ce4f040a2c2b20bf5e7e471dae8081c3bcc3254d62ccb69aa278840fa8538f51ec47e43fa27b1d9cf82ca47e55865c1d0678b3d70997898467128e5b3b8c2a453a37c41fb7f4250698a402884c841327c019323f3467bc2342cf1f8497ea2fd8763a8944bb31553964957b7c9f166b96f5e46ab99effc1798fcb2770cc28b65747f8f59f00eb2c05a5cb5344966ca37101821a279f36fbcc1625599a2f6e2f767e14c1bf36d50fb0b65cc52a3dbb78a70e9d8d7f82e4e456879a8b1e344619cc1672d71d75a5da2d90f4acbbbaa90040b8b4956ee7305b0c142b44ffdddfc970cf1e41cc749ad0207c89fb3a616c8b330e8e7bb7d441a5755b275ac5d5cb6e581e1a343377d4b60305428ca0dc2e9e84e0c3cc60359e92dfb387d0c221f2dfd88bd133fd008c671fced34d743bc0104d266e40fbaf742a405d184b08346241c7b4d87a9acdf68a3c63004b13199088279ad8d2b1780d72dd9b64f27371c2ee1dc41228f052a1a0af6b01925f55c9fd7d7a8e84b89835bb1c943b99281b65c14dbbc234ba9155f89a0957ee283e3479131f498dea05d2399a289e15a5bb591f0cda15b5ff55df3a5546ab9b25bb59abf9646ef804d9e41f79f6ed3ab41625f2aedbf77631fdcf2886fbb7b6ab7f4bd79ecf0db56d5b9a6bf5f08f7dd338817494768a23670fa24d6ea73a287f02d76ab018a1f6de70806c01147fb598f7f147e84cfa4029d600c56e22e60fca4f4d0142da58e768e4f28a6c4094358abac84abe5a5e2fdb6a5595f8a2239e9b85b4332c374a0b72b4037fff99e1c3fe62285b8d7341a9cce772d66277c1ff30c9d5fa137062b69138fd625b23d71fa4fb5248c33993d6543e960b3c5f3da3f20698b0833ce114075a461ae138877f7504fc3f61ecb25db7688e7f67cba1f9b0f30d15a792e87d2454dd33800ef5a0bb419147f91ebaf6e429a0db143014eb25348a6f7be0258b7801f886e14e598e41396cb7578f0035498808d883bf2a0ac50c7832fc7dbaf55260bf0d6c341b35f2a993022aded26bd7cfda377151c10bc612a7572ae873e75eb2d34e8c687fb272d2a4dbf2b1cf8467f248d07b0e64dd4e4dd78efc87fbb448590dbb8da4fe57b65ddb70777ae4eb1ce5b4230c407ec6ee182ef7c10ed5eef9fde356bb58bb14cfc95128ca0db37b810feabf2a26af3e2e215596f041ae788235e3c529db5b7ec13248d8a1627de1aeff8e89bc72a1a79571aed0219c74a26809caec2f659c6630dd9773fd390b38ffeb9eb85d2f39a1e730b14faaf6a91a4d01270de16edb6c804b90fe9d89a24f06aba3f00773642835b7b3928c2ddfc02b85aec481dd2ec0d4b17a28fb109e74199719bd3dc6238336c8ddb8ecd865ebd37b1df913b20531b8f4b10f429f3987c293d8ad50170ad8e7e77eeaec24c9824cc9846faf06ef0e3face2228566abf1b3658982db4ced3c01b399038ce92f700c30485d4e2ac5879825a5199d5935e6c7a06052d9bfb3251f21136b8124163b20415a16751f8bd470cc37945a8c83cc3fd067d5beecdbd5e2b244a2d769207fb0af7d31e141f502dd2ceb966cd3e333bc8e6ee0ea5a439cfe81d6da7e211466c01d93b02afc49a1ff8b14d98e4463ac1afe9ce77947cb2c85b942d838e3ba3f3da6c671daf46a8f26e0b9da27abc099654e55ec890b9f69e497b8a24a820af0d2765a93d3834dec01ae4aebc5ed093dc7a7611a998a0108db270ff6b1d8b84e3ef5f5dec6851c637275315bcf7a57ae22402ca454db4583a5f0e6405729bbd5fccc1a3c9165c8cadd27bcfff77f997cee6552d778cbba1136da3720a3ea4032c5c861af82d7191298b1f6d2ce9c73885a42b68081e998d5a4c39627e6ba762327bbac572489e226e621442c64e6d4b2aee32c2a87506a5a2e3e2f6a9fe951c495f61a4c7130ef42608d51c69ae6d0e66361ff51a53d80271c315abf5c0434cf53b4de19326bfa75094235d33946e8bc480ffc38c989f191c2e2507f853cbcb92e8743344a7271e0e4353fe82ea108603aeaa1d925820ab800531176540724649c7cb18e60ce296289bd06692ed5c171d029257f82b4955034dbed31257047655097c12173d254ae37d308e77717026c727257fe510ae51ceb52dc4abd1f065926f236ac6428773b19152f6c20e58659d6cf2481efe6a8cff9295139feacd24c990108a8467fe67d7c3e3d740793d7f2ba82e1cf6274a5a6e5ac2c7f8f46f59516a88ce7d49ce6d602cfbe24bf9079a62faece69390b6884be5db4eae2ffc8c78428a6563b7c94f12332e7fdd1c4d91c8a6ccd1954edcdd832ef9b69db014ef307d3a6734e9f8436f4db8a000e7ac742ff61092385f6e75385919147f7ee9ec66c64ad0ab9bbd880fb74e3dcba6d4b565e95b63aaabab43f5c17fc23014ba2350ebc1fbf7477cfbb336a25e6a59cd85d365f3d8f03fd4116cde159142722403f83a04a9235471e60c9781167186808c64c84708f86165842e191edeb9081f82c86dc84cc246500838091d96ba5b3557e218bde479c8da0ffd7aafd9327e445e28b6cb2863658d034d4490773b574b70cb328d8e01756ca06844580d110d8ec52ebc69b2c0cd2c9d788a1432e8355ccd54f095b0bc240917ab0a6398f5291b60422b606979f83b76dd8b90068aabdd2618a3a098160a62d0c00165e395c20c89a0bd5476ea59db510052a9a89feb7974246caf5a0e1bd932c4729dd70520211fd86c89b6082d78b8bb0f20d3654b40ffe4026b7a730ebcb035d0bfca16e50ca912f5ecf8f7c8e40355172405414449fb2d3254a738be43d63c44d920759a5611147ab3435580043f32836bf5e0f043679d0c9e901060e14d1b9e9d316d3eae9888fcfbaf179d2516a703ef5abcd55dfcd763a12045125ebb2dc52b40c20c1cd24aca1de11c4f72ac0b0d0b7a7d0f141a80c4872c236bf75e00d867315c3cb5475e234bce62c49d4e769b6eb1ce61876cba0f68676fddb93fa9a246be5f1df4de8e4b8f3821ed5e204d8658000f79a6544652828a5e901935c45efd6b194aeb6459539ca4fbb5f3fef4611319bf6cf1f100100c51c4da096761e0fdf8500a99ae6ae8757a59447f114012059c7e2839b98b7f134bd64f9ff7792a764ff722114f82695145b12434415c6e8f021312aa33d46b3289039b9fffd47c3c9fc02fb6836aff3f5544493d021c21b2c6ee28217ea008461427198a8f8b708342200f1ed0e0ff0b0b25142a74c8c7917e3fa7c5ac77bf7c515c975ae3d151234afd96cb95cc8f77137d9a2c8f1f28b6cb21f20159d2281172ca09d33d59fbbc5d3bf97cc44eb755f3cba924625d5186081fce8aafd6db7bd8f6e1ccee3f39344c0ce5e4d41ddcfac41cc4163566858de1b8a9dd37fda4a9b1c5bfd938ae7ce2ed85f84d981be7c39c4703bb0eca60ed507a05c54b696367fc62eb31cb217b41cf8bb45e748a7d0fee56c09e0f1885fadf344fd45e1ce2390825f9584232d4e19e25a087539894d79ddba924204590317c4b6657daea515ec592e18c121a4806a55f4f74919bc731177f92b060120452a253b98aa2df8ca971b853378083d9d7170d13e52d02b2cfbcdcc8e63f78c554e051fda762ba677b5d7b03b3f2f4d7d84ad84c7628e89f224bfa19656a0bda80281a7d9348f370b2cf12b215012d5644440abc1fcf8411a12be7841e824e92f333e5b42823e84aef1dbbfda4037cad989e68a4b07e950e8e713400369fb0d1f067cc5449dbc36df8ffae6f7b72a8f2c27370694701d5986cdaacb7f43366398521b1ffe9caf18a6a535b85aee83e676b7e0d3c88ad6aa2f47e5f2f1f2b3b64f834abfbc83210ee241e3582c8fa2679f361038986f2f1b8666989c88f1473605b124aa96b32e41ef32ef0856072f0157ad4e8ea7654a036750899f4a4540895c61983755ef3641a68381c9b39b4ccdd5d8c0b909ae4027fa45a2d79c996a1c5abfdea80bc087e2af360517f691b1648e651aa6c090599cff5f894b9aa721443efc5e98352785be065d1218c069199b552c7090ed32ad29e7c837a8e05368028033d9711733235dd744f26329d0b540b09fe73915d9ead0b53d05fc2474ede84abffee69a5876d0911bc152830ad8c8b62431917f7bbb22e3b84d801401225b0aba675224926c65a3b8fa1b35f2caf30cb83fec121ba3fec7ed14a4c203f7100e90f6fdc1edb4be8a8a8e6aa96a4e170f3a2bb9515e8fcceafa9ddd6cc63583b338aeeeeba89e75e5a7293371afde42db2c4db1cad3224c037e115c95a9e913a8aacd6394c422bc5ceb10e153b700593c50b2323bc42dde358587c797ea3fe69884b82a746ddc9286ff6c40e98ab233aeb16e63f66729ff0bb8db5efda4bebf21852c714721dea8b7a718c46789a524eaefb30f3a133ff40db682502ce2926f4c7b547dd7dbb4d2f56618ec92b84d35212dab6cb534bd005f6410c2ed647278ef676fbcaad73e441a7ff12fd8de692b1853a526143b694b6021c99e75b1878c9f13c661f77a533a9f43510c908fc934e1ab5d214c36155209e02b88b5c220f2cb9c02a0cbab23525eea1a2b216ef620fc808f7d811df2248315b8606192a5b703f0c929841aa2ea113a9ed0a2f710536ea9422cab7116c08897f0ee35a9fdb4e84f7f563a78f223e4f94271eea084ba4aa6a72ed6854674917e19f665b09d4357507a97d59ec2b901c93f69e9585241872c0daa1bb1ba18b6743c905d5d9985db0a8358530b810ec0fb644cdabd20515090724677c097f187dae757240bfe24d34fa4b516e36e7881633de9904dddd26e12f3aba4814f14e0314693bb05bb47ccafb53459d40a27fce9a48d58b899666b24d777a5f2b6cb4d9e5f9fbf2d27ac099691aa89967536a3abb746acd93e7e7f9eda6fe148b315aa44a4dc8a5b3ab9b6dc0209481ae37ec1e1e92f5ad6628c14d1e7ca0312a7d4f52954a291c3b573f9135830ae20c35fde787f9eeec4aa7a33c975a81e375d2d8b7c6c1f32280693f72508010142ac8a34186c009663a4f87d994657146768fabf2f99f90dceaca5df666b245e0a7e95bb29a19c2dbd2f46dd54354f08c4666b89f87012cc0eacf207833e2410d53548d384787d60296c751bdc6910e3f686062e535f171f44d06c18d4af30926cbadf060b18ee23bdff8171e04ea673d559965dea891199b52d2d663a2eccf18a06b17812e5fdb9b02e65b6589ab830b561c5b0505ae34e9e8b671b6d6fc2da52f7179b856561fb84ca9e32f8f3f79206418746be0cd20044d73248e49119c5d8dab9fb2e8340a890309363a09d7a6307972ba5243b8afdaad9a8a238373772e1efb42fb121d4a279b1f39113ed93b8b2a7a125e4750da8543f348c97f286af95ff3ddb47914980893d411f13c98fd43ca078373c8d885581b54452a8e09f92d47d6f8d06b4bef36f1f183a3d5ffdcf835ef7bb36f41814c61f3d91452717d6cfcaf5b6319177d27867db96f44210d21ca63b66f86995abcacb665502ba9e326eb3f69eb44bc414162147bad65f6f5173b29f7a16ab60809756bfb61df533be18e4939f8da5836b2d8238444e284bbf7585651242423b92c05706407e4c2970af04a46ddd5a47ffb315718aea518f0b7d4f1713cf8a38253a85b6872ee748b58b4a7b4289ee20fe867bcccf0ac219f6340bcc51cb84b95e684449c965987c0d6e3d08a03037ff0291586dd7d5736a9993bf6287f6d79ba46cba5fae66b035cdfbe1ec91c18eacade3e793600db047db9acbf088891c37040f822ba42d78bf3297753c12132a87597b939f9113dee9965dd643d78385f29032385b971e45e1a4a92574b3fa706f07bed7ba1189dd8843f67e51429e4345ea51215963f1e8d548f1f1b05bee7b2dd64ba4e31f326ca859b929b8eecc72c4d8d1ba292e11c4931c32727318cb5518558f5d6981f7701ede107bcf8fe627dfb8acd81f8c5137319c5d322de17c4b726e127c1f3ee68b172848804cb53afc6a078809f1a94045b8e9cbd745188ef3bb785b7531fc5c7d8c48e5f8ac1b02a9b0ef0da853e5ae2847413dc034cc1124b6f021004b7b968fa3701048cc4471072ac5257ebed8f1dd45800067e1dd52503b284bac9c848418ffa65ed2b6a44a814623b55e43341f28122155d565af0090f01cc06612afca1db418acf2104c9556741ec3f82c46d896a58cb962634fa5e6b26d6ef07774d7afb234bd15a165adda50abef7d8b74433c36e71ebc89dc09bdf413fb43e20fa1d86ce13069ab8111ba32788dbc97b96312a1d477143a55b4a225fb99a3c6bb5870af35338c1f2f044827d6aef7266ee0f24e4eb74f5c41d9af26e30ee7e15d5cabe16a8e18ccd1820d826fa2e30694707045aa044875b3c85b6a4cc8258b8fb604d71edcea660988be0a7a3302c500a73b1fbcb0848949a9c05d53b95e893dc3e9f237d2c37937598a824f91924d9fe036e162f667e9e297d928f0e271db8c28f39b1bd3ecd6b8cb3457acfff042b988ec635d518a45b029acbce0a985e07b479ad184971202eb87d49ecffd32b8a3d4bc4c14980400aa11498a83039ba8c16a41faefdfe69f5dacc688b60530a8a64c41d2cdf21a3e70b0470a89a5e95ffbe5d2b91b683fef4082bad935cc600f751d728a5ecead48a65557b95cc5fcb0879ab85f396ca924883190759ff8a08fb07934d9f5b6b9c84be4ceef025a6c1cb8906bc6c65ebadde19d45901d908e4a61937c18918eb981c609b132371666e320c3aac5857e234056a2a907e90ebfc487c5b4a5d04e61c087a6be1c9ad7e95c040b952225d6f69638d24eac1acabd094ad8948a227cbac821d9567849f24c984db2fdb573b4d90fb6b0db0631172d92b3cabc60bcfcd17b779cd0f72e4f29715f0add6154d7a561651bc23ab1e32d8dcce791ebafd1e4697b4c0883660f88af47a86b3fe0e68ae9f43b54c677154b3c9721abfaa3bead6511c424df76249528b4f6af19232e6b9031a5d67a8df48a49903026577ff1bfac646ed83f5eef8b88c4774f4d77f1908504cec0b851b2d4bfdeda049cbd202c63fefb8c9cebaeb298f5fb32d178bc9a229002a74f6b894484fee2e3dc3680903f20f2ff6940e96295451f6b7e9b109db09bc246d983fe4908f5b579c4d12219edd15843edc7fb15e32146e18251a9096ea1a1b9e431e368204291bf7da4f6806c630e62617cc59251a2ab82ea1037e59ce6e5797181ea1a287b522a5aa2541cd9b622d7031cbf52295486c3b526aeb154980919782be8dc2f8dcb866941ad02853b640f97a8d0c5dd362d2fb681f3e422eed095924fa58be1ec6c66e4c7bcd5d933a4d514ee36349f043405071e5cbe47a6e8f3195c5c1554f542933513ac345a84461713470eeab9da5aa424d39831c94eeb8810a6dec0d44fca8d8edea8d935512df01d516b59d3b997f9ef954c0839993989b384253214a23c7195ad9b90705f848d0542d3eef4766f5ec7b80a69811142de170a558e336f76f4c23cf995ccb58a2331ed7042ad101fcd9e480bb7ee09cf7a8c2ab7703af7a3db49846991b6d01aea95e917ae23108d06478885809b1da366dc7398567603ffcd9cf190c7d738a4ca59adb851c280e6677192270989bc073f2a70d1e16635275f90077d7df7ca091ea36c4e082175635dc7f35071e62a373e000b55a4f2777d2adb866908726ac92861ca8c306a4ef7ca28203ab953572b62c3568bbb3ad0a292e24034e2227b711c27e79822dbe0194f2bb67514001124b3d37ac70a8af7935f49ba4398d952bfa0943d367bbe0026a2b14b449b281d5ed609b8ef1e81c3c01c9521a7c45bfc8751d4a0a7a37e712d7f2c1a9c1a15a39e12d89b4e64f3f362bd19512858a70783a55bac56940018a95b502f0020ff9d44865ed5782981c07548b75f3bdf4a665e7471d30a4e8564f0b468978f960036b8467ba3fd54c7066d37ae52716be0500cbb41debe37ec0128e13e745d8a54f622254fa0fa148fdbaf7a4833942167a2c5941c31017187bd79018ee3e4fa314b4a8099772cc2255fc56a4d6cf39c6a17b73ce1efdbfde582f4ba2012e61abcbe0038f312c1f8547a69ee9cb3caea709aa45bb6a61bb3d01764574164ec6c25a76641def4735af6aace2d437d5c5cb1b0de2cac634e1b0464ce5b907b3b76aca61b886b82f0665861b42fcb526f9bfab0e2a8c69a856d93b4346d5a533a269acca4232edaa4f6119c15100b8f42fbd9af137f0b02976b06de3f9f3f0a1eda7c83b66df49ace505d4c6062b6b66278e4148667e15f7366c8f5607e6de2c9a25d37deb0ff5d472c1e6e5bfe66bca49b45bee2d0ad1f845845b96a2945feb41569eb270d52e69666d006a34de858cae5a9d816211a70cde81a0377bbebbda7954fccda8f300f63e8e01f5b064091e7a633164797475c7a782d5e96c1d892c1ee77ebaaf080080bb49c136eef73416a7439a801f105d85ab51ed685d410b9f0641dfb4730631eb4a54fd750689540d6778ba6467f037a93320b9b095efe039be7f2432308314994b6f1ff0c2c6ea9b1de11cb937e3e765c66d02d1c4666499a08f6aa4d57c8033a856caac067cccfda4c3564fba4a474feff6ac475b5379e5b332a12a603495abc3aca6ab51b50ed4243bc13a2518697a897ab31f976f057d1b8c3a50afb39b103738a195f6b7729b440e4be289e84e9bfab08da191965f70ee9dd6a5f3480baa13b46e0ab3fe3c6cd4d933121035222a67d6eaf991072bd90be1d15ccc3f18c189f69341a53011dd153eafd670607cd701c6a27746dceff238bb2d240f2baf0a2e4438f5cfff2ee267a1f6b40973c3a278c137fdcc521c3cbd25791ce5644447bcadcdb4a5c389daf3dc3f030a237785944c9b3078189d1ad08c4243c00077b8b73e8fb2e549cdb617bd9df1a007ecad4074a5ad51a9774f9e53a6b08c48d4392c66f0374c19bf995fdcd81648cbade27ec9330dd879e4c3d30475e6164d1e454c3fef8d7a4f68da507a0c05d6c575b487cbcba569200c95f08874109795f4533aad52fd6a67b749a547f08e6ed12e51b92e592cceee0e1e3fa768fdc1e35ff1994f29128bd489b5976c5d7b8dcd6b53a3c5e976e1b9b014a3d84b783f91064b763bea373beda45d0b6dc0f985ab3fdada9043974bbd156e768c2a0a4d852bc5f8e470edb318e3539ca7cfd03d5aa29e2ebf86fdb15595378a83f74208347485d3c583da8063aca975e0dd2f2e1de54adf74bcd9774f42af7fc737e3e54fc97ad6675f344c13b2a8e3ad9cc80138dbf9a62357ebe6db08e9637011ef0f801a44306a3c3fbc94fe35451a1c65012680a942a1a5c67de225e3b353a663b247b1853987c1977fbd67ec2502668e4ec5d8b077861438d6068f24adb514121b4394d16b4b6340c289e01f5956b8c7b075229bf126242840c09b70c883c41ca7e11219600fecf4fe3e4a79c5bb23984a3ae078f1447a357428d37c319888f0c1394e2f24cf2c41e3f3fb0430bbe7210c8d8ee57036d0471e0a1abad80578873393518e39b49fd3c30fc1218fc1b0feeea8598e735fb59ed5730e506ac9908e28257789e57ba3e63dd101cf7ace31570fcdc57b7ac8eb1071abf8406a8c68ae976a99e68156679cded9fa48fd32fb181003b38c92ae71e17922b7b05d131c730c2baead6c9b6017803ccb68302864af65ccd5c56181577330d64042263dc4c09676c09873629ba039779618837ea19e071d8c220b5d614f814276c2afdd754e522239aa802eb4092237f41ecd39dca4cab57c404d02ee29207be1839e947baf084183f25dab0bb682d71aba9bc9f327cfbd2d880c2ab7e1a6efb21c6a6c7d9c9cfda55870eec73afefe63f29231333dc8157a54bf33bee48078528a738eec1557b857159b7b763b5f62bf42c281db2ba147c17ea6650c8f3893b7f3c48a7129f8ed0ebf092a13db052820160d67a3c44a8696e21237b64f2a57f7252de1a5d59703bff31fd3d674789c5b99c9aebe716918bdeb6285d487eecb04e7059890a9b4afa778a28744741acdddde5f5ac5d87b6a19bb51697563a537370471e5d58c3dfeffd848bcd860e1100d42e3575a4982607887d3136191adcf57d90beecbd577b77b352ee5ae4057b3b9bc1a9a015b8a49896b96d40b53aa3d4aa517374c0a84d1df9861fe8b8ec047f4f44b6afa7b41f6aed62f45c661efea95db700526a885cc0f504e265a85a1f21137912665cf8a5f1f60c9b0e40242e3f9651211be6d2b58a3eb79717d640d8ba6a4e99b2f0cdee6d563bb8504373d0e73c63305faff9b7408d9adb7f0926d4f58260430d55d9b506b7e59afa1dfb5a4207536db572d165ee225c534e3e8ae7fbac001c3d04c5898670eb10c8d62379980c3c400736c0cacef6a0d95b0d7f48dd01854f695dbca21e087fadac3ac93c2e5a7f54d8e6fafc42a26e14faea32ebb1a0125b76d8937a22e8839b66ad39b56b78b3cf8848f30127ee46118ff5a63f9de73e75059ff430c863665a06c5c540827dc03fab29eefc8578b1c4319116a669004a6c43047c5cc90cc2f597a15568efb66196d2973e216e2950e6a21d68998858ccd7cac2877b4b01ced8c8c6951dc43af69df9363aa2aa585e764de125466b477051c6a24d43dceef092b6671bd482167c5343d482308b83a3a74674fc8ea451c01e0128359a024438d4c77b24724bd15989ed30cb083472846b87b4ab662ab9659ffdf51cca40defdbded4b29e9c41ac0ea1bb85421efb4dae07d9ce94b1f23aa49e1c7b86412bcc9046c1a2dc35b6606bca625d2741b91c6f3555cfc3c17e62dc2a22cceef24f007ab08b066196e4ca83d0991d7f06735189d825512f251f80927b348f884cdc8edc834c27858d579bb5f2e2b76cf1e1ba56bcf857de970b6e5a231c6b8da9fcbe8c56d815ceac93e8cd3eeff2735bded169e13772794e652dda7adea87fe500bd529419f6bc5fb5ea121a143fad469e31a007cffd3d0df0a7eda3be8301510d909263cd86c16df064b73808c860c569edddb9b757a6181050e8fb98098aa472373ab6d87994e6dbc0cd341521850f1d796fc40e86e69576bb2d45df6c1aeeadd94a5f7da2aaff141ba5f7229c82f4ab931fcdcb2fae6fed768d50bd88fe248cea10cb27c4fde83c33d31b4467f1a777a0be952fcefc92d15174a94461854bddfaf204e9ad16ef4082e60eb89b79ca091753f1e26baea53b18a1d4f047fd3d58f63e67a8fb624babb99381ec03581e3660f3c771ac424c82049758f6e3e46102871173c9d301f6725a42071b43e97da976206aa504d9d47119645dfbb484dfb2490773edda7d597c1056f80397990800fc7c596c53ff61ef7e1f96c72589e5f3bc379d8b08b349a18be0a736577e024ca91c9cea08ca443b2b6e3d7601269dc53cae5eea8caeed9fc00bd4eaf5b0eab691b6c284fafe1823b603d552ffc115641a25de58256629cb34c80bb6882b054ac83f61e1af659369d9c514e17bbc1dd3dc3df9a43151ec6f7f43a9307fa8aa5071479f60cdcb39f7a8fc8380c7d8e23378725a57b2bdaff6d9147c409f84744aba31c0e755eb5a103f149ce378a3a309f83d365f5b5ec2d472d10334d403996f928e97c079279886ed41db1730a0678623c797136a06a4fd4610878bf357ec29c52f005a7682e803e851f7b289f7428c73673582e709bc964c66e015f28f8fc247c37e5f0d49a2017e7f26af503ff6a689bfc1eb066074bfebb71cdb47d50721f58b5179040e4c6c4b24c9f8f82be941b8ae269e8da41415d1d162a3ce390c9ec5e80d67cd873a68a7a9a655d093e530a11e063cec85b7ec443d213a0ea2a7b97de15329eddb7be82b0100ef6c0871effd7086916b2ad588705b95c50417b5a40c57b2c507794e2b43b37943b4c488df3808b033c7e8488849376b331b88038a5316d9bc88cf7a5f69668714445c2028546e870ffd41423bf5965634149978fa5b2d3a39905b1392de21d214eddaf3442a910f96b311887c016f565f7a2ffdbafc65446be6299793a5c8790d0be6fe49d725bbda21e747576a5a2a91b048cbd69585611f7a1a75cd8c84a5281d29e8b36f302eaa15333f5e6fafa92ba4866c35edf087f3f1bd754ee82384349b31d9514d2467552fcebcefb1e54774b1cd2d3edc1df9877765df913bba0e645edf35958eca9cb61b6f9b809be07f8fd18333ed8b3c2d18d20bc30e4636dc2c3a781812b0cd120b67ad68be0b530bef47d62b8a4241c178bdc7506ea1f161591c2df9f8b7ae609125b80f73cf4df23ca34ccf215c315092cfcec40eeed07ef9cbd612032fa6a8cc4e0d91a7bc795e462d6e217fd27750bbd54c90d835ba1be05d8823bb04ea1f9e5b24261668ae5ada3e6a8a2c19ea8a6439ab3736ca9eaae37be59e61026dbb57553f8e8d9dae8f9b290c0c860fafc104c9d14281ff08f121cdd18d4c10076c5e8764bb78b4f67e77e27c6ec967960d81fce39dafe5b29407d09ed4a81d073545e57decebf0411a30f17a707dc7ddd6c629c3ec3ce45bf2e7d3e9848409cbc2387ee0ccf43d1bf29a1f761305e078d26526d92acbbc92a25663c766b6c6672367a908510b0ff690da155f310540a1eea02bd9b795ebe87e69cafd9acfc89a1c587f1e8ecf9181ec5fea192ab2b47cd78caee00c24998ffe55965424d909e3599ea4f9664201826dd940e28efb592f41b97c87863e7b758f7c154b46620915aeeac5d118f92e60fea5d6c765fe795a15fbde60e42ad48604a929d079f53d2d8fdbed2df621c9e6621898aa7a2d4db0dafe38da4e435df9a3c9f120abc61b528df08be5a0e253347180b94cb48a332a82126afa4fab1cbd468c5158a47294eea0023f96635e0cc51c062d8c9a6dde3a8d317285c9dad0fc84b71bc7c4fc7fd4e77818524fc13baef9f74843e8bb45bc372314580fb5c25b88e725134f0f9cb0f7e0aaac6e7346f6cadc2ea7beeee9d3e86a71aa0eba0db6a0eaab2a7dc32331d9fc449c2e869997095348c02d5be7a69b4647a347e6e3985734615389f123552883a54bd81c4e26e401006b263b453ac96020360475d72a4cb8d12c454b805e955e292c640c122c6e875b1acb0c0d087da2805dd987f6477da66a225652bef8c2f0d2f3ef7438b3e0e148c635b3eb48348d2be491f39008014f7a87f02c38f2fdda4fe92a60712ec0b2bf42e2910d7616fdd657dee98ba5bb490e1bab72d62cf5f440aefd320621d67bdc071044686b5a97e1440b525bee76722184b0bdee4ac674c635186552a0401998d35e388947653e6c88c2974c017f4e7881c476656b75105a1b14bdeee29d57af087fd662ac9ea0b3a334aa93e860986b7a45d3b6be92601fa9e23d9e3259d14eb583ea62ecc13129a6c79d2c044c9b0084fe6a6c37d8da0371396515f023f67ec35a9a1f5fa63e5ee5f63036281b46d425b46b8fdfd825c927fbf2d3de5fe6d2ee04093b65173e8030f5bce27b3c4915fe10131ee3892384bac1a178ae68f8e0c1481c7227a26dc05d9766c787277988fbb072b2942408a0c03f7b3a2bb3d6b3a4f0588e0513b74a084fd106898797a2aafe4d62383848110d40967e2e74a51838d8236b89a9fe96a87171376a4752c875412dade553ede00287f887aba020e6777da672977ed6831018df91ae4a90a4eacb18f113124e64e6a19547edf384fa57d7e2fe0314e9d264d5523022c30faa05a88ec336a14e6f32f941ec89e0f77238cf16785dd428bc235fc556c32d078889f8c3bc0af7a907f217db02bf584adf2bc7c3933b297cdbf6f42af6e5ef18e40ecb9dcdea14aefb113b3156d51efd55a851a400482166f1f1b36aff6d04c14f160f547755478cf37b2b73ba29106a8bc9839267619145e3d170dfff30636c9b06530011a59a9c856c521532375176949c5b99247e5c3bcb08a71cbcfabbb086d379e3ff77527d144a9e94c63a05b0ee75ab9f4eda06428a38fac921db75f794bb5523c4ad487526762ae7e72f6374cbd87667ad16d3dda9cd30175aaffb6de933054ba3cec70701a9709c2d44b342f67a6e9a67385e53a6d06e982d4674b7544d9b1585d37d84d8b12dd194d972a1fc44b6a1f339276706622ce88a97f2ac11628b8c6d107affc44c25e997f1451c3a0f29ab952a23beac0f8ee8afeec93c96cd31bae8168b495bb5dbc6790c20c656f197029cfe6bce189be67778fe15e96f386ac04fc0b47d13a24491b5735dbe540199cd28c18b80ffadaed67474cacf5a50d986fd8d736e755854a641a1cb141d5b70f3cf0cfebc4ba92899bcba62931a4fc110c5b9bc4436daa1ba5c23719e1499b168fcedff04a9cb1dcd28e25a7e152b73418faf1fae2df76cf72e7e94946c64cd816666a0fc6f616f3e9f6bb455e118e734da67ef671ac66f042151019446c9181dfaf96d33eaad9f9f1c12bdf593b2a48de4135bbb1ab189b808c0c3faa67f94ce6670bc4bd170ca6fe05a3badda04133a722d64151fe4554db9e9c5bd98230d88d73d3edbdec78e0adcb5b945bbaf32a9832a9a47fc97111b10388c893d0addac4a154fed7a6db01aae9d64b9f877086cc4929ab7492eb16558250039279f89c1c6b944844e3bc2af04f604365d5e35ae0a4a272f9142cfcbdd2b1eb3a190372d6b2c00c582418158b8172794c9d3be66b4d09ad81c2ff4f62d387b0681fa4b514a4a5eb0aec5ca6ac53ba8fe174a660d8b9a75982bfff0c097c16b906b16c1fe91889097c1a135eb88ffddd63e2dddc3b416c128906e2bea957489b8a28b8bfd553f436c2c498c135908767eb30e046253515dd6a51c351148c1ace9e1c880264bc5a869ceb1724e588484479cc16e5ce07c3c14159eb952ddf680f02edb189cd153c92fb04905258a3dfdc289501c823fb552a6a4842179e3931e9dd15d89cd6829e33687618629bd8bbadfe29a26a5fd56e5397dca99f2bc70d7784ff037ceac2d2b9ed2a8c4c09e661cf273762aabc2ee9e507b27bc46261a99d3488f73436fcc26cc78f9decba31b825e80a0c61df0c667d2b76243250848f1bda1b33ecc04ba9922d0a7b50c4cdbb3f3882f1c0c299693feaa2d9d0c195f7fd6d0a4b41862c0fc795368ae314a387d6f9ab7ad8e84b72b32f0ef4f04445fa0800de65457dba3c366cb76cfd4e685b20c16fedd9e9ad5cbcc15c8dbc6a935063fe0ea29dd22d2a7294f510525463ff63078a84b36ae4f01d5e22fac6a0dfcc94be0627cb332d303d18076ad3ebae688ff764772ca65802e41487b523037574d029fc6e64a7b4a59be062141224673c92aaff75891d4b644f15e9d670de93ed5ea6bfecae5cc5ac870ede02eeb40d9fdd2687af290573718783a79f9806c500fa67c0c058340a52efd49776e232bf3100b4dc3c57ba2fccbd736fb66a33716ea5191f51d3e7ab0c2e57877c0498fc50c1a5d776437252f6bd536a827a0f1107a6381d4e89a4906e56c9639ecb13b2e6f2bd54b105b4907308a3e48638a45bc0fae0f9f1a79f918ae79d99b43bf5277d14b42fc77d1324156b71f9777442f32dda84b5a10a95ff2ae03cb2d0d6808b3e4f13e49d90a52672eb5d2c5b6c3d94eab5d4c87dafd1274fd491b10868348bf74f8d3f46869e023c3030f0ba5e8842661f15300371cc9ba522352dcbc75dafbd90af00f0f119fa3720c89a5692789c1a7c8018f0fc254cc2c507eafe1978eb9bc0c317a4c08ac16a308e53f53de49ba93ec76f79817c5b6bd2f24fa26df0acd911377ac068fcc2662738e6df4bc53bd10a3ab99b5b65f9d02684422c15be3b2b5cde3ddb551d3cf408c4ae251f3257f13fa53f31d9b226dcc9a34695eb134f34a162665e0b799df207f9089d074ca6bb8dbf02d9d8fa9c01b29f05377a8ec9bd42042a98b33dcd1f03be6958084ef48dd8f94e85b987340940194e31ded1d8daf7c830b61cbd959dde768cbadc1f0233ca0e200248aaa8760c982f32cd07a43580cf277c533f0ebb82f0dd923f8b5d6abdfac058ef263b704a7cef5cd9e5d3ba75cd94188b0b22b87e0e2cdfc041c0df42e568c4823e6d9e100ffcb3a2a17368ccd699a6498a8bafb7d71ae6e9dc80a55d8716c2148f2651953fabdaac331620f9c557c84794a304974d480a85b3efad49a34dea1a3331c5c303f33ba283a34ead3bbc57896fea2bf3a822d92baf17bf7ca5459f80d0d2d885fe356223b470fc28269298062265a5dbc0d6b601d7a54cb993a630f472f457839ee6cb0a6f82aa5cbf09cef1f78f684f8138df8dbe7bcba986d147f8b4e5aea6fecfaa6792ac072f872b66a47e681786dda2405a7d59c106472124b7a773f6a8fb233469187ee277d4c970aad889c50e0d5ac8e49b54468a24d08524e79af4920d03c4307332738462b7e8374e10f5699120c764c1797fbf1f13b65bde2e860ad5c6cb2de243c4e5dcd4d704e2c52cb88e94d9fe766f7e4502835bb6183df886fbc8ae0f4358c8a3c55c1bacbf340d69910fb75fa38c1bcc2c47a77c55665f85178cb70073e58fec14a8549706b661fda087292d83ba47c2d7c74ffb3b20dc9807ca58e3b97e4d34ef36bea8725f406234947d20bdc3d8e2008ba26ca1ca5d021e064fbe43dce48a5f0ae18a24d355ccb3380661e1a77ded4341bc9e42100f273af80efd7f236213f8855494b10cb567dce73a39be2b82994d535dac53275d12dc53e5989b91d7c5e777a23f8ee450c1fd1f1bb8a87175e9a0b9f36a3a8a95ef7847f948ac67e620bd97e79c9b7b3b0ffd94544dc3729a9164cf581ed50f8d8b5eb693aa5c15499798a3a9e1fa24783387083910d8ac38644a26592fc2429c451891f3aed74f040f4d84945cf602710fc6c16ee0f74d5b98866c8928e3bd653c96c605233bfd3acd94b4566e5042f0e209acb259b92384533dba35afe2ffa914673065f6cf556127e6c39a280b5189ec66862d2cebf6f56716b5a8e7937fea760176ee03e7e9b9df965e07bf7f7c0dccc01cd97f002ad005de19eefbaf83c9660e16238b7d5f9609a37483fa98037f424bb36186360cb4e7dab304eb259c6121c355cd56161759bac2d7cc616f3259613b6f130bd1810717d846fe5324c986db24a2c9c0d9bf91514640014ee0da27c9ad546ef68149a559e7a5eb1bbbe829b0539d01d0b028749fa39cbdfc422288000dfe5d8d3fad8836c80fcf4da87064c3e63d483b237dbed4109d9fbcb7f6a8ff210266f5060d0bf3bfe1d7a6d3863cabcb3bf0681d1e166dcb0f03b840d9377b42149243c734cfdfea43315665271aa06b7e5264604e98c96d5935ae82f2e54e2aa2f79c34781d8ac14af84a0c76527bdc1509c0c35ded76d276fee368ff7db7b765e0ebccf01ea9b004c0ced395a3bc53d95663a0018dba5cdc700ec8b286610431f8c4fe1cd85f6c23810aa9899d97ad55ab7650f4e17e0c3860af27b84d0f24069c78172941830239a853f17d306448e1fda138eeba9061b9b7ddda967768a18b5c779061655a45fa21b525e439e53c5c725a6433a5099a027c3184f5a39e61a06fc8e88a6b1594a1a0a7f1115eee99e35dace7ebbc1eef048ddecef221273ee085dd86ef51a6ccbb391d1c2109c57f2c00601f9dfa7418c2af260a42fd5ed4318eef063d883888a27278346e99787e259847e2bbd5dbf5a54559dae18b25a3735939fca7fc7ec450dfb2b67d35f189089eb47f7670590ccce86051f08ea8a4407eea131dd2eed8c02f029786a1a55223675a5cc77d8720328bdc2834a27b98b37a62bf398e72f925a1c74131bfe67ba0ab5bd0217da471c80a6cfae6bf719706a15076b8034999b000b5d90c0041459d4d84f2ddfd0029fdb4b5a8b4a3e5a02c070a8d4f4665f84af837890cfa487a26f102c188499bbe816110deaa277418553ab9ab2d1f34113a5d13f8c1357080750ced45f44b83e15b0dc034fe0a6b342e58c5b830b9f4b0e1d073b69a3bc1c678db57451e0bc1dc9b8a23ed53621fa49fe3de9e6f7f5c35f15affc7c9faa0a6deb91445d0dfa818c993dbb54b1d230219768d6cdda566899a54bbccc2bb840875b57382ee81214a18351d004e9ebe55bcf9891c6ba1dcb380b7fb0de2d1d2390b6afee0662cc11d6a6b82a85f89cbe048a0462c5bb464594deb2801533ef389972dbc2808c3d491606180f1b6df263fe80dc4a67c4e8bb972aa444072741398bfe544733ebb2389d5ddb0100d6a14d47b637f861a064ce9971948f6b16fcf73e5f768c51fde3095206655d4e5852679204e261dd76d13ffde9d649d5d01ce17479d511f5225e7a1c39fe028398a98df17deec69fed3e38b81c1e6723cf1194a22394aa019a4792455ba0c00d44c21907b59b246f4d791f9ba56abfe4d6f15d816fe1ac10485cd97f8e96e86d2abca8bf4c2b90c7c92d0d1675b6854091efb75e1329ea1d8c5d514cd632f7902efc18a4d1e21ce81ee0bc1b3819c5cb6225ab86deceef56fbbdd12b8706b332354038a9dcdfd85ddaa4153f511d9e2097cd7a7144955224d2ed275b265c7986afc3995f8a7e9102039d6b7312a22ef07af791ccc7bd21677c8acdd54dacfd6f8dc0fd1910dbd9ae2a03bdfccfed78e0d443d0116c33a32870da5a37efdae50742b1d3634735aac2cfdca5221d6e2d53ddf1191d7028febc2fa6be957623b34fdb1195f7814ed9349b1b356933f1d83837d913e64a138c007084360c53c4bf5fff62ef3ba533f76c792f4b6a8cf8c12c0de7d2cb70aef74ef4ec262db68ea976d141067ba4c78c46b507601903f4e7779dcc58ea62ae13c859d33d970197bd50715b8168ae0678e568f0f2afbef4e91e724e6a145110c54b1eeca781984ceaec56518830953d9f9c396ee210f12546f408892aee15f4e56cdb770a1784e9c6d43209986220cb7fa4d1c0b20528937fd93b67a0b949a05c746afdb62bcf4398f1838e8392e30d862086f9907882767a524cb92aef1bc50dbbabf8d2404f856cdc249285ca0cb504910c4c67875b5c09f2d819495fe806b15b936cf947f18794b11e200e1a8084d2a2448e07d1267d9238d57af9b618e4f23cc77349cdb2efefa026e0e59e0dc0b5817080be5edd2c394d7bb117c55440d03867b3cf8e3c848c87bd6f63cf214c4c0a5762c7639541e4504f3bc44bae10397050aa15b6fe7c336234a8a7c92580a676c1f2f7e32ddefece660245b6cdf929045ac8e4a91f050cbad2e095e83f68f4352b18a55c05f69b68550acba44e7943e965ed7c2eb0879a95e8a622d9fabd08ed7f808970e3eaf6ec2fef8c94da7e7e84aa26d04c0da6d7da37f0685388f7de285534d72af7399b99ae9a14c0f0ac0e8c429ed3e98831b0d19bdf295e9443191e97b24a1adef5742e618414bc902cbf3e62c712d6c09de1cf985bdaffd85dc352ef07bc6473a0fad1f23bb28338f08f900598676e2297c51a97ea960ffe9c8186f601665e835442ff133098bb09b4892453b4f6f9360c4ca8ba519eb8e67ae5310af366843a991619df9c19fd301dc13b30dab26bbd1a17c95dd4ab5ac2f329f42b0b987a4f54a51f434de16399f13bce52a79b568b6b155fd76379c77f37e0f4fc5f0b6b495139f004f3192b2ed562339075e127cb217a63dbd3c48609d80c51d7221e9e3e56d31092a3d0dcd94bf79f1b2c6d6dc750703cefc94f7c7ec668a996273ea491a7c18d6469cd418a851fd3b8ad6ae9272b2314846b0e0e7288a58fcf9a9b4ca900abcad0819addbe8ae26969eb38a24a378d190c3f32a355918d0546b005e51823ac1156cd7720d4d344afe612e262f72add836d1f9246d74e3c61c1bcf3ee672f73f6c6114ceca40f24ac111b4b17ea3a0922bc35f0e3c72c063baa576117b8f825c24a9e579056dde32d523148950fb2cfd2ece9361b070284025302f86fbfafd9578dab97fa340c769dac10282590e6829306a017efd9a323e6de8e7af332f8580ba501a7ff529b84eefbe459ccf423dd663b205559b68be26664213c66752305897eeeecae9487b9be797297804b0799fbb14a8b74dffd03bcebbf0c6d4167374243011df70f01becc6632340f66c93dfc3229c95bcac05c3995a5c6f263688e3775d587b47aa8264c7695aa33aad6ab4230d3b56223965a45865eef37fe774ec7b464583d6f9feaef14f998136c3fa0bf14e84d8eb4482cdda3597a2a7958d8360ad1c90135461cbd8ba627d6eb8d6ede47d182e6bbfb470f2487d05a72c7570f24f01d543a167700a71c0f9d56d4076f9adfd3ecc4f71fd2d93a44e63e325cf9afd7d7174e753251d7461f488702b2b94889fdc3f4d01b1e184967d215fae763f6c25c94fb4b4e1d4f1b13fd4769525516b3b4da598d635658faf84c3d974563f07e430c44f06754b46d99acd130cfbfe826e4504f5d7f2ca28be7bb8a9e60768080476d47aa6be156ff95d0f494ac8be274c98119c6e3c973c4963fee9b6c81cb149c5eb806ff245ab92064b72d4654227935176bce8131510488f4801b4f0f19cb73d1b6b04bb1b6d36bc8945258a45031a2a7764bd305635609debaba2d73e0e3825932fdf54bac576d41bbb093d907c06166b8e200e225560caf7e9059f819bd1fdc770e2240b0442f0f00c4fc6a80cd1f94d76a125220a608032b66f3498628857899336e67e5d2ce4b11585ae44aa11722c6c681ea88d18c2bb3877f9ef90275dba97de4d381117bb67b0b4e366c76a0f3632ecd9e10ad6982c99bee2638dd5fed7acd25ad57aa95a5692442ce856b1a006aeca34f6062a81301b4059fa904db42fbd2e63ee221ececec5345cdf42da8eda07528c3b2f4e7443692128a1ede60c88f47197e2e412db14491ac10192ba0ccef06b20cd52c5bc654284fb29eeef9624072a0e60d21657dacc5b29aa76fb86e376bd4816931e63032c10866f5bca61d247ddc275e7493c2ae0350b0fdc039ea450654e224b69234d20a7bfdf9b48d07b4a81255832cc009527ccf0352be626b0802b7e6ed5c84766494fd58c70e1e0bdf4944067cbe4cf56ccb57b4392b6809cfd8c12d84796253d31022766cf477dfd06ee2c2ff8c46eebdbe875de833e048aa1200005bda69c1cf70ae523b6cfa82e97dde5af57956df0c22f1a9970b2e8b24e23a0b4e2ecc0bcec3fffca12ae1a23e151f7a58c02032d0fa8dbb9f0473ef2d88d5b7c7cc92966618f3539a88a22bd662b4e3b1e8cf481b46d8a89a0fadad9201fb0e17ab05940842ef7b92185d9cb79b4cceef1840c3689255666b3f9b6e9b17463731779d6645aec71fe15c1c09354ff120486174b9105db1de321b8eff43518aacfa6666ed8f796d6aa6d392de3c3023379c990fc2b9dc2c25622832912e3f9e958634366c67506e5bf52589676b77eb0d291b252d771b4ccaa7e23a9d8a487a45199f46ede5c7ff71ae58386e93e5e4c95956d4b1510b13d9b590bdaae42a5049401ea60daf93a805f6713c35555197a97a5fcc840e91bcc2bdb9286f0887055618703f484f23d73128efd89be8b6974bdd6eed332468a444663f9c1e3cbe4cf41ef8daf639aae7b4ab42b6e815833ba83a5e1860f1a934c20e1d3284dcd48f85b12f823b2af855939c9d013d51d403e85853ec267af9273c1ffb0fc984b320cbd772bf44f81bfd3328775b90462932c124ca3da62771e339544a00a55a6d09150381892cbc434524feec1ac5f75f209d0ac31e35c2b68ab9b0fe40fdb0bf0de839d8da5984166257327de8691e8d25455cd979cab8854f3694665ae342211e17d894f1a7aa83eb93eee2b4ad8aa03035daae9ab579b98757c384c3b07bd129840e645de75f7b3e2d6bbfe2fceb40fa8a047235f7f7c658c1c60815c0883b1fcc3c82974d9cdedaef0c31e5f21de07836484941bc25bd61263c3b7c85ffe1cd2332aa4371bbd9ada1d5d271c4b15285084a9ae874bcf4027538ebe02c76a6c9b05a8b36fbb5643ec0b17b982d2d8d4d6ad4d8d38c9fc9f5640fe6b4f41798a95f870db2844e0fb697340259215f48b0d4ea01715b6aa3797854502e04a52d1ece284cf81d6cc0bd9b3dcc0d20b93de47c3623ab4ea7671b6f702d49e1548f6c684fe1514eac31460b8bcbd20108e825889208f675a53a9475fa1bee5d02f8baa0160e7717c995297636bbcf95b2f31f7d477fea372c4cf8a46ae7f9db7bf189adb6d255488c009efda901eacb0fb678aa3f12a247ecf31b158217470466f0f0255f208ebdaa68f76cfcf0148d76034b49bade423a4d43eb438c0d45e2a9f04b171f46d12491d8ac11b81d04d4bc032cb30f435a027906f986a36c59bb502ea34e91680370652ea944e8b44b21f52c61bfcc4eaf484968a9ccee6979b5acbbc1a4b8f323e7f746639418b42382826f4e205ee900de49c48edd0d9c8a7baa1d72510ccd2135d5a476f8466534513d932b30e2bd5300ba69065e6d550b36cc6d8ac681282a78a242dccd6c71a0ed06975b5b6404494e8e77c15501e26b75d21dc227c19231ba7fde77c9c3bb07ab083ba637be0b5aab2c417001af79a5949dccb7fb8c4182ad92e66bae469c8380400ae694b490f82e4fe9654b645db3d39b494ec9e9e6212b27238dd9454348c48f75140e6854fe17186a8bdb2077010ec28a884e774b722c57a2541b6370ed1a373110653afb78ce6a65f11ed3edbd72ae9776ee0ac589ef7ce12fc0024be76aab580733ce5d312d7ca1b6939e7f9b0518c553a9363caa456f2984b13cf4f6ba363490956bb13551359f72dbb9c350e876a553111db075ced88c1832f71a4565dca300248022665b8d3d45f2e6b5a2e7538259aff8b9612c0f4a4a0abf79d5f47129e749990099025ef58d202ade2b65b0ef8b3eb4d3336c2ca6dbbde66ff40466971e451e9d8c0d7231d7373f5ba9d20a96fc14649c366df19f65d997f225ddb41984eb1891ea950d5340fd9fec98ca9b81e46da3355e7ff3047e78eec8d8035269413e08f028d96bb2665f0b17da088551fee34a9a447ba1680dea0f430685f1988c4bfb9f2aef6a18821026f297abb90f058be139237224734b6e03d135fbd30955a82c466065e296fef1380bbc8d411600e5ef82fb6815dafef6309a8f0298e1f89f9366d3ff78f5c4823b386614b06abafc5ecd04e2dff759eef59f94eef6853222851bd03398485dc9352eda722542e8c953597deb3127bdcf69f79698c478e20ca62bee1d4047d3d74b8c68e87547e3f515a98aab2e62d2372c6462465894f1271083018287ffa3558f0baef72f73980a5762119bce616aadb18c3fc6c4002454952ce6e8ec25522edf9f760ea63c6a2575a270594d38a823b4fb37fd6e85a98033680bb7d20e9aacee72819fbcacaeec069b0cd3b8381e326e58986b0024e08b14ca699f61449cc873f68a19c08d989dc620eb5455705154f04e47c4751dcbe92bb416519ceb0c046ad60497932753946fa82d2f4348f597743652d794cec5ce99c275e9b46d46bf4312b90818db214c5f1e23e55f8214aa50ea18ccfbfb99e64b7ebbfe18ac2761ceea949d0a1b041c2580c9d1bfbcc4401f3070b971b270ce0f5bc568df68d65d109086383aa7c368510bea552c209016f513f1b53f3ddcd0bf708f7b0c6a5b6c63a3de25fb148ef8a1240efa6ff8f05e24339ea77ee724cc6a68ecdce3ebd72a1cbba21b3ef68f5b08903a2b9c6516d204b3fbda0a4c7250f9a9ec6efc48855c3313939f2f94fa417bf61920793230621d4a408011c6abdec8d7d312804bf0bcca2f7c9a6255374c2fd34872387d06821bedd32b9f4fc92e57c9b52ff29e50e65fe5be6932138f040df0b493fcb2727c4d6ceaa138e69b39d41855803be0d2349cb66ed9297b5395624ee311b71ede18c31d32813c7a883c07746b3b1e543b996a9f99f7488529f5487c46c2587705bd8d2cb9e2915b127ab30cd95f47505a0113e1b9f70cde8a7c48e4a7f8af215d1c9961847842cc62284bcb053d0cc6bc1c11ca74405a7d075d675896f12f3e69f75dbf4654e74d6b94295be4a66ffc1694fb97b920b9f3b3cd8358fc0a7db427b06193333df5d87977e024977552109f6a99c9089c3b44d6137fbe3788c850334788f0691008a23622b01f3b8d79655cd0a4e7c51fc999f2e961be8fc4f48bd1c9a49efec913a2441551a317014f2f73e71747cd6fc747fcc5bac8cc9b0fc10b6ef308f61bc7aadebd2d1d984c3e37f3a5483dbfccde02da9392e79773a5447ddb5432aefef8a2fffc00c25f03b0d0d1854fe2da98c34918b9fe7e698ae1ec7c71514bbcc827fa46528515a863e551ed1e5a4de65e5ad9ce33a54b0f3f0dc42debcbd256ef65e15d5149879d67e6b91c4b36880a836888d9045a21cf76f337e2b22791ac349958e50be87af3507ce477624f20ebefd600bb6ecd7b419c312b60dbd1dbadf931487de63bee720866527cb9877605207d49805dde169dec4164b95ac94d12b359f2eb03ef7020224c1a29d02c5d253614edd5bc2ec525f63c894fb8d86a2b8b14737c602ae3d32b6d26132777222dc835631e2508607d5bb6047f404d8f6c93b6a9be61ffadf819f80cec542bc4348e6392b942622852c2d5893d7ec6e2da432eee69248c5f644cf8532c0c9c8dd13f29d55f10751b56b924f743c7d370ee0ee99cff5683030425ff982a6deba15d532b07b390e7de21ecfcef1cf58229817616a6ab9eefe63cfa8c4f21ce0b063fc281e39c4d80a6b0c56d0d47fd6f69a573b945691aa2ce2900dd42f11a3c3d018d98dfdd691178872e817a572be14dbc6485ad50006de70afa6c7349ae08fde72bd2abd5a5e0f78b5eab838fb283073a71d55f67a3d11b6acb5e57a9c991f114d2abf4729875c0200bbf8728d33c032a29f4bcc60a58c8d298cba8dd92b7b10191b7eb53e789dafe446f5ca324ea6633f44f5abbc913e83324ec90dfc9a055a6d068b715db74d9964c459c26e05356623f65a1e95b0510fae2a6c43922cd5b766f64af84775712b7e50dda4425fa67c19310cd4e6e21b4f7c7b3958c9b1ed5d8bfa7da0dca9f67b97b73574666ce1d13124ec1da3672f3f1365ca786704a04e4380c8b00fbf70719d444b936dc7188024094cec1563767c08e3446841952f491bfe27653c377f19e47d58d500af37a858a63af8935480d2a620aadf4c00056881cdf9f1f3bc1c8c20d5eef9663e8bb1c8dc525f57c2d216dc9ecc5a49d9ba66faa48bae80e821392f0727ee0714253f36881a42dba5648074baa5282712db205803d92ab6f718c27c45989884f619d4045f9abd09aa6dea8114d59aebb7c614b56938e153a6d1801250721efc263529c9f0aab4cee12235dd35911e024bc8d2f45eb1a52180cf9d0030b5e79b1b563df580395e52378b0cf28530812724c2b08fae1323f44230b112473dc3eb933c4c55990d462fb435190ec051c9101233729367f8a4b14a6d48ce476cfd56752bb1f78adf5eb63751a1843a5508f87dd74e64536359ad5daf0250f8d78c166706a891729c6cd65c139dd4519fd119956104382b0c705bb1a84f713d63ae3f682e7e1656ea796e7b032cd013f4b1fa57efb0b3bed8e64d8ee6e3191dfac2077001bb453b6ad0fd1bf556f9bf1e1e8cddb80e1da352ca9d3b17930f27eb2522c833236c24a346c05e52213d405425aea05bc722702b670256069d9ac3dcad3d6f5b391a5b1c5d26f4c34c994a43520c4f42ddd18d2724fe7d16223dd41056895484c7bc7abd8ca3435467f7d8499adaa6a429d8a575b675e4c1afb5c9414ce3d53ebbb036465d03034262c812b3a7ca7e2946afd962eccd46a22640ff0e0a175c244a9a583b86ee83eb8086833fa9cbb1dcc27c81d04099c0475b737c00a6ce595d9572f765fb6766a2d08035b786daf4693b84241bb526228f1bf45bbeff9b021a2a16add1d327724dbb0c3be913f6e7ff931f00688e3b2066d10c0e75be92b3bd7d1f8dea42b44d501fd5ff66c3e26e844613db872ed8e5e9f08528830c3ae3f110383b3b32bc2d0e9d45b4c0d9a12dc12477a90a30e40a396c9381db148ce50022ff63c84d629043d7c327b248246e983aece020601e20213d0cee2266c3f3f5228bca127843d3f4c8f6714b60d87e1752125983d2f676d07e5202f797f20f6f9bce4657c673f6308d7d34f126835e5a8f94a95cfca546c967aded79e81cea0201e7b940a428d8876958b12cdab3d4fae8b06eef8b65208fda95913f2c7d51cce182645036e5b6c6939063dad239b703c1416138ae6c6edf9e66d79177d6c4548ce2938691725fc0bb6606583b5246f3f92d6822c2a5763928dfe762413745bad43ac9f6eafead3907d2979b4664eed0339826cba480a7f3026420300950de57df835e986626d93eaeb1086ba0497216cc2fbbf2e739219edaa3e77c7f02f8430e0dda07b14f7053c5dd8641d94dd5939ad984dd76a3c75d977f8458d3b1e72f9091f6563ec71cfac3cd4fad05f48713bede61e0db8cc7dab88c3acfda2c0c4e492b05e10e7a0310affdfc841a92d5b646876065f407a37efadc1dc82ba6e3efc242a52dbe335caabb2152d3e91a29061172c0ba1ebaea8a55f319d0c507210a2def03fd43d5ca468367ddd0c1fe107849b51f955ff5ab2b3d719fb5a9634b0089751c616a9be64bc17a7580f49d9124d50d6638f465117adb1ec953e270fe220da63fe292d1ce6d5496e27cce72b642f37e86243467a6fcaca975162188b15049102c41d823fb1de2a0c01c5339abb17305444b6a5131a30a16db8b13e5b73f21422a9716d60e67dd077636786b3eb28b4f2107fe4969bf8e89868c2cef2a8c404278d7fbbe318ffcca06e55bb6a079165d39116068e1d2c35a292d802621422ddf8af60a172790c4ecea6b6361dd38287ae34d309b2dcd9501f781a26a9a61b3053dd1e1309a091086dcce65f236e3a95c16805186e7b1de6cd6f63ec07531a54fffa1c7fcaabdf4aa5256055c13e76a3d8b1fc34a4b2c7507fe32c161d9f0143b0db906c4459d2de4ac692945e0fef81c2fc081fe024cfa62e3289cf091877ec604963c95e0cb3e0910997f1db12d6823b244f21de66a0b3b634dac2747d0fc8ac381a03886e2e1c897d3f92dfecb50d271c8a8f3d1cf7059fcd639f73c6915304f91e9c4c4a945c381bff5cc901fadad375e2cbade6e6cdd609614e875dffc88462d336c09eddd3e43c16ff9d6ef88e97d8c46747e7cf370b5b2e259e15e818dda2d87848ee12d1b6b6d5105fc5a6f059be2d4970f6b953af9ff8980a76632a0630409e5eef6af7a3769d8065b4ffc92f5c8ca581d3bfef84f0b4c9ac27642e48a877695922b18c201bf0914a0a2b80dd91329e514d6c70f8259209efde79f4f432e52ed7e88b2978ef20803a724ec1e59cfbda27b68712d8ccec3f237708c83d2d5ac7b7bc19b9eec20e1cccd80acfbb79558190af3a40e7d118b33bbf311504504ade007549a93f194504b50204a37ab224c9a811e2021512ad6dd898739471f9c03de5623f466fd5ed543362e5982dae185211801ebce825b5a5b60714f8488f5c558c86c8cbbd4bccd9ea77aabe1d7ac8b2f2100021b1ed4dcbd1b29b2faca1e7f1dbc0387cf4e5cab3a092fed847d825480489c3c2f9490923b49b1db09f3d1ea1feeda600cc383b5e01fc6e9320d8df0cd4bb9afbbe536276c386f8a69573220f02f387ba124c532a10bc5af8e6a68893a47197f639bfed166a93a8394aa528b3c05c942c223e653f46deaef55a82974f311c43f492dc25346004ee49c73f66675f6e1b0e150f3dd1b10ebab74b596f730307024b9f20d34d56459b7660d5024dbbb2145293ea73744cda66897a81cc883139d175ee8e823412d90d27cf87a5fd0914b7433bfe548bcb3b3487f47e1f7a6bd006e9966b8c3ab9031e380d03d9d4e2cf4435319fd40a6024427716eb0a8837140756926c46078c5fea9f3f9bd81aa5f0c35f9da6c3ec072ff02da92677b50aa84300f03f2ef1d6f0ff18a433968b5ce79c1eadbc573dd143498eed2e4526a7c0ac35fd764d89686a9ef0c7d31d0a3adc176b5f5747134d8b5b71ed4f23870fa525c428a092618ead6f1eeaa19d066e2f23b453bd5109c861a21976810af1012c43d0ed808034e42b0b5463b91c9190774e50b549fb43375e30834a003b3248d23f34c437a2d115c7d292e1e82499a71f68fb08db78f6701c465e8f814f59d03264b5a8268f2c4939662eadbcd70dac501e8ea900231809cb76bb1b028c858a27e0fcc8f8345f4ad4df3e6878bb0772f3ac8465a43cca750544daeecafae61d63482cbe7869b7d36a184a23ef44b2cae2a4be8e913c76e33dcbc898e188b6d4ef84d08f56bcd890bc6818cd10d6ee0d202f2046f70b830ff7d328166e1c11a187dd8dbd0255d889457c4a30d70c7fc13f5b7a50d08ae88aaceec6c935d420fac3c8e7d6701845df2e6f3bb5273362608e017184b5e774d27f7f93747d8121df5f768f23a6cfbfda2a62de722e3f7c97578a05a045fa841ccde36439d4c508d25b18d26016824888bea72fe4aacd3e783357c178348fdbb2f4058698ce5b601483a61431d6394ea7e16de0d1fd0db68a8861800a824ac64282d97886a658a51c30637d5d8f35e351e847f381bea31d8e76556157f618ded0145d6042299c2310e0882bf5b67deb076b7c70a856037d7a5e6c6f5974249f19e2dabfbd356cb5559f09fabd5acf9d340659870c2b0e02b1aa4aaf412715ba5bb2d517e2c901f240f2862e5d49677efe42775ced98b55621e088112501352321162c04bb1cf6f2c3ab8fc2e929e9dd582c67b82012cbc600e3b893845959d1489cb5d54c7a1532ab323e4b0ccd9a60f73d08fe5dbf1c10d259e97cec1a2fa2a83219d48a3bf8aa444acc6add1d1db9c1bfddd1ebd6c4c783fba80f010250d0be493e08f1f544159db8dc09eb34f581a2a966ca30376c31197cf04ebb374ee6c0cb3c86df0f08283ad06339a2b96b6932cc302e80d1cf9809452a96d3348976f323a8cfe76f0dc9d4ff8088b0e765a4e342445038995492f1f435a4199d1c6583e802cbe419fa0947b7ad575c0f583638dced477d0f7f51843d874cdadb4ed53015e0b503e603b9d6e5c4268a4dd2bdef474ef183f44ebee6412da288d475059491b3554897a4d7a51d4fd52247649422abaadcda5e21d106aaaad06b0f35bb55bbadff216749078eafcc2a03b209f9ed8935abff830769dcdf46dae7531db5ecb377c77dfc8ef87100f6ff7013c57bdd3b2be6897fae5c876e200d3b05e830099b6ba3daa9e02d3bc456b2eb8db3c0ff53b2a9bddef6190ff75f2663e6bc28fdf259fa39494fd39d4a82335f1cb5fc27e88b2aa2dafd5d19f779ca120d678cd4170f888673d3b28a82886c1e54dba67ce801ae010a7a3e35b79d3711dc7be1200b22ee671fca4b5ea5fdcc4ecbd88f8b36344a99da72db63bed9101519bdc6c65aa16408fcfde6f800e273d433c42ae0fe964f0399929712539a9c78f5c7edb5686e8498bcbf92a9bbcddf2c1f3c49fccde4fa1274832e953d0a10ac9082f73017f4153e8ea658e65d14be25fa31f4122dcefaa5d2a3794529aad6286ec5182058cbd128b1b7ab077b7173a4da405230421cfcc01273f5623e6db671f8b445b62df413d2730979feb52747f289427d116f8e70b5f5c741636b125332a0c4cfeb46e2e8bf7d1e3e7bce30dd3d3ebf24f521bf9708900641c773e54443d00f725c2dd3c43338d6b4690b0ce563ae5eb74c88c4c90e30f7fe30b48d88fd0c888a3991cddbbea0788f96c5fedc736c444a1fa2d65cb044ea26f5ab47134648f3c994b4174bd4da475c27ea20968055db52c740bf4189f8e031e9c5c2ebaaf41700b4bc6ebb62d7e4e6b4faedf3dfe118d48d7c21d1cc1966c8b9d1f77416640771226179100b79bf51b8cd713635f753aeb14db1702207a5f7c7f5b8d2a7919734c9d701d5a6d75c4b78e9e5d7eeda22df487c4e3cc7e4786287503cc30bd42c9c718ca5a80c721c0f71ede8bcbd4a261da2e87e48b34ea55c587a028313c43fb701a5531d2e38310b511e2aea8210d792bdd0a7c261992e6fdff63340e724ef60015eb6f7fc85f994cb6d6e741a57802072b30634afe4290ef67ab23c92bfbca5130352b5e2173dea1198997ffeff3612c1c4b875dd8cf21451bd4db749344953f13b318292c06dce548f7b69f3d6903ca7a6a99f02a5ef7371295121c33205221d39be1f7e72fcc1b825abc4b2f515ca30322847fc27cd746464f1f377da02bcc2d6bcfa40c8a40e32fb2c82b11046779d03986466dac27c4e48610c6863d773d92ac70aff0c8073ff021f43ff1b178d875dc4e3e33cf2b92db82257e52c8b32ed88b5d132b6f891ea510935bfd7d20957150d24ec2c092a829782174ed50770f525cb2ebc0dc3bffd5e57713e89ad374e6dc5270a786eac7fc3a67301932bb35fc1e24dcbf50b0ca4166664f429da3d9f7b53c1a4e290fba1c9e67897ef0a77930667bc0971d59391ff480849326cea73fe2482d8bf2fa4fc5c77bce73701188bdc5cf0c813fc998c9003d6f7e4d6b1125c2163557882775737c0fb5178caed0b2966ebf26157fc6d5b09154a828c9ffce8f12d97f46d7dc5d87cfd305abbb5b39a1f3a6ffbafc1652eb8b807f1ffa5abfedb10c8c0422a8651008351dc1f7972dc10c1c34bcfde506ceb55f160af5e77d92403652ee88f02a58bc0a868d912523ea30cd35a1808aa3b35b0f7fc383227e8d58ba6a87677aab45b0bcef7385c48aac846ae3c7ee37e64d832ecdb5341f79e74eb4199dc8e1cad361bd5277b99a5e4f42d2c25ca591678d8d49d24a6b94bd8aba0c6472ef2cf52ffee5648b1e809d07204748ca6f076702962ceb22fa39ad88874741aacae563997cb96e099ecb628ae811528bff3dc8e8ab5e6d28c5c0e4e65f600caa7ae00f9f0095f010f402b05fad087bcf274042d48696c4f7788218420f18bbf142a6e6aae181e1b1f59dcc3a170424199a046ef54cee3b3aa9ec18bd5c89731edee2b17eae77207b82ed5e1c61099daf25f7b00f00d92fe0a4d941daf6065b570fb63eaf8bdcc713d5db40529d6a7e94208f87aaefdf180f14f2214c122410693f13ab9dbd7d7cc97bc7ab791cee3a73fe76d5d1024e30bf1abd2f9ff367b636f670a3542499354f51ac3f725425c61df7d626240cbc28200cfa12d34685313d8db8a12c9fcc5952de5a983984b288eba87c0043f3080400d0b7f010e6618f4cc90f4898d7cb0bd287d78621b8c7ebec4e037c9e498739bc16e55754539c9d49f098d62a19d724d1d9b7ccaa1ea04be83697b4186eca1be4ab65ae78f82fa42824b56bbd90a40eadf627e1e9d8572e108d721fbf37fb35fb69b8236143f64b8f3b3e68094937f1f76c7a747a48b544270837259c119fdb3070929e37ac25488182aaee3eddc0b1adb450b4a02971a4c509979c3a1236b1bb6abe82299e4e17ac801249c3c4607da5e0aa0efe6503903e1212dba8afb917021f4042c1233ac24ad85bd466a7c21bbfb4f09e6ccd5689b90573a20238606c4623bcc36efde258b862ab2e1325c05cdd473128b991162eef68b8060ba922a612e32d2170ad16fef541a0bd45d735c557155a38cde5817f1182ac683b1471852b9b2e4a7e4a2fb62ac4669caed48ca360f95d621de8db12d1a5ece0368420c973fe657e4d066bb8bf369775fb695715f0ebe78b07f044427e26ed18ca95b0a1f8135d7ecb3596fb1d1d7ef55134d054e3efc8103cccaa90bed09e15722714d05fd8c0ed7a75aab3af3301cc627247622274b74e4bac3a323d5ccf0e642fda40a2a6db7e55086eadaef779611c6a31edffc36d660a279841f7edbb0c6340b338e7ebb60f80ed74d5e842edccff2a5691e6ac7bf09a115341ebf19f7c7fc6801c5c13ef80d3834b8d26a0d6f8fd7aa076d588b8fd9ff065e7ad2d1f7e96b243bce9913cc33d52f2ff5022c286b57ac42505b376b94435924a7790a79f770e3546e8f4170bc2e0907036d62f95bc8874bbeef7028558cb0ced834e114fdb15bc8fd9a01c2a3950ab46018126a04628e78cd56d519b1e138c81a8f335caae2b23cb95f56843f08124f3f0726c9d31edb042de31ec21cb0be0e248ea7a9dba78fccd02812e4ca783237deb37a8a396559c13f0d56e435e9e397a1dd86f82792c18738efe44c2e1d752cd0aae8a1425eadb4750c4d969fa602e0b0954156ee55fe3145b7f1b39e24ebcbd3dd0694d44dd2d8ddd8f1dd761e4ef027fb82e8e2ebe040935d113f592a36e082a9e9c599642a03b4d7704c714405b2dc1304cea880630accf2ace76e1766496284d8907e0386a67ea37dee02bfbe3ba78b66a6e1a4193d11f6d055ba5d4d6ff7be3e2ee044a8778e9e5f973c7a5218eaaeabc19f05b6db6a1f6ee400541d7dd1844646a7f2e3fd494917e89741cc4af7cb5c16495d1099367edacad650940c2d52ea70e09547daff6b66f44f9c68488706e2ced4c16e354dfc3ab1e3b9f3d1eb7170eaa62a5f167201664a66ee603818257f6782ce17bd039646c73145e0c464fd2e1c16dc36f6067f8332a1bf6208bbd8d89bc274eb9c8fee96c7998f1d17851232f46638785a89b66f7ccc3c6e57761e83a2c3963de749bd76efd277ee98dfe96b43f28dd743cf0aeb00e4051a9bfb39e1443baabf1f9528638aade0f8b62b6f1458fba8d45867e28d7dd56902d929259599d6c3e3c88fbbace11e36022c83ee851fd0b6551807324dccebee0a25a14fcccee92c8bb25a9ec40c0fac66690b132d79e77ddd92892f729dcfbecfb87153cd48337e7e456d0930aa8626478159cb0d496ec773301daa88c8b68d4eee60eeeb27c7763f88e85299202113bf59f98457da1f544a60bff0a7cbba176bc957e021f78f136b0df4c4465bd8171cf286041367ba231c8d2e0e78e16c8ed87e26fa4064acc736ae34b1b46535675650fbcebe80bf3b4448513d9d3cd062ccdef8f0e956c066f7165fc0180269842a5c3391b9ebd9201376c7485eccba8f22d1241265a5d8ab9d552f12fa1b5d630cc89050fa95a132cd1f8f333217fcfd1a7e4db43889cbcaa0feb9e6f4c68cc0d1e99b10e21dd146e41758096b7dc15f733d4b3bf85b3d012f5c335090dca23b3937d29c3d3194fac5a73011698fee47f040931c6b94b179812154e83f6a973ba8d4a833539fc42002a80fa0ddef3be2746e01981d50c4e62cb9ae87c7aff7408c20bd4565c7b4d9b8b38569bac4e3ad11659a73f4eb4b66b8801ddce5e0383a89032e8a8ec23513f5fbba249978b9b498b8c675835f700c9ebd0e69c83cc2db3c5f491dc9521ec44f575195e2178f7f0aabdda24e820a33d71e0241a574986b855beaf0173484b1abf353a6ca6ed662ca192a561cea0a38b91a081c2fb4854294516ce826b3a8a707fcc87ae24d60320d944291dbf1b4c82a7ee8365631c6d8dd4803a7b5d60d383dc8b16f5a0d64512e516609b3a8fe84e7b7f158196f9918895e432fadd59e7f76c0817f9188801d0a6c42d34d58fd2c3bd522b68d517601e1ce5c61a55f05837d6eabd417fdeef703e2d1149fbb5ea3e7d1d2ce3acc622fd6e714443691cfe4cfc493331fe9d6acd9f8f7e51b3f898ef797cb4c99754bba8bc0b944036b27f99448ffc6d7f9692bd7e28de3aac2573c60c44452302dd331a8ddb935ea8b6fe879d987f344ddbf74ead44b7a0462708c847811ebdc61fc7258978cba8848a8794f5c9a8a99e98e3142801d5b4e2dc4e5599a44b65721df9e3bc2f5573eaf6fb80394a90aa389e52022724ee9fa3c2d229216fef984c9504d159c9bed00e8d45a6a21ddd5bf1d9106bc3a87394252c0155b8b7a7bddf92401cc1629b90102db8a20fbcac868c9b295e27cca9900fac0bfc667177f3d4a63ff8289a3728fe90e339c927e14fc89fb5a47222427c07918b721d7dd64965d203241925f4838fae835aa892291925456920ddd1f20a747066540aadd39bcc357e7427a820b07139195c25f15cd90f7e28e68e9ba62bd5ccb8fbc2d3d20240a2e9d5d4a78257f1305dd803961e176f2f7dc37c1db93e17162132668bad0bed71064bca912148501dc9f894cd084a9724409dcce87c3fc44cc11f6ba904716c03fe45dae57c96fd418247f8ca7154badc4ab97892ebf45440d8a03ac6fb3e3736b530c0a82e9173a3c8800bd1af38596da1826024945f7c795363df661186486081fac5316f181fea4bc593015683028e0418f1ea71ef9282e9e7888a35c36d7b4f163caa38b4e467f1490857629c0ccf7ca4d000f9a1a19f312e750b20ba5112c468489e7ced96f9f53c5e99bb10e4b4912246f7fa6d5bfb0e017ffb6b789b74c1c78df9ad7ad02940394eaf0a97043a08d42ec0bb013006d6379874595ab61ee3ffe36cd242de1ab1070cffc00c7de570f17d350ecc406de438b0a0515ee0ee56c99dd6635487cb18591c3cc7472c7d3419f67e00adfc6f69acaf34cdc401f1f0820a8e46dd606aa324eb906f4d0915c530e8c36f5f6a6cad53aa389317f32a0b6171611923b6a158c7b66608922d545042449f7a6bfef5ad21be6dad3d1dce0668895f2d8379480ad0b39404f0fc300d61af4f5148898f990a090b15ba22f41f60c45b0b64af391f22b81c547dbbbfdfaa907dbdf3e25fb52a5f655e0b128fae05035ef4f87e11e43b3107f6b47594f49e6a8cace1a8775ccd666d660a66c0036525add0569ea601bd5c215a2ff69cd53b9c9ad12fb8585c51a8af13a7146378d92f7f5d3bad991ecc6c8eead8f835720247d84d7e566126f9f2656bef47bed1024b30ea1ba1c36751b6ae2540056f4bafdb1d62a60a815b454e02ff85c59e59391650193d33c663cd785be1350dc328aff50ccf28f064182b87232b5ef3791e55e4cd92531d50a552a49d7e7e77964b1a2bf7ad5ebf85136bab74a06d84ce06d6f1487895259c4682997a4867786139f8f99e65a1394a16df935bb0ced83ff8f8aa0c055877a36096bbc2c88ac88a825abad3ec45a5a198b847ed189ae45f67a3ae9a4877d4cbe81b504b3777abeb81f13bd01dd9581f47e8f41126eb9f1486c20b3b675c25214cd5cd9afbd68cc72caec996cbe25da55827fe1dc71c8629486e85bd6866e71061a76dbc17b6c56bc202bcf95448f2a2effe1e88eec3bc9f2448d03718b50c76d416b31ce1eeb74b62d600c1d8d0a2292bb1aa94711866963d476d0f6eaca777751fe32319a1b432d81afc21f75f52eb7ebead12368b1a6857c6997dd16659946fc3fbc7fc78f04f971e408f738e7019082be93872d05960b43e1df6b9e156ca766ef90e583f312a7f2bbf6f1926a4e8d01e8bf1565cfe4be65c3abd9a0c9170238cb1053643804eab4909fa5d05bbefc6194ac8d1686d5fcae70aa741241fcd19e12f29dd39ae4b7ac787f3ac1d51fefebf8287f5053595362280f25e1408a166bdfd47be3ae361e9392fc21c33b3460ce9be5b5f891530e463c1fe0b01f2079d817d12af3b99f7ee72cb8467e31b4ecef309b96ab2280a324cc82aa376102d0d3a7b381bff71b0ee48854550bf93cc5449035657e9268e844011a2af8d291fc4332413a4de10f24fe8a84853e8724fa77155b272abed37c86e6c6e85868a59f6c909193e417a2924a34ba038859071891fee6cbb3eab2cd021396ee32a2aa30a78b10e774fc7a98a24b17975940af232e7fc39509a4583683d99602616801af67430a72f447b7f0b45449d641d91807a149817c833b860c897cabccc5097bddff43af12544b7c090f60527258be18a7f785da493896e1e358835e922723f43d61458328d962498834529b3c85c4aa0be1eea53c653b2da1d73d91f9e9a26552a0be12701f91a975ce208d2615ed6818c5723c37a69d86eb4b2e9d056e93b446a784004e2f9109936cebd3741e1fb5b8dd7ff9d7e77f7cfe0e10e5e6f16cabb2af3232310138de7d384eb6e678f7c4da08ea1bc55877952d6757f90dc19e7e3b3631e3d65a47f0b01990d41355f988a8d34aab0bc8eaf0567724071c0286dbc4a896f4e33dc26b1e890e8044857b64c5b7128323422f04fd847c249a7b970d43f5ccf9b3297a31555139bca3486b095bcd7d424001f1c0d3f9e4916805b5c879103f33cab801eabb84452f5f9f1fba1b6bf3274ce862b74e473c38815b226697ee327b793c43a0f7513e34694b27824320efae481cb92ca0b1798e2b4a48a054511119776979a98d2f977e8d2a716460a75e475b451abefbb4e97ac456367d27f07184922fae80f6929d2b5176d6fcd975df37ff91312cbdf7301c94457e40f7b653f48772ac2d93a9eee320324118eea3ce6d966b026a76c201dbcadc9ee7a6c443b9710b8c946948e368ec33836bf811879ffd2ad6252e3bc3bcb25a760da53bb8f86fffcb063a12a48a64e39fa81c1336e2d255d5baab67b9343f6c01a948ae271a5ab1f683271d0a234a53c335b99d0ddf675e1847b74b0fd00a97b8092862e3c523207ea19a0b2f51bc481545f9979a3f3c904457107247c14b6a99012d50a875c4ead37032c36991cb8c17474299f28996f19f926c156e39c6f79f0d50bc09fffe853cad16d82a046ee37f402c3301c6eda8c08faa0dc00d6518ca94080856e31a045f238b6efd0bdd8fc515ba97dd15162342c873b752aa0f12879abee2da5b539a8e250c0f30af683df0e9d9520517583ddc1e339c62b9347d4ea2e1328d1180157f0ee81b6c6b554d4deecd5059b03b8c7eaba96b2de90fd9828f602f8028a8760b8b4faabcf84c19a1a6b54ca072ce8b701ccf188b4c272ef7f61ffcf749c7104eeb9222348c003495ecc1a6d769e5973a559e1325f8f95ec6d100eafb83121d9e28444128b9b60ac150b43ac2037d23b22b2ebcf4794eb437f4d93ea75f70dfe63af4b1da1ffdcf5d7a574f5de94c01a6bbbeb7214b821d56fc92975f0c8e578ff2339b3c1967ddf31ad45ee857c9bbd835be8c3023828ddc7886c635376b62943b0d9d8b10f984fef5cf63a03a313a059bf91580d6eba158a2f7e139cf426f2520deb68ca8aa059c1b4a061c2a9f03808e4a25ba069dc6456855b2d6579747e3f98bd8710e4934f01ee979f53f382da9bdc81a38c42d53faf993c437d4496a9a2a64accde9d12b552666811ec86732bd73c9af0620c9a89e53557b62d831b61641977dfa6f18be326a61571f0cb92a4c1a87855292bcc9c1ecef8712fd79fa126ff05c3d7bbb6efd2d7d689646cb5f8bc8e336f0050a57455ace5395b116adc536ad0b32d7e567cf0305a9370149095002d0350d72d6b91ebcb8d1e6e9947077f70f7bb94707d41313180c84926ab98b4edcd267bab79c4db5e050d04f6d2f43fb12cdf2deb4266bd3efd414b5a16221bc077aaa33566fec2e9851bbe9ed98c7b39b50efac20997b876559011a551fc9eebc1b3de150875465e221877205ff791cbcd69c4d4e2200f835d3f22548bb46bf4dad45dce8fd7364f2ad8991273a04f68d422de611504456733f9879ac8220105613e788cdfef7d4e9fd0fb67297fe990b31c29d21076d965a6ffa922314b2409d9ad634809773773a6134ba74036372465f720c977a8aeb09c37b921ea73d4dc5679dc7c78a4fbd3583a3e57555a2ca632701ffb480f77e69d5c409712a59ecefe92158af6e6a165da614e6a3c629a65fd925ae533c1688fec8267e6f717b4a037a025ec500c02f573fbecaa16a88078c3e2fc17450fae9f7de71b12e67ee5200b08b476a90053b84cfaebafbbb5631c95e7c872b21f5afec91ce0f464e8d4229fa88095fd1ad65114f7f37dc1eb60a57c08e5798dc2d90b06b04c03f97f10f39b6a8fd22b43e487bdfadee96497f63f2cca547688228f29f946edcfad86e5c0dc9ca6a235d41dca75276fcadd519da7ec19d2181f4025dae0f93e8e7b76e9342d81cff2bc2a1ae1bee259973536f2a351659eeec56a962e14b77127eb10cbaa6f224c39a3ab57d1c4728f5290d6479ae5fd6a76f23c6fb82286a305335c7695c1accea5d6e0e1494ace43ec748f9b5f98f100120fdb9ac931c180e270f5022d0de47daca309e0066705ca271d3338ec05da97c9462643bdbaeea8e4b3c80c75623c0466fa6aebf9cf49f1f52f0bb97e8daba1896f047235a0367b478bbb9affd3d29d16899393ae34efa45c84e864f6f8c8370993577aa047e8d553593562949876d696b52f7447a866fda1831c6642257b31124608897189997c6ed748ace1454823ce9df5087a251900cbc6a35a9dc7780428edd38ff5d49a3ca3f397610d7531ea7849582e1bcd2871f17e54688eba800556437c2b4e0b9ec568b22769089a314ca11cc1c04e41c949d24642897b02ef0bcacd971bd7f6a2a4d0cbaf10aeb5cce1d20faf4f99c068d741a98490740e84d10eb0e5ed55a3ef40d0fc588f857d54a4db3350df48cb8436182af16afe05e699c24e1ff08e394274626338a0c11b35ecdb96c841aa5f683e38a7a49bafca63ca6a72009be9e8f03a607a48d273bea5d77935dac46a4c5fc6424d8e2a4defd299cde97a4bc38f487b2183ec2f2ed7e7fba63c56d9bb86b23e52ddcc98a0366c159fda2928a3159e618913979e419f08c2be758bd7673f670191c5862c19cd25a0289006d2f51597077967578fd6500bff2a601f1a25386560d1097a8fe7cc61b16382f6c3077e33dd2cbee59ca33cf409ed18dfd6bae15d1b020345f14405d420670f03a4ebbc86518898db7b08d901981bea041e480619c67a676e29cb1f307eb0bbe90b318348e61d030aad75fc66c4a456dda0ca11ccbc6227582757f83892e68469c3d56412df267492d848251d40f5905b2eff0cf7d751c2be066402ade48f7f0dd0b58546e18d1d5aa1707fd3d663d2dead5755ac7807fd3948995613679fb977dc79f89d7e311c48dea8f769761c642ce14c8664760ed9d191ef9262a5b5f90c80283a4f72c8d7dfe363e9f4789856401ca82bc6ea0e12c32b6404c06d0ce9b175a6d020df0fdff71293164dab35ed7766f7c85d489590bf30f87c30c0c419e5838eca1d0748434071b96c2edea504bd44e64827156013aca9072d335d43c15f058d6dc2ca9c0285ef8a33661b2fc7a24c86499125b222b8a8b1fe944c516c0e67f3c506a6c1e21ae7d0efa9ecccd4e988780e9e9bc84e09238b9e3a2f0da01dda2bf364c23f5d7248e1df84c50b69104dbcc41b10c43011f58da576dcd6d2e0f81fe7795f279db4c4c3bd171a8d994bce4ec55e29fb78ac19669ce7e3990038db7deee88ce635f54b2ded8111f080589dc659ef10ae8982eee97c7de7bec3a7cf067465a44174359b9f06f5dfd03a78d5b505e24f63e351e3778691749a754773c8947c8020f22efa0c44233acf33cc33cfcbcad82e1b958b574daa6f3cb26df6e4fd11b358fbb1313f8ff3c94bc0d6722736b166779ee5e5dca931ca99f2e3fe1a539023b0046a3b651deafc9c8e34a9d1acdde34702e26f28a95e595277f328ee5fb082d364b026eae465818fa973759ae404a2782509a3888c277315a0c91ef37a6ffe40619f3e4b14f90b181f20cbadf5a758ea3b4ccbb6ea3b8408b75cc1d7c2f761afea6d3cfe0590be5a832effb183fb71a03f9cf79c84e9f8d89075be1e538114f5da7f105bb6ca12153983c9809f24674c3a2ea7a45b692638c78e94adc1b893a4ece31b3a2fd72f8afd6b37b4a250a7a6735829e9d2a51ac1e495a5cd1151ff72a1d1b2df9f25d68a66c9ee7c1d11c45d814c0b37e69ae06ae5daa20ac34d67366d509a648b31e06501b160c84c50fdb7ef8166a22583291b2eadf21159614a72c73e8e70084033f6004df704d85d3feff89c41473d5673e0ee005f18563bf3a5b852c59757441d167a615e5dcf032dca3ce1494358283311ae1a966d9eabcf38533c70541e07ab8a2caaa85bb0bfb55e6b22cb42c912f48666be7f929f69d2094b8afb41c7a709b5a1bb27c168488d647965b5631c8bbdd3f4afb5a47c5cc72dab7c0f454d320c7c44344304f7deecbf98c7351bbf0624b3dfc1c3ab49ca5a872a77ee48dfd85fe45a0d5e0eec2dce0dc20d23049f6a2526f9ee00e46bb6cbb743c365a1bbf5b848b64cd18280f3da3c9fbd3e9b1ba7ce48eb4494b70cd949e019c09534e9ba5c6c8e026a91c676d0974e12b0ef1a2e230649f124345bc2cfa95bce581dae194b2edb1d82c23cf0c6a1bbf073b785a3686b513741618a5af95671ff57824a3a80a0fa822c2684773266984db65d5586f32512ed43d441fa9d719bf245b77abc06fe5df475ecd607ad405795ccd00c9e7a1265a99d4fd3f7d7fccf91181d2c5cf8955630d01b1bc15d797c22895defd2db01dc1e1d17570fc955ff51e9e4606fd2bab5a64f699564fdb9fedd83c4812cc5e4af9bee48994dced3d24b54e3cd1f5034988218110ac862e4accf871ac4e60fb8ceb5ca096c996c2cfaef28509bd8682628b6438217173ab3311db4535126a8b1a057e702a20a563b0f4c46f194dbb9f13ac1cd0743d030427e4e2d2139fe9bbb2b7da4ff8e7ce365c79fc4fe552cb02e604cd3e0b92c7d62553e9e3b202fd9595139f4d5ff1d608114c001b3b2d5e7b8623d059b985208c84d8773af4fb2554052a0e4e0c7c183d559e46ca0c85baa590a6fb97b7fa2217a7442a328afc02ca4c7aaeb2a0baa5c4a091249fd88dbab0fa6432cf1b09e5428213a80b9062be42e5e931aefe1c7bd676d6cebd46cafe398da235eddf1091554c41db45bcb2af09c11fa417990718b86a9991790dbdc7cf96b10c2a7de38c629f543730f098886472c3fa05b877b35c81f68b65a667b5b6e17791dcf98594abbfb6fa4ba17456bbea5f308be880c32f93d064e6bd320183993892cd693df399fe106aa897025e97a4d36bef5e93efd8dc4ca806c063846b2de80e18973bbbfd70c00cd2ad79f9d127350a99d5afa8581a5d88b2abca2dfa28740afd5e52b579573daa79e4c54ff5268bb7e4ff24294a82d22a69f0d6fdcf3f8d87ccc09220e2d7c623719af4029d94fad99f6710694917fd4276a185627e29b2dea141785b4a0963806e4bd08a8e4d9bd07cd3c3ec5f6fd0214448c009a5f32499cd02bebf4af6f61c2f0233e046eb0eb0d45e114a656020498bd286bad0a51b114489f6561a472cbf0532ca34adff98cb5874d4f3575ce0b90e77379ca3caae259945149470e9d96ffb0d0029b82eba63679cecb2a3c59d4310874f1de9dfd7ff49f2e510cc3626524107b4f3038c5b4a5b046d691a842df5f956482a13e681284b64d4272eb42583ed3a89e2801037f9ad62d9f242d843121d1374e760540e4972176b709e9bf879fd392c8249ab7ded625a1466760afacda837f0fd8ad283e660e7a6f26e866e684cc67ca68a281b0d745dfe07f2343dfc4bd836830e7dc790e09d05f5e8e93cab4051a3a5f9f7a797488f19af650dccd0c0da8f44895c6d9f8ce7f83ec5f6d13811d6cca6d1c6cf33afb7bf4a09d912508520c8509519851247d84808365d3bed93348a5e06dd1664e6c7e9dcb15d52fcd6c0b8c9b91d7e1f76baa7d1c3d9334b59734a9c1084a22629897ff49e80849ad60658fac6e5e11406140297449b65d40deb4cb8612d46388630a2e5ba00373b34b982d5c7164e9762ce664a8e2762467266d8b9ecae28248459bb0b46e91d6001010bed1f49f8986a3e328a68716d487dbdebe8edad664d24f10c01b98cb69872a6a0ca1186148d639389aa34262ef7f948d31c62c09ec44f9375c5ce0faac6a1e9201571a4c8ec69c4d2c42c0fdfc1bd1e52170940a1473da147dc3e0992fb529e58a1f9aba27e791f6209709098743821302343b4f28fd6928eb0fbf13ce5ce41c6b1f60001dc7f1827c8906ab1454377588783c357de3d390599f6daaf641f4d4bde6b2920e80709b86a5b92c9ae575e990e62bb616b123be6c0f1cf552e352b8bda2cf5d18690d3d993af89db9d3e29691528227a1a7d50d3d0ef21a2e7b9d0b2dbb7c99744a701af4141e07714ccd6dc67c68be957a5472a30cb4ffc1547dd2723c814569660a18f84e890894a18dbbb50cbb0b76ffcdb2ac9aca70eac1af1bf4d78e72fe446f8ebfc07542b5cbd2e408f0b637e885043366cb53b2adc24a772e7963181a1fbfca1e9a9717708f0d1a498f54a4b01a4d01eb678d0d11b65b6601f5d2936bb116cb52d5d9c5a36db03b681f9bf2f0727a6daf2294c4727e646bb696207b50cdbf5b1560cd06bd7245c4ec9f42ad5111a93724dbd25ebc25368014a0767ff01ccdd275191a0587a1c0c2badbd4ab1d104b661d81a1fa5f33545fcd9af7245c0959c6dad91916a4111ac363784e3bf110ff7e53316551b102df7eec95adfbad0107c9781b1fe8bbf9cc4062fd96114aad0a80699065fedfcb7a061604730d91e13c729fc1fdf6b12c4ebe40779c7415e0c1ad7ef156fb473b3b79617944863227e821e1bd0d2e9c09673193d6b79fc779949666bd7f9cb03aba901858c519ad7575696462ae20e1db217b03f4ae7b004db9a70a18e6a194e1187cd451f33fa7e1daf2ef0b7ecc152c6c26f9444d39dee80a965c8becd81a0fa46a60113788c4094d42db71b269abbefe394dd6b5ddb449fb8ce6f89eae60690576a0d6e6571c0206297b7a754e4e444c8378d34e27f6bd5400c6777a2b37b3e7c4c35615353a26dc74206df0ab45919ccf7709515ff08e5665b95e6942167e67333ae59ae3d78abf287e36ff17c7e25962a40da4e7a87cab6f1647ee83936823c8f40ce1b901e93462d87e6874ed8c2fac7af879a9d3459ed15beb709e68aded720476e06cb974afc317608fc1d22e976f266d6f526b8be04db76ce95d159e83a35f0f4b2f3bf29801fcf960fe58afc0866584d6603bdb1ff96c9752b8b0f7c82787ff09c608d91ba770bf42942952ff440e03a4b3531e1fc8e64592b879609d9ca8038fa2e97596332dbb5bfa4d327c6bc80c9fbe668a643f77b5475dacedf8092a00e2deaf79480f1e8ce0993f6a0677a6338040169e8b006fec1e7f653c522e7767c1ce9f20be9ad9f5dcdb00f8b96ee2bbf8073d9bef72499ef302ac1e2e329b057dea3df5e77b5ce54b18020e3a6ae7c6aa07b3a01e99419a5aa3f5de2ae3f08228f0989ec789baa05e114e4260b707381965a28b3ab07f1617ca5f027046632a60b0d1c3eb7c098e2154d5ddd9db5dd173ea3f31a91ee9a67de0b2dbb950e86c811defe3c27aeb36a80cc204f49fc1b66f5843acf3d35526cfacf9f2291d11971a504efb4c5fda62599e95783e3341a25d677c3ea4ba925ce3c2de6bc5d208c7c9c82a3bff184d44184cfa7383c1b4c8faba8b744e39ed03595ebbb0576a00790af76bc4c50a7b591c2f4662ad83a7255ef29fd92fc4ddd59f5243880da9ccd45d10f734deffed56cde4fbecfe2703bfaff335e260422f77bdbaa0a401a62294009c17f041d21740fa525e276e6ce0b45f0198e85b4ea4e65dd053f68fd61f043ddbd85dbab8d02047480a9201b58656989a7a507fd649120789e521a60cea2b166e3d8ae04e2186d7451f27920d72aa40c2545dc5ba2eb4b54098e39c85ba0bd4adab2d03e79b7bf834f10d2cedaa4f97a04b4a46490db17c133a72413221a9e229e9003dd0b541353c8250b069a6157e9f3b3603861b81c01dea4d3a06684564b5debd46bd1205f9c6856bd27f9d0c26343cfe3deb133d6f04bb79b9b28a819eb6e03e9d6f6672c7cb9e18ab3e501f2f00a263b568b3f1e4c145ae8dd9727cd345f0bd86e285f9b43535bed4f92d0edf5560269737b44e4e261a75b122a35fc6954c940dcc847eaca3a7e5b61f10eedc616e4adbcf0fdc4483ca080942ad766d833a2c58a75cc8c1d07892d9eb55c5a6efed69e04aa7c3305c6c0018bff677654d1839da70edb2f9b387f88ab640b944410ec82fd3709dbeef2e979f69c03b18a645abe222a3c60494c0a6d2a8a9219ad03b9fdde350713a3224adbf4062df18c1df4a2324f5c5ef08d3657130f1f093707658b7a5d822b5d7549ed1c2fe8ab3fa37f070376f8f6939a50b021e9e4659c706f41f26c233e0114447c2f540b89f53f84d213ba13063cc781503aa4ef29baac88ae0cf8bf15af42233d1c7d97af25f3ab48195778b1f6c78081dc8274f2e197fa32ed2efdfc49382f6feb16ea33e37482eb50a251a87dd3e3f97b5ca479036bde6abb42388af0e3692694c8d418b61115fa04a0411b95977105172f077670d44a21236844a47e4c70da200d49510915d7f31aec29906466ef5da92582e6ae6fe72d2c4ee5cb0b33705780e08c04f856f9bb5044b014aafa305186445a903ece56db5e4457ee6d8c3814d80ac7d151d3caf115c7f4aa2a06bc61a30175a177f09614be165c93e4a19a98e779ba16f001067e8eebabeb1602b6e0cbb21dea4992eba1b5e1dce4a6cdba2573482afff62d6373d85ad8f726e677aa8462fa0414c50fd588da1d89879aa365141fa826592063606c0d8e62758d34f6e03a70426f234917042595cb2a1a59ca26095f778c3c794ad3c9e6706a89175805a531d9bfe616b800d0df0141dc8ec0e8ad18c4f60e2123d0474e3a47327d00fb8d5af74163985b1643a510b5ad061bbfe4a303989a8d16b57775b90e61d57b3558dfbab0346576a882892e7edbcefcc75dbe469ce3b3f7be8b6d2ea75a76808edac171a20a77fcaa91e8e281c850a306d04852900b187d14ed261544b93edb37ea77178e93a3d8eaa1b9d60498fd6e59e91dad10e4b97ebcf3629f798e2ab147cdcbc1f37d8eb57a93f0e44d97bcf0dbf380ed0a26549e3a41ae400249907fe5148f3633b60679ebb10fc51fabeae3a96afb21078bd5cc2669ed4b1040d7393125f812f9b58a17629fe6d4a59ae4699819eb698e718ec73ceb7ac23c7f23cf4c2ba1576b3bd018bf42039c3cdaf276378f69ae7a1b89fd95984de11f24e7675f78a78c92aa14a9e47cbf18926842472c7b6fa682b034633c8fa4467ba87698b98ff497873d4e345bf6e994d73a94861895eaf2b3c64c456475725b7f125a462e88ec156c5de741dae83e340771f8f71e7da451c8271b60a0213f63ba9bb6697a4ba0aca7e5ee103c71e38bad5eab7170b27067e360e647fbc8130dd5f1852e825e94882d7357e1e453d523fd809e8fbd6e46c2bf35297c67d7fef2cf3854af8282f122a37951967360d7f25d01b138a68866f4f79b4e8a9e939bc71fdf6a0dcec2733279a23a5106bf779e5e97e55949e8ec71bb7c9bdaedbb9d8b7c0a98482382f59f2dd8e5d3597ec2ee3d72e58e9bfd281d72bc3dd373ef6849f2f102c14d03f2103aa94bd5f6168d7c587636c8835529d43a50a39631499f398fdeaa01e23da20e7e6a564da542473c606c7fbae3e1d66b17f7abcae7b22a59a0d0775e7e19c16b440b6b29b740f66f2cf466f7274497cf9f1f76450fbbec8e3aeac3e3bfce71dcfb52a4c80d36aded5b02a188141857535dac611d82a89571d5be8ae72d987dbff2147ff6b438f725380fc672ba6dd6029925a373bd186fca33b9ccfa8c3bd0ff2836fe088dd116e48c1dd7eb64b0f93ed56b02c5f57453601b3f708c677be057996eaa12f93639cd6e2b8fb2e3ff3501aae27f099896bfc546b78b8230b2dffa3727b351657b79f5b1b69a266bd3fed2eb3a70f250184f5389afbf8b06657d07eee456b9f345ee780e22800da2a9505a64d011d086a607771bc9c2c78b3adefe81950995abb70f642682de4b6bce50ebe9dc4c28dee84700ddfc2aeec8d1c217aa2379ee2ab45a3f85835c77f2ec67366372f3c929be41490448fbd1322c31671f67cdbaebac3c4ad72bf10844a4318d58214be9c1ef91e7586432f070da80faae3bfb1a7f2bd96e354142fa487d7d447658f7bde117932833424cf6ae2cdca0b28c8b5c30450346edc862ed0ec7fed6d3e91c85f3fb8cb65300b90a34d4efdb7b3546dfba75a4cd560e82de52569290663ba36abc6db70c518e2ce05fae8b71daa945ee527b7e8feb091b2982605d55d6bd072d9e2b138da118cf8138b7317e76752ca2faf7939c1b30e792bc5dd92a5ea2417d5dc1608e6614412d74461515371192423fdc2e374be9986627103747f6ce0b3da1b68c8db7ffc207e9ebfb52236d3478f7701001e15daf07662df2a8270e2e498bb266274ac756413d33757ac2a5f6d6ab2f183d210b94db48cc3e1251983f299000d920aef96d8ac2a6912694ebdc5276e397e825713e47a8f69fdb2fd58135a1f7563b58fe7e665d765919486d46c5ac830b3dda3d03b998112c2d04e0d3f7da51b14a5bb178a928419443fda42b51e22f76c934899a547fab860c6fe5fd7a347507404a8be08e22cd8c18f3f0ca86ad4e681646e0a3d8d425c11cd24f53fad27395ac197f6ec6154aa703ab107f66dc6b5a1b94f294202f49aa08ad90a1ba724bfb427952a69f97c966b4aea4a381a173822bfc8e18f3c0afdf2c32455915196cfdef7482b6ebae97470b208778d5842bc64b0594401760ac4888cd3172aceec8a2ccf5f20dd807bc8e57dc8219ea6af4699b7861a6e55421e9b203d072d640acea2a7a6374bcc1495f8e55b7ff97303eb74fcb623fbff4d9cbbbbda43469be477beebea16cfe11f84130dd9671e4053e0d71fcdf3f34edca801ae377823b40a2474638c742dfd8a554444f28adc2da678597a0f96b88b412053ff3a091ee3e4a66296db377d207eaabe4bd7863c4e2e28a0eb4a2c100df6563d8e0fbe255661448d2ee3d27fdb0279e465d12a951159f75407c641e7ec2a8feec6df2301cc7decd10a23984d67b9f5a09c19f068b9c4e88e12a54685821581b7e018f6263e3b3ade47f07a80b736877abdac8afff02bb0907d4f4ac0f02f686cf1d2fbfcec2ae8f4929946c4ce4b3c39e80ad4e903b6e4ecc0beb8dfca416d8a59bfa0ee8c5c7946064fea1c785306caa103ac26edae827ce2ac8e42c1e0039013ca9986f47a5c6b42227efc1e8cd831a8d8140bd9e43287c5ee4f377d33f2a05770916859d3964a37ad6b7b30443daf9394323855d3905362b07f6073e60d7fd076eb68a75fd56fba42dea7479d40120620f8cf70bac8d8b7aa6a948e8854978ce7e963708f35db1786214a12c7d6fde6dde0f4887fcf46eca3c53e313bfcb1c90f4f56b56b905bd1a1d09db5b3bbe07c666b831543d86ccdfba1dd24b751a30c091f5b511a73c806de4b314ed15b3997e4811b4e5aa5820a593a9741e05915be002efb40149693fd6d31a9b7a14d5961873c083dba4021d44a8c7f8a2d73a86270072d048678e757a5bdb4e5913ccc72426e552788524a29c39694272bbceb4a93fd852e42e5cc86832d36ba9567330f58ef069506a1309eb6f38523779383da4755f57238da8e1b07c7409d9e4d0c03d66720855d9a33161997d96cbc62b38b7577d27f2a7a2e03f115f1add4099d5ebfd485811182888561ec72183c98b1814b6130d26203056c129605f157b45e277747feea6c3a5a06132236677c09027d289d4478afeb7fc8df72d66dfc9fc71d4266b59d67e76c9bf38c9780c61a4109456c7be4d23ac5dddecc04b78ce1b39b06c7c4f451b31f532839d82adf0cc5aec6be16938c076baaacb86dbfecc80174589406567bc4c9d9c3ead850bbd96076c42eef408214d49acb0cbc109efa9b35511153a21a94f9ba7e805a50fa812f24109a4c3d670fd1735efe9b825fef85ad99c7c93bf0ca9e981f93c8c63d43db1addfe92e746221bebd4c20c2579d7a3ebb1cc20c55288ef07da942f8e6fc9451431441d0ef72216f2eab2e13cec85e0f5b69a12a52cd2c36aabe492fd672a7bbd85c457f9356dc6da6e3f415d155414b8617cb2e20d71f8bfa0f4b354e110ee127f4ca1ccfdf894bf5c9832909e39f877392a12fc1678ae0ebf67d963d1e5e7bd54c3f427d58edfde1e188f3256e3a2fffa188f35976226899c907a4e59834daac492028aa486068f7af764256881ebbfab5f0df47b1af8a2bc62b270c3af9714369f6fca32bd7de64e5ab792ae81c71b470dfb510d661d6029d88cee0a0d2f6c357bcc7a094cbddebfc4ab0d346419ee01070370680ef90ec6b2184d232ec9e5bfec0bc7b50802603ce0b8eb8bd51123411e688c52576f892737cfead0f7069fcf24443594d54c1bc2da0462c811ccb9df9620fb4202f3901aefa74b246872a20c050919994bcaadcddd67b51c5c2cfdabcc4f3bbda3a8303646a4ac0545b15848cd4f1a2c798d8565bf075ca6554d8e4ca43408b79ced1511f42bb8c21c7c9fc7296712b0c8e3b1d7a4642df7f07b46b3a2f7476820ea8f186876b4a0ccd56c24927933e2930adc368c02bdf535c867d4545ac625ceab7311ed7e9adb271602268191eadf6027f90ca9d5ec6df2bb77e77c45d4b75481f474deda9f681935b61d74c3faa9d5088847a63759765a6258feabd2c5f291f6cec07f49731249c14435d26df617fe2a57bf25097627985d32cb6b8fc9c9b8baa6add7589b287c3382c76a8581e6a757784bab912dc71a2446b20f04c5f1e12a52389b5b84423f0b3e51764fef3eb8a4366052fdb96c79bafdb1ef8ee504575322d3517aba8c24c4b915c0e4e20699fae6f3932e15ab79a68fd4da84a088e3b6fdffd06d84243b22e99738105a97ff524a564ecf58263d637d6c1cd461d847120e73b7baac3de7ca1eb3a2b3162ce33d1ba1180a0ac3810f299c40ff150f0886276c0fd55c0bb6102b014fc75de4825aed3a1db275a9f5c5fda124033f5f4554372098eef1e8e90df47ef194ac305c0dd2e0d12cda40dd5f947ed57c96a0b4d7cbb5d6642f5eae39137f1198966a46d4578b28b2ee60e487674529d6aedbbfe23f088e4ee3ffc1b1393a0c33a54e0055d45f1a96313245f73c7577030d8d2b6dc16253219144f45a1c0b3fbb7510044282ba55f5def3102f1754e990067ff2d7156525bcd0a92ec73d6cc70807fc957403f98d55a21f92f4048d0bdc3d9d5ffea1db2ee92c528a1a979bcda273e606eca303512aeebc9707118d9d04e2dbef2be62817e1fb6a0e31caf54bd50a778b0320f515b52599e7db706d00effc65ae01e86a32cf697338eb03f847cf587e076546f5d4ad17a56685ad2fa71331cd5e5d81e033ec2002566da6e2bb70af5b85eea01fcb5b876710fe6fa6d9980549b72909657d7fdef0a9444778963a08b4180094019952c59cac8376cca25a5405d15450ef112e6fc52209cce32b7cf88c20e25257ccffdf0d85251838c89ccd917a31153e974f7b454e7469edd5011e5d6d3f0295aeea0583de25a9aeaad9efac6b076f26e936b3482eec57c802e86a44baf9333b05342188e31bbdf93ef1957660b6b827b57843be6a212aad14847a2c72b3b86d930c7619edb6dc8ce07b7d3114e5c88e3a992c1aa03fda9bc379961561aba1ff64578dad95033a4384cc4c43453d1343e38d480509232d299c0837a5d6817aac538542d3e94d4eeda346fad0dc10a0049ddf357098a9f53ca259d8e30507866fecf3421186cef316c1c4a3c9c4116c38d16dd6905496595e81d1cdf2efc718eb834ad36b5c9c85e5b97b46a65d62cd4d21ab82ceae2d1e71518241766afc7a13ca077776839edc1841309f08b0c6d5466f03746291a0b41b051dff587acf081f80b55babe4b084e82b15e7c9d23654539d4156ad1250b3fc332b5d5fd19d6cf309fd32793a553e6fb60a000515740911ba25e2d4961d702b6ffa7279faafbc54eca9bf94cb60877f1a1c714fa73f7b5ff662c37c8ea91a040a6c0f20956521ac4f386b627f3da75a5e2c07060a724affa480af31676e022a94f7e4fa3670ea173fec46ce07c1402e3e2a01dd0d6d5c9ae523e48cc87c33bfba0f91bf5bf1e61bc40e0bb4d0792f8aff55868e50bacd59035198715f9133107875c0b840a2177c21fbe90c45587a7be9635f3bc1d09157e1ca23310ef4d874498956fba6d6d6814d12d38972eddd3d9dcf6db43dc439f6f6ca9b91871c4ee93dfd1a74c72395a911eecf32ae9fed9c08813fd30cb98abb81629aa0b8a417fe2ddefb5107fe52d60e7f5b8dfbad5c74791e4b23f30f96388ae3ca7db515bac765058eadbfda0d909caf0cc3a6185255a4388be1d451cef239992d38ed1c9d089f94efb4e243ad5cfc71cafe4eba5ede02803b10a92a78410949cd981be46afd702f7e5234e51841fe706b05089302d27cc22cbf0ed075465e80555e5cdf7af0d9212b6f237c4670628ca1d78bf41d7e25a88112a7fda26c07987c6ecc78f61d5b036a5545f0f3097a8b497304de8aef0f0e1e28e4f50133b58aac1a9ac9926ad4f7b0565eaf2c9f21ee4c3cda6810f1d4d9915155ef59dc41599e5005923a7d6c62ae60aea9906702574432e84f7cc97f40e1bf78c598ed8508b6514290055e0b09edbcf37ba0fb237bce22bee856e4e1e47f083689e6e66950388961f85341682d15c8fa1e37af659a1c3ad6ccc7efef1c7f6a07d6ed3814d7d0ab75a3cb55c0b6a16e89e0448f18a2cd6e236d0eb3c7966d6de9cbfe3eaeea7860a38772a1c2569880ba0f79939d612c319d6f1c52c7f54102ef5c78a4705d08e4ee29e4b537e25bb7e4317ae3b5b4cba6ab836d1b035b3714c41537a4c9100dad63be7461c4b88c1cbc5eefa3f4828fc4f9aa4fbb11d458fbfe881b0c7c95f4746c57bd7eb55f0054c8445bc47d8f4534c236945a1dbd06cc9c8731788b47b52e65cbf1e9d97dc6dd1ee768810da435b6354f0bea097d3fe09f37d33c872b695a3cf5672cad80dddfd86e7ab35e5ca32318f8c7d41bdaf60ad244c21b55e281767d65ee6fef2980713de4dfab7bb218c59a753d11f4a6e06b13026d10e1bf062b90615a2f92392f34cb6a48e6893df7e3c5d069687aea3a0028a9cd302af72c6a063075e2545e458b8f7727f7a7bbdebc27ba8b8dd27e46a87e83e9901e9147bf12694e4115f6bedc533e57c0de101d533543d594682a67e944e60e80572fc95c865dfdab6ac4d0a13278973846be1dd1ce9339248ee75e035f3524b838ff30f59697f78ef08455d0388ed3dfa3adfd346a821c2c59e401d75e7e752f572a28407db9ee65fa95d804e6f9f27ae457a2ca207fca0db22ec778d3e24cf1b3d96f3d96af94a42bcbf876892726338f542ed2e7e48cf539bcff0f71f73a1d83bacf085c80d166d47f72971c09d4b6ea61fc6770235a8fa8337de69555f36fda96b1e79860c15baa8e1d08495afb19565d5d722bc9e8f81996e50be49d08b7ae7a5920eb08aa35da0ac012fd4bdc25a7b6c0a0991dd09a657d499b309aceb115183a339a9d36250132f43776b545ad61d1849961bb541ced4de4429d03e0d7feaa88280f038c494148e36bf56e9e96c29af3ef4cf401845ffe5a38c58be38f5d867bc43036daa3ee430a7f24892d03fea03de49f199295c02676dd58db618ae1b4ad7dea007f01a876beada68c460411a2ac5f6a057eae92d799d5479a869f2e9228313f7a3a0272f639d109f678b4c0736015ef9b193a769a7b2fab25671f499dd75e1b1e058a2a875ed54c01cb8e572f55e738f79730b71b80babcf08c7ae7e4b562543bee20632c9c8e2f049793942cab7730f1d4f1339ec37184edbcb05bb1ef33bf7e70c5b33eb29d34d96e363325db6882ce58c703c55efec7370b1b6c587c9ecfb1eaaaf83d6b5024e73eeb9fdeb01d848876de2e09f34a4bd477cdb19050d54cfaa3776d1704b34fbe44de54a1c230f1a9c70ff034bce02b9601a592691e17e5f8b0178b62df62dc52cacaaa8236e1ba86200444415f1826a5460f7758f1adbc06fe1dd8c48c4901fd9fbdca7fa48a1299bfb14be02a9eafb0cd479504a54ec3f2d26f7e92cd1cae0ae8f34e5cec74a168082690344b0e605a0e03e5bfb5300bbcb53e7793566f1ea6f70575d48cc08154534e5c637df2142eec6c2744a1b5249c4cef881a8f27ef0046f81d101910bb190de4c46136ef175d95b7c13d74aa23503723ebf6b05b3059c6e83c5d5b0d93dbb8b93b626eb8fcbf37834438a6cf7a8282a161a26c45355b72b90515e864786b3450945996889137ec78e139665204e014b79e8f33216b025178473433ee100077c042b07b2c2b03d4f16f06fb20374dc520da66cfdbedc825d36a9cac0a045f0b9b4892e7346d8751ab06290acd5da7b7a482e9decf50fd5958983f83416c46df48a9e9d963470278a8022429cd61ee8c4f12daf4eaeca312c1b467856aae51357b3de843dc62e269efac1309b171b79b98b916f02c6fa7f1b6fe09010d7709e6b76b1d94133743a688ce3c028b96f4a919d44eada0781247293857100332c2656615ddb326cf8f3eb081482713f54458019c0cb420bf28fa20a0ff5cd998587fb2f80ff1ff0c43ce30d1066b7b3fac8f3742cc2fdb934468ab4b3015ec9cebec767507c72bbb9cb4473eb00d7608ca4af597c1b9fdbb5f854742ee8daedf73123a9bf91a133cb6642f4b6a9ae09fe3364e0ead0dc8258b7f9a8e6c98fe33861d01dd0d6bf20008041d69abe18aee384b80e6f736323524cdd6f963a9f8868a5cd6e32c0b7fcd9e62904412edbf3b209ae124434c2c6d52dd553d91efce0d8db84915de4365ba2afe094d81688f9c2857c2eb23cc318c8c8f44d057a38dd184f6b451077bb5089a408b6065f3087f3cad995c58eb22346a58b725f6468ee4068572804e638464dc2817137a59764862e7ccb715934c8e57b5d7f63b3d9079914e4ce4b9a486f74a2b22d333f44f65c94b142398c2190da58bacc143550c26833076b004d926567a32959e21bc850fee1b3da032b9870b947ab494bdb39fc5d7201305f686b5910e39e91d4c7d2e896ff72dfbccd4917b11b9124d07a4d6838d489134511dca74fef6d58cc88746cc217426194905ced116e98c1bfaeb53474b3f40959f4aeba0d7ff1155439aee361095cf7d6210e197badb0acf4316113edfdd0b03017b36310829ecff5a3220bb79cb24ef0b6103913a3453450f5ce872ee076cf98d630053b84d50a4a77670c4464a6a76a847ff17ef28199659a755a9a23f5cce2a575d442aadf44f66623f81cad3e2c1dbb27df350200ecc538833c77135e3d7bacaf70868608670e7057449a35604ddeba1ab235a67e2acd7ab6b9e7cc5d9c1e95b1a1a5ef3530eae942c2033ea183a556ef458c21c13bb19e99405c3799ac034036bfc5e46af72eb2ec4d8ab92d781bf02218c08076e1b4b62609a8639b2b84e6f6b9b514b8c4ebeb9a6638ab8271382589fc64d3b2b3122e2e9d55e3b2dcbbae5fead3a767d27efa996a3e65db183cbd3a4f5e27aa4d0abd2149b8241debe5d7d308e16005de38a380616fc4b482be455b21ca8b725dda4680d0209ad38a5f3192a8a50ade1de9038a14ab9fa3219831914f341a16659d55c1ad08629f6ded81d0451610c53b1fb07a21dd711f0f22ffbe74e79f8d1bc5f4f8bddb79360f579dc0db29d4c585c6c5d718d47469dae03a9415039b14d55d38fb1f96099fccf47a37da96c655b38bc6af19a641a59c1cd66ebd452abbf3c062ad115713e847cad7ee76ec9d286571ce52f38d0d746cb2cd0b5e7ff5aaaf67ca5c072020d572d373114debcb4dfa3048815fc3abbcae038d5eca670bbb9f5cc004558cb56ef810640042127aab3b51b4bf0db79f8a2cb9976095e88fb8aeb97281ca0272c1e73ead48519ef503b625e4f67a2cdd50250acd7ef15e59a0ecb4582322df7fb42379bd135a14c22e2ba818f270597bdee52e8b2756232aa3e5d60d3de088d2103477a89681bc889e12223e7b90c12a4bd20b2c9fccf9312a8a6536075349eaa8995dfb7ca90c0251a0373405c0875ded290391c8bf3d697720045c5b92f274b70130b5a75a8ab8d97c62b601fd75dfa0df9ea1ce79613e4a0aa0b381348a71b28626ff8fc0575f2f6d10c0e921d9c1e342d21c6a8de10bb095d46e8730cde2139e8253463e14c883a4d008adc1d6b9f65a48e03a9169e637981c945e676b5ef2d24788222cbc95864fbca96f76af25078b13fe7259008cda87ee089cc589021f00336d70004521fb49271041a712ce95daa63ed03157ed655337feb21cf7bfbf083836eb0d9b3b6f63302d3906a370a961320252bd659f031a926bc7158b18a04cb88e875f187260ffbc03186e11bf2dc0ad4d30a0c747f875a9798054f9ed7e9d03e6c0bceee44d6b8bb2ea90c3b1ed6569a9ed92bca031e4af83f94f893b7e4ba8dfdc9574e4b52f5e947d71433ffe564572e88123152bb7757314a124692eefae168680982189969032223686bffedee1c364c627a14d15ed926cf3e89f2891666232b19b5fbad0f4ed9811e852391f99da979ab389cd6c73ccc9c5c2aeaea0781173e5bf6ef2dca01d2cbb70267a1e607d9bcbf09c3ff73a05003cd5fc98eb180201a5257c4fcd0edd0615b9846a3aebfc9b02597cbaaec0d94c4c621b582c0b909f200c3d0643dd4f948c97426ea1b5675dc5cde3bc28547493b1a9c08a44ce35a5d0396c7d469c77be6a8dd16e55e291310bd46ce2e1a8b561faa6ea5831397f5a44f050b905fcda4c013c5b128c5a22dcf8c8d7c7b4efec4ced1d67ee9ca391bc5c9f143e63939bbd517e593e52c6f90805d845c97315ad5db38a9d43ce2b9305c8f81b27f2bd7c64afe9bead6fbad7b8f43517b973099d5b7c128772becd6ffa5e4db32a4816e4c16e02d0b8e0e34ea0ac4b4056ce05e39a8e16459dbb8f71fd72caf1e71abe920282aa0e929738541b1256d8b0fd76679cead0af3e5f2ff79f797e88ce1ed1429c93bcbeb023a66aff809a41fed6c2b7a4946e7864d8adc095b0a8f5263ca7f35a963f88c6bfe00aa2f73accb039f53e0f362ac6d476c11f61faa1ca51a14e220f5094a05b9de8554b21111f017f9d56d29784a24dc40b969f0f60b06001b682bdc43683627e676815efbb3cb53678080887910ad4a6c833861b29f44ffee348382955af542e1224130b708abb3244dd44af589740d730a40cbe3984ffacd7512f01bd74dcdd63c16b36c200f6e84a9157cb9e4b6e95830069d6a9fbfcac9db8b63004107cffd4c9185577ca7f3e9d8674a2ad7b15134174de4b84f49ba09145b96f3f4c045ab22a84c58366533c6371922509d9c91e27ee4d7c63d7e263cdb6ee06ddda07bcf4df1b99da14deea171eda1664f840cfa067bf470b8f0a7ea5792d28a5e610e40d8757d24fb738b1c35a7b51ff3c566ae42c26f0bf8749289dde1ebe785d4f700af3bd1a260eb9d3cd1298e004a03c8dc859c1a973b0ec885fabb8d11944a7f2d21a1c5cfd6526f68d3b26d3adbdb5ada9c83c8a5d7d1371062b396acc6bb2fa8e5fcdcf078cf6aeadd2876e3e8543879d81c376b1d4108b97053085a3b7792c24297fc9659fa423c7cb3f8a226a6acefeca00b1d6888fdfded38cddbc050d5e85501b7df0313eb3a484c0683da97cc2de5b96f57f6d6f9f4fae94f01cb3eed423917098766da1459fbd9bdbb4ad7c396f651985af8ee67f8f98d5cdcd9cdf1b2b39b53276b21058e6920ee1921efb8b73125a63a5b57fc85d3aa1e2b66b8bc7eee5481830e4436facea713d739875e3dde27713f8fc5cc1b4f62705209440f9bfd920a351bac954f871f3998f9b7cd75079259cc17f5a4830450b6d0e6cf9d349d1024a18e7b32218bca11876d5f99077a634c41b7819fa952bc7af7f908ca52bc6200fe770efda0afc0bae898e5b586ce5b9fd8571be6ccf662928947569dc729d24eee2e6a4277c184bbae1be11b6547fab93b48d87e0fc4aedde9e76b0a09e522fa1d63590f8fceedec77bc32c1437fb096993c4cf8c1a90c17b350e026cc3143474822730e73baa6880a5035fa688c3c95f07b28321e478554174651c21a4e24aaa5f3d248304cce1b465e1c2969d65778e96b297ea4179f4af279aa8f5dd10e6116dd098a3db5e505e9c639d71210ec890e6221a7b80eefadda677dd5213b814a3da26c0840c0144a680ef22f1509ced841840ff6c6256b5852e5e803676d91893eb257b638afdafb30c6c7de50edd115a9f1ebe8b06b1bf4216aaf14f2b094b8fec4aa78ac1bac330d839f8af42b8375aaaba64bf8c553efa5e5f06f46251bd105d921d585fde6737c02600cc6e2a1a0aca2233bbe1cde97ff50f2e8f5acd58db8d5290098f4e8b1495d176fdfe258cae00a346855c6420f2952f513d70ea0fd3d9230721ec296be77d859c6cc2712f9c524bbf4e66821f2569050e6209aacd8969a1a4a833c211f2f8d02699f84715f8b256c3039d20d16d541569987b618917ef6bc08dd5cf241f2531b398a068750109f21383c51a136d668347b53b8d8f6936bf1d3bcb4fac620d32ba9baf2b75edcdd2f344c90c71dcf14e27b28cb122d940b0777ee85598730f731e180918f36c6adfe55e9b40d0edbac532cbf12f9bf59759e5d1e7835d5e09c9008ef0db884996461c2a1da5b32903b0b82e867188d59c9e0c4be89724dd35e86a076f7c72f0452e91416dc4a6e1c5dd22a03e8e1d1ed722d486240b2d54a58c671821cb85c3ed9ecf28c7b7622af0bb9e355f74d04e3e214147f74cd52efc769d39ef6f27244a9274f3d592fddbcf797a732c69b4db0c0933b082817f4ff0b6564b68e2fc2806fa8095f50c9dc195c26af75886e842f6624f03fc6a1cca5b231ed9b5be5d11339475a71d918383d62a95d205a3b86f69d51b9eb1c300cd15ff60d2af3ff4d1eba6be47cd8fee58279b63e723c28dc820e59927f888f97dd01b371d1a57db4d3125331d5597cf9e08717cc69b694407c66578e9f1c2e01368cd3f50c3a682e93f88af1ee7b8f924cb44fa5e0b6f69f4b7647bcaacffa66e649ed2577b1598f32a8297f7cd214f96f1ed7d2b1389474992bd03eff3073890b56b0583717ef56c4e7ce705b66a735c4ec244196225e11be982644c966f60da3f412ec2768382db17688efeb4ebb3ddc00b729619cebaf5ca35c4ab712eae4268d3d8607ff309b34aba3ba32f79c543ad2e3dd3a8ebcdf52ac2ea4337b24d4b063feac9c94d8ad3f296ddd4b2a52b6b59f8cfbb90e71e513c97072a311fbe5f5e2f5d9934839e65ff920d77660b49f294a8951cfe4eb833a98ebc7ab77db875ad3e0fffc1b3fcf9056578128938fa26630eabcac6388ff3bc1e2f657c8bbe68d6708a1608917e3eb21b2ddd78d26ba159fb6ee0366949b3d71162b5ca5cd47b4acb0e0c4d4c21706a8d1e02de4bf19f6ed1092ca7f3baf512e3a741680b2d7b60032973fa8f76d8fe6e2484b4004d0e814fc07a2fefc005b57db5f5b142714aac3b0c9e307779014093c4bcd948b677a3470d8bc6ce228cd75a1297a0676b44ed226845e691a3b853725418ddbef93ce9265c911f6ce23037ddae2759ba3b0f73dd70f1d52c24ff25b62c8ec2063614e1f2126becbcaa26c60c3cb22dea359130e20fbcea45028d43e5861aac67e5b135c66f4ebba74ca6a1a3b831f39d736bb34aeea9adaf726a3fec43257b56673a942ba32c4de68104ae86ab627cdeb7aec6d4e644d045206bf575344d059ae04188ae4567f5f198d92423c64b5650e5ab356c6bd56924084ff42e8aad56e525ba9c0e4fe9c8498c9777250f05d55198f35419ac00830dc3544e153f9347b8db245ad7cb06751a4a2cc8cb6e4d05aa96ddfa471b93389c6ed1d57b912901522f6c756ddd1089abcc59893195e1a16c37416cdf3f9a6468c6235ad29864e7fcbec8a6311d5595cd38637b3b63e605cbd33d5ca1d415957c6655a4744a81c0eeced46c7856b9839939ae6fb8093eac9db27555f84be9f2332b6ad70127eb9df6fc6b6306c75dd9ffe3a0d96d8ada542f627f5bb1f53fe906f4e948efc7eb51c942cfd403df0b12d46c32b006f1597495aab0671a0cc7161615aa66ac1941dbb1cf960dbe50ae93150776578f3c4ae4ab18bc8d53caf0cb8d6d3b7d2315c4dad5a615252a1cd4b849cef560710f5b87648572185c19b98436b27071c63393e04ac26bf231508292bdb9cf1fe5935a91837e78413e8edb77494da6293a5a84809c81768c0208ab9d3881c4a50a9aa2005d938a6137807ab1b7e5bc301447ef538ca9aafd36988a3e7d9008632c737ffbb216a9226466177c11d84088f1148f1e961d70183ffac6262a9af4787da72298a6721bb5ec61198ac0d56a19f73966b9d2dd97212fea2b25caf8eecb8e73c48a7ecd049d0768d87d64a7c79cca3cd021899efd9650041dfe4cc410cbb1358f0eda8bc4b23a223bb953c5206d4de0b38cdfbbadf01950666cd1d7910740013ef9c8c59d1ff7db65f21557f8fbc3df175d347cb2273d9b8976a4cb2ae51a4886ebddedb4cff7efb6c7c090d60709720fd3f2364f807bfd18dec3badd6bb2694d2d89fa11ad9246631626bab96e84db8e90cf318e9aa473dcd3a09825b664af409502ce8e063fc1bad23b0d2897595a3b8e1cf79168912ab8518a15d899295662105ae4d863423aa68ecec9e8277e0be0248031814f92effb8b8f0b311ad63ca93301a732aac6164bae7f359e1f9c8b22cfa7b994da3207d82eae8e928ecfcf8927cd497f3e462d45541ed01c1d6429a09e018d26d27c85cd8b05ad2ff5b658a882765ab554dc7c216068b0af71dc03428c43898a699ef830e623a350b9479aa1daaa4e691d9dc9b7636f2605039087c59504c27b16474891574e676b8924e5ae9be3eb90fd1e2526e765222dd0040daec8b98340c27d7700117dca1928e6b91b013f8d05485578dd47a9f3198eb5d73621fd500b1ce57668625065471dab59148393c83daa63152601ae04583b373e1a78695d729875147078d178db1853013ad79231cf6404620209e3b2a670eb40d64230dbaf0240fc014e4be84f880a10ed5307dfde6741bcf607da8b38a894cce9071ceca1d74c3fc9a2116f16e036c0e033a217663801204d354db6ca4e713ae2d4ece4d21d04aabe7a00fccdd00621679c58f507c0ddce4325526a8e3975a80f2049e65ef9b29f238b1d183ecb351fac05c3608badc8476975c808d8808bfd71a933f20d70bb460c46b903a1fe102d2e8d0f92c318d4d8e8178c26be1bd7e86c69cff9c32741e6f6544de6a23fb54248df6eab0644540ce91d937f22e8cd43c74493ae1ac7956e5d767f3d1c53ee22cd0ce42421b87fe3b85444e903c4a573f0de061c106fe7b685e39166bc7d5b909f405a69bea625e0162d1aa8d177a3fbee8aa0c065f95433081b7ca73c5502f293997a4f04a045055fa1257b7dbd5a843ccb0f070353882d21bf12e415120409ba88aa5389f684434d70f12f67ecdf0a049cdcce4a7cd602231c37b48fe59248234e6b20385e886e445d6dc07b7f1ed8afeb0788289e04df516dd1e92244a21723aed52dc9447ae4d35556f81614bdd0663c7cb9a89d8520d7196386be417bb0a89eb380439ebb28b75d93df97736dd4df3fe9c2db473a837db0dded654dd06d9e8d4b16e07895b05bb7b46608ab7f695e85df768d2d4c23e981e86fee670e878789758b3c870748edb81acd3a0bc40eff90ab1ec7ce4872385b1f708298253c68db74155487770e4ea9fc59722810bc520f47708f4c04aca4b3d1d6029e9a61f63a52d658419f2beeaaa9c6a777710469607cac99d1af76e8a363763544c87e555f9027d6c8d71abc0f0505575e352f690b42dad5a2cf30bf2a9228c05d77c77b744a4359ec3a15426ab8ae2f602e21ece344e2b7e5c1c643937ecf383890e5bea177fbfa8497fdc184c4c93cc2ec1e4c1f5fea121a11f7107adb0f193457e632ae88ea111e429950c864a0a4c5e9071d33d23cb5866a166a7e6f454ba3c58281311aae85f4b6470990ccd8a8082882a79bf2c4a7234af72bf9a39822224ad197f9029b266217e63eb0c57dca0338700b8d76d661dd35506e71a43e21ef29f82b00cd5cc06a730b6e423074bd4725b51ecd0ebc2955f9cd44aaf5bd58a1c53f0f35d5160622c02c347ccfcbe181ce0d0525204173147da460bebfb03b7ef6c198219c5e7c0890c198d5dcd75808f860d41fa8260a9bc3c9b2320c2a2f2e4a18bf795d8cd4dad6b625f3cfd0f7df124c011ff779f7e137e2061bd29dac01a2bbbe25eb4fb067b940013267d6a9a1eb1b7d39eb45c60afcfbf5ef21cda11471bcec1bd79e4d30fa617be42dab4f5d850047df7d4e43529f21789b53d12e55741733d60115b20a802e5d57196334ff14405973013958812f10df1722788ec8151c1ae1dd85559029e97deae73d79134f258b2277c78f9195056c39d057914ebcae0571a750600cbac433b3d39251a62308c1c7cc959fc7461ba58d00cb88654c3f87217a152e8bd1f199bd3e52291458bdd0bba88b1ff35cfd8229244464a99e756afe013f5c9ff3efc2cc07c0208a7e1c920b26885ddb3b744d7017c2f5c844144e8d419a7bf7ee74ae49df7a6bd1a71f0d511e6c355a49cd05eb3248e43b0b822ebc2102f3211f2189ee3efe1cd6b3b9ff977de31fec8ebddb2ae7914b391bdc13ed9ee60fffd5cc50b651decb16c6a2f1fe394b0a586e9df7211f2202c4fe4ab43336a754689abbcd6dfd9cc023d0933712c8403fcd0abf394ab83ee883b84be8dd0ed5219ebff2a289a89ec705f97ae6646ed4f4473f0c19b5206775bda85884186628c1e344f38259c69f6e58c5041d49b70d5b1184ba0b733be12a9e097f942f832bcda3f062f5aef3a004348b86ab1d1aac78a11e86613d9ac69bad10ece15ae814e7542b060cfc2646c31e8360c330dd27e3023db6682085622d29f41223aeb630c394ea6a9c94314fa682e0f1ec193f7bf9186cb7c0bdee3d582d5f45efb79f9e8ba56810984a96efbf2ff065e239bb5dd0764d9b123acf4660e971bcebe77d4b405ab03b2ed973e06a0811a5475829ccafa4adbca05e09766a6b85784b606f5b46f9e4f98166569fa4c75fe804e6fe85ff218d11f3e93b4f7abc7407d079e419105f8a7efd6e64b5b4f8e4a07f0a847c3d383041e41d900df98a9b9e4544821c52fa4a5ba34b9b9ba9645d04343159f15fc70ace65d8fc79692075939df4aac4d7ab2b70bd3312923ae2393ab01cf6ed38c1609d430afafb3d471beb62c7222994f338c8990bb91840a59145feb229a695c82c043b55ed3381a393bb050bba0c58e40766d2f46dc1d69e57b2e2be0b6c35c13744d8cb6f9b4a90a8ffcdeff935fbddc0e5be3ed2f044f6cb196f3ca345f0565064153fafb910ce61c8247f8150ae7d556ba43ad9461b5ab75a75d0e84e7b8c6b37d346e7f28718b8a81ffafd0350307edd4793ba74b03618bec3f8a6ec065e09b933b383438e11ce773ca5f4a87fc0ea6869961a1979fa6344c960dbb9059683c6953e12362bf086b9db945804b7686a6a9f6cbb8d0a3e1e3764f1501d6a32067de5c0ce3abd8b98bb793cb3e913d64d38d0ff9e2cee40c70921428283ee6446ed72eda63ea19d1ea25dc2d6859906b30ad941534ed91ea725e42a8a16937f325f7872bf257ae8d8d08c2b74c4d3f827223e0574bea91d721aba26d0b9b882eee3c721a5ddd11f08dc91af572292b162b36eda1f2a16e97b34198dd34c7072c0e20cd6ad5f68555912f21868c7e3478183b6de6e2378c115eb1e3302b1b72b42bde937cc829f206cc49d9d3d07bc3a312f94d1e60021de1cc245647fcd89919bc735f088cbbc60af952b7b67c3482445163ebf368b75ffeddf30550a85d88affe82c629135971c7961b9ec7febc3b390b2bc9e4486b79e6d95c94117c1d4e0c01d4b7f534354864435067b9cc2faa48af29917b4fdacbcef4bc9bbeebe418da847cbe294199c961e94a0934483ee627dddc3481bcb5c4f3d2e2b746547d9d268c5fb475ab96a1a094ed989acce8328518b93ab8c1ea71c8347344f932474c7fc96d2ef0f8b57a57f6d142bd02b2bb8c4b3666f97b23622647c9811991b4d1fe3634873ce1d5f2bd8832e7db5d7a9a3fb41df2e1a31eec537485afd993bf7a439999a6263a3b1a7c892300d1e326fefe3cd8a0be0daeade29e8e0f2c851e646090a0a751ccadde5e8ef6528aa6deca9a6ff18974f54c9d3f9d18ea99f8530cc367208122bebb60428f9ff4046f62d7ec6f25332d6430a2c8adf88817f143115f816305d80718029ea7b2452404f1f605c5ef85db83c9fc7e2d70937fad76a5f9c70479fa7276647a997253a662e40074a4b483e45f3c360f93374be43798d55076ff20cdb0020a5d0d62c9cc7d4fe659a2ec83834d3adce66c1df31dac7a67a0eea397e476c1e865454a35e4ed5ac4c34bf9e8d8b77a9418960543342c77585a079b18dafe7a10737e31f78b0a1ec45dd2de1e812399304695c1cef4eb26925d14b333489c57a52fbf27d997afcfb12c49d6c80a78a450d7428541d0f0e7924c1fc831c326fcbc265ae0f9da17c5c8ae1b1b890e6a165cf226176c2462f5624402066a42d949d559813ee1d101c6c4fd2e71499f3a9cbee4dbbbcce0c060cc392c2bd16994ce9cb7a844d6be1555e54d088ec77048654543757ffbe58aabe28a267a6a01056950026a1900fb203870133effab73069dc4832782b42fc98b31539277e4c16d58610afbbab5cd9503dfbca53b0bf2297bac2251908c2c2c028cedd5d2aa6941367d96317acc843d27a4ca32db825193192d04e1746bc01c7f1eea628f85b83ce527d2a6c0c23cdd526e4081342a957a9dd875df42aec0f5067e0520b7df5a7fc4784074c1c044ae902232c1addd6b08ee850df03d8de32d737340492417e2ac1a1c2b774db0bb488aca18f78f545503912a0f1e942cd7421b81fce6b079e2ef7422b5da1175a47ed9e15bee338c1cb335c1beb1652382d9cea3c796797f28a50f7f5884a701ee684d083a43da1f453ef6491e56cea2a18af4b6efe241dd70e8ca944fbcbd7a4bcb4b5124d52993e3bee79dbfd3aeb713f3c06de605bf46898766df47697ce23dec3ed77f2ccee4c6a7997ab69c8412bbb29260eb3804d5ad3bab90878327367d63887274f6905b7197570832d482ce5acf239041a6ac7d19704d233f33c4185238af6b262b4a0094c9877c7e82a11e2d8481bfc92177ecc6db407d27ca16ca96244fe14b3d225e1423154ba3b1c7eec911582bfdab1ee377603c8e836f2939e738262c8934f1599e72ea9cf5aaa8e0d6bc7c24cba15a1ffa95cbc29cd6c8eab7fb8b8851edaf0b669c674d427311f3eeb26573a5fdc29cbb24e34bbfa17b6c5cefa90a25a427f645126262964d0042536d7ff0ed38e61b1c271c22fc5952ed53f0a2f146a85ad7116f31597dcbc3a42fdda2fd06d9aa4f5fcee111a6ffd592c80c8b5b4644bba63cce9e42cc1ad5af36bc14edd99626ef284d8d1bfe4c3987c1e791ce09a6d603e51c4d05485381c48db458fc94199cda965199b823737b010686cef67f81ef68855cc29bfc6276950ab17aff94e9bbe74e37f6b56b3f8574462c8ba0d7ea13ea1ac8d7cf2ddf7f33d19eba74c7b7db2e5d64e65a689babad54973919f64bb637ed60d2db31e192d830540cfae0c597d5404a8f5c6b165f8f8037dda2a270a1058d1af9c9e39a80770027f92a649c32e408a18524782cd1f91987211ffca290e4849851ca37b50a2a0d6a31fb578557ea0d681504e01acfebc7fea9a4535d2b070a3f55e8958f110713fd36987b25103b751bc7340e6d442cc1e35e62bc121ca992610f20cd9d51519a5f7d71fa9ec07a44971f9ba8086907f8d26e1ef7e1b14b37f7ee2f9795b3fac15c6520288e7451e14c96ed34c563d1cbb4f608c7c5a4237bb35b7759fba5051fc65f70544e992a1d9ff4bdd07c2d781404d9485612264eb4a8a808f6d40c7ef63ebc61009e1e9d90063f1336adef0759452e6079d8bf02fd9d845027c2d391a706aeef7b9f012fbf796ec5185e6ab0f84af203dd18bda195fbdc99a73f84654c4eba4aa62d9234a97781cde13a9f2d4252afced33ae2bc94314c1f937285839dd19c36025310628ee4a02d37e41f10a977acca057a7b5e609c60423207bcf26a467a676d38a655606d527e0e3b12c98d273f2ff74f107463ee21fd39b0a01095bb823278dd0e317f3c584fb828faf15da24df7f917e02daeddf2805b143380bf455a43634fb987df2042b8f171094d6a1f66fe41c8fe9111dd0ec37a0c03ef7073dbe49e3ec26a5825c6119180d69116c20f8a563aa27701cf07c97ac57f35f62d1a0615ba858af4452700886ae64ac7fbae93e3e3d3509e5a6cb812b8e6b9905af6021a41c3e3fa0bd30cd12c211f101ff28f51244f38dbb14935f7e90b3ff9390bf5507c14cfd9f593239a57220a533d17123fd4f1728f4c451cf42b9ebaddf1efafc4a9691e2f4ca0e90c73ad8642c4762ab4769405c99927074103051050d3d47642fe1cc4688b62d1686ec1980c303d182c8939a4188d73b95c22127e6731d28816777c4c68a93aaec32239ff85ac9c52a3111dfe03e63891c145f4a455d8fab55fe1a84db8e19348984b08adf05441a2d360a296defaa14c3389de1a4d687cc5ea0a1b438170b50318fe60ff152a6ec8d3a918714e5d5cb64596a01e98093ec8362563cd0561b816bdb4d8c7d9cad518a34f4e2465f60667de48b1affc669e4a28ef3ccc3498b8a73d6398124a6f9cf973ee37c279ec5290eebdf6ec149ae72bd050d06b65607b9abe133a07cb3370ba3b5e3d7d0739393724b71adddcac1bc7efca4460505f2c3d637abf3c301988ecf240fa1d5f70bcc27fff08bb3c61657d3f1dbf0c9316ace1df1311f37cc09fa84270b461001a88c527fa50f7d04ccead4d6d640edca01cc551df5ef95d34a896c882a23a314b90b4974a08ed7fe690cbe8cac64369446c4b088a8a557f6411d3e90a20cc732f4f89c25283c6dcce86111dc041bcad39a1d88257b9851da72197386429c9b00f5a066e9f76b9d8af39f94cb2d8d3c9736d675c8a9ecd726d51b376138e13d3db4db709d0388ca6a48ad5cde0d0959b222449148b3fbd127fa820c1124d37a07ac2341a14991bb8e828f5131c7967d762f0099224030a9ae245e4f3b81fdf3dbd9b68fbef4ac7c8ce2a5d8ae74c6d3f5f948daef491b43e2dd1c21f449073b68ce80681970699a9d76fd5890ae1353a573dffe003eebb852b3ba5a9bbe03134144bfbd31ae1a786d6834c8e0f2fb62deb5a9c2f21969d261b627154209dcb4734499419e658638c00e42d2cf9981ffb0b5f3c54c68e1b7f94d6f0f992d711e4ef71870dc817cb3526fa5b38b21e2254368c06d0422c404a78ce18bb991f133115a59a440906022667169149f42f051bb8c749487700e4878e87320d4c57f92b64f06cfc832b23c9c6eec407af7f39274d262aa4641c8277297318104f72fef4bb905938f34e4bc7d58e27865d9d3f270ebf8c1744614fd88dbadd8f36045bed654c3ce3fa5e1fa24581a421069109b9b9988319d2d43be94e0381785600356afba0a1385fe5e556a3fc5ea75e10b093475f31ae9a7fdb3f9c63cebc88cc52f0afda4c985d954c76b39e06632584d88087713d79e0882812369419f99bc1b399a6193e7b6eb84b89e6d518f04146cb63cca13440c7f356e5ed83ea848b0da0bd4b0747be4b923a7bd429395e06c825d0e6ae477029260118d1ef4604f5f7a46bd46b6c8c55f1a0b2936aab7787372060ebbc3b08335c50e54d19e1162a2eec68cc185429e7da6b8074205c9155a20791c9c609aa33e419eb70d1deb38b94f92ed1e6e117b737010b178f0e79ded0a4e6b51e6e80ca3017570f999923abf3240ac6477910d4c9496580e90d5f179f0021ad9825623e3f03cc079bfdffeea1f2f73a7a7f6a524645cbb8fabf49c589b365c0b49b5067993494f772f4b995c852650d34963318017267e9fce09665e39c24386648c20c4380c873fef77f23673185c4ddcb6766de98f469352cd9af1e64e3598e6f30a86d7d6e1dd8a1c862c66a4ebf5a04a3e5f1de8d78eaf1144275689dc607645cf079107dca6a709eb1f1b8c914594d27e2192b5ccae81615b4a9054d65af9123e6eabed9b4cac6f6707edcf7a9b9b70f749051ecd54a12f2e0b67e5334358ba544e6576a7ad5739169bb8617fd76b1f00fa822f875f6091a8c0a3733e7b14475ac0989ef452f9711bdb189ae66934e7febbf3589d88f26d5bd63bef481ed6543fdb2bae8aae1fa06d72faa10624b79c08938cff72e4597cfd075c331a293bc8b8a327f2f91280b5ddc7cbc64c7489047b02ae35b7b48ca2ab5857aeeba10dc9808ccb7c1d6911a13987a80fef4ffa68c67199af226a1518d449326324ab6175443986f3218fe10e8e40879bc7c0859414650002ebc033c214bd585856ea434eaf3c5afbcd541755d3f96e04a13b2a35bd058469f75698d08c4fd3a2f38ed36d8dd5dfa08130622932ca9807925cd0b37bc2024bf08268583352567df4314093419291adeda5e55b5cf0c7ca6bac646d9b0ad7c4cb4847acf83e3dd036c4a9e169ec9ba128616c85cc93afdc11c0e8484cd56bb44c23c748d37af3a2ee5d8f27d8109ef85ecdf0b77ab3d7929d294bfaf5e0d70530436c61e7a6480fdd6a27066dfb9b477a7e20d5ac32502b7a2474ac7b58a6a2b75539b4b99c206ec44645a4af2a5def620c422efa0d80ea96c32e779d9ebfb0b2b9e3811b1d19a15faccf9027c05ae1ac2a9a09d0f72693590ede15445a01c63836f4de4277e8cb28ac35ebcd9ee946f0ad8c28274da676915ae9882c826cf5298b98abe098e527736b31c95762de0fcb76d0e09def132637b6888478ee100cc22d00382418de70e471205e4f85c6edd31921fa7273a00a4bd9c0a527ce2c8d61c8b5c9b469909f146b468cf9213c1f4eb59f101abc6cecafea792108fa9591b21d86aebd5fcf4ae2faf002aaab71ffb3942c254be0b390e36af4c10cf5f44c3a2c18b2af1e04d6dc0a20ee8844aadcf42768ef66c38670965a3c9fb1973a7b893f12fad0a4cbecd7d4bcaa242f94e40698f1f52edba8a12bf8982c151d7d02e9a8391e28b3222ec323da00e79f22997af34cb92f5eae18c711115569037f8baada7151b954cdcbdd8508ccf0f330fe331d0e6cffbefc33364820648c617e416f1a1c4e943fbe17f88b3baf5717335789a94cee65e92fc67fcc2aef5138ee466ea6b2c3bfe0a62d19e8542e1d56fd494cb71d475ddc08c12b44e5b8a74764bfa2a68400cee92a171cc2f76e78df910f94d5ad27eada496d466b05b5172e155fc6d9fcc322558b4c49373c8032be0658c3ccc6dad7f20fdef6070aa2faaf056f766633d18bfa8b4ea5513115e497a237025a52a2bca1a223d53d5632544807587bbfdf859d5ec3edd5f6033a8ac9ab74ffb8520efaeda75c748ab51227463af58cd77463a51c99eff12305b4f0d842863a4e49cadf951fcbdef855ccda82733360fb5617eb10401e7f12eeb1f70dba94e2eb04b45cec5a4d2e91abb4ff718977fe79a67d98ddcabf30ef5682f9e094f774fedbed03ab5cf56d915832ff30eff0b06b4446492687eec8158a02c5004c8d31d05af9438cb8340a785c51424c610b6c6dab8269e560a4dc0a368b19c214687fdf1956fe0c06f6d3bc20e27a534f49115fb6e44e3890a4d8d4bd23433026ada04ab809dbb39e024ade44f9d2ac771df5e0a35b893887fa627bfc73cd16725a4cef881e7319ba5573b48cd9a32c440dc5ea388eecc272e5e1a4e24b8fc6b08d40e728687e97d39e5d3bc31334bdfeb0ccccd1046224dad820c5f231828c2962812f1ea7079002a14737c33586ff97497913ff090e2b3b7cea679778c5ea87f549f82da35f89cabe1326b07a0f6b9630154f7b76ba3ffe148accdfc858948083e5eeb67466706e11e7eef9819d2f4e56be1730ad11960664645ba1747e0bd2e96180d4547f40523d3d29be93ca8fefa58d36d0d23364e38a3a2921d4437ae8f7e8b370c3a23cb5d5aa73cf10fa401dc0b4e4168ace7e3f8aec5d381265a4a25864d9c5a679630729a20c02bd85e8be67e8555546e7f9a52ee27acaf8271241177bf9c589abb0e9b63cf4506fb9b752ed04788a0e4935b01c1b63aa19265eeca647af5266d1bdacb3eb03414ad81746989b9529c6f1b4d56dd13ae37699b335610c9f77294af2cf85c0b2b2339f8811ff721c53810d29159d0c66e06adce836cc7686e70c285f314d9521f964698ad2b35e2f0a8d4902030bb2dbb11bf6df88a0e247644eaf5b9a0b414fd5779e6d0d0b229838288653ae629fe3c2111dc4b91657b180998532944b0cb772309fb1456248f57d1d57bdeef47df000cf7b06f49c272430aefd1e01c8c38ea55efe196a52767af4fb9faa25747227c1a8ddd812a0c5be0253b51dfcb4a6462388acdc8221d137903915f943625259d8af46add5fed948efa4b3fb93d7ca3966d9f7cefce8c411c1163790c20dd98002961153fdeb93a7134b027e3d72840e19e891f7c7f2cbfe173111ee6c92e91ca617472bb5bf227f175b50f7003618b3a23221ae755a8d165a77282188b4d0f52ea41bf23075a70181a628b2e311b2816d47cf011bf8bd7469eba2b38b30549bae5ea8a6be09e63f10559fd548ca6dd9e1c61d46a699e9c5dea1c5879643179605c46de57be66434ae1b041a900df8a5ee67ecbf3a94bcf86768cb88f538e3e050db8d46ed832dcb2a0327ac5f2a42536ed4b147607f64567e7ec6494a97eebaa734f50bcd4183386120f3544f8fe4df32c656c77143dbfab8d726efb32b1cb7e8fd9ce75ac00f39c9452e07ad284e22e0ed2c4f1c0a88c95d552eceedf57c6ba2556ef7b8d31676c4f31d4e548487ef918593fe962cbaa00be9746b9c9ffd09138d20cb3b5ff503f2230f6963ef5586a5557442fa11ec2c1e00bbe2731580349065fdc1a1e63aaa63434451cd6b801ff6d41315ea8fb17ca4731160afbe733349b6a34576e0089370243f1ee05c69ee6a4d2c10dd1e33ae372539cb447e3e7e5e82328da18886dbaa37c391d92777411f896c3e3cefa93994dd758b6ddc631762d591f9dabc75a5918ab6f843d87a3383b30aa48f88b2693ea7de5c7f778cd2d595c308bf786e689664556b6577e1989ffc736cad3f2d147cb0f49100964f384e170c9dee3dbfd2abb1171ee551319157ecfb22dfd2e0965f7c6470eddf9d3f2916a5f0a0b093636995db80f84e8fd4f642e05b66e731578e719de1e948ff41bee4e8aceb59eab963b1908bc3bb742a99de929364c32da2ae22a4089d19383fd3d1ab0b56c383bc172f5a2b3407b41102c5f46358629b74388416c23865b5368f4e2d57c9fedffac43258a79ff7f3600ec62438b2a3d2497aaf9171f3f438d177b5316fbe2e66ea7115fdd24daf04a5e18623557546ee3b682523b1655db68a31ca63fd521ce1d0a86464150645141e00e3a932dfa002eb7d6af2b72175fee19510a90c8cae378dbdb7d50aef34ae903cb709ef064a3c1390e75bb917419b21fcadc08d8cff5adb59e31ce7e8ddf2b420416263081498ad09a18371697e827b5356265e9cba4def7c78be006d4a435f940e9f130017cba296cbe0a40ef000c0961370b5afd36406a7eeae54168190b849c8bc80a78baa1d647722ab5b748502cf9aa7eff1f00771d78fc17bb5f3fd367b917b37bb28c1386d16e3a7755e5db1110065c4bb298cf7d4e27487a2d97a531367b31b79a72d9b6e34d9e07255decd632b3a9965d822aebf584fbe2c5edf0131782e1620c8bb695c6b3f172b2659136d9abf0bba1ff7ff414be6a5eee31758963e9246a98945ac92a7dc0255738ac33b7ca64df97de8f1450214610bf51ddb95b5ac05d72c6bd2a2dadeae9f539f7b337692f0db63924f579363f0340fe27d2604db14389adf6c626740f37515085287dd1e60be6639f2b253d28dd127459a75b349fb41e43d008e8eb293f2faec92b42c7a0133b4585bbb5c2dab1e75013b395ed471f52fb1ad9cedd15ab2209fde9a9eded5653e885dd578d329446d6ac95ce5974c054a3701655f59a6fa45b99f37b1407d900974581ec6825e4ebf062121820ac6fc0d0bcfa165eca40f8682bfa0103299319735101a01720c843724adf548c873430cd52dcdbd74263f4f8ce5aa4ea5c4e9ddadfa5a1d5e7322a16ff90e47303d02e44ad0740c9d3352eb7b5eb85e94721eb92a7b2818253f04e42422cae0f727500f9114a6a4355296a4b10ab43609f24a3c3a0290901936f15b58274d30145dd331eb4fc4144ee924b7e654b5359db3777dcccb1ca57d2b62bf09de06c2d81b342a13369047b909c8d34aae28853237525cf669427adffdce68c26c2834c1789355d3e70db4d412ed3654ca875cea0821049abf8fabfe5b89ab639ad984bd2088814c2e7bceb68d58419e466138e41ba0c245059c8e3973596e1ca1b0dad743940e6b0bc4f8005e2dae13eda355666ea9aa27e7d47a1973f6b6663ed05994cfd33f9a70b9d52b8ca1580156690fc45acd539f2297d58d14e9f904ef4fccd6f42de587fcdf243026b2a2b0400364722368ea28b55eeb061d0473a07014591c9929abcbd6cc7124ca6b62560025119c84b788a5dc1ebd9cccaa998686c53f48cf8bf377fb27ee45bfce514b4fda1bed0659d1b2d64c13eca2d741ed19cd69dd110e2dffea0fb2b47057f8240ad9a17b2c12b70dd42f33d879313d1d2d1b7bf084c93fad3a0798f3a94860d2a560605b1de079350c537dd943bf1fcb943b1eed4eb86b88e73eaa4835214808cf47b23105ee4eda0fe34f3d3f4c3518ed3edf538ec6cc3242d5090b0feb1f7d58d310e1c6368eb1c6a55adc9476cf2df7bf97a6fd5596d8d042d774b2a9c2d0ea2d2ccaa24bae9130e43ecbc48955e02e1a64db3e0902461269b750b8bbe6d4d787b27bfdfc18e0fed9258ea7a587be59865f5f001ecd600092ada6d109d4b17bcd13a43f16428d503bf4d8c2074ec5767f543e9d9ca71b3fce8b11a26138934893def2033e33b536227679641ac4ca33efb402d60f8064a769f6c832f1522c5bbc791943e03e5f8e8b3a95c891ef2250bfaf58aa034cd4d87e5e4d37a77ca446ae2afd22aab7e5a57c429820b208cb01b5e7cb3af8b6abec5efca14757c99d9e98f10014d07bb5277d52f234efdce9e9542acc7d2fcb3a9f9be57988c69444a60edd81d38fb214389628e0592ad344a6da91a0b89f83d82106d85b1d9c446e3da1e46ec33ca353f23ecbe779597a0661a10e900e42e5279b93f190081862f42a915395185fe41890ea0d17827ba1c021131a17c39f5bd8f09a6d786108184a36c1fc91e652480130b1d83c91d68ce6c5c748a12de5dd88a4e38c66aff4864b067bbebeb8e0052de16f0facdc129366a011600704b335fa345099a8031a2d5db3cb4f2aeb750538c239446804b1e35ca5c141a47f1d3f033d7f1fc8224ee5b91f76995d5e9ffd2e07ec5b3da21b0e8c4903cad3c11a186b488241bdb2bd058f6b0e5287bb7beb75b097c33e7b4c6e495465deb9804071f3538092a88e5fe2098dd61177d421b52b094da8446c01f801946073472a58cd0f4d6898b36d0d1409a254a6b432cb4714a834205d5087f88ba7397d239984b5fb51ac9dae97d17b0f9a0a6ac4dc76e8175fd5be65e9ef5a1ba707df02e28fcf2a49b1b4ed27d9eb627ee05f19249ebc5f4dc077445434f181784ae8e4fd4fa89fbcddaadc5d3fed7d3d31901377f80bf1d51a648cebdfa156ae1edfd74680b307324d560f8772bd100ed1bc6fe270c187b6246d150dfc0dd98c3b4dd08468b74f04379a594255cc383b9a662335983b638b3c30d90af69b14288c469e30f3d4485dab0c9944af780ecfad86eaba7b2b5190b4575a097729bb461976acf98922571dec6f8ee2d20a80349ce03f57e992b1c473397d6873896b66e2656b835e1a1d1f7c1b04813f45f8d1411c79689e22fdc07fcf809078a54e27e754a877b708e50b59922549ab7d3b8d433ba3c67ec0ba8b93642f81adc58e73cd8f235a7c4202657d6b25a1847a9d9da301e34dea43df6b131a13effb215032f3e7dc5af834adb6fe172aaf56465051d30e057fe282b3c8cba22396f5939bd5c936a43db6176457765e54bf57a3c5fb3dbfce2f14e7470e1f56b8b52c0cc71db8c70aca4c25dcc47656709fe5cec816ca72777c83389fddfee8a76c571e2f3cc0d1407e616559fe4a5890525138828b62c62833e8bc2c047f9d95d313c0883c2c628a581b6111baee0ae6f83a82d2eb97d06f777627d8448a0300828c7fa33f35f246d456ccae72d5a236d21e92f4b74dc7ad6358ac623cd68c2151c5ed7615d49b1d0b401a2b3c64b55427690dd411b382a547ccbaef684d92120fd6aa50eab07be9e39be6e4f5cc42be71d7ea20794f0ee3cd5a883c703210aa24b58097209627e403d0c6cd53a78f86fbd168d78c3c854b87f0473214d82df0bbf54bf8e9da8d86939335d38dfddcaeb5c61e841270ee0ef4ebf49304aa04a291f835d9f53318b468d2902acbc13c08be2dca0df1af833b9ff844648fd0f2185b7b93b3eaca3caff0ea1ef26929242948a9f38da3971c7263d0bf5c4c95496b39c9f99d0af2cc61ad8ee475dd4887f1fcf4af337cf88696196b33978b6a474230971c7d62ed147bedda4fc12a7e153268fc398e725925b1196ae5d442c60950b3f4a3e87b70393dbf9ae45110a4f1231efc7f84a384d8253dabe8135eb51369e9a4ec991b425071805041aeea34453613b4a479a470699c60be1c95ef5ec1084c69ad732573d70c1225c9013b63285b22404cdada7832f5e6406d536dc25dcbf4c88459e3683833b9115f9c4f99583d1c35bc1a3ba057f260b94a97aa88b79fd68ff230a2f61746ba584e95127d914868250381533f1b4309b41cd0478b54504cc96f5292c4c91d13d24218eea8253a3178f5f9656326aa12f904a5dde386efd8981cd0d567eb1377f969fe080dca66803fd2444bfe29afcb9458b8a4724be57b53cdb3205dfa13a5a706e0d0bc82bb0aa795fb30c1748d0cbdfa13b38bc748c525aff7d923a5f4927b6e45bce5cc06ecfa09c44677b91612f1a75837a25bd66f11f5f172b4fb2c98b4ffbd4ba43424c44435d0da0b090cc9d3546320c3f8364ee359baa34da7d8b1e2b589ab8b6ea8446c1a2e38fca28c673338eb6fec7b609e56000b523ed7b3541f85a62f6ea5ffa05d3546f03666283197cf75e94c274875879abbd042bf735843c2427fc639052451114f9c258a0b102e2848223206887a2a0d14ba51214c4567cb63a41036acc13ec0bbfff2ee26447c4543bcd65e8a466cb4e395123ab7868c2adc5c154d277341fe59ef3556d5847049154257eab6dd8414540b01bccb3ba4156913a91993bd51218db517849cfd5530eb34646065d015b6b547f28bfe417fe5319863b33b96741ea2d067957c162daf154c8c361152e8ac4ec376d06dc51f57972265eb8d9989938187af67c63748dd215e755f8c142d8c19cdda102acbfbacaa415855826da90eece2f8f131c8f122850da3f42d9c3bc92ef3f61d7510ced3c7de5ff8d636245e6cfc83dfb5ea19325f01a69f06f55653646f9a107ebf677c547ef8c127a76a754ca20b080108e3a4f6a49cd83da44eee71993e86aad19da1fc7a46e12cac54a1a2ab82b97e459aa82efd785ef8be36d052f8f0968b9a739da7db65408921005b6cf22a429ab7b54c44b58ffb0f5dc4e159efabe90d31baf54f7aff4fdcd5a999f62d7641fb9180590c770adf8b0de3a66fc1b807c9726611bd942b890ee1f508fd8bc3c0e5f044b6cdd54635c3e3f038a703e77fe86578b625b400f72b8c9d4e80e28819b1fa1fa6296089da1c0062b78a45b09c0022b42e6d6a969b8a766da3df031bb6483c702582efe7d17b5e63bdff70e82f8bc0fdedd9acf49eee8a20ee132461f8e29f11eb132338b31f2ceca457d8285a535bed2a5ef1d37d7cde9f8fad3532afdf6ea4b7191c8c28eb30605c9766efd249101684c60ff8659ac393b21cdbb82a14ec0c7da8db57cac273782bd398b28e2ddb445ff4225b3b749adcbffb0eb2dfa45ffe5290271e27268fc6ff529b5bdea603da8597d7859722e2da11434b3ef392a7d7355dfd34be7dcf4b1e92f6def5059ee9f8cc38121a7694aa02a4385340227dd4d4eed4f30657f306f75dcc948d737b19040a298a7100fbc653f7fbbedbfdcd4f9277edece663d8d5447b2f351240e74a340da75b069fb1fabbcca4db1a8cd397a1e75db6fd0d25bde3b88f3b0b7eaa9ca54baafefab8920b92eeff6c8dc2895fa4b7bf4dcd47966318f96393e4f64e944423c13e86a36e08e7faad2451ff2c2a780bac49f991b7257ab750f0724e2b8a699aec8555a617ab184e8d786e3cebbe9b9f7a61e699d6df1fd9c9488f07056765d082f8bb3ee8f8322158444c6cf5e550bf45402d14766458965894b6b49c0037d22f5faa4452dac8e6989bfbe26a7cd584b00fb7f68c908222663e79108382be83362a9a2818c7a9d25d031bc018a8583c1d1aee1e40c1082ad78739ed6dacfa33b2a7285810f7329068158c45caeed2f8623dd45e4d926e0b8accb18e4c8d36d406cd43cec5b505e7d145168feadfe35403829f59e9882229cd40c89e37c6e4bbe136e03bd853be3109eb24fd9652c8533a779c98bbd799394877abfc3ebc37550b726d9c333af775241e15929753ba83292a3c0f08f5bdd22b8a0f8494e1346a4e59cf2f7f7668ae11eb3c701a7050a532298c61237d76f06b4091d60fad390755ef53aaf9d7aeeb1275d02ea48b64bf7ede86577f498996aa8dce9cc2b0177617a0c79256cd154b39380d0d0817e6458eb168560c126b0fbc93308a77bb056fc385b5b8e10ef403eb0eba9bb6a2cf69613e5e7c9b4c61ada90f9047050d5c3cd99cb6a8a211e9c1af667a7a3cdfbeab23a151a3940111f358faf8e5e75965c31483eded8746a7300872aad5c92c1e82ab3f55f0c462e3a40c35e287cf5107e983167df4fec0e48547b0daf9761a0a54218ebe336c5dfc5b2b2bf4b50f03cfe5ae34b3149a8fe0201513545a63bb6824f7a2afb827a3987dfab945f5513c186f8be33e3667d0b8fe09cec712540c7a002bf637952699076c50cafb7d24b5ea2cefdea990098a6405b06d49c3f02d21fc38576b7763e6a55117e36a4f8eab7d0d9013dc93f24b1ad49b2941718dadd289d4af01628bf186ac4d21a5cb4150e0f0218b75a7f4252b2da3ed63e1210bc91ce0a87ca2b92083394c102e066abbc2cf57ae1bacc1b9796685b4b356ea8127b9f0f0fa8dbca57c97d5dbc44dcf3287dc8fa0f82590e31c0eba615e4a3d11876058274c6d25bed8e32da9633eddd612e6f3abc97cec3ed2a7a383aeffcd574862188ea1cbc45f5df53ed7b0de580c144c8d7d6a11c2c61586523785f2d95c2720cf00f2e093007472072a9f3bc1be04e49192eea350a03fc934427026caaf6faaed3415df479eb00ed91565003805d48918c8d91c831023e4655515757e9ccda348fbe1b61f21be70691bd66a3ab6e77eea6668c002d7ffdb9de554079bc87a7977b2a2af23d2a7fffac10bc7a314cce5ba0e9b78ae24218c2893375ba9c1a004f8688aacdf5cd589dddbbb6bde26a1d55c893379ec27240f7c85ea808c8cf6ad6d8d188e93d93604433cd7058b99f11edda8687db40ae15bcf2f15d2842287802b25fbb58b4b8f272b299fc91b9a3e7125e51da45896578ec460493482a908178a98753b0f96f3dfde39a9434293bbcfbd5b4b5d3ceea40f50e0d596ffefa22cd3e7dd3c1b4557066fabc09207a162aa8d962c4690e7e9a33cad96ace8e435fea8116a3c30d08aac4e3a1cb67b129280ed95e43223bb8bd5eca5a40d057d2915bb6996c88e7e213993366b08f9dbb2c847ebee6e4c476ec4492dfdef43df7b9f6b0768fc92f9dacf8979c2d47cbf9fc58e00873e78e7c24bee5d46b68add3bc0ba7b99b62630d2c6a1ae471134b547d619a4defdafac1cb87660b94905b05586bf2e6491c229766531cd72144f96d1d850520d4a7990fda15664cbb582607a32d23b95214ea5369c87bec908fb328b82c98c936a0368683e2ebdf48b5bd24e6e8239b133f1c415f344c1a6e3dca9f70edbc0f64ac4a5acc78bb8548f3e2a6af2dcc32ed55c2b08243d562b3cd3dc8d52bc4a23b776c2a8d049f76d34416e88fece49d36c87e5bf476c4aceefc39c9bd0cfab2680ec3a3b655ec6b26e0ef92052f51b83a619646b74ba3eba170a7f2679eab90627a6911ee2664589c55c72fd22d509d87b01dbd340447218ceaa5d6a860e32b13bbcfedb0c0e719c3043a27fe657fd505b532655db22761e61acd0381c4a28568945dcdc15e0c3b5b0c530f3464c3d021917561ab4024974ed7e3fd2ca33b6519080fc4966f3febd49b4d60d601ec20412d1f73c4239d159870e7760993e5c0cb6c19a48f81a73d82d7dc389f180983a29fb8566e5e45be30094a4c9c6c53bc2c610fa9ed9f7228a1d026d938866d44da860a059c1f3d4bea7a7855b335cb3fbecd2bfee2f10374206ea74396f8085b91092c0098145b5f437648604eaefce5629dce2f2d8bd0ccb39564ddc49c1b881dd73b945b72683f597acb6e0e796a584cdafddfea9a17f6250a37202ab665dd84660623606e1241d4f4bf3ec58de6b38b606c187cd12c18ed4dd2c0505c744e9eae7505448c7aa90916c8b95eb52be0e722c7844ad5993a3bbb5b57a31f54de0eeea3289924734adba7e0b142cc031e81789a2c75836a36249a843daafb894f9e96d4da60d8e708c473978a556cb578684c0adc97b46097e8b8cec6433a122da3b1f1f2d4c682ff81d89082fde03523d6df93888d02122be434298024856bdc43de9391ad088cd5f99d0eadc97a358eaab2e6116171cb09626f85a1298a9dcc5acfbb62f4b7b23f68a84c366652adf6e119a2410368b6458a812331072bd66fe22df7a2996d37a40b1ed08c56d1fd2a0e3b325182331c1b9088a71a5c50f58fb7a9fbe5d501e09bbe1f24cb35e2e7493f0cd6af406cfcf7e8ade550061e49503a3deb1aaf976b2e0a9abcfb0c9a09d1a7c2e445842e2aded0bad2bb8496ec8b2a97827d0f752f54cd170d578dcb019bb9f15d758d49523ebb1fbb7091b34e05544ae1821179d37fad12caf56e9bb4cf68b81d7479604ae679100c9ac88ca391cf62a53286909d7838881641d6186f7fac62704833dfbeee5709443b7a04647900b40ee3acd40b59e4c04f468a785adfa89f6d66bcb78e1ec7066a4b5ed83887f6dfd4951e218f3fcd4ad7f7e2d34137b84b2f777c43051b40f9b2fae138dcf0ca1740f7962fe90580a74548aa085449680f65a894515242fb0671ee1ea03dde1f24d723301f5dc549d97d72f8074e6114a66f691be62d204655f979ac319bb98bab4b009bd87880571dc487af100f23f77fe88611fa284ae077b012fa815e8d6ca666626883d411440f65785d5eef1e2c5bb854161d83e99ef331f302bd49962ab0d34cf00618c3972c6a674757eb95a14644469a1552c3f4242f43d35b138e24aaca3c6815d0e85fc345bff9194c38457c18e124f29279a40030551608785a1aa2a6feabd398ca31cb40857db05018211039998999ad03c051d4451dd34d1a586f9073eb21071f3dea23ddbe4fc56c5653d4850ed3404b9cfdf87734e97fba944671ddfbadd080b6a859e238f9a8918ad3ddb34f7ab16e5982955e830fe566120d6fe01c9f90cbb57e371ce7af8ffafacc1315c56d7d53ca98e54809eb4f586d03fed8247efbff009ce6daff89a7b15d47e229228cb8985efb004efd73c26acfc190db2a7d7883632ae9671ca423103420d88e9d1862faf1e8caf6da0f0fa7c7aa6254af714f990743f30fe920aa80edec785fe0679aa9bd9680109300abb5327ef3a423e3229588a4e7a5063e9499a6b78038bdde7b893c1a67cef82cad47397fd2178ce9a0a3733c3bff5b6ccca7524a9c555f302bfd37123596f8224e8b02304cf8916246405d395d0f24f5af28ce20dd7818f69a93ed151a3b8033bfc4872e007f469fa35549f1b93a28cd9575aacb750f4c75abbaf5f486f6466df313346710baa11b134097f34421151cf52c67c1e5b11f1fe46bdd3c051554ec773e39ebeba700650425b02cd55351aebc0b52d8565f6de263cbefdbf7e3f7d68a8e3138a21a21daf7e220c996610b5848076da9473cef30535cfe652122cd657a1f9e5dd265778b8b2382c33a7f4d83324885dc527f790b852a924e38b10d08a23fa56b58342f5c9a3f30aab015c1b236f02088246113da7ce1c23615e0654045611d027e0f894977f7b9d237342c4c930f14b44a1036c4b385c6e58b6a47a386361eac371acbb0bf435ca3a7eab56cdc2238e9724233b430c4a9a46c1bf271ad3e04301433299ba87e62c1a10c81921af7c3f4dde0ae49a858b7516933d4991f425984f15a65409c4554d7d1ebc813fb1b0e7524f5352490224a754157a9010c6f1fc6d661364ad9b7603804f1d711c89ee2d206f3e25c1e205a1d6829e71ecdaa0c62a942c90c37d144739084f3aa958ccf9e03967a0d21097de26e3d6b9d82a955a6c0422525d3981e6206770f0f875d3836884fc99492e4007ff5238ac3c390853cd5d29683bcac20e95b454b94fc61d3c5b75b148aed13af720db9178e14a06fcc1a61805f82dbe49851a2e52af2d3899743617874d4a41320b9d47bad21722294f2a5c0a2e96778b4fdbf5279c5c8ae29d6c2d01a6b2d6723a1e760e899798e958812139250ebbc21f8472519cb44452e6fedafc8c0f4b321b33d747eec5785169336d10b0fe2e434d7da0a82e6aa309ebc46f62572d436bce2520bef28d13aed146ef9cb21a030e9f882061c60ce2d9de410534a3e91be2c0864561bd163a8e8b853076f83ca4571a335c9daa9ae87e202b348e4ef75cae683d7e2dc692a0f16a83abc1330f5d8ae80360d1f4c2a8780788a2080c4d96d80489500f2fa6186e618099dffc8acf738c9bbbbd583f582a99b79f5bafbabc9caa85a8663c8fdfe92b9952e6599858799fc47313193e6fb0d46edb5683dfc538ec70d055b342a807927b0411576c4be9521f29da89ec97f84be5269b7f46172c137d98809875744f1ae436cfefa246e068556a7b9b0af7fc39ae2f30978865069c68f49ede241a4cec94906cbc466e6eb0a766394f8b983d361ef7236cc7fb3a15d6d46f0b7331949fb178f0cd608c15a0d8ed76e455a4d80bfe6c197295000b70deb8f170f6c4d88befc7d18844ad7d1c429bd9ad6764d09d864b166ca1bdbf5b9fb62c1ecf37f88e0ee4b1a239d24ec718a3272575d5b67fec496fd4736e374dbe4c92b4b9fb51e6f566388448712cf18ea9feb20500c35297fdaf67f9753b9caf672bd7777f44f8a5bb49f5d451eada6b335ec3fe31f1c11fd85dcaab4a624219c7a207cc2eb801bcb851a0136bd10d6739ccfc8f26365f885ec943e6bc56e3176c27c1fd29b59f3d780c30a583af1d3f6e0561d0691a49fcbedeef8c2158e27f55947c6840084bd1f35dc9fccd63bf7f15f1efae62e3ab340bb939c1f1c248dd1b74072c9c28513abb792820f3963d7a471bdf6312402a9178a9d0f0d5135f0e2b84b8ccd726c769c8a5ebc8658bbe3f024fa9c3c4c7a63cd4441329c5cc83dc876def213b11a0a13de9fb0e947a4130bf2da386c0ab3176720a039508c08398ec0c623c01b9250446697822eb661f850f9241696498c1c4b18691443d86e8f650417db2cdc6f9f8b86d2684c35c8debf52fe1869aba0e54464624226cd2153d54a722fab66dabfeb908d3cc49f00ec230105b3eede073d3308bf98fb0fcf5cb07bffecf8be85f287a4b306c0c1b119fdf638345f98ec52fb083717a08c282a53d93c35b4f4c059167246d256dbbf75f8b1f67cad3fdf08dd31f7d38e2e90fff68c437d32f59ac3ae626e3d9db0561d0b26b9a4b79ab12b52437816e2b84224fa15ba4769b992cad2fa4d53a5fc4c698b403e3869ea5ff3b7470e3951f15c638395b8d0bfaf620d2cab5e3a5844b0646245b397f4a98c0db0e4df0acb1e448a25dd8a59bf6417eb0115abf0acebb1043f38cef3aeb2ef6f635be19875bf12ae9bf7e4d7a3f5d7d1debdc0ef43fbe7f2e6f86e98c8352aa2aaa11246d7ffbafb427d2b9d2d2074c487f39d5796b26726abeedbf98094c606650f00123c82a417b3f4388077040db7ade7643bb10930c0a93840f05e1b766f417b673be27e5c89f319d9e7c847a21781d9de641cd9b69b74a816ce41153b115211362109a5d8890030717bdce624b3229aa896544bbe2b35ccd35749558c515573cd7a2e1eca77534fac134fd44473c443393932d5d5bbc056efcd44347e799b28871ea555e4f7fd4df283a133fe80c22f3d655578860057ccb65a883d188b1f3c930dbd4dc9ff172c082c1f89a8a6d913a6b6c548e66cfd8bcbc5cc1fa4c54e806317cf8a67d253d6b22001459f74c16eec459df36ce358857a3fb3bdd54254f8800900972b3a558415ff791c27ffab85d08d391db0866ee7dafd061b7c9b1bdaa8787b2854c71b09416fd2095561991bdbe963646bf3bd15ec33993d076ae6aaafe373c872719599a44fa1f870baaef844225915e69aa846a646f787ea99eaf9556adb4ebce36b2ba923cefb9239ed3fbce3c9a2097516c2834b46d8418cd61dbffad242603818adaeeaedeb38d1d7e176bb36d7dc6fb661023a0144d5fc2cec2d81395e3b0f52400fe7ab30741d2d32b358813abc8e402717cefb5e86e6c07ab2ed1730b8b25894b719be34ac3169a434b83af68a69f2d34249964c31c04b6c0825b5c9d172cc0b7cd59376b7c7ab830a789bd984cdd4ae6b640c89c799e2d37d16309e967b2b690287d660175f95804781d9d00c15171de14dab1dcd2b75aeff1e6cc5d071521c1f6316c88990a3b98c8a6415f147b94c805a3bfc5af1276f04daf26143c99b1954d209a24ef2fc252bd56c550cbbc6e0c1bf74f893e49113b0cda2239a48193ec6fb18474baf6fc0674c58c1e679a30f2b41d25134ebccdff192299e317e59a06a52133696f110cea00addb249071d63d04453220219acce731d25c04ab50f6e4c9d63c0390712451d51ef1a9205055b6e4f21488dc71fdc308a68e0a0e9f13044d18565fce0ac712ef4d9ff66eda011c8fdfbdd57470ea8bad36031255684cc31fb531e264933e089b4aa2f47e643c60258cf272f6179711d9ba18c12626d422e0c61de55476472d6e39dded9ba0b3ebf9232ac7ddbf0fd5d4053b905e290ef85edaa1c32d2763dc49e97114c054866565968215ae38a34ac3b912f01d958c9afd48e7461d00df4dd546fdf7b5b1fe2d006d451ffc887e50d3e9c50a7c83c0c31b9e55edfbcecd03a23197cfa85b75007f7ce92f82cc7b6517e117ba6552621acf718338257299f8020af27c13d045d82436fb747510d39d45140e9d14fa86e098cd10b76e8e0cdbc3a2afb3a640a505e30683d16b8f65c3e04431d694752f0e0f52445ca4b31e147df7fca6369557cae1e4a7f104b15db4a1e14dec55a9680c9293c366f3c56408adf3e4d340f012b27a1b57dd2c06faf987b73c526f30141ee9e823cb4251532405ea89d80c3a50492b824df285bfbb23449015ace6da8e3da2b599d8220613dce9e1f0604c62e2c564ce9409345eb8b60d4c7527a5426ac122fa74e623ef0ea3a3c206a816585bd20c4030017fb5774c9f32a5c05af5cc63edf99d6a0d983e515f68bc72afad45fdf301f6f50c0bfcee59a8c3b079e41f14902e01c4444f388dfb779dd2a9fa6c0cd83c3120478baacea6da4ca055839b3cd24d796267b4e79292954125606f491475516f24325539824607fce2c48abf2a78c03912437c6f5a2e246258be6aaf59ca4dd16e38c6219f8657874cc7d703b3777689c6d78d20bb6a4f1c61c171428bb1c86a2f76ab0c7f792df92ccbac194408aabb7f4de115c7be61dcaf35e567816e7ee0b172682901c30ce448ded1593e5b96748485309f663597bc43b95eecea7cb9fc95c28173d50ab11ff6d564a3185eacf07817620849dc76ae01e3252c8f94b4d7976e305712564c7d69a60fde0bc6e2309c47b33a1c8c56aea3388874ca3ee2e7dc238df6223a5558b14a717ef5482435d8bca6e54972d02bafc209e999e93763b96300690f005bc5e3d9e3b3b36d4ac6cc976fb20d6dc93ba5f386f0f36678c570bc1c6cfa25be8784151b047e80259eea4ccaeeccb5f6d4ced57550b68f7b8e3d0ee7f80046b5b96f56e29637c6dafbfce5c6fea1f2bae58ca9cd9df1da171e75c07eec62157ab8412337c50f1d082bcfe6f9cc8a6b6846b55214e94370df10aa14bd91581021ea5ed0fdc1bf94348e83f50fa416d9d6798740a8dc6f38fe3b217f70e676305cef58b525d7dcb66b352eac5447c11eea456faca2bba5c84607099fd81728748b9b88006ec43d213ddd32b1ba3a2d23e9523a225c98daff7c47e650cdba649d8adbbf5394546ae948bfb7d63a61139b5653972ff02470169018482194c8695c2d76f0a1a2d8e23e4176b0478681e922d5a52cb4c3a74eca3b537022c1379c621374468532aba951ce1234f75314bf7ffee5fbab0cb44d2c3e9b03f9c4e83868f4d29fa3e7a6ba617d23badd9a9e64792e0142923a57aaf35a60465add7ff107b62bef334bddc3a21502b2d542d91f28f5d3e1bb95668d42ff66c587b91552a283a7a17c1eb7d0ce17799553b673c989e732638d725fe04cdc3c07f650c2b74c7be582d1d0ac9c50a8b1eba1148f7b06e43edb5d6e8adcad63dd08e1ff0ed044a69e8f71881d148eebdae5d04174fee4778df8b169f2cc5ecebca77517171bebc691c426d6f9b1687bd3c210d0e21445fb28b8ee82335bfac6632a481dfa0ee43e817e1739ee411e500ccf132fe537c3cfd4cf0cc9afaa9e5279278213f1d2ce13f01df37da7eb23a7c2e1902972200be23c32879666c0a12375533c577f1f4da430812fcb5a6f9efa6e762583747d90a17f04fc71d9f85479ff687499ea425d9f96f80a899c835ff42bff5d8702154c8193657af3c2f34e65b4cbabc0905733e831a2258b22bfc48bf9eb89dcb4ce68ce68da63f524c9e025ade81a21ee4cf5d893e3a2b653c81646c2060114b4ba156510ec1bc6dc4e79e4a5213d44cc3cddbe9fc7a70421b86a6ec3a9cccfd4bb111a3ee409fa9cf1ff2e83c94d458717fda8b5839ece397f18964b90dc1409c2e15d19e3e773ed0ff70f27ac06cdf15a4d6ef6990481d0b2637727f9fa33bde3f3197d4052b8e8c9ec64669415305f3ae85b7897e553516353060f89ff1ab122d986774a34cbfa4ae32fa0173ed3581c9dfe0f2f4c329987c02deec0a3b34780e5896a17f1e85a79920958f5b84675f22c9385fb5d32d31b11ebaffecb7fc581373b0904b11d824fab8debccf112ec65ef3243195079c419e8187b82f04f1ecfa6c24b066ea4cf3cc7b51643cdcab2c35ccac0c2097b61edddf4f8b5cb85a9d167e47963e1bbf105cc60729f1920c0a025998f125ac597d3f3c7b2d68bf4ac7d0e4edf384793339918571e8001184c9af7dd85c08b51a92a657a02866bf5da41486645561c22cafddaecc118db5c929bd398bd768d53cc300e63bb0b6668b380863ca002f5099438b854e530677a27ebc726aebbbab5ba44655204d340aba52ad1dde9769c16c4c2a7a0c8b369be5ff17a789710bea106f09309acc46a290784fdb16e934753156a79b45bb4584b383ef48d85872b674a6514d74f16a7d34e5e8fccd822b4cb9394a0c00abc204ac23264cd6667f22e463dd00fe2b724f2a6994666d1951119b24741c830bc2d945280345b97596576a675f82878d894be4a44e65a6cc285b3c907bf22a6b95e3a73a0c863cca5772a8783689afc3cbd3208c066375ea59d5e62478947f4b1128e7c18c52a32782a8c56e2e52b2df4e0df3dc8d164d462bb1083dd8550233b1735a2549e74def308c4a8b2df6761fed5142a8f78e6325118c6b8461a6053ce1b2899f932e4a737323dcc5be18b1c85113299bbd9a2923175023b1f1a635a2f857019608bf98443c3739d06f44fc417d8c2c7b8cb7afccbc372ce3a3a6106456ee63eb0c32199b95ecd59c3d4edaea05a52558b7bf82f821244b8b4c132e09aca8c871fefc40e6191522ea736e97f1fab3f14eb49a606b06d4bd53892e04e38477b839cc6ecac4747fd8f6d9233051c832e6b114ab142e217aa57e1e8f7675bf3b0561b3835e78406444d2a7765b21afdb3429980a4001c100015e4c456635aa2218f4865757f15970e9f6894ea4b1dbd128fee91c8b551962a166f01f84e139cc7d3ff7a6fb4ee6ec8d62f18d52675c0138a5b58e12241fa6af85041547183bb168c1b9600908c258977dfa0f2668c24db14e7fa3025fee064c6b7bc1b2861da6dc57d6f00ebcfa940ad26cabae3da85e7bedb14edc15131d7d1f0420a273a96bc458cb5e3b0c8e115af717010b9dfa3ad1634227e005fd987681cbe78e15fd94407a6093d6519caa67b7fb2b3b55f883068fb1d771d60a05ebea961b8a3c116d871cd7642d5b96ea6427f48042d7cf01229fe58dd4ad2a0dd48ea7c2ecb12244609d39514f461d4061b95c1ca799864db16621681cb7e6bf412cf4d93fc9b387b1eadea5dc1665faf1c4892e4e179fe8d255cc3b455636ac5e4a97f68e2453e6a3ced50ab8ad44a8029794466d0affef7a4c20bcc93f2e9f6ac4ad2a7d3797774ab88f0d7071cd0db4f8c1d5bf24d5debaa211cce654f1a73253099057b285daceeeb1069a48b4d9066d7fd4a8f2247cb57babdfcac56917c50903f2250f13921d8b74d595ee07f0c92b5fe55adf3b4d685db3e3407ea1b4b96e75f9ac96d61031ca2888811623d9ae46fb43aa4da557a717446ab0b9c5dd2e9000b78d541fdc97fe110caa68f2ba8d87eaad597cefa6629b825194b1749b8433230b92fdebbd055b2f3bae58c63661f7ea9926161fc05af22be658d0b45cb1ce43ad7c9113347a4c3841eae9412a5a44e08f54a620275338b7349e15238f3abdd1bb1f5751273aa3da463286191ad5748b8638105b169e0d1c35533b5d536dc192f10552e68d17b0d302022766e68fc324a8abc2de3a5eaca2c44bcb8f63759881da7e14caf43c33daf3712857741a9fc7db16a5714d2d7d9e2060f3bd2883a5724d32cdfdc44eca0eebe127b1d82a85b290ef8a1067e0eccff4070340b6c583667a80cddbe76472139bb2db30d918bde91f2f926df6aec97c212a514ebd291f7f1c21eef62ad0cbb57bc47ffab22f025c612dd7d4af319ec1a979e096339667543c45c169c3c721cab6e86650a59c9f6354a931f6aa1106a75b11750b241ea452ca2121265df4823c6c0ac3aefb6b2fe468453100500611ed39874f5411bc41ee42cd607f76825d1c1a7fc299b3416f43b7a57c5c5e80dc7c61bd85a3817f7e681b87319c358389e0dc71f13e75a81aedef05baf886708d9a7e0eeabb807e26e440d61b7e51d38af37d47a614b52dc712599519ece0cb59e4e2e0ed632cda3a551bba41acbdf7415c0fe1f392ad7906ada67a256e4f37de009371c7914dd0390ef52568fac3a1937d6a1c0de209f855c45a30e033873b40635543bc03dc573c05fb4cbde16e7feee424fd0fc215fa00954286fd933ca6a3bdf9251914d1e2e47f6c8820f608acf6c4088559c1b5e8101fb751e2ae801e623be0cefdae3e7629946a537eb3a9e27c3c6b871350116c0922bcf827eecbd87af316cd21d5e9fa6c3231c4ea4767531b2ff20928422fd4f0b23fe74979f07078cf29caeeb6b3eff8e0bde8653f9d3266f926e4a6e6ddf0ea1ebae3c3a8fc8072fd58e6f8ecc671ea394ec74fc9fff7415faf69dfb80d7eddf4563f57782e1b32082569b1658e74c722f2959d39e4fe8bba299c1eccebd742184946a82e8374364d0ab6bdffa36395d443b29f2c72a0e154eaffaaa43de072e0899c31d6990e40f7e727a4473d10bb10ee3a2ab9f29663b11b0bd47836587e428942784339632ae39c32e995b2b718d8df04ef7d7af4141d369684603501ed0d2ed4022c5a869436cbd5b9825ccfa989030088e52a2ed1e2c85bef66650081653224e3adb93260e37564a6e33110f8aa605956f7b428f97ac145c8a69727fc580e38e2b0203705d50364483b04acd6f3ba0d83fcdd8e183a88d19b43863555d9e0d6e678483865651fb05e96b6e3b8f0f82b6f1b3c847d4aa95bffeb3d697764a320b821b0d8ec157e6b2b25d7c80970c098e98b2a27628b98f633ed63bfc59034b96a4ad39dc5a11aa24e2c34c92084f4225ee4f2ba9fbc0812dc9529726321784a0dc1e301c6e0690f374fdba515d58707122d882df75d9ef6aed55281e959f746391c760648206004568addc24b3786df103939e82d656d8677fb6006e21cd657937f8cbcbc87f8cecdbdf3bce054faa493f1e6c86420e2e0e60d00b9edd25cca7d58fdaa723fd617e1bdb829983d9cd5d638e855aa4a6094ec1387c5198cb29e5c0561fb329993ddad2238d9c3bc833ce59f8ea3eeac7998a8f41f93a34309dcd11ac1f9a4e775fcc5ea8199a2b2326175c4caac2fdc0c6bb067c74751e21396d9a2438047f4d9331625b634c8977c6d2299811bfb5481203cba15dd7393057de75ca99015e0968a9005ec8fd4532189e5950d2fc4360aa0d6078bc4071bb584491fcf21e8bcc3e7f05f937365b5b2278264666bec3f415ac4c0c91d613caa77bef80f6ec7bd44c65f3b6e358daca225c56db98d06c11ec35cfb5691431f45a5511c8f36ae6b671e71059d766a94802ba339b9aecd834a8a86dc06e525eed4d571acd48dab3e0552673a607fdab5f0e6224a176baef9a14e842fdca753092d913463d56f8d54aa3fa66c0e535911283f90ac0a341db8ae700f6fc4ed966d64e760dea60d3b0918468e2c4e3a824394316f2d53a1fd7331d63d25676b78e459b00b71d96340dd261d3cc9c67fa1ac9a4288e3e5b6764bb2a5ec5e59a40a86d7fa0cd257aa7dd5e376979429930103070d06560f05080303e300f0208e3caf3ce4eeca6424da58e7139dce51072601aec5887e6dab370ccdf0c50c0c81ea78f36ed327f3b2025b409591d21746450a52d1d1d5955189628951329872f9a48a60b58846bbeaecda9ec36ec2c7b501ec7c14ef3812a4937177bed72d3520e957e1f884714b32e95fbe438bf7d653c16b4647520aa6bf45b9cc25651d28fbda07b1def07b5738067284f8898e4d185ff9f318b36699b9096426c41a4693ce86edd0b49c67d41eaadd44de043c677f6389ea4b548d7e398aac02b120b77dba3a5edfd5a83c6a2d5029e9dfdc323c1d16bfd2b83f527a28f51224cabaded41cf2d93d38894683d2735915a3545496dbd0dd15fa7b273b49395fd7f307cb16ad515c7f2e8b9cfcb2739ae63753080416d10fe3fda3fc1726c2c4f77b4fe9c99c8ea459ba583ac9712dec1dcde957bc2b4c063d1a1317e176454fc32b7e8bee34656cf8a7884786f00fa713a0d7f7b62ab1f67f79a1906cff0c99f9d0e06bc01f0445c2f34a67d7b371e3201c087aa5b97d11de3ab542c80728853ab4bce4e23dd7654bdc3a3d0a37b4d7c9bbe647d05c4ad5d34c61b94eb949b1ef077ee5a98be96dbce04b57de196b8a6c9e1bedd926929430053ebb396d5814c64ebf0f6c0ac8e2dcb6be40581b83c94c27c6f7e0a6b01e47fb29ea5f8d63c7a56a1daa4efb651fa8e0d26ec743226301aed84c45c570907df7965c98d0d3df3b309a6811995cb35ea229864ebdc0dfa3d8c296f73c0654c35e5a4683146a0dbc5acb4eaa864fb8a6e74460fa7334996b0db4a55075132e0d34370b7cea75bd68d9282b5b280bae27b987e4e716da898caa3a45ab237d3c698d8498bca71453e79194069deb8398d0f389c37cd5bfa07b2a5b27333174a8b5fcaaa5d73c2e8076da713c249bcf44f4dd7ca423c9df2a236f28c11d3a33913ccf53948daee451d2cb5a9ecf9ab1c1139bddc7a68265cda28d5a1f9d32909999d967b6a8df607387ff5a3145d6988c9092e9eb3bf6aebc065faa7f0c7ab25380486799ca144c7d1a8bcae7d8da0554d89616c4b796e0a660054e219341d60cbfee711e1c8fb5e9d2b8c3e8649a403ae6ffad5e76f900a8a1020ed4cb7efb3a9aef84ac6dc67241dd357f51b274bb36c6075abace88302dcf9ceabee6f7ab58f3f9ef17d2888b5cef20a6935d2d951104f2f190664e91fe2cf61879a86e081b2d0ce07cc402066ab406149f259694dc34901617d480e3748175a68c6eb408abd50b0646162afb80cc6006e223426a6a6f6f0052a5f7a3cc3082b0a327a43288632033ef023ba9a9c97128c36c0c3decc935b659d673e997d701d70f74e2282158504cd1c9962613d7f3ec145524e45b88cec381e0590f2d5d4cb813c6a87230c121fbf1d177caead15f49896167fdaf02e681b5f3a7816a9f0ae47ec8be351d4e98bfd9fd902980033da94ab4d8333201fdd5c802faa64e0c463d6e9500781984ee70df7bcaa07c321ac6ae24d1b8744220c2a4650e9a4589a2828236b9e1bf52679ec7f7ce2713ef44b47fd4535e585c16453b69587f69004d92f5068e87839233c4cc740fc146c412e3126075b7bda5940dde49897054d5eb74051f1c09cb94da2a3c75dcf5db7135d84e9ba25d1937a21939701bb687bc3b65112094e9a93d8ec5679a26291b482f5b3d7107d2858a1b7d3cd29ae721085023da12fc4b36d29b165c3155bc0fe7a5d523d791fd3167fa56117735627648438971b151213ac8bddb7d6346ad3c7abcc7fe9298552f66109ab2d6c65d148fbed166100b5a937f1ea5f9d88eec0c1c4cbf40b810c3c6872bed4137766263bb51c45c12cf68586356ffc31d0231ebdaea945219861e2fdbc49730b88ce4c7dfc01642365d8323258168616b85ffd689123c4b862ea9c9a6e3b8c0eb55fdb9c2a97014df74aa032943ea282e5f7f39200bcba900b0e3937935c95820644748851ae3c1d7f1efaaaac2f0515b93a36611008576b8e20e1c30575bef00987211fb088028e74af763c869056b9e9ba7f09d3e81a5534ac3ab56c5cf7964a559d250467871b5c50071c8b4bed4298ea704193dadce96e77918a30e3b677e8ddecf899145d51b1e3e7e041e1741d4ccbe62b918f916b067b3ee47e257f002a7ca51022008e97a50a1e241f2a42893e9255e024768ec71b17ba5f8c73a09f6205983a7dbaf60ed9cca424a97cc3b47de0589221e08db60562e701eeac0957d25a19e024ecb7e019082fe2e63b83aa40dda8520e913600777aafbc063247c75cd9d7d32716956a0e12050c8ac25bc7cfa04cc6da9398aa66fffdbb1205a96115491de1b1730f602ef4011bdc9e25ee832f95bb7ec7493a23bdf62497118a25672962e13294e8d641291d49422184cd213ec2fb352cc99495999eea2ffd4b187f437a9547e3e806d368743dec81d664cfb766eb9bbb9674f28092cb84d78a0b727e328d95c0c5ddb638d3bbfb0e17bd3f1d6d646db83aecbbe9b082a457ed10e42fb0821879701ec5ff7bb978a8af2bcb875f69c787a2c935747f5f6fca47f5ac33e5db7a2174d9026314e3d3a147b42fd3d76ea837adf4bbb267e3963999dfddabe475eaaff0854b2948fbfc5956f2dd09d794bd2bd89d537a51433a6f51cbf8c0ce433b750855ca9473e56891bda545175d690da8d6327e08f4197418188ae188289b7e883e47828176220b4724c564cd06103cb1255954764b7997636f428df11e74d6be270b88f70317c82c23ffd1e7bb8b974443605daf066010d3c637421150ea232d2cadbab7753fea25932319f605f75c08b35d659209b1c50aa4079d2968eea94f95f6afcb560fb0a17396bf8b7af95456542b84c55258d77f08e6217a998d949c5485f923852575ffb86cc8d987b3b8fafa44c806de1ff42fe608dd0b50a36144585ce789224e0da24ad0a2f146c4253e8a1bf4198d8ed225e177ccaa30b7ba77bbc1c9377ce5dcb086b66a97c3f8a402261149d9586c29ce1a5b8eb64eb257c0a107977dd2bb2d56f076c402799c5da2cf4e4cb51408b3d6a9bae40ce0978a63fc369860b8907ba5e7e5adaa1438e5f7e86d35d11833379c1e739f94edf8cec7d7a14f900555a21e8ea75a310f5d398d4b8793ad3393f27a2d64d87f6fa82002ef1f45b3e38784d3bc2a335151fabae7c6276baddf6d3456caffa37d9fedffbd23908eb0332ac315551fb2a96c102efecd5c773039d2784dd04c6515cbafa826d1f7556fd87d66e7ed1c2f9dc06cf84cbf225d89536882f65e9fa77995a9cc8fbbcda961ba0cf98c2e85b9643aa99de87b0d072f1e3fbdfbde7a55b87489bb1d815df7eb187f9c6a79ed4b483a17d8a38a1f82d62e90b95cf146a6a5d64debc5ef234876caefb614fb7100e47f02207326a16f063642de327e2a54b5bdf86a3193d106467b1760fe59704be1ac825b3a206ec7d34caeb0d0df562f44e7f5304eaf7dfe59167b78c5583e50dc22296256a6073f06740d7843ce222638510fef2da81548aa668bd73870a6b36f82c3bb239b1c1880ce9781180320da10637720c84f7948cc9e817669695b79fca0e5bbc5e02feb6cffe5cb42f0c5688f1e6ac93f44660761babae5ce689e8f2bf2f9f5b79bd24b16ab6d2da262d22667774615635a5710167a5b28ab87132e066281dab661a787b131ca05edadeac06f8101756778f18a88087a32ac63ab884d33126cc82c3842e875b3a55116517ef3c617168ba4df591fd839614f0f35aa0c8bb26a17d095a4e3e3444aadd1c9dabcd26280968c26ca6b7d19c5e034ad08216c823874adca492c4609a6d574cfa6cd30c980c7d3224caddbd16eed10328ec5cb7e096705deea0c77f93beedbb807e82206236f8faa2c50c944263fc347308210b108af6acedf94cdd4370d595272c61a6c80cf1f4a31176caaf56929391e423998a9eef64d004598084c61d909c97922dc2b511720386b26090f4e482d2426213c6d71ac615ed84b97532fb043cda41a5b427f4fc68ad77510f7f34e1ed8b78f298681d6ef483498d1be1de4b5469e2f17b9f57409d720a8386634a78672718f9b64615775e59e2240192bcf838aac2629f0fddd320d42df319d50447ae5d45d89d50cd4d5d895fd7faea6e21b8630cb5fdc90e51bef8cd4554fa572757969927d0a3c632d0a43a41cedd4ba8191d67646195166d5137fcee133f6c7a61424d494a0cae17b7e747eea0b95caed0450be900f8a9d5bfc1a415394a5135e6f9006ee3e0eab36dcb703b289e8508256b49563016e2d8b249e858a721cc2c16ab0add457ce81e3bcda82234a6a21a37cc315b5b41574db8ed72768e125e85775d8a3bb22fe135a5b3cb62ce611ef77f3c132d2878b84769048d9a323cef7ec9a759fc1dcf81c12ef74389a1715dff4cc404085c798756c4ec4ff1fb6f93366f40f1e0d2b60226145124878882106e792cec6090d1fe52c9ab7523eee3936230ce38043bd82984077236f31895c82acfa36219d1bf784a380981470e80a6f0a6485cba4129248c17f4bec2ace093c73836c1662b21ee5c4b333a70072f91d5f43d40c6bd4c5a232800146488112245a0eeee3a68d5405c84bae8ecc8b795cb7d535efbb29709ca8e1ae0915e149547edc74d56f197e5f6fad870c13fa52a6b30ddfc118d2274b1138d126c60b19ec35b29cf121d1fbb1eb18457053e2801fa0cfb4ee107abcde6cef0d2464e4c76959dc9139295564d77b54e2c7216c96c43373a7bda8abe12e85881efa71d4f1bb1c1de190011871c945c79dc7662e0091117b9deae9d25ef997a583aefc1e84f0a865f7d4ae8b37585a47f8de6423d83bd7c1753709c5b877ed05c5b1055cd8a3f61768a225f8f6787cb33e01c517b5721c03a55dc7c075174b8a7dbaea5beacc53c00a8e97858ddcdc10ef41a6166f10a88befc39029fcb9454ab821ac95440a76c9c1b9d3acec7a0c7e94fc100b6318f2eb227667fd8c87949e5c74d7c573517c4a9f06025026f5b3655627690afad0e4d9afe53b4059eeeb89544939c78d865c3919b1a66c3c3c1e45149d5bcb8c7065671d1aa9dbcc1b1cf6b068d9e700e7dab2b6b3d686aaf830f4806a106bd1b3d6a10d5f590de83fc4ca90b3f35e8393cd25bd24c3bef1066eed8e07cecd9c8e2491e6d917dd4e7fdb0c911a6510d6829e10335852adc7d70cf17c8f3828e813a81ed70c68b3255e69439190e66627f6a5ed65930f2841741a0431335881ad05542cfc10f7849b0e48aa8f95465ed9bb3941cccf71cf1fc870fd4995871fc595ef5435ff6437c94de2c06a0edec72c38021f7a0ca4f3153054132453d8cc10903c483e05e26a704a171d029969fe0de8b05915372b78672caed241baaa1bcf67574cf7fd7cf291e48d4e174b00e721465cb46213b77f82a2067973187ed545f32830de043d06a0f523b82c127cbd301111121fb376faea5ad02740dc769c0de6d1cb45fc1bc4395b3c2d6a104eec7825004c2f895814b9aca57d451fa977771bed7a6c6d64eaff808367bf71943f822534145295d21c70bbe7aa6da59a04fdb656e59239308c2ebdee471ab8604011712f423f19922a841ca163acab656f1cf6dfd931aa48eecacce1cd71d95614ad8dc27693156bae5b749e60d0c36f718ebd972a4d54b809a6906a6199c909d8866c2727778b4df7716a3cf565722773f98f198dcd320a2814c4bd555834251e0385dec80fa596a07b7e4f8d60ce50eea57bebb9d64434e34fc48e72e30b1e5d79b0b3ee505301aa3e061cf7cda39afffddef0759c454f728238752d751c579dcdc8ea1df749d1cb0a8854bd4509ad8d368cd0ae66beb0416aa273d97ea3d13c0039ef29455c9d7fbb2a5d0b2366b55b666ab14eed7f211fa003b4b42407e80d4af3778f59eddca4606fff922ca771ce0b97c7b38a91c1b3d759d7f5dc4e382089bb0a1bda99d53cbc920de578c3a052d101fac814280719729ebe59a28db8e5192332515ec70b0c9ad6a3b9441d85b29138c30a76f89bc6ecb1e6c1d64e043d4f4ad233b42f74ecbfa43d27e8f703883e2ef32f84a5b00fb567e3370585020a6cef52a806a85875afc3da81ec56acdca5e114a420f9dc008fa0e833b5cafa08ba49b166c594bb4874498e7caad75a98b649d9cf2863fa69b55090699e5b2a961d0953851aa44c1f7a5bb2a85d1e6de873996c141718d1a04edeaff3e24a7013b23cd1cfa84b1434944809413ffc48090d4ec67716f781ce3ef75791272a5e1940b3f24c155b71aef770a2aa80eb2c3d28859a949f98786ca9fb2a415d9f4470bdeeabb3db4e5c4b4625fecf69017eeebf910a8ce299405e71a918ca7ee5d20e75e57147cfaa1196997bd829c53872e4af3d556bb904d94862492d4ed6add942ada04da6364a4b4cb14f9381e2f731fa0514157bcbdc80a9e0a57fd9d83f0e10a2e6cc689c4244d567c65630d2318ea7bd6e44502a8d9888aeaf3741098648dfb16ae86b015b3d24ee3c37151f414e4fd657b2d59156a9bc3a3ef02f6ce72ab7e6a9faa775e946380f96c0b45f104829d0ef1cb3734e24b9c61b1ac0784b696c34a5dcc09083d87b7112df63d4e51e29cab01d1bf6aed353cc36caa6dadd2c5c72651cfa783523c812542a701bc9ffde80c4774667d5ee99c1caf65d6ded4542694736ab634413a4e586fd31b63682eb48bcfd8391673ac98d9af7a564bef6935e1a8e2f42237fc1783e5dfe30a883018c10d0482b32b3cf19741a6cb92b98870c8c1f727a98879964d4b4445148cdbdf57d1263b34f2f945c64603c44510328b9d6ec6810a876d2d8f5b3d8593ecac1a7652d59a564c9adac18967f76b0a8dbb5b3e2a909ce34231e97185791f843ba663dcacb308a52c7b0bf5c4b96832d8446a2dbcde474f20398b5175a661e119ef39216967c7a36ccca5a3dd1ccabec5750b6ac911a288a5f363e9c523373ebd1aae29cf8b5783965f6a47de234658dca9adb356a73c2af27482cfa8c7cc48665abbb2f7ce9cfbc0fa93a14c47f79cbf909e68f45df7d38f912a70a686b12be7be1636e3e0187370f26b4a307b495837b8c93ece99ab5ccc65833db262779e6175295e4a30372815025912129e71abab97aff13b8fe3ff6ee61ae5c07928fef4d072cfaa6095c9cf05653b796f300ccd832c90f88eaf7dbf1d2f482c2c347c3c13f4953a60ab1f8015b1d4342b27949399cd4dbb8926533164df6bbd3934c4cb4247a7e33229edc41d9e552ceece9122776363a9d933e447c0e8681d6dbf4de2c9f8342899241fd71e143e2128c846785869a10993a6823e86557e024b938fade44af7f74e58c4cd594a584cc66d53afd5b016cdb99879a64393b720caef7e9a5f137d3b8662917f53f01cfee3fd56a2ed8d88adf84f21ab357a28bd95de335be81d4a3f35ddb5042335e01a72029b36fe1108036558ba2d4c8fa63ad7dc0d117f8f76a8a6af553021581b64d09b8960c5d7469a06980f756af23eeb1a250d4cbf6d72c65b2018398ccb049209d79ddd177a6bff7a06357888fe960957b288766215c27ec086264412b060f69c9f8979c4f70dca496cc36f5643922b733bf585135c44682d2f0127b31db4d8ca4cea9297b0733ffc980ab0313d3da79508adb504b9266e2c2c03cc3da4775683f7f28857023d66dab9517c2b7e7eb527509f6b0c736f5ada2df346ed3448f20a8418ac4d268bc5f8e495dee61c47546de2ede423c2bd7ad41320bf6ab750b513755e6d6ab2fb316eccbf06b98acd98cb434baf5cdc2873212a8772708a6a160e067561a1de8fb11abc7711c7d351b1d321a13830876eb8815101463665c6f6398ab730f684ce7862929eb1ba4000889b328c1ab69c174291f269107094393749c54b8b850cf63ea46cbd5b53b07998c0e06903df288329bec1a46567841fef4e690505788ef14978a9275d524c64f571305f52e52af951c6e33ffd22a161f21e8d7f1be78e66ef26d94c68538d87b91ebc4c1b2cff9400efd5face41bf30deb819e1b793007ed5e530a566507cd28f4dd023012397deba4c0ec20fb11cb50ab73b9c15998768ac73354c0ceb1a0e09d6387463edd1d02c64f030a347eac5fbdf8429a587581aa0b28f761fe883a7568395b84bfd02450c39c87d08e9cd3980cef9696cddd9e9fc43d623dbe2bf205a02cb75856a0430474d97456d6647aec2ddd617dbc55fb8349c8742bd9c31629535ad5fb289788e585a67e65713f4d3a42afebc8f3d0662ed9fa1a617403b1581e9e27891f67c17f54f004ce01f4b3b91166a89f388cf0306bd86c4fb76b6baf1933644e6d8c5db6a8b34453f177857dc350d7bc907c4573fb7bcd298addd5bf778868c87591832eed35c5e0085f208ad44ce9d7078f7dc1ea82380a6fa92030b0c1ac3021405be0d4b0a84b7658ab53dcc325cf117975c7ecb455dd9eabc853d439952f1e39ddd7770f4440f27ccfd2eb8721f13a06f378d0f9e4e8e3c3df5827217c4a3be9e7a2bad439c8173ecf7b0d02b6b3613b159b26ae0cf30c0949090c0116aad063917457332bb06548b5b03a879d556117bbc2d59eb188e9d81b363e099db7cd2822ba595b2d5a6cab1e74e54b0aeaa83ec41285d657346a6934d21ccb81c95437b2f22a0720761ae2130659151c6655d3743e6baac0d1c7cd78f46b834c39f052ca5fdbceb657230500b923d0b2f5e00bfb3c733f225270940d797e7cb58b0ad0c872dbf06a7ef16979300c3a642564f2a5cb188d4c59e31cd148ab09167528f820681f97ed9696090e80606e86a16aef6b032c8c2ae923f40b0d0a93cd7a7bb68044b06c6d4c6c66cd8d3dd04ba5f36289b7bb22ffff7c75667658e13a302dca718fb06136e5289a9817010e3cb93f2d6908e096e62ef49584db28531af4356612ea7d10aa87263061272baa9a28657358eb3bdaf439ac3c790a4a02222e4e49d0df0e1ad6cbdef410160d56d232d2834c37f47ce82660a9a5a7e7a90f0e9c4e59150d81e24dab0068385bb08f733798c08c503ef3aed043b8c2b9c90d2b608d3fa98d972b34cd5b19976fd37ff904488c5ba43a158fe9afc61de349eef0b733d1c024b26db17f6f843a350100dc7aaea0e8dcb36091c606e3a89f0961f15e89852d0bbd188a5dd01f2c888a2748cb55cf5d470f42e59a9b2d70102663f93cabec69215487217dcf6e751386eb29ccc8530e5f68d66defd7515f26ea9dcb59f58aa2e952a38ab2d0fbff57321f7292abad74d3935d58b5994adc2aaaca696afd052df0092e714cbdc7c83c02915d35110a2b2c2d6e26165cfc8fc7f9865014c7a3f8cc6feca80f13f3dce51af269f8af9bbe4c269bc2aa4835ae85087f9f5908c77be89d6643fb69e73d49696bc131af62ee38e363f8eab511f07dbf4c51b45737a1b9e5b1f2e2bf4cdd5bfe5e08c2f117fd8c6ed1a5f386728152675447e338c0a3100bd900ff9a721cfb9d0b2af4ebac691d3b12fbeae6093b5e42bc5d4f6b010789cf9f5bb9dd5bd9cef78a12d6c27b21cdf0777332dd07dcb6c1d94aa0e9fb1d0e1f1d804c0d32e569a388d277a74227f692aac6ac3acae3d854e2fdec64c002c048dcf2cbbfc30bda26e036fc14f7d8e628fce6a5614d62ad28b76dee9f935a1f64b39dd3074eb0a5d3a6c528e57a1a86ae49691b67746232391d1bd2a6456d0dfe8e78a337aa71c157228492814e9655d61de55fc3bcf4a9672c3cccf01cbefc90b8c330b317b005955516b2b29fd462181eab85ea43f9789df7f111ec5643a842a68fb7d892cbad8726fca69047ef65cf17e080277e9d8ce20ec9c00c2bbb9fb8ffe70a2529656d473f435582b4f44a77b83e02066fa412c6ea0c047cc44a46cd0ffbc263961b97c048820d5d02c80ae91d5cfc82d5eedaf49fbe69321239c5b0f8018491644a388636983eefd55fbed620326df9195742340e8b0101abc12b8b42a6ad04d340ecccf58668c453f9788174fabba83bd09bbaf4d850197eca4231c34a5c62c0624c59ced8ee03dd4da5f1e062ec81ee7c56a86690671aa5980ad5e93c3cde9b3bd27d965ffe2d289c79f7db355c3a3ce5276fe6661036590ed69fcf956ff589c8d250a15609d23ec2db7eac06f3cbda881beade8cb7ff02833707fa8ff60c1f5783b8508d249f7033bd6a9f566324c445fbbeac9727e38c3f6a5b13fbddccf8baa37cf5952890cb77b3b279c3039ef6365cf70615fe3b1e5c17c3e0890102e0281c6a5ab3a857bf62e60aa0dcb972382d197f4521e1a3e6ab4f4c0b9110b237fe0a6ac2e3364b7351acf6ddee92bf81631f0231afe1b4f7d05aec9c60cafea87b06f83fe2aee47b71ed0367e090a22838ddc07b9a3f2952254e20ff463ddd61c7d0ba88b0455d7128b83c06075b6457b1f6d77b1f230c2f8f273fa7fcbc3b6ff7bc8ca5f000d29511cace62395cd363e6677b3e8404c887eb5185e2da883bd38c40b661754ddc4f0469f615f591659d18dfb358ed6720720895a0808e49b0b5aeab193d011a345c31e818b324d43024cb5e91d22c1eeb5818bb4e0accfbbb4de4ab933c9fbea805c2b7b31cbd5c88c83ee8033111a9040129cded3be3995c11495e9af165d5e35af6b97369713d0146e78f981c6cd977834cb973b51371a909e581eade88c4f887b7e46b61a4f50d61849645e4c3fc854b1914c7671363cf12e13d163cddf7802b4f83050717347fff7e6b31a8f96a382d7ec2f789de9d37553835da9af8ef4efa1c5763693bd10506515343099fa1ce5709b12757f990cd0716edf581c94fc299f367396e2b20afe57bf6c43b12407ae87c52d8ed236cc75c1866c7cd1887917d68df7fbb646f82c728a9e8c37004038c965861381eea3900d7f48670079994c9350d4b2d95c1ffbc5bdbbfbaf5a34054b35e1e1509357095a8ae65e55fcfa9f3a753660f3fe51de1102c10101c526e34f2c41efa01986315e694e360c59a329569a2bf08505686f8197dd97cb2299cbd6e0f3081bacfef889ed5f6cfed12777b9c5d3f97f710aec474015914a4a5ecdc96bd3a87e945b1ae143225d61c12e1b85146f0321b716cebd23e86251f8a0194e8a58000ab6e05c0d2182b668ef7b10c12e090d6684882d6a68dc4bafe37c8cd50dc4ea313f8704420cbe1a170c6f748069ccc45549f29bcd68cbcb5ef1790ac495351995234902ca540ecf726e2a42eabf0bc7cba5633c901b29945ce227204d1487bb64f33aeaee59483409d2816f95da90e1dcda9afd6987f6691527636947b79099226f32d52234576e7bee064d8d0021ec45c51fd48dfc38085d64743eb807311802f5f4aa1f7e8f6202695789ad6bb31b49c50d5aa295cefd0fd355151b1769df88f09eb3aa13f37085552b990656eb6bd1fa3e125c8300474cc732cf568c315c57c904e79c98bd16b1eb32baec120be2f98cba3cccc14ad360e7ec3d539212116aaf06903d4d16717ac566af8532c051f340fa5ff4d39c0d3d88d179ce01a20c462bd292b4d45dc55802cbb11fa4f9d79e12d0009f428c29ca2b932127395b05b23753df11dcb4e630be50ca2a168be38e4f4e6d08e0235359927f86e810ac94eef65b06552e76f464bbcb822302716f15fe4c662b8a36bde5c8fb72efe6adaca5d8d72abde052e398060d4d2c18e2838bb0a5cf36ac45634fb83fb51946e559b6c9078ad46cd67f0107058dccb13e54f9d62c4b083f7aaf0841dcf34cf11be5c9b1ac0cd30421ddb130ef47439b71f5338fb5dd31443b612604b027ef787fed8b94c9caefdd6ec7e7c8c0a144dff2239a9421f083b0d559bd866ee44f70ab059c31dcf7d71b79e486bcece29a308f54810a1b2564c666d02f51c4fbf8dc91130f831e53db481488530673c761e4f44567f9ca44e337a21f4643ed36269b74995808b56fa175a867de74ef261bf5fb0e74fc8b8b8f49207ee9991e883d6e2ff7ee43c531ddddad9788c7cb87856f1df6fa5bc97920ddd7d415c5f46c72fd3acc6e1be63794bfa29489be1423dce42a37e25a3dfc88814f9c28514bff9dfb10fc97f9e2a41f6a15239437dce23e92aafe0dafba5a6935143d09444389df1ed92a91562e9979cce34e0909c7d2e05e4fc2b38886d910bd86a4c5a90bf0c7c7760e02c96a6f81c5c2e29323ae49d9b92b9af7b5b440c118d565fdb8234e1a9d045e8945abb7267847e7d95bb85cd6299cd9871033365ec250ecc1194e43cbb81f51cb3f24f370a4f938fab5e241b9a308d1faa05907b7cf35ac14692cfb0970e02a079e79edc1411681e6d3c9cb410dfce2abc56ff4f802b819d129e886b41ef01cfe1e6915b6b1ce7e439dd2fbd4aa705300e68fe7266778f629190c81b95f54f8ef476d823021bc5b4f809f35782a65387df9917abb606555f9f7cbf106cfcd7fc278448380e50d65eed30fbaddaff7c7cf58a9b0eea2feb69ab8689ad92acb29522ce9d0a5d2c795c85c4317f8108a4504e194b0ad65e5b2260ff80ba64e7f5d5abfdb6795b2ba6d58ef0e29e49bcc23b167defeaa18d62b24aa3c15c382e7f43448cee35f10d56aad783a4a6aa298d17f4bb62ec859f42aa216b36e0832737ed0071dccfff1464e8b0deaf0b00fe579c94a574c3028514923c97fe47cee80da0949cb64115ef3d04b6b0b7b9b7bdaf5a44eef7462f23dc2a342bc8a89793b221cae842c76ff235c051cf6bb3d46aec40c9679a3b2efe2e67eaa42b0b3e4cb538b9f277997304784b7bbf15523020f7d39cd4cd5b80952d48db226c3b873845f7506645b817b6f7aca9ce2252c6fdc4f1af11f645a4da960fcfeb43ca8648e3de0695974f8c4972fa0a0e6b681ae1ea37e33657ff913a2807da30c1556e69cc7d3330898a11c0614e286a702240cffa72d7d55b164b1427592a23576148d99e52a36edf69f673956ec4f5ccd956e66b974fe41d34675d9353409c4176e890091161f4cbf089c95b25482b917b41cc747965a0dd290f1a9f7839dd29e30105aca1572b2572c17286f0a26af04bad37eea63e49c6fa2ace83628ec8aab71aa8d0ab554a22386f6397139d0223486e6b307f4bc14481d78505fed01f1dd47a117ff2a3e5a8f4b14aa08b68efdd7e393de9c1a7ac8e7895e845a2a1ae010c5261ca355d8fc63c109c675456f664129e68c18ebd08033bc61570f832090142b1142e7ad0ea50dd78d8a5f802e10bbf87686fc0e9c03256a6df99dfd3995f2b6935d6351f2fcc8b84649dfb2e177de11fa6eec0560947efbfe15972782026088d84a9747a20f6cba44ea40b94d054aac2cdd8185aad4ed79369ca8980312ed0378d9ed2c97b5cad0136e9e049c34ab712f148981d5ab1a392608014ad587ff6c013a3fc64631ace95f3df53342171304f3838831148644f4455dca1aec04c5b3d594ab3c8f52330e60d1d8bd6221bb0303507b373c94e017ef43450d1de9a43cdfac667d5cf660fdc8ff5fd9c24b93a164fac1d7b28b59ccc64b2105e5cab20ecbce462dff6404c559be1cb3496a7599fec2099b59ceb17844568a866ff7b023c64356f7169f6cfdec5c3182633495a26f2a8468af5d3357ae7a98debaf95b079e053cd330515a6ccc7aab14192c98958f9c2504456b3c702d99fa5eeff99a9612b0b2d92aae66897a27b719d0988dbaa9a862c693450f2cc7f215e60296e4cf0c9baf847d57de415940a7a2774e371b09ef995b0e41a811ce33b598763aa2556ef5016e00259b8b5beb2cfebed9755ff7c3bcf38b516ededfd6883cda2831dc42c7b184e0aba33cc2b4767eacbcfe71d410559d36a08b72a33530e301bcf7b5307a7aa56eeb11c5120843deeff118f5c9f5f4a992a4e9d241f1d261878908790298f74b22e5de6678d9582a6e45e47e4dc6f4844f3c9f960076027cc219d58b0358146ca57ba58cf81b34bb24e87c4759a70cbaec8b270bce87d0761589669de3368dfbe433f5fc8cff2e44cee9e3f47d957aa9e3c71b10696ca123c31d6ff699e6199c4d2313975bd16771961e8cab7bb4ce5eaead5deaffc533da219b7acffea28671fd2e3085261857e2fea46ea13859b914bf5948ed7b7eb0e7e5eba9f3c7bb9b8507da2ed7cb656a63ebac956c2d7ad6c28d3f99097bd57391e8d8ff220674e43548046df709ad8a74c99343403d0ad63138fbf7c3b0941468bd7bbc5a97fb0fb836541a46a8fee02cbd70ab6a6286cd6f720ef93a0716e97067524b208ed4216cc543479ef5029e2d99e7d1058e6e367027136b0c741ce84a586111725bfdf28a1fb7e9ccd5b17e15d1e86b5368add6e66b98edd10c1e75cc99bef21a5ca1fb77f0dcf637b9f7b965b6e298696dd97d25b453eb9760fa082b48494b78b205d3a363ca1a7e5728703b6733b655331d2c693f65e923d2188c0f0f370d182ca1e70209a47d432be2fb0853d33a640f0341e9b9143eefe8794a34b4d7f2064184cb3714059a23edeefd6facd6361ff5dc5c1b2504257ccda791773366326a18cbefa7073f99ea42eed001b307a9c549832049e62ff24dfa2548471529076286a25cd68afa965607f8203272ce6904d216db529fd602d10b8609cae75c08fc4e27f12716cd871576222d1e0cfa03d449eabbddfe22611c2c2de51da15d61327abf56c3c8086b210f53d8bfaffd9b1b93b29c67f56b20da9c78f5db741b9c6fe65d633c67552a773de1f42192d3d9d13e6a43776205d4874b5abfe3acfb006cfe9b52b553f9f9b0e6b46be574af9a9f8db771e4cb6808e80499a858b992ceb56761b2b628c60169e804122534d1d612b76feb471faf639b6ba293792570cab4f62e3d8ea55b5add7c88ce1ce6a6d85da014036adbd98a64f244aa2fe694a1deecc04d8fc64d1b109d5c362909d279e9bcdd88434465cae10b041f0f210a34421ade3ed2996f8c3aff5e0b1c9c2b716e626d1e0e262dc3779226dd52d9e37b74047d893c43e74bfb949541ff7b774bbc735c7d528c0cd961b6601a7997076f5584dd987a2d9037d21df5e2ada12f5d91196c80d92c710c0f20940168325711b9ee8341e0230b1c3ebebd59a283c244c7376acac8f7acedcadda006b07a556c1ae8c45e9472323230b5521e3037b2a7c422728f458769fe3476e638afc923c0ffd3849e3ee0fe9d486b781969379f26d5af0d5ba3228d390330f445a28826b7f7e4340532058c15dd8e47321751805867ff7436090b9678165b19dedd259d8a50f26d41a2ef06b34a0376052d4f082ffe6a6acbf2bab1dd888216145c2a980b33815e5fca5f387f988b0b6248e0819e646658fe1edfd87d59dedb99933053a2568e47386d4828cbaf81f62dc9ef9b3c850343b642a6b8e6b5b2b560548eb28d778c2abe2398d9fd3c7e0e7877748ee7dac7b345f94a793c4ec16f663b2b159268c33b16e93b5ebd994c384ab107e58ea7e81be1436db37b4e72df3fef705adb925aaf492cdf98eadfb36e370d4ad7b1b48d1dc612a53d9c4d0a24b23e4c8326c6d3f07c43b8215691864bcb9cc6aabd879a43e35255c694c900a02b230a8699ab0b2c1df73edd24654b4fce9505745138a34b4111b4da93405d1efae16d013c1547c2e823a2f0a8e9de9dc693e4fc3d877d33cfcf13f501d557d3c501158430227d0fe99cf36a0871a0e4059d2b6e8c865f9f833857aff4d72af32b2c5bfc0a1b2503e4f59abf9fac10bf3afc611efdaac709394f75516361cbf3884b14046adecb0122f5e6a9bf8e5bc86285ba706f9998362eee23d0b65ac8329e1bb75408ec45afb4579cbc720edf5ed80a5aeb09ac10f433eec8883db11341aeb6fcc614dfb924e221439378b6c6a7b916b91c7c3bf0518fe42e1330d146447aed759d41d7198bfc8acf98a4e2cee9b4086ba6a8d24c5df28303000f46153e55cfe0ddb92a390d420790ba6a0d7e229ed039473893a3974b84dc4df2a238ffeb200a159eb9ed4053aa6200d4a234de4ee6dd1bb2a93f04faa1cc563e513a87191f9d72d0d2b199444d44498131dddd7b61fb1fd1cdb3d56a7d9140a9665ef0f6f62225b6e8b555a241fcf7fa65bf79b30c2817d4dd81b32c7247b470254a3e614bedbfaffd9b92d54bec3b7d14263dea8a3c042b760f8666d210463db4bad459bfce13769411244d18dccfe3cb6d1a8b1de142cbb95c99f901badfdd22d54da6b7b99cdc4b828e72daccef8994e719c4cd953cb95a7bb322643a9dec7b612da084c01f46f30ccbeaa717029df8c7158539fe5ac398c0e1765985e57913810538502f5000bd6a2218e899175fbaba82a788d6765814bb6b723a1bb3428b1191e119ce8259b046f393b3d4aa5fc02335957ec1af5ac661e80a6aa7e06e4e3bd0507ec7d0b410b71d3a244a2e886df7e2d37adae38db5deda23194dc0c6194ecaff508e8755f1fb8436aebbc7c7649dbd014879a812bd241e0358de046736652cc3e7b38718bd676c369affe4b384fa5820b2f367ec811c203a7127dc38aadf9f0e8e48301ffae27789c3b7425a7c2281b43c0347886d4432b538e5cd6daa511d7f912a9165edbe8904dc1c25e0427614bfd25a888ad5d8107168bfc00aa7781f7da6b64739e84dc617fa29ef64a43df58bbc55a1599e9aecfb6497075bda051b265967eb09c8f3a7ba289cee6ffa100b0dba8efb021b5d0a1f5f194d27f2329b5afdcdb4810b57cf9cf688821b3af4d1166cdc54d07374c27d88d54f7b4bec9cd1009685b51db5aa038ce67e6e03d61df95669be7f4e8a91412ede23306d9d317926ec3bec19d34c4253a3f11a5562e3066be4cebfca5a08a4333c084dcd8881046d9553c62d7bcb12439bcabace4bf1edd75fabbb7eead2cb166c54884182b07a11ff77f0f8a4c8b828de0a523620ce9b77f9107eb4a65f962288d4b7c4a180c1e3ad70f5290f4e8912d25b34580fd7102e9c138095f5cdc554da3bb6300eb2ec1eacba444443d4543412d4d9ab0bc30c126b91f7fc2ec40c4630153b12d598a6f271bf23e015e33c2bd89035cd16a8fc408e1055514025e39fbbe927d44b5845cac5f387f017fd7ad9a52026c9cd62badad9cb4b49c6392138eeca6a97598fb96ad193fea8320e358f9fae0ec1549fe07d6fd1a87495566a56c62c9d58c5780b63ea71e8c503974f368c7d77f8e98c895f9d7874938718af9b3daaba0fd8b6fba02bd7f09dc59e6ab10b76d9dba069c1142252ae8c103a66cdd6902459bb3ae77c7db7c78a687d84c6876fa15bcf8b6a1084377d18c301309571b61f5b7a8386f69eb0d3c4deffaf2781c2b800dae4e656e7f000d4c30a5a42efb5ae94d4f15d2911ba64077b1559e2561206f121623557ba994415d986e4182e581804609f71427fa5942e5b5b82220155e64bb4bdfdd535280082c31edf8d2e179bd19230e3b897b3397ec5f76067b14292296184a1423c180dec46753072dc4ec493efdf2b3fce257ad15bdda8e4e14b79ececdd9e15dfea0a3ef10b4e35397b40ed0a842eca5d06b8f47d49891969a6ecc71265097512c8e4609c705d14dfefb7dc87ebb8c50e291c70f8c7cbdd6cc24675062939380c2fd947f7e0b25bc8ab94b6fb1933ef557ec1f28c6e4dec3fa0224a7beada42442e91354b6a076d5755347335c4a7669ab77afe5d729dfabd25917b1e6e24cebe2a78470488dfd436f922b4cea476a30f5dfca28a9c2bbf932f6cb0b8e5475a07e73c9e6c1cc877024c19e72e42f7a75e68ba99f0160f9e324243c3622d5289e0b95af751583189f848f46c6ee0eb4a2eec8cf4ef09dbfd8f0056c8645e8ca4eab96753dcbf02bb1d5392d4159bd9521820d03868645e78d96c221eb8bf2bdfc08f287c7638e3674bc39576d9c330d962ef497f0b95ce0ab5498cfce1b3370f1df8355c343ab76921c31592eb7e27b17779e80ff53856e333508a26cb2ec3ef93c37a759da873e9fb271686abce8896f38653cd6d6b131bd76f0d86b5a4350fc6277e409b153d36bc9d56ad91718da40cdbf3dcc6515c5296c905977a216fc8d69b4f8c13a57dcb862948a32d4ecc848a6f3a4a93ec9aade04c7a4599672ec769b0302ccd2ebcf91cb8e86a0977eef0744a93a7f3250171d832313ca2199de075b97f349960d133e6058fff7e647c3acfdb14b75824afd56bb0db0998a34d5c48cc00a609b0cbb44238ff2de0341c94767c1427e55d54523d6791a1c6c9670c176bf1ef6aba4c6bd0e06b4fe952d9ee57729799015acd479d029d5a7b1ae6bfd45d04d445821d89b504e1925cedaeb7a6bf9417ad11f087bdc9adae1d40cddb5dc25610aa39617ddf0b7ed6f7515e02f55b8f025ae09ca9df6ae1af67155272dee943ea911adcafc7c29f411c5926e086be980ec3528915583b5cea70215438f2509d7223cd7fa661a93684208ca0ee23ca292c6f3d3c7ebfc81ed653db0b25b87d038555f27486016da44d9579364fffe76b406f01a6dafe97e86f3852089b63a6d285c6f49ccbe08f317ed9d785e5542c4151ed7bc59d213e8ba266a5f8df0e943b3f9e26154b3098d4223de21dfb95cb6fa5d66bcf151c5ed3312a3e86e7fb16efa7084c026d75c7298ece8597f962dcf0b2af4b2df5ff5dc756b5bb6533cf2c9d849bd83fa0c7a2dfe62e42c5c2e6cf6bd88d0535dda7cebabb6e3b1c20e5451c116661abe03fe7ec0105e4510fb4392c92ec3523ceb6e424813000f7c37dcc0d1be6eff62c74df47f46dc08d068db68344be374623ebd2a8725aad204da61b1064c14e742ef0b7f787567f5345c2b19a9641aa7fea7a67a5b5273f75685c4b1b2f00c5e93d775ab75cae903d0577dc0b53f13fdff111f0ecfedf968e09ac44ca703ea2a815fb8858cac27120ae08286af1d2c2ea7a6e575fba8feaafdb428de9cf6533ebbe9db0da21b495214b2a6039a249526f955a486a88daa0f06016c34fd6828d35368592788ddc787d8e655057572d6c4a62d8c6a2c7161f930149fbde8c64031b055d0efa1772da207d3979d3861d9cb8097e9b7a5973b195ad1350b63298b6fb3b4f98bf2f8f6ad10c4fe205802f975487a66e02632948881e8fc39351c4c70e35df90a14fc6c714fc9c190bcd0117be9fc2de1e07eb9cf865b1d8712c9f018bbad34f0436a5d76b59184b26dc2a8de4d3cf6698b0773f7cd3e743887b9496aa2703149bb19d950a894064492f90ae0918620dc535f78d66c8f807d91748cb0891dae6653ed7ee0f30837259a50be7ceb12155f6109c6ae931a8f7e798bd67fdd70cbea3291cd457cbd8c2401a85e516da781e8a43fe404c0e6206266ba92aa1310471b8b0715c383d492c09a7741111b870133546252e2b95d2c0029b6d8434eab0a99b1f6494414906ec0367b32d60463709d93c5f80d592115e47ed402ea1142e647a9a7bc9c1aa98a7d524cb32559211db07e3377269865b6354bcd09e6b6aeca4519a291683c59501f7bb83e89a16892c0a41bde4c4864412d449b1f41df6109aace68bc43902bf26c708380a8dc6098bd4e1d3224bcf1cab3671f17ec18d1e2ac179891a47b564184bb7df63f0aba4d70163defcd778d531a3ca4a2ff20811cd299d693143a7fbbf9dada1c818c045beb8fba19395155967de5e673ec4b92c7498ac1147c66d70e3f237dfb8152678dbef16b4493f75e96cf2e5b093340d2d21c7e0ad1028129f0471e1eaaffd75ea7266d204c5abce8328047cf5e809d3107029d3583da5de797380ad267786668450362bf6b8c66d14c9a2cfdf602bcc675bc9094c56be440af6105bbdee09ea0e8118c3b625d50211967b51be4dde860a33ba3baa9837f880bc16e0afdd960f23a9a43efcd6e115d9a9a44f609eee0e75e38b5ebc336c117af8cb67afb6fb56d07b88f033ceb470a1c1b8567ce6e345cd758e60e6b92356547af15bd105bc860de0fbe9d087c6096a5a4d4767af52daa270a935a999dfe3ad9dce85144278ef6135c2d1889436ca3c33bc2c29ab3fa835c5376eff41f2f02969416320020a0c48260a386e42c99d5134258047a2fddd8aba4608584be8765a307c5145c8650b0c19112e0ec8b4adf9c5f030f04a86392c81aa1ed0671fe3cf251d920676365e1b841e64e078ae881b18a1a3b1f0be27a7c79344167d5d74f2d49576736ea7f2b4844c2499e5ec75eb0d3c89da2dce4f77da781e3ec820145c0153025935716fbe58496a1c316381a01dcc8ce3df32e05e9547fb8fdf7008b3cfbb385a02a875a326293424902c46896acf273da57fd56a4327ef5a229ea21399ca7333c5452d78a99493dd4e0eea11a631f14a6021728c5cc76ff809724f95f2eaf14ad199129cd206209ac7ab400fb059d727820302bf3cdf61da4ed88caa68583da490ea6ff0402b9024de83550709064f48218873f21ce5076fd967c65f2feddc7a321824286c92a2f14ddf918e7a06c78c3319bd7798423749e4853c40b245a3a8e5e8403f55cd70755726358d911eca946460336fc98db0b6663a3074205213ae55f261572a767b868a0082659cc0fe21cea54bb93a6cc77ed665136acad0427931e23492df0a3c0b68f048fe3f5acc36cdc6db9285380a3577b5ab47672166678b372d253ea9a22e55df0fc2ce46890b0212a678083598a96e95d63912c5d9039e44534871f8e4cf5b391ac20f1c1060aa4dac663e45fe0d3e2b143a3b6adcedcb1dfde28d9b4db72f897633ee43cfd87ec4b764aedd433932fc8014bb9bc9157094141f3f16cc847c8f13d24787cf0e9c74797550f1f423e748f7b30ebbbbc37709bd4c34fad90346d57172bb749ab425d5d0b595ad2f93675d4df33e933b8dc45d20a2ed23b08046d5a5ef48ed97060c7d10589f3a47fbd7d222e7d583edc428a1c7486659e10d8e1da1b667397198fd377c7b139ce5a6cb67a316484e715d97dffdbde21335d6b478bec61e479af7d74697d21ce9b73323d16ac8f36102c24e82e9486cdc089e69abfc866de8d55d8979d45207f2fd0d369c64fb77f29dd0b950d3b42a66ffb17adaf31e2a1a5835f4685d594b60400f61b24af8f20fa61b9f9aee9b68b5f56461ff5e0243d9cf9190a3bed571f59f809764bc6c251f364ed37394fb59f60ee3be3efb74580d16da6a5154edc4ae560226f8defd8ce1aea6a54dc2a21a36127ee72c4de8d3821f61eaa76facf2f6e0f670e21a0a7f0e7b11849e5a3926d29c48fa7332db8b0b4d2da48930425ba72e8ab90a38047e0889fe82f5d370685742865c2ec3aef546a29bbc999e08fc20079ae3437f4e0911450c43f296dd5bfcbea862b324616be67417557727811fbce6d21d4f9b5f33dd18bea24eb1b86584947cc91d7cadfba29be89a4ccd0c1fa68e78ff652d70d6f11bf9090f4c6e6ab6a924f193faf4812293d534e38c882aef099d791a427cae0cf8a32e8c90c39ee055c5753e1d9f6215aa2f98f6bb01f836ac51f07ab235834cb988a4011cb1d137a35661e4a6db303a314cdda6a92c2bd3fe5c03548b0403ecd2104bf885705c48fd27cf283d8c0ca28895ee8d84b1e13fb7b7ea8f474692077394211bee629671f70ad076d47e049b4535712727a06ebb49a2992b7657bd7d5ff203926c4066ef6939c09e22672dd21246baa0e584d55f12effdeeb86baae1bd4c7a0eb54977d967421b32a1e7ed54714a3f990ecb3da3fbb32b68677061a17b601eaf5be6b75084799b44bd2bbf385d375bb31dba36b9e4464a9a1c4194ec87c3a5e5015f0e0ef3a1a678ca71e5a3c174a4ae6eafd20232aedf18e81250a2d35d7c324f3bdb51599cecad1551fd10a3a5e15c36a24adaebd1f865d75a01e4f021f00ee84cf398d360517ce5e2e1c519577dba5f3ba338db0ace106c72245dd1434e97921181ae930ceac59e0b86f90eb739f900e1aa8312d227f14ee83dbea80b063829cf469cc7553dd0f3da2cedbef9aad3e8117618ae46ae5819f84b760e6d4cf31fe63a7c3ce8fbaaa2b73516ec950fcf6bb631161a127fddd6830f54691d9056ed0644f789f9cf13e2eba196972ea4efa02f9e8b120ee0c2d7cd6ff0a6f2639a3612a3b6ed3f2c307c5f789b1ec063fa5e6a1d004a4aeb75b447cb75bd2695564a40a98a947df6b0eadedfbb890d6f19a716e76d7df35bada6870a1ecfd29da350703c8d3d7f7a2d59a12e8b98df80d5c684264f91474a741bd585bd0c8a4820a5df2b62880854008f422c1f5e24b403480074bd210e71f0c174060b546ed3faffb813415a82e8021c9aa9b643c849f9868d5595556ab4fb11a6a9fa696fea142d9aec98924563544a5ac041932d1188450f03d6a89478dc001286e0fe380c128878e034ac1cd066b1bb4df2126969e45127fbc678a5eed76534463a8987828b58a3bfa69b4e2a9d4794a9f4868d98347af18d5a274be2f3b3281c643c8bcca23e3c925216a5ead478cbf92f490fc9477abd0428b61450a3c3e6b0d37e0eae07a55a78a19b271e6830cc90c0692e289b7f10f8171155439b129e9b1ae06d39500ff067b06a8899dc075663b89ca1ff0118aa4620e083cdf479b15036219e71940830ebdd384df1a36b4dcaa567a9e8eef823220146ff7a3baa137e26fda2a27f0458319e411d3c5841312d90cea1d6c5c23a63befb8728ecf3275ea83e71e8f0ab8539af2f675110f2afe07a28d4a700df02acc719e571667fe8e6c80893ec68b00234e27d93efb47920d40f33d37519f356adf710bd8b681337dc53a338dd6c9917d967d121e08a1f184afd680f75d8d42d4ecd4e85ce9e8a004054c39731d3da2ff7e20a46c84f4d51608d402f24f530e5f3d5319f7b2c2195ae11c7dc09604fb9ad55b58c6a1f6696e5b75d3d3cf3b29721646e3afbd1e209216ac2344172b4ba1074b98ca127fa5977e8961f2329e8c216dc58fd454761f246f5c26898e9b8eeb48cdb444a7fc3dd71fdfa4964650141b72c1e9f77247806e57aba38ebc9e9ac4965cc6df965fe0546ebe7b9aec604b971e914ca7ad0a56fd7d18d7dcb5c359cc87dd24130c34aa311c25b6d0375b5b5083f56d9f9a13ba5ae905b80e11303d1ab49a854d791a149eeb9effeae800105702633127799368c4e12418e352f097962e8aefece4ff98aa695f6aa75cb0ef61d87340a8624b7f0934818431999ea61f56d147244792cbf3a1e2c107a1eb83c077fe81f25d2c3d0e1af19669cd7871ddcd8e26644538648f462e1142e3473abd240dd418b634bbf712214cd09e2f8e52014a50e5878d6ade66f899e1192719f65780d9aabee47b69f236a3470ec3ac2bd68badf0453c5141461359be9fd3769c06a3fdc0a2a0f06e58665639fbcab4c68cada87d4f4e608bab712fcd54c73da0b184c6095da5b84336ac6b82b07c3cf7dcb928bfd7aa9a391b130246e9ac06a740548c3ccf9aace721b0687dd253ecea1adc4fc115ee21371b250d7c6159f41d259915dc646b93b2d9024e32beb6de4ed7a76bf1844278d17c77474ab21b3e3a084447f541d47d2f0e50ba8e4a430fe03ae0288ea7610d3afb5c04edba0c6ef5f6ee5de50842a3c0b04979d99607a891bbbc956556da55912520c3dc54c71c9d8fcd88c4c8fb281a5fd6fef23bf5d38d2ec67830e1b59c7fb82260fb3a3a6e8c91e3818fa571d9d65a0d1d7c8c8b483e10e097b02d097ae982a3bbbf9cffdc2e41cbeee1db2598873db5f595d320a495282b6696ffc6a4b0d19b99e98580ff349f66f45e096afc4c8235a7886db32caaa63627afce3e5010ad39e1512aee6572defe8abcddd33a28f78b3310e07134a143bc28e700d01d88bdeaaee6be94d5c7406a0a1d03d96c203dcb5d3b20af0db7afb1a5b3734ef091aabd51d1ac3329652005a23aada8ad6272fdfad59bd46c91a03cdbf9bb90fbb137bd72ce36b7d43afa629a61e57485f27e70ebe48308f2d59aa77360df5316b684a5f5cd1a7c9a395ad95d806c8bb5fb3c1864de25c7a39bd86cd93ea3f322d7067b906ab2f097e5c65de645d92ddd5d76a11abbfe001a29a143b1cff4a81cf9faabccdd3168a923909c8f3fcb56484a85f00c4de6dd7cf22f82170a22602ea513666675c6851db2afd19ee3ace824d892d9248d62e5cc8c6e1d9be982c855392a4e96d8603956ff1ef401fa16030000fd5d4799a2c822d11d8ca3d8dd93618dd240f696b0328c25ecb35e31a374235ab0abde414dc3ab78ed75c65e18b02536182c1ba599f1ba129950ac67627f04dda1bb7ec9a8f1c5d19583429cacb15573f8e02132480c7dde7fc40341abbb6d8b7f87afac07793714f37c37ab6039cbb10c47ebfaf053645f969f0abf190f2ff4d67f21f1da92c093f6ae13bd9ea8fe0c0afbc056d707f9ca2b8dad3da7ab21b9d46c1ff62882ea2596a11a1f38c0196d6f7aa4180a4d4b5b35258bbaae9824622cad45e2f1c38fab81924002847c38bd347810429317eaf4c99580942041b945455106e5d8f40ce0516435a27d2f471e1f8c31dc3ae9ee77a231d2115f888f2f17a4670918a6f367a44c5e5aeefdaa015c8ec5383882ef290e2a50b1ac6071c7d6672fcdfc9a6b5668c2dc4658520d2114292ea8ac4f1557a02759d982592f580a057c2a48e9bbdfe1d898a7308ccb4b35b24b78696fa8ff2fc9bf081d4b8f679772d48f9870328e6a0eb83c103e046379a964b6f628cdb1e07cfa7e72e8661c1851c33ceb0edeee7635d3c416767de6ece80b313b2ac43ea0b67b8f59cf7ddcc66a31e15efa9fbc51d77153db9fb2091cda462d4c20d2cd424d019c2c99b4815f23a6e6b6699936d14eb52272b326c4e69ff1c625f18ad3d420e204c82420f2932d2a5f4d7fb659953d1c6c215256791e3357dd0d7fab88a292e2d1f44f6bc5c6b688dccb592c115a0e4b92b4bdc119345273a2143e76ecada115987d203efe6f600040fc102845a20b3ea1509e8b6aab736fa432d83b213922f4c4449836dc619d2b4143f9e115ee40602891b7cb12ac4abbe39358d476749780c5afcecfb0a0b233b9759a2adf8de6f7204a0a1e4550e338b4d1aa567e34f2e2e5c6e3d85dcf122e46856b7d4b5673304222f22465b7ca48ea4a42d27b2c612f33c11887160c64f47783025d0f126d6809790acf12859e60ac9229e4bcd2529ccf018f82aa7d81c5188e110e8ba0ee1eab2234def41b7775a90660637e0df084e2c001914d437660ffb5004a852da9688c6a143ee6c04d4a910a3d41e7c0d4c3e9a0a59a49e071ce0cf7242eec401a3681816435409d6f380e7dc1584bdc2ec2241778cf160a85507d7b0dd22bfcc83cb6dbb9c2181ed4e677bc5ac35e4f371b43eb4b7b476cd5f8461a76a57ecdd209bc14b0c8a209a4bea89e3cc2b4f6f7ad67d601b84e953816a24317628168dada56000fdf37bb94a8d43bc2b4f4aaf72304d913486643d74f2be17535bcd4936eeeb51b0a98714916d3828d9a3f4a5577ca02005df0d9ec0c8674aa4771fe6d871d855cd745611b7952b681b0562024df37a9529362f0634a1d45256e3d489c6ee35984bab6859b94223c658059696ab084967a01bc1791fc62f192279d9edd8680a9ab340f7fac1940f6e8b03da35fc7c57ac20bfe1ef524d7ca304e81fb15d04e669da78e696f77510a7f7950e9cce3921508c3ed8a488342cd8a0607ac77968f2e446493b4df2f66a2d08b4fc9b1d22ee6a4fa241700002716a5e33646e442b854fed6680e5e451902945bae4dd25a6e2f076384da8a8deee1b2b4bb601f2797a20cffe6b652b8d1243d0d27bb0eab52dc60056e464bd877cb5c97ab06927de365c929686af13f741fa449eaf7e3fa70ee49663de3998cec800a4b073dba09ec883faddc643721867b6947e718ad3d8fb6507daf4861d5a264cb50a1d20061df11f92c18f3d992ef46bcc42f722f194210b48af691669d1096d9fbcec7651d8c32325f34e6fbac745f673c54f1aa04c42d3064307de62fa10098dd5153b753748a85712df5b44d0313254e587ed8351a370757a1f2f5dbea8262768cf66bf50a35b1ba6c5507a11c982260dfdc17758426953767888e4fa0003f795135378848077c090f82192c4ec49ba46c79cef8920a799b323f63b404954844e93fc89c34f4db771998c7575d2aeed666afb2d322affb239124095c6774f6dc7b8c4a5ea7c27595c8ab602d249ebbd2816b867eaa897fd20bc55a933b306eeccf0639cc4b903f062e959855c0014e092fff0addaee921552f4917e423734b955f4b1312c8eb41fdcd05da48afbb4770157e0f44ba1847c3f1d1ad04044f0898577d33e2870ae0bdead0bf215df54b8a25fb999bc1264bee855231240c80d73c8917ffddb1ae9c6c2dc1ad8ad18b95ce67114d11518183f8d4fa9acb19a3d8dfd0604bd30b6592f72b47505032059fab99c020a55774a4a5fc0f5f96778b2bf0bd7190d5f4bdf0e2c406f0a71237d462ab294aa3e320a2d2a49b60e1ab0979114ccbae1d8a735568b5fc3097596503263d86f9248c2dd8f6f243df5be458d699eb7adef2e1c5262ccc5dc23ebaf5e057cc792445a84c1073516d3918f22939ebe780cb474c2b1380fa0fb5b7b623ba06bee9b85ca1a76593de61322ad77378ffe03f3419444b1c517bf3812a074b8229d4bad53045119dfd305b78fad8eed999382a2c28b0c7613d4f8032d8d5c997495f33adbcd1110257336cbec59fccae4d56e86c43765f47d910f1627596bd8f7775b3618a2424866099339c44dc083b082dd580ad4b97260a27f58dbc2bf75ef5a5dfd2478c8e35054eea5b1775a88cf6731d02785ba104febd2d116a7dbeebee099e091959ef9314ca48ef932a808c7977afb5231f68d9d210daee020f10853b02a93d57bae7c3a683cc5e458c048e90679403a3070f79a42aa35a23a27f35b5323ca1c4f585c4789dfd3af51c67767b28430697421b50e50da7244886ef9b74a71e159ef90cf18bfa5e925176a24407e9127120863b2e2d535fb5dc2f44eb28e71cc5426bd4f45f7bfc63af07614a4a15b62e4d2e0a52493ffc712f2e9995e19962d98b645a9c16ff7d7567dde64bca58d4b74c5d9add0e2cf4842d3a4788d347291072be17ad8a449256000ea05d55845190fd1b43348fa5a38f78190186ffb5f284a66986fa96575f44f57b22167623f6a3df7f558885fec5043fb2983c13d6625e00d555e616137b5ded79f45ad9ef4bf9504573ee94963fcf2bb1a6eb883de8bc8673fd03aebc146133ff4c95eaa9754c0758a449b3909cf5306a490bff630dd8b5f2488c30bd8f7d63608ff7a343e12df09d5965707c96eb38a589dbe7c659ab4405fb9ee1c7df6369b3b2264c6e9a51990bb65d4e588fadd271a2bcd68c7b7640254db12ba3197895ea880a099ef397407680321b52df06ea0cfcf56244c88770f8f248a6a98ebe2733b2df0209306d5cab262b52170068f7475cdc036ba6c1d4a87f078cddb5405d1592b6fcfaa4a3811ab9b35e54d824c66805c58a556e4727ae5894d22c572d8276dc28ee989b755fe7846ffdb06b90b312787e93060b5c6beabfea8139f1e76cf71c31d367228123545989454e2e0d619724e20ead0ab6db204393e130582053e9c3ee03b12dc509370991d07f66b253ecfe3e264e5779168e4f6243302ef5ffff3c5c544a33f4b453526519f609836ec676079010bd358335fd6df20a4d567404822209803a6ef58cfa05a7e8a9d1b7ccea5c0e6189a74a04299c8f870bbc53c22d944848188262ad2e3bb64779d71aaba4e7cfef8b48055c52626264e5f497469fa7031d046ed4cea43e17bdaf1842884bcff4e1afc66e3d3a63cb58f244808258fade798710d31fcba4473e407cd412bf08dd9cfeff6637ccee5f929905191a47b7b2f811ff690daafd5c65da0b779563a763d8d1cc6e674ad17e878db777e56ef9936d3ba9fd22a555b14b4754f221de962ea0d504bbe9dad746a383ff603905746eea4f1a1ef2833adfa67f41359663194d82e0802507df653fcadb389e89836846bb89d162ed21236dffd652aae200f3f9710a1bbf188b7b9eb0b1f39895b207598766092769f388febd79427b45e8cda228da5760019da27d46f3d685d9934fed74abcf7db9be3ec4f6408a660bec6220266213ba4fef27b35c4d74a4a36be21674522c1f4fa3161299ca19c50152809da3fcde4c8d531eb94da9dfb6ef1abaf8bdf6cf16a666a7153c309830ce3f2a72efb57b9a049ff0ed42894b59edbdc8c26085627cd4e3b31d06409b55b987f8faa0e9c40180efe1b7cc4534df1e83db96852162755bcf0eaff40b1e13253511eedcdd9d059695ff1db4cfff9300fd7a5651111204ec01d02aa060ec915bcd80e3b57455957940e3417682705fa22925597cc20cf98467299e6edd19cb2b6f572b49799b6777fe149015661da823a6ea55687a861bb2c6811285fa710e3e4c9c276f737f645c02c2f408a6ef056c46471184402f3029bb6464d01cd014c5a1eac8b3943a52c73cf4e42d8fa8ebf40913e2ce72fd1c1329ea03ce37c58d1a6dc189abfdc82b5c6c91b801d713d238553b04476ba20c8de9a30ec1c8d4afe4dec30d54a5330fa432ed03c906be0a9788045a8200aeb2b02aac3d98bcd828d4f0ba8b80591b4eb9ab9690a6638b35f9772cecb6ba73211b30a95445ac1b392e437d5e2750946f82af12f27cc2ceca4cc4028416cb72c6682604cfaeb3994816e2cb799ff1289f57f70104084d1b68207086f80e99f42b7d600c1154c24ca07b56c788a8be3abe595d8c2f0c061eff43b2c288dd992a500cc64f6087937df62f6c331b16cb7ba101023599bb6215dfd6d66fe2824b8f91279d6a7a403c96629c516944645992faa6e60cb6a07a268fa8ad91e8ef47902ff6139d661bfe247d78e7c3506e034060605b3b52e47ece46fae6efa6760952e22c4707978cfcbb5468ebc42083c71c533aab10f8d958c5b6a7f53febfb8eb9424131572c5e10cff1dff9bd4800b0cc05b67d82edbcc7da8cc116a67bf64fa0260c950d82a0ed4d255ee9c7c26c30545bc6d8010f784ff1715806b3b54d195eb4c91235bd181b81e7536d829687f701cff3c59ccde44a1fc28860f37e7b64f6a152cbf93544f4993e37d54ab8a746aae7b776d77187e2ff155de1370944cf896332dacb7b24e32e333f602733308e05e6118b9e75b2783e171096e67e4d43b2e61f9cbb40bbb584034086c5bf64a861f8551ea6836b488616faa8fbb889e76da627fe034df23e369697e49897ebd71d9524352b3fea6dda1c7b713189a9cb4290e115a81f65c521e01115b3154d6ab84caa3f328a75b810fceb3522745236cbe123ff64e78ac1172e2a02d644ba534e2392ca8e90bec13e734339658a8aa5096cb6a8ab3d393caa87af85126295f3733023fbe1b47dd1bed9bdaab6fd2987397db6d78bf88e699081491f8df4134041e8f57e6774e8cb8b6475d202c362d7766219142c3608393c6ce660975070a1ab81e9a0726ae33cf51d25c4722c035caebd9fcef762351d1a9ae605f46552908ea04d63c565a2fc636e4183c40f3dac366f9d0973f8a475ba9d9a0d53ecd90540cf5c7153c979303f8f816a4f22688131a33a9573430f2d73784c90420e60fffbb6b0807daef385690e2490eb0930e8df97c593f7ae793624bf67f74495db62f347dcc567eaf2f11b4911215412878179b1851e7c2c10bab828c2f219d4e9001cfb733bfe07ce146191a41b6ad04d8720d1bb175d2d705d9fdb82b1d2782eaf2be8a85ec83413ffa1fc6d757fea4a7b14636d69746fe096977f4651c0fde03f301f41a9d6a527dccfbaeae5fd53608260b5dab50cd6842c54341f722ece97c5ad0044a46f5a136230f9f39f1426f92fcaddbe198162a6b0e157bf8c4abb9e23b3df5b1d1a826bc785d55d9d97f99834671443cc5ef270307b57dc520a6e9c8d271d09256dab8fe22586c776630cbd64e76b630efd123b6699a77ea71cd56f23f246a29c186de9e5b996aca716530f5373ca042037eb60e35ad4d837c91fed4e3e3ef6999068945029e133b5453f58a0a7414dd62f8b8797e68d35603bf6645e3e5a2ce4954a61a4a7ad2161c6d4ee91a75a74544e731108b61a0c9a330b52478b2ee96fb56acc9e52edd1113b97daef157dad16ef5cc87b88717299439d3cd68e9e2ce3e40ed2f86ebe4b9a51850d612b503da0aee98a7714ca5dd15b60e06db88bab9c7f38b0c6e4a6f7f3d9d631408c47858cc3432bb80f0983d50bed85c03da82b461f18c05781901e9fabfb0f8e4ec46fc2c5da0b50bcba741177c819cf3403e1bed08a57d7512630184699dcab3508f2ea771e4d694ead01c3a3de101d598a99a0cabe36dcb7c44f80929f0513b8ca18d0d010f54e0f75086df0e7a76099970cbaf7eecdbbdce33e5ef752ce22485e7c1a144d3e77fd4c56134635c6f4c4b9e49f37a4687ff1c46849ea518ab0ce7c3683d681a971119ee6e93cc1085aa10cd5b6fe8991a40deda4657ef16a91dec50e47ef68b33e3fc442a4612dc3369adc289a837e9b778f671bf5407736a846064c31916c72cf90f7fde845db3f0af358ac5e4edc37e9d125c00900b54142f7f2b22159aac54a73cfc31599d76896454d52296e17bdbe5bac06f20ac1831971ab8f8c527c1d348ee0e0dd5a0587ad1043ec0bd9bd0aa8b1d431250ac5fd094b6d261b2333d374fe41ea2d03dccdd3740f58196198f712434049a707513b08c5c95745fa5de12f3b65475d5e21a846b7e20898f7fb2c15798f2ec06fa8f479ea8557d87b5ecdeb6b5744a1566c2eefc745792d6006fbad06e2951e957410e45c49719f16276a2a6b0d13f0d9f64b44860615d90f7eb47fa96c54a722a2bb3802fdfa190ac62bab5c2fc676b9409821c5a3e68ee84a483d6383c3e60c9e1a6e5c7b97fd7976c93c40ef447f25199dff6efd65f7d883f3146677f808682d261097719414ec1e89550a45fdbaa56e07644d272ac0a05e0407aceaaab8dafef7b7823ab7c77c9df9d246bb9b01d07f5e61eeecbf96ca1b77d27c55d782cd0153c1e7ecf3479f00cead7b22048fcc5dd0af4fccaf96f7ca9677634f1542a27f7aa09affcefbbb9940d42643b9c90fa8c3dc724e767cb351f44fb9f5da9db4af4925bbf1cd9a9091468104effc13359b4de7c2f4bb19e03cdfa22b9bd8954df3bcea349cd9ce5f03a22dedf77e94f1d1e8d65aab2468b7d41c15648c2434e66f4acefc0c7da65c53442d76ec23315b83de96c12bee022fbadb2fb90eac4a61d705d2eb9dd5fa94331e2ce4abc3dda936d8ae78249901b4cb56bac4d209b6aac166bd3dacc7a11b54085dfdb8f6dcbceca4b2ce4339de10e35b1c0f3f2289dc2bf1cc2261e225c087505077282a8695219e370306438d1d458f21bf653e4d19100d1e5d351c304d599bf3fbe8b0676b3853fbc9d6ff8607db4252c8bf87788d39038cb535f9e28077969b73b3ae6c971ed3ba2bbc0d5f4bf4063258d2487e22efe3f2b5048e88ac9da8fcb60590370f2ceb17da1348c9a0919be9173d4e64ceafcab2d6d0fa49465db89c535fbca70264cf041fae02467da2a9360d8d3f47e9189206101a6243cf03ad557f9305b72dc5373a38a112b068b99a43f486fc36140602789b510554dca33fef6e696bddf6055487b5277ccc7436f6b4fbd6b4b542cdfa6c4d2db2aaaa1c405704a553def5604ed3c9b92378093120dcbdd9ef7663aad445c1ec45f9c2a581e16e1ad98f39ce3a2b51920f35f4b4417aaa821923e28fe55c976b1961d3b793b7309438bd56a8ea539e4e4cde7541ecadd579e3918dcaae396e698bd2a8a793e0af8458fa30b3c1bd0ab9c90dd87d48e9dd9d08e39223a4fad074bfed93ef000ee3039b0eaa7cffef5ddfd601ffe88d501a2b6b9416fab611dbf4a4521b962ce5129f87a96fdf4ce12f5e26d8e6da22a37181668ad03c724ca17d502520df045ac177eee5d86104c3b244805406b2421a92d85276ac9c6977fece312b28b2417f8f424d0d41738cff230c235032c1ed1a7df093bccb29a4eadb02c8271b15ef9952556844d11075400ab8677ef1d5abc6a76bfef93615e1158d64beee37d5bb0ebd7aaf2a2f82636f4af2fcf4cded5b99164051c637b6e462d2cc4ed4094750064e2a2e49e6b86596b9a09caf25f6721fde48257a2144893ecad74a31214a0dc431317e21697723c82fe0aa19ea4be12db70ec7abda2d9d14394625df0dab9527e1c2129b2f6af62c0bb930520a48c961d6f02d2a2801740556b77dd0b61b6a6623f64d83a9d2f5d621a80a8114b1ed46d13d90b3fea2e3dabb4a889eee42c248a28e7c20fff65c4b7c7394f231d1c66a32b8df0232efe5836ad93dd6f77442e034ddce6350db9e26102f5c9f27d386296d2816543f7541eb2ec86952d67b19d7684cc3efa593beb35e862b09a25f1570eda434da4a55aa47f183c8a8fcbb1ff6ec5f73099ed72cb8286d8c601036a9fa25740a9867523f47ba7ca3bc5716d93230440fba85d1669be86912db3358dd890e9fba714919cfdb3ce16197cdf98edcdc3a6f4b1a04e4a5c5dfd2af641cadeecc72127918955ed2712012f1f1b892b4450639439f8154803d44caaa2ea4eeb1de94106bfd46389787950b22dfa68dea21eeaf8135a04554357eaf956e03123258a481d4728347086ea25a51b6597b3256d4a989fa441ab928f035f0e8279e355a3a68153640310007c97ebbc761a37bdbd1df2a65eb7017bec4113a89656e4cabe6878f44c0bdec0103bbeff7a3a2fdc53432689d492e83850499eb6b6e28964a67818335387453f22f8415fc23ee2fb84c1f75c3d93ea58f6ae46f9211e7b8c901ec93cecb7c4794f2e3b72b228724e9efd08b8e25ec156a03449ddf4cd0830157d7b13f9668640b0357d7a41028533874297c2480a061e722be12219bc10396d478a3e99b821fea566a899c84316fae8a7d261a3ea3e5f11aa7ad8d970dc46ac679bea3e64f2ca2e68a52262b5d226c84db191e9f7c54fc3f977fa455922669c9e64cc50af2fe3fbf7d1d14a2b241342bd9436c5d38108fcbc9160dfcfca53a0434a63383f0ede5a0811b5a58f50aac5ee8b9b0608f768524b852473f99109b502ceb175e04cd94c0972dcea923273d3496fdbe61df5e61bbb9798642f3e9956e4ae2a6382e0eceb079cc475b73426b2ee8cc27108790531c8c97b4f18bdca09024e6d1dd53f2efe389870fd3379d4b1c04a6986d7faa1a62f51a9e175d81e5279617656fb06b417378c9b20f63d8cf3bd51395b85c33216947f6417db1e172ff002e4d4ef23760f624e96f34711a14f4de82c1fda6167aa8ff89e528678de81765f097cbb7aad6697701fb04bc35426edf4b349d269ca86b1e659cd215f7c6477177a1f9bde202a0a669d91ba82167ffe1e7e0eb02c074b4f42fdde8bb09550338fdabe7279a204e4b6c04c803e433eeb8177032829dea5cf49eb4112d4816be3eb3d4c12644f61ce0feae3e1506fd54f73f523996b57ec6528bc0ec5fa6dd21577508f302ea8e94b0b7d1b3f624b0d7ea17a14ee8ba8bea54455ee6ff76ce95d0755d8a409671a5061882981588cbada679fba2e8ea879c5d2a05e14fa24d61fac02dab4fc78df9f48970dc73a465e312ffb4eea0670a342b121db68ff2311aff3c3f7b463836ac1f27f3fffd1c31ce97d7930b00e5005f6cc1f19d2c20823e97221c1b4d234d71eadee47e9171f0b2af37b0391eaceed732b57ffc4bd3129235360dc60399bcc69d34de36ee8f9ebe7f49c8c5c4f35932e637759e370aec3e9f32accf918ce72bf84b665bfd3ea44cb87b6a1def0129c404aeb262aa1ac40a906f3feeecf0b245a0dbc403cdf5d6c4c5e5a516008221129b6e72fedf24976d230961c4761e4386e447e5b60e11f007489f60dce4df377fb7f2a901e64ce3b017e68bf75e0744cec1ce133666ce1eea36ac06be10aa6f67d89e7fa0eab0cba43625160bbb10d67c31d19fd8c14a5097fd2ad86ccd7d6efdb68cc1ea703c120de0e55b8ad198e7ff78816885c1dc5637874f4d407d6526440043da0df5089d6547df5d4a02634375ce7f42c06135a2964a62478e1edf5e2cd0cbae0b1473ef1fb7d68c802d694ae6e44787a3390c76c700f05d86d291357c5e8d6b92b046c32911f5a36dc5a1dbda4d0b24b9b24e5d3a4c9f566ebdc2217e0b41bdc2e435fa07c7bc6940c8badb79f92998c816ba70da596128f7d5ee9a13ecb884dfbf1a7c9827a0440bdeee630b4d48fd97f1fc22936f8001d37e4423539abdf41453b4e8a63a7f6380953b3653270f781fa7245e144636296116b23ed0e839cc08a69efb1c4edf991b6f3f6e00b272cd634cce7aba472544fac50ce0614d28487a3a585db70f617c44a8b3fe2ec88d4997b4530c95472c4c2154f90a190feade8c3295755ef0a349155d5b21bfa0d4e69fd443a74131db307a117e97728a4df39a123b154e98eaadc2b2e6bed01dfe68b0c39eb1984e48373ba95013b440913baa26043b72bafa4e5b92b8605b68c69e104398f74d720c15175b855652d03db9407bc9958d8454d397fc663bf32e5f6b28559cb050b3345179ec37f902939c6a0104fd914941272cc7b13310c0f4d767988ea58d8868efbfc71ae556a2c3959d686af2454c2ed72fd1a58c340c8c044e234e623d084c36226b6c72c6508bd88ba40dd05d5ebb12000b4638dfd537a9603fd9dbe90c284a334fef1be16f91cfeb455b74144228cd34e5cbcaa3c9e950c73f5615933d46564dfb05aae7e3bbc4e5bc3c4ab22c8c30964c8c5d45e430362cdfbe0c175e1a8c0e2dd9b9f1e6cd456e39480f7fb2913606e5f591031af688f46d86896ce6591fbbdb7bc478f41b48ea0c692e15dab45e67864a9a4dc15194dedc808fd416ae2ad2e84031b4e0c4e89f502e2264e887c0e9950b1b5003619f77786d0379312547e7702c2d5ee58076106ff2e1129375d5b53b7a89974a86a28e8982b471d58efc60c08e31000f35e307ef5d6cd949890bc1bb3fe246cd804be26bd61b723dcf61ee9b513b0c262e017e186ae1f387e5c39ba5cf78815a13bb4cb914577d48823b1f1bde9a8ab5f97f6c4c63c386238bda9618db86024c70e46bb10405eea443a2019893415361184fd96b734ed5a7393d805704b98a0433462bc34e916cb26b5653816809ac9e67a4d51482c9ad6f880f0623ed8ce9593e9a2e5ae75eb5301cc275d1a9ca2dc0eb2ef554aa8894ab74187ba37068ee451bdab548685f621432a06c8211ec8c859b5dd400325ba77a9bc3a136f8a4932f3e3ad4d79ee4484c912da865fef0488c4c9d6bc09d51a3e5cbe432692c104cd71a2697d570766549d22c9d21574f215cdb1897c7fe29b6e8ce264ac68ff91562823f5c3dd8346849d5c4df38ff239c38d35cfc4d3d49aaebc5702d59d8b0fb584db86e88096a82a2042b8d359a48364c7ebb4daf7ceba0491d287aa92308910083ebb31221072a798fcdf69f0a24cf62d2b0440651f8f839506fc131a1a886df203e8f7a3866d2772bbfa6f0eb842c87593d904c67c183792e8e1f642f4a3b1e5a1f9dc2272cad144c7d0278438d383233129ce7841bfc4b145a917d015b2d668b27bf128c9d28e68bbc332cb5575613401ec3fa91fa20adc387b6bf8f99cb0e7d2db48ef639936c37c9fff6a999bf7eddd1636ec955f76aa956c434a8af901c276152830355c9b803a639a17117785d438808860ac588f8f7527710d606c02d9841089ee229ddde81c98cf9ba37415ca2bbb35d1619d97c4f5ca6cbbd835e8b9ab708471a863471cd2c869a4cea90d097ddeb3c598a4d07c616fc0a7731974a160c3f358f2287edd63faf294492bb068f41d7230ea6dd2b80bde200df5cf775d0b760f77b6d7b2562a58d6bd3731bdbdb506bd221c1c93e31208e460951b29df81a83412bc79bb4102a6e6b13dea864b9b9265686cd920ed5014de4706973c2440a49eff583cfcdd90f54b555243e9e4c3e1e75984fdeaae04a7ed36533408b0e9dfe325598e05d00d384b3f36a7df973ac32bcb4c7798132f517a62dff03bb435bf727b949317bb908f43ecaf5b70a9ff620061f9bccbc103521508515f065040867e7b6b8e63b66929ab626768c41ecdb4a0b0cc40b92aac424f3633d666d5886ba882a01019c883008d0eb9ef7b49f4301ed641d192be7ae1df5cb83dcb4675cdff9ec01b5e8482e4441127050f8325d5745459c2d632ba470544eea7897e72c51a7cd8b815ddcf09a5d11df7c05eeb2c07d8966cf59783b02014b2319695ed1bfbf97aae59e1876c6369b36831c0407f3cb4990bc3d93217f46d81639c345037f646ebd4b62f4a359361e180ef259e25aea558716460189002edf034a8f43eb8b3a59782eb6b53b06111a639d16303e5d1bb1dd7921c0faec089e120e27c3cd46b2ba48982bee8f91dcd45deb3250953c31effc24ae2edff304bdec9f187f31d43ced7ee7a4111fad6df7f272128e86f212531c80079de545f7fb6e203d64c28ec99249d11c4041e99c8e0d659ccba5873e7993a5d9134264ed4392615a53b365ad9179c2003689385be4bce6a78ff022c2bd9cdcd658fec42373bbc6c020ee8820dbbfc21af99d6e55f6fd6bc24dd96a27c550f267d4b44adbff77d0d2ee3be39db28e34104af19abea97fe8048955bf8d717bd3c5c74badc476a4dd48ba7078ac3652ba377fefa8ba55667c32bdcd1eaca4ac2d96e9bff4c66e09cccde6ef85b1f4990a71ec477312e1fabea5fd97675c72dba1a64f8171812924acdefa603462739203187654f6d34d89eea5ec090da97a34f706a153af35b0bb21dff6febbb22239a28efa19253a6227076612b13c5ef5271520e2a318363a95a07cce849a59c4cd9a1cb116c39d5a4d321a1b0c84f3460caff97aab684fbd1977d54c3cc2672947d812ce78855528687a714f2efb1c65aa8f44a18940e65f2dd229ad7cd5c7f02d2f3c78369c420c230a19528ea06946ffe9a5b97ca579e586d1a3527e71c3ffc21789af594a34c200dfcfc8dcce9805f0a460b11b1d8649c4c4a1e265789e0dd4755ddd36bdbe547270731bd180af99db0db8a72ebab496e6b3068923969616c15c43090dcffd2dc265a422d7ad591512e2dc7ef69c2d38530f55c4a0a38d577acd1481377d1bb9ae2852dade6bcf763408a1e8c9a86cefee698c6832ed3365fea800684e9930264632a76a46ff1c6d8cf34659eae66870b154fa7a39c41c41353d875793fad0452bc39c7c18c26b0cdf90311c50f5659857c4632d09b1a179d04564e4d48f962054f414a8684162027869418353d253131e76f0255666946737e94fbb4e66b3dbfb4b42df4b6c79a09cfd8a5fd4e9f55bf2be8e27d01b626e9398fa28f42617acb817eb7baa252dd3e635742f775fee479fb60a3363b0c4a4f7e0b5ec0ee2e33b997236ae93369915b1a9206204343dc80b24cf1dcf46d2f1c24d9dda1a21e320f2c8de6bb39c547668212e1c48a9679ef8b5cd7e0983bef5828abd9794ddda7cca01c2deadc48e54e0117127ba846a07fa49273c914999d2f62a466b04891f5a806ee26b483c74ad0432697ccf28ee4d11d41ecb7cf4b75d93137cb0bc8b9bc5e2a4fdb461608b4813f2f9d01fab19baa24f97b48b70a3bfcae730ef59b9b25a6e288b7c2600bd3cd6afc76f6d49f78b0cca6daf656dd0c84dbc352edf86d5083d069e6de7e567c17004433c4c5e295f7f8d11d4a31c47cef1ef55d3b8bc886063b77468776a7a54cb276e09279abe9d1e3cceeb1829f29580ef84a9e79e7591e6944208784d1c39da19d5edd5432c2e87a0e5883582ffa28a3062085cafdc95bbb13363e5a3e36e159a28cc3077eb5276798ed61a6e0521a9ce96cbaf919b9f1a33d75ce5a86eaeaabfd67c9d2b386702e4923841fc350d1223f6fde4483e70f8317834ca3b38d835d05ef16b19e9e59afd332b0d01787c32311717982f5f0dd6cfcfe4f829f3daea28aa9220897431197ff785a3099b7f6c66ffee68c3bf4e46d74aa7c5a6ca92f0c62d2fa1ab617ef47e68a1b65d53400124ae3d0e800f5ce3bfcf09b244b76184c156d85c4e04be1e1ff4e60af335862d03c4fee1ad8d917a288942a7370eaabe5d66db6ee388c3212b846575f37269c1601f8efb0d38f0907bdedb12a8d58d6d471a1ccf10febffcb7355e89b638a5797299aa02b8c7c3295b533cf13384df467c4ad6f0773388e447b7e1c45f5e64ad4ebe775bbecdc59c3234f545b88341df638f9e1f385df1452c761c60a92e880e7e1ba0fb6ea414f2c665303c763791219f549af1dfe4f9aab5810782142b1e8547735ea5a9158035b95a50a116e8d6f0f093249cd1bb77778919f306dec917b8740c5efb32064a8ddb23816d699f2905e9b578b49122b04d6e3fea84fd50be2647bb4b288e2b9c08755196dfd35e07521af4f424b89167e6c2cd1f6355195a5ce812141e07f59683aacac98be366de297daa71defb3493da9e4cd5c5cb560caa2979f19afcb8b487eee4ce462ac802c448d64c8ff3a8bcee5452d4bb5a2033cdb8baf83e0cee1397abb904d929dd56c4a022cd8e333e105133aa98635daf2ed6b15a03bad72d59e8c9c384bd782d2fdb845d49c143abf39cee264048123b7ff568e1b056193fec529629cd850ae9043ad3af51c1fd42ef64ac4efa27a98933ac07e42d57e58849f91f9a79f654bb486dca77a30809ba6011f43841d5ac5d9560cc17e3901239a7d43bd279cd63dbb76f8fd864aa1215cd98a41f0333c9fca410904613b5e83cc90434313c96e7ee7fd1917c87af2cdd04de83f0a505be4cae29f682a01b1e673dc70c991bdca21636a0289d1c7121db283cd1c1033c7cd4960d9122c695e5465f117e7cdf8c6488ab36a915aa6c415f10339fc2bb4c4157f31f56447ba1b225b150c710c6d8fba66fc858c9652057f066d137fdb3b1b365134cde6969a5ca03f68d0566ec1762dec48a32ee7746093f3a5eaea407231755403cd3ccc59a219c1a1bfdb510ff639559d6b714e98f7bbda1ddf92bc59ffcd3dd3f25b89be0877fb298645cc1a2fd6e180842b5f2314c53ef86058f98b3e6d2245dcf334e69e8b4c6f512a9dc64f4bcb650ddd021bca8c4e7df8d592ebdff2b3de2313b93bd0ad380ec9c28bef421fab790434b28867132f949ac70f9eb8c876a31df06b8472d069d97a01d6156980ec2e0ad9b20ad4b2cdd0a0f62d52d2d58e653ffe67414c15befc64f10aaf30f804999b24da4c903a013460b2698a0b66b9d8d6015f24f2453ddd0ef45aa92e38e831e1d73a14b40208de8ea7e20b4e015cfd09a834629459fc1e993c0c7e1304f4094709f0aa1e37cc4b2d91cf5f49fc4079445ed1f22eca69a8eee0cdbee0535d96339aaf9e540160ba3b64191570a414fae3f8be30b346bad6137d32a926e6c9c69a9a89e8568308e43814386a78047608f42a7e9ab6e401da73fcdc6b00306cd858eb97385c71b41abf9ab56ae93559122881ec125efedd8698e80c5605bce5d9dafbd7fdbbe438a2cd554a04bc1e3a0ae5d86f4857fad00a1f7e3d90b4ea804e5a9eadd1e19af8a0fc88c707b1d91662c9dd94502a739b0b6c419e547b34f01ac6deae3a319f82f224dd2affed1056feac5ec0d2856bb347c2c824c716fb4aed64d9adf93dde01d03a6a42f7f91587938dacfd6119aa9b1398f4418abe0a47bb03ba427284f486479375ae777fbc84137a7701b2c7c692f4fd1efe4cb73681b2441aba2a915c5591dd9c257e6493317e063adfd4f6a1f0d9db0124111570d12073024f295e04e07ec806b4c0cbdcf307e042d589436db5ee51682b07d96b37b3428be84a8c5f5c09ba0d863e506aa37381db1521b1cf5030dbceb1ea741bf7be72723fa391364b25d991996954a650dff06fde0464d40256540b0c02ebbfe4806a61fd1e6e85a4a2f5aa6acbfd0ea0ea30a2194477230a59942e7d101dc2e40eaf7d2d698996593af3a5a07219414df8b21231f439cd9795543be26675eac1e9509bb73e52b1c575281be3f4296b1482c2283a29a2b3affc155504dcf919562fd2ced28d584a700f9e20778cea7823a510d73afa204354f22118c720fd73c51f1c4c4f7f3a5e7e3ff9f6b0882828509a70d39c01916a19ab8bd319ff4d8359b1804963184d6aba20669213e2cc455bc4f4c17da1506b13bf4d2f9d31dd17ad5f6deba7c55674e5512cc6acda9d98d4764cb213cdee65dd3811e7d86bd4db3e0935107656f1ac1851a7f72035f9b921410d9e37a397a35759ec1afc6184ea4c78612c20dcbb1c26c7993ca68c4aaf6c3727c6dbb030142365dfb19e5d13edeb24833f83933aa566ad5b54b0aab2a995d40cf8b8630cdc019c1c61ab1ddc4b0d56401b6d8745a048e246070f53f40774a3f831899efe88b30a5e924bcb5019879eb9e32edd1c0f152b703705f86170833064b37bdd96df9d4c217449e748cf85edc45401f8bac197f40182526e34d1a6d2d238623128470dde1f3cdc1a365aec587ba0e08638abb59807a412e6d7d1b045d385907b7d28a95c2348d44fcf092c02dab97359fb5321e30c974ff907d2a9a9ba3a51fdb1966a27629f7c5c508fd891f8011e67515a51035d028d0c624da6ae121216fd8da6a4407609f5958e8c020f929c5fb8cd2152dfea33900c5aac2e6585108935fff7600c8e90cea677e73b499c4c7bbf622c61dcd8b86868c03d75c18263968820fbeae21a73bb54f90cf5e3833497437809b7bd0456d2e40d1e3df40b790d73e86555556df02c6ecae6aeba87a0fcb1f69f094004fd4519c90c5e660c228a14d1d508a4fa54125cf3e16ec358544ddd4cab154165389e51024a0bee66dc5a14a119c93e8e97dc975ed3687b566c4525c25e25d44edf19c8c1dbb291b2c150de7dea894353a0afc0a61d3c6350f3f787342636d42120a1affa8a43ddf9fcf8d93bf5a23dff1976e55797f8abdbd37a695b07f8eb13a52f4fa5a900f5d499e1eff7a27e7e1db3b0d10f4253890dac11c749fe2b3613f6e2e29be40575f10437107b1d8a2a144db17794dbdf77f68ca13f4c1d0e765f7a9434758698b327e420b4107a0865ed4d4eb32d2a49ac1440c094c6d06a1fe03111fc5b2f96c3aeb5b8ae8063cf2f625ed06e27e89316ed431c6ef7978eb1eae950e02f261647e3371217a24aeea14d706e75f94a7f799f04e2fcb6fdfdf4da59910c9a10adf6e1b5168342042f8069ee03fc1e88173bcd98353a15b618b4432149cec2f8f012e562fb4a589e94f4d9a31ff23408c0895d3882d3469cb1ad69d80ee62d92f52897f722e8f1b8956dccc9c343337ad406223d0e4fdc1954e0266127764f8ef37a5e5604c84c6b56da719cbd2889c04bcb7117f56386bef2ca1f441fe1305b943d4f8846839e361d76ebb3a4c13d167c552599d4d053c2129e7b5e458e6c5fff740f5d5c934d83f35304f1c5315ddd7f3d305094cbd026f8da8a2e6b846cd07285b4524cf33ea653703d54a9d5c5338ed8fbc8fe3c9bfab23a8698b08fd6b49bfb703ab33d3581ad27fa1d2ac70cf2a52372211ad83a700b46fd53b010e5ee22ccecaee6bf14c1272ad7a897d0349ad0dfd7b015a21651a15cacef763740a5185ee2f6d1c119d9b6b00c33d9343fcb9c65b8bb9a09f99fd5a9a746092bd53e07dfecf7420e4d9f731a86096c40e9856d560a250f0c3cf01d1de9ec244d3b47dcc70abf96eac81b449a261d11d57a301d87b937d54dcafb6aaa97433ef00d9e219ab95f57f8c8e52461873bc9831cd78a87766b15cc0a582ed17a927ba093cdc5e6c80ac93c39f47d231b45788e0d16b76336bd91e23828e5c34c69150039e19936b99187467667312d9f3463269ae1fe24401e7c42f9f87dc92aaddcd13a5c94f4f449e8d1767ba36320328a02e011a52c5d723f78a51812da624159537592ecbe93ac241effdf09fec6dafd89ad0c843749ee68c65c6b169fa66886d3f7988865e9d0ed34f001ea112204b234cd519f9a387d6f186792b648f7e89e83faf2c568438a38ba94eff22f2833c217bb0caf19fcf2468fb533f531c5f7df64568b68e2534731792d35b924e23193e0eef745ec5783d42b49f9ac95e75a7692cbd6db39968469c50b213a0a9cf37bbfc74783c8789e9d60d8d3a6c94633f14e816fd45c879229aaf8794ac89a4a365230a17bd0be70ea4f07943df2356de286491d1dea930702e2326dedd7c03bcd2ce4f89cb8485c58a86d613a88694dee2c5d03877bb989fbe10adb015cb2ff72f9319eba5a70a0a5d123cbf04cdbfc459426e09a32eed0921cf4b394371107ef5fed811b4702455bc092ab44322193d8a99a6fc589a683fd541a32c67bedd420fd186e5911242a1e031c74c185b7e2f179248e77ed8d38096a89a2f6a2f23417422b65cc7498b026528ad55f2c27da3ca866315d7e5119090c4b4b511fb4f9d3ccc4877c82dc2375797b4422381dbd8964a0a2ceb7fa830bc138053e950fe1b8f000b2d2b37e758ecc5c28f41472f844bcd0a67e74e8ca61b3bd4c2a6e5406b7ea992a225402b5612f370d30870dc445850c546d0b857ea5a796dc4311d8304840e7746429f06deda38247358e956259f65cfa16187cd14f105428501c09d6cc9176f9f268447485a39f8406ccf5d416f857acb1281131ebb55e308636810304646c16fe4453288a3d8d4904440381b40c89a13e1e1968630b2eb170469b68636e5a51d2216a2c39339a3a824e97198e6fc094213a227cc5e8c30d7acefec0e89cb827f5052a2049750ede7a206c4af45e29a76185f3de07dd64457decae5badf11d6cbf358e3335199013b89dac31c1aa288f9842bd71f1bfe624269bc43ea8708ff1d642f2ac54c6e9400fbcf695ee04a92d07ddf514a40d9c138d31c8a747bc509f1aece0d5f5b69d127f154b7d3eaaea9ce09ec2f0a9c4f37aaacd6be7d21dcedd1fe4ede7726e46dadc67bc37cc872554f24fb5582e3e1bb6344151559fb7030e37ff65d8970ec6f18b69f5d0690dd707c7af50c63654d1bca7f7787506f6beea9104e25182940905e4577876de35f79a78c002fa14b4b1fe5fef134c0902033d3b2bda5049e7240787fefae86dd2ca006936a9007750fcc26500bd8f83f02b289e85a1c7b84744f0c98c9d7e5933163afb3f67b0853c229f65119332280e9e9b40a9916cfcc835e1195e728f05ef26753ba04a62ceff285d0030a61121baeb36a3ca64502c485578e6dc8092e591b3d07d85b1f8234fec2179d371a62a065707a365ca56b273ace83408e5278f239043cf729e6b99815b95436bf306ef862bed1f715d76ffa1198d1244be81ef4dffe2cdceb5300306858f1766e310fd8f8ad7fde3f8121da6e7235c15dd22de2f670b0566394310870adfb2b6576853fa3500a63b5ece7bb33d46ec5d72af582439b655c9854b6821a9d29b137d5442835f563e04f81ba3d27a9eedfcebfb80b89bedee2a10fccad3577b5e473c09e8d5ada538c27aad5d31ffe4f3eb3a5ae7b3d7bab94a6d97a87e8a66f941500b139b00a6af9b3aff8eca1f5737eb8d06535604e3a918fb98c645a355811a81caabcef44b7e71bff09159ba38ab42725d618d5c6cd7a66b49cfb5a3011327d72661caef8ee2949bad3586fe6a0a01e205c0c8df574f8b3bab96fb452262d3d8369aa6ce9866304876605efb0107808545b952a5084607ecb9c68650ee7074b763adb76545999e2c0ffab82364549147d75d07bb66c5f90de2ecab9b66af3bd265c6bbb3c4ebb4efb3f08254443b1c2f0a9887f93c8dc44d037d475080eacd01e54d19b8113f423a8bfd75abfb97eb785b09eeb141bf96e8a79e6c47484eaef4edec60e3fa21a807cdb9aefcaa4731bde58bff307016ba1c06903831ba0b4ef7a0dff33d0a91127c5a927e324fd2e4ba780789af497cfa22d9268703636b5142c329369fdeaea35d8aefca09cf29654f01fb75664ce66ce6b5218819e1ff2644ecdded3e8f8f6ef798edb9515534b5221e2da57d6e6d8c5f7b98b4d26e3b0ff361bc556e9e1d4edef40bb2358eb13e608aff98611e8354b6ceb8e24d507c49b1cb3440098cb0bf67abcad72d64b9f83bff806e31cd249368ec852669b8b42fa3c53d9b0baba88f80fe3d51acc7db3aa066d1ea1bff38a52daae127c2a90e7f689ccadc9f73a3549899feeb6f1b40af3e71ee1397691ef62502015f780e9afcd913d8114a9440cb78e7e6c32bf6b8334304bde640ccef6c847ad1341d81c9211eb4e7b9094e11d1e9524cedabc222d13cc1be233676701ee3dcad0cd06fd3123f112b4525a8c704503a766f44abac19afdb598123376fde4e8a212b7e5bf426d34e3661d29b3caadcfca0de0c05e366818079f81474cc6e632690e6ea49b3eb9dcf9b5b1d84efb71e1e30264322857840068f9da22cc42037d336c3be9aabb12fa7882ff304cc7d117b4f26bd4ad4fba139f6528f6bb164f20b1ec2197a9ce13b7532f7615d99347a748ee67f3dead7ac96c707ec6682b10c85b05c0069da9e1a726c27fe11f85f1cd0e4daf4e39806fe67d6ee465725e39bb1aed6f9cd5eed3d85a4ac79a9e26f22ea8554801f205e5063279ab300ae3e891756b2e205f62ef1d41d081a1d6b4f22d4223b3fb50b730a6b601bd8927ae46ebabce20131a972841cb508547759c81195fde30e3bd334e935300999fc5286cd265947f105f5cb55a5dcb80824e2a9d24d7cef08bcfce2030f1555b06e6f2e15a3f2de2ec7bbedd8265acbb3bfb6e54c470011505ad21a01ed29dea9eb23197d14e0eae0f545db5e0a443a2e5bd5d76408a971d917bd69172cd3befe2e9c6de1121b3de40a69e73378b0054c5f856a8628066b5c50d7c9a4f98286513ea3b47d12fd909c708e97e4a187f3cc1d5573348f8fc3ab33eb4def74c9840e0cb7cd8a49419a5bbbb7a2f5af5fd565a32d588ed4a424dc00c8af44ac16a8584ac60522635dbe5b0399a7d9284658a9a0e783204c3452c348f7fb55519d2f37ca3e7bcf1cc0e2ff50b1797455b52c880bfb93e3ccc44d1b062ac17bbd0a4bebfdcc75d0e4328be749f396ab81433317bbab8435a18d7b3763ff04e46ab84b05e660cd7d82a0108e67a30a47e3878d8f01d55ce806ef51e40d892abf7694b57761225023d666aa2e43f7b6cf1d89792f42f2654a6e7e18b958be38952aa017b822a4ecdb033c75a538ec9bfe9157e8ed2097cdca6f1b31ec9f1826f282d637131a44afd7c10dbd02d58d7fd723e28acb5f5060fc60cdd88a15f9a4d6dfe7b6d3fe7e941765be0f076eb934565121c3ea4d903d4a998ed789428c529a92329ac57c757124943af94b7a2fa082a15ec7a89d4e6f70f8b71072c86718b3bf6010842e03db2ef9b7476d66c712add6b58bf0585fcf977dadb10a83a7f26e8048f3f60f3e59fb0b4abde28ecbd8e3a95d289f5d10290e2d1c65d3b4a9e7d1ad666d0a799b3ff3f17ad4f7d76ea06a603a011cefb9ea56980feb0c0215b675d4146f048e5195b8e49bbdbefa70b4996c2c820fdde254ea5d92009ee9b10b4e7d06dc7e415a239aa393e75622ac779cd6136d857e4e7f9d34c07278ba85ea31e02411966d188cf07c3ae3543ca87b2899bca2639bc40e2b2a3e5a42fcdbac64f1fabfc9bdb142950ad249cf854ed250702c408c8ff4b0b92009b0fa3260779af52341b7fd421a9060d8a51ea9794096fc929ed46fed609822ffc5c783e298e14a11c90b743ebae89eca9d3bde4c22fb6a5acc22497579f5cd2d495063fd5f3242aac06fba612246988416a05b7c84ea219dd0be3f323fac9177f8f4cca50c27886672d51e0c556ecf904b146494ede495aaf4dd9bcbd8623d7195cd68161894444d461f09e23fcf984536f467912ac79bd4e9a7ddd499ae08c48533b37477e0bdde14cc88eb469f7842e6a9267c8395dd803cbcc0f4f8c5441c19d9bd8762d200ae5635e85516f65f08828cce0f165603019630f0dce449c2cbc712b88d18cf0c88a93509ef222ed37c6a7d24d1cff05a825f5a5ab4c245ac085348a8b55ded1e9b2b373ae0b687db8a314456faae0481b29caf566a366ac11cd18acadd182881b090e1ec8fc5894ccf7dd64b87b1fbbd20972a4f678ba92dd927420f5039d9edaa830da6a256f595f47ca9f2ac3399d438e01bc32493d13ae2f9f3db718dc521b501ee70c086a724dfb68ceecc2ad9edc3df73d64cdfe7172acb3f4efec1b27251258187fdd305f7e96ddb868988b5de1aa7bcf6a27f111854124176aac5aaf5690ed44ec3508c94597bbbe06439114d594d7fbfc70f20069ebdaff1c2aa0ed2b17d23b883919787611182dedf573b5880235d213756bc4cafd4265af0030c4559dbd42915a139ec6bc818cca29ad4577bed56aa8ca0d78c6d0232497eb2d373b696b2d114446ce9354e8cd3c2df0dedd0c42a029f4a83b22fdc5bdf25b605c728980eecffc13edb5970f357bf0dcd3c4889f61b1d1b35b9c430417d232fc32e8c509ab5ab703cf0288ef1f6748ddf5bfd697cfbfdf4cda39e9b031d0f49d273d450d69641f7cd63b7c68cced0833c1457a15aea2087d5474556616beb6185d8a367a82dee9f555c9c65d9383d0ad048d5d75ad099ee871207e45489da1b73899f95dff4e83ac0a6e2eef97f0857bd515b0f7de4ca74fc0b8707fa3ebdbfc4af330485452b72a25ab73b52e8dab298e2cb2e79514fa1fea3510cae53713ace21cdd7b23d7fb5582af34bf7446a74cb1286844ad670ffbd3a601552d49fb1412d0128280b3558875387d0545f4c18b7128128635875d830dcea64bf55a6525ca71e4a6545c540c21c2761cc27d24ca9a45fa8492d4fca211cafafe00ac77c47073c3148b38bee9459816b109f37298569a42cf02f45bb03270222e6d745c2ba0caea1e49fc7ec5089fddc9f1e00fc68bc4ede41cf07a6d608d70cb99815b19b2b1aadb5ccbc27411c7d195171aec4cdd739e82cc1fa3800dded5af632ee1c500f73dfd4ae216321289f3b9497eae93204bb5d5dac04b0b952cb8d6b9c31650afda51ab7d27a2841c78a20a00f129bab300e8c2b12593e8d201d44055c3f8d8808a918470ae0260af5388b8127db45d66333c52fca5f52b52733eee15d3f0774bfbf26be75480956e0d97ebfd7e9fa7189d71c37c8773969e7f7917d4d2029a97aae1ccd6455261a73a694e74fae4adb47dcb84ec8c24e68558aeb8adea6e061fc8122939effbf6638e7686195511f15c94a743f33904ac416e6c53ceafed5b30327b91053a75f9cd1e9ee74823be428d81255aa60aa694f9c4486246e129990b0714141b05be0bdc011b2389fdb91a48f9258a247dfe72114d3abacbcf9bf21888725ae30ccededce0fc262e2831a4fcedb628fbc1ad99352b799a269601d61da50ef6f755f8f71968242f083953abcc3a3fe8f21d894cf8222dc78479dd2a70aae6b6eeed6734b8902e68cd7b603960518f2b57ea5d3636937a17ce13729ef9fc00076a85bae6fc4455362547c0486ad581374a073fd995ba01638a5b1114ff7c9deacdaef31c3cfe527b4507001fe522928130876cbfaa281e1160fbd14518798ef9fe0b3195f51c40f35386784c2abaa87b021859ea605916d325a9ff892db915b497cff02f5dcae6439ceffdf1a1c0d5ae4f0d661c9437bc6c71e31693587cd3933de06f2bdae60eb1984d68ac4d6752a9541ad1ff02319c7da750c823a3d5987afd6da95d1a42275d01068db5e7837f5268c77ae344041683628300fb37cc50568861d8a61faae559211522e7e4d6dc9a28fa2bb3dbc4b426a0433a655bf5cc0f24308396ef0a686e8e7a3f4ba1c8a4ac6a8b7762fddaf026c4f61dfae57cbd955c3ec1cf927dd45e662cdc131a414d30f0fd207c432fd4219b0466f7565bcc06bc37058e42c68c2e45f3e07c511784c13b35243e6f7ab667701810416b87a42e2aec3ef7bcefe33a8ee96919cdffd944cae452fd63beb286c054d062a30254e8272c19b822ef5d910c9a3aec1908b903a1fef131709fcbea5f74868ac87d9094382c4d90845a36ca6b164b7c7d6254f0934467845352ca0c5c1b4d11302bff8cb515f71ab2d115338ed7afb76723d06ceb27d3e1fde8a170f5c0bceac0afeccb6d06c6391ff805b880ed672c233792226df39fa5b54fc5d7bf137fe73f64292e469d115e3417cdff645cd96a8399dc92ce60f0149803b4cba4c46b829ac80b7f01ad2f252e007c6b8db00675ed3cbf06b49ae91fa47e57eaddb9f471dcbe317675549e243e17bc9323a6ceb61c6b77e7d69316763c101b237b56dcc0e3f5f744979f4a1976d4ed313493640a0072e28c90203a0dfe95b5eedc9a10b183d1128b4942281bfb249156a17e4fb071755e5020581d316d17a3ee275f47fb12197790e7d8d4c242524eede1ab702d7f289006d4925b50fc66e6283721a4e1d412d249424bd016d732e3b0011794e8a96dbcf3c6e23650656a0f8a7f8ade2374c930dfb88424670fb7d9095e0d7e5ef6e9a489abd2bcd1c3755ad4f9d9d1dae8c09e5069c91be0a68a451f8912280b28d0991b09a7a9892f96dace867e915fcbd846b359088842f032462596e7ddc7ffc381337736e751ade2094e61e66ba007de1b2417389f9e10abc7008aeea7afb676627d54429c3d966f51e8f83b88b71266011a871640055c6f979f7eee54618aec14cff5c650724be3f52b4e42b8c48d3e24394f3910614d071f0a3509b05acf2c7813debe1d425dc8459987da960c9dc49c51bfac8cd5fd2012b50ed645814563ce3a261e86a304a69858623c37a360b7c8a314499134af33eda493b1acec67830ef04870abb7eaf7e34d5f52e1f785f2b74ee812585b8c01d4be09d5dc07214152b8f43d8ac97bc3e72396da0e5205458ffeac983cf269564e8750dbb2f085231d4121adff656163f413f3c16f526431065043682f31bb8a5ee81b4a8905b953988931aef1d2d30cc8338eccb723b20b9442cffb5af77eda51836b1255eeb37b78c35a0a4277d2a57d06455492080e5112256bb6d1960c809d20735f2348d0668e6d0b4256a86841dd107c507e51f120233f60304565c57fd475b02c274022ae318ea89d14c81dcb846876958665011ef1a255d1d5c0f28b40d19e679a74f4bd2d59274e4546f2aae60abca17133df74257b82dc131db55a042a555f4b0e711a15fabf157a8b830f47f2c46ad62ddf4c0969e62fd444340a38b8a5a5e07041b5b247f39535e8c5c158b4669f0a0712ee176de51ee512d1cadf76cb2e009bc582b1f1197112f3e9b10dcc8acbbe5b36c1a1b2a514f1276f873a400d6fa3cb98b9051cabc7ee14c8cc746b1a58f7ff4dea28bff1d31bd37521c7368ebfb504d7f83b3438c13e32c60d316e0ace98649c8bcd75243c367c314f46bd38f869f7b76063ddbb1b7630bd33e77900612b7cd62abc9338b0170f0e8b60ab880bbbe215b53a8ff22b815a01ad0a0570419cbb66d9c5e1dc23969d2a7e8c91f4cd83d076486a498d47c6a9f57f4c5df3358ee082f1c0e74c8b6d7750af29572c37d9946839bba44cf1a09be19267f8ad12fca25175269b81318bada85bb9fd597b0ee73bcbdc6689f61e070d5b6985b0a3ccdfb4d88a8b40996552cb3682e2ab26c7048ec042a70ed446f8eb703d34d87b1aab4c6057f3727be15057ed3732e01996c7e3274a3e94e4f40378b8942b32857a2d320aaa6c05a128fb83968c367366ec4e4013048331d11dc6b5871ae44be86ec96168ffdb952c4db820f27fb2f52f5d5f4ad471d0e7c2835196c86c9c3d92765b18492433593fafc08a5bd96f602e4857b0a5589b96c7bdd6d695372b98ec49bf3fafc3c083d8b54c303eefea1d49b42a05a4e8eb99bdd90061e06f5cd051e6487c49a146a21bbaa6cbd39fa3ecdd042d3e1646ed09c542338f566a66b77de9a3c69b507f876ae1ed18c1788afe3032458bd0d49eea962b6e633ed09e68a36970ffac147b3b99e1fa2f89eeb4fd4688e8b555fa7cfe4455d878486193e5a8814737d5753e67bb73385dff149d3e0ff44c8cb753e2010a66b44ca4ec856401e893396211e83600c1ccf8da4d1b92451e5f4bb00abf9c59d016567665fdebf0345b610afd43e32e533c2f7d1070db0a6980367956ead59a4774713460aaedf61cfc81044f41da3efdb83a6d9de6a7b2f2ab48244f8f1647b00e5356ccc6d59c92c041783b58d1fd7c99dfa1594467ea5d2c54b88b0245e0f12ada2666dfb44afaf88396189c622ce1bb64014248095622dfd12590675c070ab265e6a77be9a77ec0b2ee94186550556e2babce5901bdd9cea9c039cda09f560006a98022cea2e357b9cc86523378068708b79ec9a20b69bb772b034b9ae0ef85a861148fe4af03b76c24cb86358d48a7354f538bffae95897463bfb3ca7a1832877af53ab41317f47bb9e20f5fb9a8462d2ccb859cda96ac63a5c3518eea98c6b797dc0ab51a24b6ee42f08a0f25e53c1e7105a71880ba4751695a65b96a6bad46e66438be9ff03c435d9f16c90e363ef46dedca5869d35610bedf684fbb0c1c4fc83ef6fac3b5fe656b78e711a368f63bf291916d049525971bf90493c56c47ba33da140d6d9bcf285adea9604a509fa51cd1734806b9d58d4a9bc350489eca4d4f9ec50e19cbff516c0007b96920b5c02b374d7d8a3523a61e90d119594f619f7a4d18b19feec64533c38c5c6629fb8b97597e0b2139e31751c7859a9b2f044bc43b48e930710004f707ad960bff13e1a6547dfa8b9de00722b94fa82c6a2a56b8b8f6f062e2b9465ef16c97994734060d11444cf82a1b4310c29f672936301e13a36cec5596643bff561f58f1f8afac06d6e6edcd17f7d98d5974d7720b936ede3c2275c3d4172927a8796cf64357c6160d17a5ca030cf0b67bc4b2e7305b22f9b3b7395057e49d7dd576e84602903cdb6e44877eebe57db4de5d2528fcadf409041ee091f5bd876abf2f8997edd6e2272f45c1ef1386893959c1ec5311483ec55cb369ffea43847f11e9e2f08e32a29b0da434563ae0129e4d3e6a3bccb1896ec39aa2bdab34b5e4c9a6805343a5283753262267fb756a5ea929c28f0a3c12fa6ff96fa99dafb2351083c0787fdc00bf37b3bc05c1f5987c89e3dd41605c5b0009663c7f8a63739edfcf6858bce834284ba825a28eb2ab7b05490684933b4c34d6a7895d2f5b82ece85c2eba7d11979632985cf1cfb74616e168079f9c52e23cadaf3ba6d2f7b6ba82b138f87f7f29ffce51ce7b9ba0feb1d5e2e384fcc7671c44dbd6867384ce4fe4b5c7ee6c732ac530129ea6d39a089170b1c20c398bbca617e9d974f0a420d441459dfb0d4d13071a29f0ad38e3e2855079b3bc4c720cfe38734cf9838d7a895e8920efbaef985036701b0c5ad3ebf594346b3f90bb3ed6b57132509ae81b0e83f61a7632d9317f56a9390396c59b7d0c2ca764c43f0034dcce5862a6e4fdcc227debabc0b94984d72bb4cec339c6239e547bbdbc11adc0ec40f6c461bde9b218b767e2559631c44de160f7d959e87181d70fc63e25919d53b04ea0de9d6feb03bb850e18b555e8c6b0ac1e24a19fc1cd3634efe97784bc13c881e68c9defcc8b2c96f79fb5ea561a44619dcd2d968b408693a71650b324dd26e272075c0cca0c20a8a34356ccdfa43d791e55f4c5d64bc576fe4c3bd6d6186314849ca4c09fe1f513f4baea8a46c60d5fd3c177b36c73cf2242b6fcf445e5eeb253069e47735b3427cbe876c02add99c2cd0c901fb39ce7dfb848ccd07835421df91a62f5e27cce07db52e488fc2afec5e3045410eaae0dd07f98b31843bc6c8cdd93e616ccbacc6afa4e319339d62b766e2cd2212f1f76c26870aaf2cc0231f550beda4c4dab8ec55f2b8551fcc7075f6057e1599a3ed838e61a6514841afadd2ba6a380e328abc7fc86e9cf18eaa67bb64c23921a324c41c3e13ebb3a9880c7dd19cb8ef23b372141b57c4addcf8a7f51af569a722b62a13b5f9e36b121edaa23de2b7442ba78d4d4351813b4000a4bde9be39f704c740ad647c6f66b7746cedc2a61e3c79db7bc8cbd47d4ff88fdb2780a22d5257e5dc38f8cdd5612dee0771eaa73b97abb222a9ddead297c252ed3e9874feb058e654f146d21d8a2fcbffd3788a587b491e0d79925fd2114ce6831e4c158064b909f3afe5dfafc7ac128c718864e78c5200fcef91e0f825a1f64e323884a95e72b81c00056fb15885c128af724865eaafc4a84f1fc8bf292f6ebff6030fe7bdf401a65cf936b37d9d040dc863378d896392bebdbdadd53b528a415c89c14095c09b9c511d49df80f047c7a2334c76ad9be30391905038e831bb44c6734edbbcfefe18479f778a6248e764224857a9b5421b8b3273d4db067430124d8e9075e544b72b6f7e8c80b18cb948f10216c305b440c741bf8ac2dd14ea1eb42b7e3c129cb96d87004e9bf1f8a1dc0617a8ea0ab303815ce7625100d169288f4af23e7fa396d8b6e32a3555e0d00884c8cc9d442dde5e8cc9e92eee30431d7cc0de86ebf55e7e6dc14c467586ac211029f0094d8d0a2bc735bec31789af3b76e128fe7f737df0afeae1f2bddd7f569730d92e65672a541795fb2f1b5f17f383a800b9552b16efe592e0bededc0320408ede843a5e7a8408d5cf38ad8d5607501a7ee105d65a55ba130dd0c1f3f992e5bbcf799f213150d078830601e3f8f533171c4a946bf5d970ce13e18950544c0e70ca19885b170c3eda50d28d5c5018df27e1d73798b99e0d566008af387ec942350d8121199b409b04a0ea73a8b69e6ad441506e2eed19dd11025900269724353d1e74277e8155aa73ed03452cfaa8acc6bf0d7224ebe142a3254967a9037191d8a5a45cf1117d52f2c59be23af355271b0605db5aa8035be8556d38ac8701997e1b43b3b7eabd962c7d57e538e63a931cb76f51f0beee36e67a1a7accdd281d1710ee46800bc38f0d581a93dbf22567db21b27c05ac99e9d5e9267926068b5136b5fd650803b4e7ce4c7022cc2bfa85ecdd9264a8468242b9b1e678df2eed57fc4b0ff5027602cf87cc092c2180572a6067ca5fb38c3bf6e96e0406b2ea563d4dd51ae404d7b99bd4e79317b6cb032638163e4cce0604e32dc752d72557a7030ae92f57c8ebe12d0e3b5ed1da5eb87f589ce526e333660d28eaa2dcff23e07d0fb843404bc32fb751a94cc74cff3bf609196742a43806ff634f5dcd95868cf04bb2cc623dff75a86947aade0d7294c7722f3da175c0c49b669531150fb79f25fdfbc9b093e2499edc961a8872c3f70e563c6c161234ace4a3ddbd4ddb257e357cc4e9e35dc1e118607772f3f61220a9716940286d68b6c953c4cd93b2f12da220bf941c3838e0bb5884942929096188cb19a930e6fd57e503a9aed5bd00199b93d7e7fb36ed4395d874b8d79bb08867d857503a1214a8d35833c58596897ca99ff0d0b6e401f4d7496f6ef0edbab9cb9afa8f4495a3d1e027241c34f07e7116a86fc4e9f4d943f1fc9e24ad68f47e2cc84fdfe349880eb73ca7645a2c4d76724c8c104bbb2f11071d5cf0e76e7850eb725182a4894356b4e87a6a59148cfa8b12b6abd7c542cfb786aecdccaa36adffa0e1782b44a0cc7d35a77c90eb402e311ab31a9f2a4e856e9faca64192efbabd53aed70086785591390624d7d46f91d343c17bfe93f7f0f882afb5442bd2c6883683d04fac600d30efb5554063bf1c2999da87501904cd23edae4ff1a16cf0583287a7cd9dde7ab4bfce1ac43ca73e079144afa44789cbfdc8d482bf46ba757f57f0434ff49862f4fee5b5a71b0828682c4053768ef79a3e8bf75198315d89f489b0f2c6fb879aca388a38153a7701823a2289f73568f68df185ef9d7b6d66a67e7c388c017df7198213ad102ed81e0d5fa72d77d0ea08dbd4459054e2341128191aef211b7a28ddabd0a45168827cd1ff0bdece5212fd1b7a99706125e8bb6f5e0c051c273f298db4e4e2b91d725b692195899dc2815e7f742328823896bcb555ee317531b2ea3b0cd97bf0e357e175909deda8e354c74754c0abbd0670a50ba96ae01499bf1a727a8f3ad60b723bb9d261658c4006cabb496b00c74104b4bc5a142a9bb38e13985fc3436027558f354bdcb34905afa6d1e79fc3d963d438b6da1a0d7b039845ea33b94f2bb90300cd18f1495da02f10532e9389c9ab539a914eea674b9f68a888561c9582c7896a2d1dca8c182a2e0f5e47bd1cec83694b35afa6a3fe6520d6d61cd0cb8541919c3a3d17a33228e02ef575d68ab922d5fe7ff91df4b16f0fc136f6052870d7ceba4dd542ef3aca163a2b6216453b48d3f007c759af3fd98032c1d6b55b0e37d1eb18150018517d5ab9f45fba6a168f3b735769e4ec86c4bf2a037ae9bf3591c12e045f6cc09b3a9dd98fc757636a6ea7ddb7eff28b699de3a7404b8fcf458c33d20bdf6845f2a495a1cd6eb96a198bbb9012253fc088532e0a284ad09f321c34a5253f52aedc2116f053cc28aa7afc151809714a02f3cda2a4a16d8d8a1848650453bf8ce16ac39c97975489044a3e89f1a3bd9ec049312e2ca5903073d663f793663b0ceeabc35fe9ec87ba9bdbf305706b3f42c55f84691cf8c0612dc4e41c2afcb97ee80dce72b4290c8e707c22d4cbc6c39fdb98da57ca444e7650e973fd3c89983c7b2d5b7a6092baaba0c84865ee727857ecf63e2ee09f46b4a1708646c99fcf728662b21bc0a5b5013e800211fb0e34294f7f879e3aea031e508283990db190744003257a90db169797c8ebc69871684df2aa0a6dc948327dda5e27bc7808e6334dadb2053ee53149d32cc14a9893032dd4b06c0c30e4577526c54900d44b6a1d1d17203ce4cd4adc8a9a5aeb25e22f02d79c1772ded86cb5e6fc446797ebb46a2dcf91803bd095ee67aa2fd70c868f1aa02a26f77ee307ca7864d17f76ab6829437ca44c74bd18b2f4b27957c03e82ec0c227db259e25e6f4300c0a1068558ebc1b6922c79a64278e29285fd0393e17451d7f7ca98db53fb25f46c93dfc02632f7dc1ff953765baa000b7f65e0b55619f5a11675e70f5c8d94dc4c4ab12a48f594b85c2020cad9559813b2478d8bb0ece77e2773db7ed04fb31e3a74469843399b9924ede41dff1a6be9a5f5f647bd4f52301408da1d7038b03dc52979d9e0ac0fd5c01a115571812c828cb718bb36cc91d3f46d6ac7519d8b05970b10ee9a5690239b0b5a19b11f4a8c5238e1fa8b6ccd402a727e243073a80300a15d6221499be2e95e2d2dfc70011321a1f2b1b1091f0f6a417f29a7953713b963e6a174d6e98c787b9dee0aba7f2b5af2e234f46e4528b262a27b66028c055cfa9f4a3edd7978860974afc4ea315b6fd5fa4d3b8ecefd74529caf58eed2136e50b5615fe8d6cfa432b1b9b8b56134193336d9f79370d12078b02e418b1f4c8df0921f922e9a068eca19e5ac15b9fa3bea8a9b0b740d7ab461e2e421da55e42cfdab7095717943fd94cbfc576d8e6595b415161aa248925436f7aa703db52db3007a53011fafb5c46eb9d220dbcd82c239543b49b2e483d2e46e7a58acf644b5694e37191f9e5f447876c612998a0324b937f33e09f48a32a4a12fe607b6f8a9279ff71872a29935a912ff3e32e630e1856f0a8ca2c7b34a88fc793924b3f49b3624370042b4f32a77b24743c779a863e7f081c9de016cc61db89a7a0fcc83c534c3c6e3162037f5ca96c0603d837d1df066c871e376d2bbeaa8c753a86031a97be1bc919ff7e2ac984f137ab9178f0818ca1eebe255feefc970223f74898c4562d82593c853b80a2dd8ab95fd0343ecdd9074f43ab0a16ec00b785aceb9b6e1c0f8233551fd6fd718b630ba11f7a2e558a61b7a8a937b253e0f1189726befc4bbd755600d9a10bcf6bd479cffd4e2c3e5a3df307bda144526cd6fe1ffa2c0fdfad35eda1e8bcfd3074ffe55dbb53626d2b099e1649cd58fac698262f143faef5a1cce4127ec79141d2e17e6c20452b5cc743590d9884de4da7704ca7cf8df0ae8ac8abf40564ee01d0f3ef7e7b9a7753628f3e4e6440c4d6bc33ead70036237b13a5f92f4abc948b3c76344db6d2eb30e504cac9a543cb7bb7c46f8de222ed446e018e8c270b3fd0369c8e3d08ee34a6699d3cdcdc984ccfd50ac6a1461a3fedc3908b125a07fa3dc2ac081a7f8fb24fb32296efd9e499ebe29fd5470e3150380e4725c91294642fa0b168e2a06cf756eced0caff1947315e8891b55b090daa894308eb382633f16609ae9f06bfaf92903ccf91127ad3afeeeb72328d666a23b5aeb8e7af71cc6c69dbd8d95b56205682ebfab125a00e85e6d53779e9ff805feff96a63009c6030442a872579c3ae9574cffd9703699f10a7c19ea221d258d2fb1a37be8258100baf21b4a4812feacdbdd82ddff99bfd4cad1d08c467332b82491642f4ef324e963bce0914c9aae07b5f7fbf25a8239709e6a9e1c0fba8956acba42749c0884efa029e9abe597d724dfe84b946e7cd53c0de13ce1c98ed8db0116fb0bfbaa2afea3b65a2258cc2ef2043a6ad9faab2022f859dc0e938a30535d8c779c9e1fe5d8249033f0e9d4e45f60951588eaf63dcd0042196106d5d81e6d8928ff4fd9ed68a9256a5490009a981a9a7f82cbdf4528016f8e437d480f7de317c3db5f924234e7d1a48e88b33994117e6d0af3c039c4a87a7db8fa3a84523efe6f0e125b9f8934f457b93747fadefd33a73223c76d5403dfc8279a0c4d43dfdd8dde0e7242dc89ed7e301dc1c5735c7a1b05da27997f534f2e7961083942a7a667b0a3c0f2e48ffd29a6fe9f9608f8c5c4e80b288d071f737ea739b697a97d94c8fdfc2ab8ba1857b5b9ee9c535729d5a3709a22240d5b5e238f02f2326ba806ac8a8a9d3bc4cfb6c88b9c2e342c24dd83fce93eeb953d6fe1b15e9b705fb20e9b2584f3c0b32c55ebeb9b25077d63ffc8230c7d2f790e53c7074ff5530a071fe7f7e1128d31de980b0bd13062b3544664d39aaa6aed7c350f626a7ba582ac65d85de7c612a0c52203b6074dbf3aaa8cc1603db686e0728bfe38800f91b3510248a48babd3bb1abf3152ee14035018518952ef6701970b24837e8922ee52e918667d31ae4a0c041f4bdd75fb8a357aee21246d71c6f4675db97bfa5710f14abc13870fb01aa7762d803881c5cb09fa5361056c66140f1df640b6979e9d8e3f4051a57b4f57f102cf5c75cdf2e07a5a0aa94297ac9db866455cd33e4c2524ed0f61a70573aa6265360fc083d93b2769700ee6b057728f85e1531ae127edec00ba8ec31c628e26c6a30724ee593f469952911b4f2f2282b744aed126c2da65c60e0f7b4623a852311502c89667ebb38b312cbd5834c6a354b1c2a644a218a1c2ff917b5bdf4c7735f4b0d5fc0471dcf8a454006d78dd2705219965764935127465c2d9237ada777d99c488f197fb524f7b8ee6ed5bc1acc097c3977d5ba84f766fa14ab26efdaa5db42041a1776f064eb9621b0815af8f3a552914b77abb6615cf93667b9af99f08231e8194b5c3fc548739ff7e818249e37e3bda044e535036ff60a9a0b2747adc423d17b986887ee69d1b99772601325ecbe98ba08b1a99bce6bf3f04e7eb029c21278d7e0738f83b4a74ee0e00548a912d7610106fedaed6932fe2d9ba90c789208541634247112ae34d6f258ff31f9d2ccc008f4cb3a58c91c858309debf8b013e1f32497843caa6d8ad97b06fbb4de1ce011056ec30e95e5b875fdf077dd4638f24a35178971620be798a135554eedcb17dc6dcdb7567ec9fee5ce505cec1ccb8eaed4339b94513a6cd5cc0d9e9e36b569345569dd5a010332f40009038d538e9418e83dc42505987e8777140944c21c13a77ab0d624119cd86a32ace7db0224b2334c2534a09102ab03d7a08810f664dbecca466fc7fc039a4b8301f51eb70ec6bdd69b8601857be0e57f2831f6c9c96c6edf5115a2c2016b80e1fe3e9c502ea1237345675d9d4bb8b6ebcb3238ec1826d5026097bbcfb21d5d2a6aaa723200c44e3ba14e9bc0399b672fadf25edd5be01cc8c82e622defb5717e8eb1606e7b5aa21f6e9bf98b44d1c9a23bcfcc3a8c9833bb4ef4b8ff308e595c59ef77bc2c30e7c56caebfeabbd4baa2cff799c782a75f12d6df8acb03be0fe695a216c165d3eabc1f06921476a909a6587a55b5324d666495f0a4c0eac9c3cff06a13a2bbe7b5622c55b71afe1c765d579bc3aae60342aa8a4c52ae065c3d3cede245290ec7778eb9cd3c41e7eff7b644f9faf376d12c6b98e95cf0fc68662f3223c2f2f53916314c91b6dadf0538ba90c71cb5822a0e19a7a4de90671ad16789891a94afb55837615cc09b966ab95c2d44867808b367a58e4ea53e692bb1ae5ef8ab2503c3ab77cd24cba225d85e75eeef8eb23eb3e7be79f30d5b248d691eed23a1d7f9d14fed490e55d4cc374c6d0123cbc79ed746feab7912d28e5c743212cc5e1807b61a03cf2d5de86eb5edb87e23e94a2fba73d182d5578b263f036222fef96618eed73d5f712e15857968473a83a8daa7e2712fa981b526a09479330c83f4cf6529fabf265bb6ee03bd0b1ed917c0dd68087489b4dadec7bfd9ae85d0eff83a824184796b461f6fdaa835f65ec48019f5eb44fdf3cfce0bdccf8d97be603990b8be69a38032cdac4c6522de2729f7462ddd416037d226181e07c47d597095d3c1ed0216b926271296565419b771f680403d0400093b8a05e96ffa9111ca0b80aeae80fbc3b5ac69b2226f04c78ecd6829b4b4d80903e020ebd35aba8e848a71a17b4084bf35ed9e010481c174ef0f5f683500f725657765da17b06df1fd441f48f0323fd4bfa6db9fc56ac0801ec078921509250ab4a8bc9ca94ed6cc658e7082526a8d99e8ef9a32a71ea05f338e728f51b1e23095bf69817ae2bad725df9d59ee6af75bce1b5c5b1858888fa5aae4ac86ceccb1fb3aff39ea9e7aacc7c83a5113949b17e4d336cb8e0d1149cf98a84697084b62bd18e22d47358e021bb6fe51b1fad629475e6ec6a39005fc212c6f26e4e8db685bbe553f3f3ef3254c69802ab654bf723d3d80cb94aff1c9a71767c53fb0cb22c3b40f6ea592186c718f12da51bae66d74d436233417020d6932601ca3e54f9598564558a9bad2d2cc837a51191de9961b909d18c5ccbdefea96e2c5f92cb75ad4480676f567c15edc6c1693cb0907c94fde5e6a7c72ac611e3c40430d288205d46f610f5ba7000ea56e00463dcd14b9fd8b4e952697b4e019d88fab9a8260468ce5c90c614ea2b7bedc6c67a395da5f16c9df963875b7bda0a1375777797efb45d8d766ab4ceca1d4ff9161a0d651ac2f9accad1465e3f3da1872d08d9150123988f7beb3ee1827d392d1b199f73db0482a5c69bbf2be512661d35b41c94c826c44c19b27fb3b1832f9aba4bacb7934a25e2da55d4684df6165018a4cdbf59b047cd392ac254550772aaf74b8b2696f37b556a140c25e267184a99695dad15a12d3e9666d178e261b2c429e8358803f48203999b95dcf9fb667cf9b7c867ede9a4084d36490ee3e89e2fd29126b0e7bb6f3dd98e7450d2754d0a32a4aeeb7aa24206dcfba8f1770ef9b48b8b978c5034902d008351e690bd71f9f3c8d3bc4ca69be7394d9034e9c4ce3d15b1d7d7ccbaa8998ef52c5a6b5fd92b1471654cd3ef72105bc848cbf2f7693a645dc7495111f651d5e0b52afdcdec414763139ba4b85e1bec7d000792de3c225c0ecbbde73aac630c61d43a2fe78e7c47ae80db8c4247cd327f20c15f32347180cb9d88a898b9155b1b7cfbe40bf1a85f495e24095378ce5f62d359563449de060d8bb155cfd21920f034c3e3743e82d3c175035943e65cfa0e078375b9cca1eff8a94e0ccdd80028addaa8d6084af1414a8cbf586974a9628ef9377c0fd5c9a5f46f953994135b1a7992ca25727d1093db86123cb0a2a9fe0854b9daa12fbcaaa206e197f660298ab871e01e692c020ac81b35f802131521cabef4dfc4b55655646ea027820ee5c1c9ad110e0b878cddf22a46123786c45238a31dd925df67284f7f88d35c7e4b08a2caa7622b6c0226a439ea4a8b41cdfddebd2593f7185583c0f54f7a314e6a843c8c52adcc45582fe85f0dcb5df9c2f2df7bd55c97191c2386a6b143aa118f86f5df5ae5dcbbe13202a57539893813dd5b511755eabd7cd8cae031e61f5949511292fc0b216b0940f99878f4bb353df9af9a1af866e193c17fe7dd68caa35f2e141188795c701be1669cb80f5484d071c5d14cf818e23e60f04f63023ff57a52e39eb7ddd38c043485f33257bef6eb6d310fae5a2b2106f65900ba95b4be07b9a57f4d0e17cdee60fb738c6ac36491783150f5ea1587cc6d2807bad51e05399ded0f0bd2b0f9d3f5448c132fbcf9f42a68a96db47a3d68c0e9df1f2f83b5606f775f966b69239bb9aefc277476def0f0979e0b5ff6f1503b510a027cccc559d567e9f8321015eddc410a821061e03793ea492c4717df1868e29210ea994960ffb223a1c38bd9b0576563197c02b1e9b649c3e9599e93ed91e9e53e9648343015085119842086d5bf9465f6b80df27d803f4c6ea9de85cc6ba1e696487e2841806c7af697f5b77f001dd2a95560c4ec31001e4bc25429a97a023d7b3af4d241db0d004c0d6f567e02c028f3587ea51a852a10c4f0e38447e62c60fa8f44ecd473bc5443ad7870e65c27230bb79a7179a22f7d0c1f953119481a2687fde1fdd4bb6272305735a7b9a8ab39946f1fbf0a66a1f5c220a7af05d61bb5f17d32d2e284fd6d6ed53a66a1cd99fbeae355a1dc6ae35b5094aae7bddf374c9dafe55a7e00b8b3d51d70b0f528ac478b9ca1fcd718542356996469e68829023df179c6798c871ce2af863165e56996e42410c4348f218eb86d0a017fb219eed659a2f75ba099049cfc176f0dc1daeb3d832abbed5ee66f0f0fcb56fb2ecff953d347c84e9d63a316b66ae0fe7f1a660d2fc22c3f5a026f0ef1536fe78746c7f1322d5e2a4bba0ffd065ac8c29fcfd10f334b2e35c039ff16d074b5490d912bbcbb84020da4ba518a186db5497d518f663e9b46a5e8c7cf3430eed75e51f84ab44502684eac2d404ba7f3391f334d15e132516e55aca13f9a24b8a60c9b10d069f10da771058037191c164f3a0633f2ac3f23d869894cf9c33adffde1b7f20e8f0c0821816acbfdddd427fc2cbf0837536d66609c7e5ec566522dcaf7f2b53b395f9cea119326534895e10bf94aa92dca7853bf08fd7783cddb2bdfe9fcaa7da019331f585cb0a2b7601facf8e18d15fb6ccd422069e522b51c174809368ba083e80e11e4b8e1803760091d3a7146034c6912f26c42851adc3cc20e7037df5999d28f20c54e4047b7c88487f8b254e11174095f78632c5dde7ae8677908965231294acaffd677f26c4c6317c87c3a29b8c7b2a65f80d4746b8cb20fb3ac4fd84c3f3141f81e93c643c63222e989e4f0bbae5c1de3cbc927050fbde851b4cbeeeff316588c13efd496ced973dded7def125d5e5950db04e45c138eb42450cc2c907691665279558179e89f9297ef8d4a7c1d296861e42c6cda8c2dcb8bcd4e54cdae638fb49b19d4800a3249199c006ebc6a50fd1ebe9674b68cd403813e9b2f4075c4e96b4d41e94a653536f72a0cb53011bd9ec948ff933170a51c7bd3a757f3695fcd0564e53966b857eb0328165e205ee54384dc26e901933cee8a427c8fb11daf6f6e9e109c32c087eb76f7fa429c985a70783f723431d56d13a840e0c3da9950ac2c0898c43569e31e9df20e15544f0bd1ee4271114d1600792b4e231acfd2949bdcb95ff6852fe1823ec6ea223e1579bcb34790f2215c6ba9dc395ea1c40ccdfe93d04fdd29ccac3347639156d69c8c8c451634b04afe84bcb22be8b9225cee2e8d6d2a335f61adb3e960c0edba318dc245a8d2ff15d59af31d04f98b99acc2f784c97b433aa58cfee8ccb620df1a55fae8dd1694639d37d3789ab4f3dc2d0ed67d28c3522a268746b32ef16dd4051750b18253d564413fe3bf5591a61af2b089f5e507eaf693e72fef1fc3999ad8772fad6ac1bc3c1fe065fea1e8bc251c4d1190db3a942975b04e96fbcea992dfa0684f9fbd8a75a12c58d0a62c5ce709b3fdf0808c75c92ea9450a48b53159ecf8964d63bad8e2644f826773f1bd5c2c0c09f2a0395020f646c18a13afec8420fad7f0461cd132cb46ecce59d8c1c9db27724590e218d84def2c04a82cae4c2edf04d9354277f8a41005428c84b64acc8c9eeda38605a9b85c0e27ec5644bcbfcf4804e1bdb2ddfdaeb5bf0d3797452520cbbafe7b88565a3a13364ac283952ba4000e9699d188d8b837d8db96feab09e55dd6dd3841fc612686928f16c3f168e950f021f6dc26fccaf7c9f8a03d3bf8dc9c833086b95010750b8b303f9c90328034d24831c7e0b020b3b1fd1a68606aede3ee34ae94b6a697df7331fd65ec36d8c13d3eae8c03942338a7fb05c333a6e4cd037cbe3551114587324389238db43d1d30b3c36fd2fb94a2d17eefe9506afccede238aad2331f2de51ae9d1abae323dc7791c658e75e8ec4e89b4d4640924613408170bce8e9bd23e82e851e69430d8dfff4934d9c74f993efd4bd6df41a073a7026796a6acbd82341df556fb3b3e03101e228112517243f32bc0e81ca9770a1d45bc534278b9657fad725d0a1b9a097401a2664a8adc1ba2e45523e61222b9370b7095df1e417c9fed5f79786ddbfd9de9776c7d66b890da1ee181a276347f4adaf8427c4361b3df4594db89af8f280aae716cf84672671b4690c3be969fdd7b9115a4e2bcda53dd98a7e5e598e844b56a14f9c811c4f5375ee06a67bfb86ab605bc7ac803b7cf7d890a3ed394d26f8bb4349cc1b9f5f31edbd06ed1fe08059128658d0a8b5c44837c8d8ce6a34a95c9fc7605c84136050b17b03d0b59e42c599ce4265c00a424f99435746d05ddbf2c8edb3862de601b0fd30fee3451e90fc0b1757048d9777767fd13fb499ca690f6ce50b9097a0985d4406f686031c7da1ad94272489e1b16ff4fbc12af80ef743fb2be2d2c2349331c60035d0e49e2fc85eed4aebc83f4c76673f3821052edea1cc8d874018cceca4dcc318f4bdf737e021661aa70ea7dc90eb482b8771311b8d3327efc75fce8b8367a09c8ce2e712da45a852e4fdcffdfabc25e87428b0b1af17e6f6fd0241b2f2dadc59f82d7888c38ff489fc4f4b9c58601b56a7f408f8d677b96f17d109453fcf488f982e6c243aadeb2349f8ce23f85d5ca5ef1df825eeea34eab8e38d62c55734c9c4020788efdcfc875610e219eb4cc8eeba689e1dfdfea500b308f5c547bc11170b5b73d5abcac26f74b1df83c51b58c8349d58e1f70d55040d7682a70c18559cbe31e83c8ecd57a710827552e1cb5d1504b5959312fe0f6f2a1d51ef34bf7d6cb062207cb5f6f4e18b02703adbbcbb28ae1f25a184fa1861f4dcb63db3e1a068a93db641c3a402b9c420097f490ca20e2e33311f9f7657b8d967693bdbd88ae4f69fa8e2d896788620d822c4ee08cd60fb3da879d65eb625f0cb563d39dbfec89c2b6c9a0186e01bb6f6da165e982c8bc2d31a0507365b0515b0ce623eb9792d0884a74511f1596e544c0dc36ea104ce8a85feec66d0749c17a3420858cd581335449a841d70644809ed0a212c15b8d9a1894faaf8e48251679d53339064c9e682c628cd0ba8493f56593b11bfe0a253d69639ec677e0efd3a4ec4a41e499774992f8d0d0c78ebb73880c5c876a3d8cb124c4010403982976db15671e9eca79a33e98612706bfaa46de53e80747e9222df8d9b15cd5e3534432cd61c232404e3df749fd1c5e3914a340fe4dabc5aa9dad48f9e0536887c99de0b850606f79ee732dfb4630107ba6fe486344d99e12455d111d0a7d96da75aae0b9e0c12d4538e90f47ba53ae1025b3c59ccf51f71a193eb1771df65ad0b897457924d6409ec2f25563f1da9b6c99c197606a0a755b1c72c5261ae5c7651c880c794dadae9e448d9e05c5d697ea121f93f62fa3af391b0f0a82640d432eafc12e70225a67da26ebb2c04a6eb9bd9577dffe59208011d041f4115b566e347dd51e0f6c01e65d7a443ceed2bc579402e7272fcf8ac7125b959d1154df9da5302a88fea3762b5aa682287f01310cc336461e5b40395621bc75d4344c00dc703195b437aedf8277c32bc3f44d28e6b35a22bc208dceaf43b6d5aec7d749f6df8e827f78db8cf3dab510fd43751aa50de8326ef27f65a26dee26b408999f7e1456ab4fb5aef69eb454f423d12322765f033e510af5dbc12ee8b557f75da48e69638d3055e42e692c9d0c95780af11c63dd3d60a3a0718c4e21f3ecf644f13819179f95ba9110f3729690e988b1f7c25e82a9d5c2e8755ffec52402c9e36f6e0544c5d7d43a139406cc9c85595962c52fedf8e49c344401263201a6d7a0c7871a555aa9c7156e0c24b7b6c7d3ce32508d43a073928da996dc03fbed08922d672ca61a3704f9c916da38ac8cf5405e03470b1687291eab4553827ca7d95545cd7b1326cff7bc9f6bddb0f7c26fcfa26b9d4c1e3dad3c398ddc5ece8c9f3eac9ecd5684d337a0fcca0203a70e2d812bdfe56bc38a79ae23f519477f6bc7be7b8f60beced60926bbb1ec69d0cc0072f09a2db9b790e5f30b369a52dd99a485ffbf54f3a1b373d3ddf7886b78fc24705dfb65e4db22970d3e371c8c9922a436829d4e89cd3a9e032d6f0a6e4125aa1f4299ce1cca3e2f50d62fe1ddcdc3ee594c35e4dbf20899865013b2bbec6fb5e44dbfb901978acc8d8d854a1e19cb3ae11729f6fabef56e4afbd0c9408b06a3385a88182550f6add992693b203abf0a8ef1d03263caf9d564f9b2bcd591519326876655c354c9097a1e63b90e22fd240c7960e37145c1daaf05b4f734be382b43e8c3e933e6d4a4768025659723defb7ff505c441c78bf7a007ab119b152527241262705c5e32b931a3f0f12fa3a64aaa4f2c2f4227ea3f1d4ddf0734ac739c4559f132405c99e895e4745d0ba819228138dcd790b604556fae7d5a9692ad7e1c1d3789dd10900f1da47afd1d031acc40460b01c1def5123ff72aab4741f9d2290e85e5380095b5687061cb145d28d23b8abbc8781de992a40f37f3ddc0278bd9fafdedf0f8396b8cbf2131251791e8aea80c470490e7adfd23bd7bd397d00a860c8bbe5a0da9482c5655ce2221a7e496dabbff9b57ae7982ecbf83946d1529a9b60f5d9b15d34dcf300ea55199c7785b8fe09659e5734d74d578fe2e3b74ac345382c84ce281e4149427978c51ee3ffa457bee6908f7f81216c5f786942b2e5287f64062c6c7cdbdf5a43a8447d25be8b7f05de6eb71e2fa72b94df418bf9b41f1e1efefd39998c9840e2c83d646249a8bbd185899418103f3534bd8103a5dd352c080b044b3584f8d8603c026427c33a0c657c10e39af148feca7772d35e40549b662a78dce682024cc84d97218fbc9019334b24eb70bbc6c5b184692d9c22e7633e7f1342783c7cfb17dae87109d4c7a1a1f8fa579cdc80b3abf3e044d4c86fe622e9a8c0ecb2e1c592188e9d2dd07a8a172bcf4ef62651977baf63472a97dc887e65b9566f4a485c4e34564fadd736308e856126c0879fa3eca6529cb35f0b361f223c5cd7ca44cbaa353cb4a7d4e282560b902fbf84e5bf57b6c8c2c68c74584f2ba8bee39084398fe5e6eafdf9fcbd089c9d9142dafea427fa4d2dafdce4da0acc831f153d9652c1c8fa49c417d219eaac1a3e18edf8e463d525aaac6ee6b2175e5813e3dfae1de06e1822c061c6f067bef629074ffc704cc493cfc1252f61d6ad32ffbb3822a4592e6a64e56f1334354f7b06bb1e6229b6554c3b271a8dc7ec2282aac5acd510ca719774789a699ada20edc257e85a66e69d9fe206f142827ba5767b0033381ff8f463a4026e74de1b016bc608c367b203b5cdf4b248e8f4e9cba910aa4e10e558797100c7ab38a9572ab7422c2530f95dcfd23d36f191045546c971096e3a2f796f91ff2f496aebabef34ee470d89b445fc7f220c39d6138e74ddd1248042ba1f99937bc26f92696f3978c09af3d0ec079acd90b903ca03577c45370b5eecbe96119e5557098ea5a1be37aca9c81838e706713e2f9441b3585962162732c53280a6838613533312a1f53a3565247732a48938f7901ed83707770d5aea5c6b05c4f909449e1b4e8f0322bb046dcb19f4d50139589f5cfd94be8915af721637df41c1049de724a7e54227ab585856d9c189f41f954c82ca472a80180528984364cc35a1ba7022bd4c8e45c8ff806d03c5434bfe50d275d2319fc0ac821d9cebd7a53e71b6dd3e12ea36199bd619f293d819449b08040068fe85e2ffc41120bd5119fb93ce68eb880019d4089c7e392aa49ffca8c25388f3e9bf10ccf1ae5b4155895af60261ac87805268a7bc5ca525cbe9db6b767cc558fe35094bef653d220c738e188d545c52d26e22befa676b79c5befb0dd5278011dfb3676d65a46600f594dbd8c32ae2dd26aa38d708484c926409e416d86f26da27957090bcad8b9ca9f0764ef90cd0e911ecef18abf3fd461c33a4e34966b21fe2aa134c2e44731b892f5b11c7290cc0e673b249cf82f01c87f7e28757c0917d89065a1ff2a09c04e17ac755b9a7d123a1c805ded13d8574f7f67a571740bd314c404bedfada434e4a94c744897146e336529895eee4a74c2ae3e3fd01c5174ecbdbdb115616d748ca48dc98b069771ba3c8895ea56805fc5826f711649d803449ac828b54340edb57c1cafc571285c72300214606c1e3f0e05a35462cbe30be2013c646d368c5dcd9ee4413661bfc5d0826c3c54dfee38e60848783b069ad711b895ec714e8bab0faf3e7aeb41dfcb3a93c65e1bc132fe20dc89ce5d1ffb63203264b567ee0fcd14323894caace07b7a6d44ce8646974b9494e7557e2665433315fa7acd525419e82dec356097859767180b5d4933fe2cb99033816da26ffa6ca2c6736e6603522bad00f8313dedbed3bd526e4d7955c206e1f056b994cd540547fbc285872d31d9a2eccc6af1889a7775356b8ee1537097d47f3cd70bc98841abed7c199fd8b149e1617d9cf416535904d9d10376fabb0c9efd4b5a50eace4d5d93c0e5eef0f92b8a5a2e3ec1dd3885f26f0be534fef1764ee31620897dd8c1db821084b354bac778964f8c0fd3f618237aa82ab8ca58b3f0449940c4b4957e9b581354a4cb839977c8fd51e6c488b26d7c459f5190769fa760f610d10f12c48480b8b492bebfe7ca4b6f8ef82dd09edf78a6e9e0e68c86377a99b0ee3bd03b0e57f215bc25f712295894504e636b445ec459b68c41682e5004f3a7e4fd24088c9516b7b5a92dfc6daa87e2e7f6a434f79d5ce5524ad19170d6501479ef949ebb37124b40b9e6f2d2d11d609675f4a8cac0faf43d7698811f54dead357ac2e002a33e9cfcb0a6a03acd7371f872a286e6d0ad55fec692d32e54bb6ac3e8db3a17fff04f0e163a40d0d7d9e7dcb068bdb9e70ff5499e47e62c730331ed4afceb12ee8197e39c531b6389523f430afdc40a91787de088c84119a89ca60af6ecf4c4dd9ac1195ea77029ff8124d33fb72181bf04e53fb33aeb39c09011967cb6cbaa666672b3f75d57e23a63c69995b731c71dad59d7079c4460ac8e92f2aa8e47b919d09f159a15013f57f2901161dfa76e412c2771721cb18b0bfbc45223a80fd2d83d1c6b4c881ba8049a57503455a1fd14fbfa58166b0a7e4ce283b91f197d5a65b2599ac4c838e8b45c662075f520df78d32e3d58fd1ce193e5027ec6639edc107dedb60b3ccec12186578b44ebc578109305e38cd991f94caf863bc0f116ff7e92b83482b4edb4e3767e1e82e7f5f7187ebe1bb1dc7763bfa73d2a14ed04013cc9ba9d96bad3e1e4195b8f804f3a2e61b086002ed3e9d1b7b0700a09825242f04f22fe85cbdb9f7f1f0ff1b3d9e56419c8faa88eb77cc80006cec60ae49925483a4e2ac76e786dcf12669fbf0f059f58c4034cafc2cd9efb19bd27eba5faf147933239e637b6954bd49b304b69f022262b8a0424574327ef31b3219e2e8f4bbca2871d97629b22fc417673d637dfc3da9b3b04727202ac570805ca0f283776d69c6bd15b62549b01aed828a79f477cd6498eded8f08646879b4b248d95159d657909a9efa286f84e0ac07a5230253890a1b91f9a5788bc7343ed204d294566919d562e3d1feb3e70165fed97f37b1c70fa085dd2730b2177d659aaa0c0fdd6b17d91f3fd9670f7c722499e46006c15d30d6546f9367e2c911d9c082276b8ab7f5e664907476adfa1938bcce0d536d98909628c0978d8f5110ea82337bac9f5056281ad6a1257fff8d00096e7c50084e94b44a3be5c689a2b476a3248dfdd899842a018c2f920f174d9cb7f222888fa966ed614e2bfe3c5715f7a5f40fe0e0d036419bad151158704745e83d679ee776805df8b9756444ff64697fca7f9d47e0f5d8c0081bf1fab37db8656873cb38c46080285ed5cd3bb6661a0b7c7c80eb56526c7c13e53bfa23eb3b6ac39fd1cb8f9519eb88b43720dd44cc44af441f1ed4451133ca126b16bf3275db2df95510d26dfae23e35cd6e33d394dd9fcf7a99168364f3693dda6223534d543a20721eabe483b17010e2057c431366fb47ab0a7a6253db68cd04d488ccb69a2718423ae1f0ea8754504ebc7ca5c2d5400e90f691d69361ba852dc13d7542512cf870486ffa47df7f49237b7103726fc553cf0698eae16b60b1abd2b2a9d7ceb30553138855d92a987a103e260ec2455d375360cc9f93f5b2397a1b4f9cc32e5bfeb51978c742d5ec75756eb1bf30b4e59146f38b86e9054cf2a2b20c5a19e44cbc662b8232f777b1e3153476912aae90b87652421d369eccc2e494e4230381d93254ead762ec7c7d8e57c0fbed53c068ef2afffb9d556f099bad6d5f5b5f30f9072954200cd84198e41a1a6b254f7285556d975548a06275bb749bcfb02d498cbaa6ab41137654155cf332081d82ba87f58f7f846eeb49746eed1f4fd1a2139252ce4614ce78026da3a0cdb55592ef6ad47a3f512e596dc94a1a514b4818c426158e7211400b933a21b9f87bb418f720b8d8cd7a7bd8516c19baccbfcf3d3b577a86c6738ae5d8dace6c2e7dd0f7b5eb1ea960ff140bb0a133f2b8097d0b3d69b88935dd67649e54bc33bda2c39fa79795b2189e4e37b9adb2e556bdcf8b4ed60214b3305e661fe0687aec76141096cd35549c212ff17581bcd89cfcafc1caa5ca698271e00ec4d14155eb79d15e23bec9bf31f9b9485ff2ee7d160f332791116530bdf38b9f6c58337a890dc5380aa828ce32e99262db912d8f58c958fcd82584d4139602ad5fa43dfe3ced25ebe63845ce945e7fe76ae4bbe0564a669ed12f241d69f8c60b88bf7afd48999061e546ae5714ba5413217f81acbd12ae425ce75f38517d7a27ebc7a661cd9e70cc38cabcd11b68dba2e5116d95551765d1a5938b2525025b13e5dd4749c85f17d058f2a90087dc1a98c9cd32899a277d290e27b0c106e98a9af68d463f45f1c7ae89df98463a0fe17d634784587d19f006ffc347b039ea916097a5edc39ab97d09f98a2421bab1ee2cb42804b70d343c9ef2ac3a53be868c2ae9e30b5c1a66ba868d83d4dd293f1815ea704d67f4e83aee687203f36c3c13bf69f33a74bbced4f7b359767c3ac4a1091955d869f60cdb722d7dd62f6791a3864201bb556621799e58c788adbd71064ca546dc41f22d961909ff1edbcd93f410fb0783cd809c41c65b02e9c36b98fd538faa184ca00dc1a2591651d13db9052bf5ed46e195bdecdb8ba950635ae43cba96f9ac267094f8775a278000c3fa7124ae8d27d507f336a998e32699e289365c37e5b891fa09adc0cf88e8f81edf0ecda54a8cac077e837c21ca5e744afb05104bfa42e6bc18ab960471cbc29a0b2890f35d279060bbf987592439a35f2cab7479c484061b53384ae9f3aee22a20e0c760913b2c86f9b96a6e48fd2398365f941da7bea10c7f61beef5c8f1f47c2cc8607b4de93ba73280ef61e0bf67acf72ed61560bdcb8ebdaa3d39bba67e0ce485998927c5956cb5f5dd5b3cb97d1831be885a1d2a93a58f46d270ad8864e84e7ffcde9be190ab084d1bf42325762ec62b95902521cd4f96e4e9194d056c1d4fe489c214c439b131feb512ec86afbbb3014a3be17f3727b8b285de7f4f4a649f6ca10ffc6899ccfcc27589d2c61e46a06ff3ec0f460e28700a8847e2ef133cacf0a91d48c45dde7c1b3e2d405ce8c6c9c49334f4dd173f13dd9055d9268ba431970e3984f1643b5d7d810a42fba5a823fc80901780f606c9b4ba0f8373c8c2e9d3e5f50485d30800ab2e2613790466e80310a898ad9c8c2306ac209d0a17e8955fe1148e5cc1599577f287220469036bf8cf98fbf36a0f52c27afec49d4f520eca8fa00f9d6d2dbd99b86c3c1765578e9c7e0d6dd6c9802275199da19307e97c6ee23dc308e7fb43aa0a1c09d91c1cb6d38744764316ecaa821b7b6081144e4cbd68915da97a0dc9722c236b2d25222d2d039c5191b5e90bb5f8e7a5fa16add4794e74ea0885573aea7e3fc2759b6b2990bdb34cb5f9d02cc7ee2495ce7e9cc666d225a374598cd60fcf73d7cdfc415f5e614f30a562ed619418cb1459603fefb4c0e18f9134a94bdb3b5d5a9baa1a2a6d041a591bcf63e4657b036c618df1bd0927f71fbcae79419f187078873d85670e2ca16107ef8f54ec4d1851c25cf300981cf7920d7f936daee06f8cdcfa28226f3a57e29bb4886bbdf6302161f9fe99dd11432c6ced05aded78ff27f21d0f77f72d3f23cc2ad60eb1aaad16898a5a98e5dd5ea389b5020863fd70191618295fc8587ea34c0a79300924feade38f4409266b1fdde1777c73d83d4abf17cae288e5a60cedd189b97c3ec0b99e601fe91aa030eb7e67d33605abd747b7052fe5d82ad739a78ff2a49d7aaf0f2c0a787becd132cdf6a1550eed109a0f12c3181904bb577c8372b366691a360535cf255be5b5450a71468b9900b52ea31e135da083f5e557d2d04c13d87a2da978c916609d61f65c0b879cf681616fc3211098c93da3d53a129737b0b7eba31d44733e4e8b030f4880a76e681de19dc3437dee1fa7db3cb5ee3b7d33bbb73dbc2fd16b5299229e0522b39e4a088a957542af4340a58864024d48dc33574797be041ce16e411962c9bfd02930d820d4059203e4d8d8d793e3b4635b303debcc4449181da6cca10fd106a1f8f1d36177d8382045b6d8642f82f01a3df7a7ec7d952e249c63d894ef880fa55683a4f37c28f76c432972853dea2ea788fafa3a09075a294c14a15839db585f259dc5342d8f84c89c5786a1b90de24b8865a8b668e5830fd8c81cffc9534fcb33ccb43d0f4b82affe5d1c891da4b6d52106da7d88574ae535831508d854b6fd33895c23832082a7f2f93ff06df050753fa0a127d78eba5b842d5aba21752707f8d0ebd2b7e79a3034dc71aeaa85b134f12aeb2774a71f98299473ff28037d0ea12598e8870a7595eb6040040917e8db47b3aea7b2118a54e5e9912106bc514b514ce49b6bfb3ed29a824af06f0dac7cf09879cfcf82821894f251dbc765293bb9c7c91612797fa372bf3ba4edd738b7be4357255809c15c039517a509c19f8c798f4e50e07b34a7237310a2f28c12ba450736b57bb532cc4a80022b21aa870f344bfda8ce1f7da082899350fb04b6ffc0be9227100f58094dab5cb339b797f1e041ea79602566279cdd8e9f5911a0ed94308f4d0f510cae838300111a9d1786b28528f3a5983ef7a2fccf27a3a03ea00b5b4d4f7d1b0bf3980801bf37d7819e6db6d11ee2f2f76739ce9995fc1aadb8980f6482095e804c9f3266ce319dd348364197482e80c614fc1dc63001115aed94ebcddc6c93a9f2d1bcdc183982424e592601fe52a40e2192061f9a65fc6579c4a1cf96c5d4b41177d668c5f4383afca12cf88d13bbde5788b02fb5d79b15439f90294c2a89bc8525547cf84c08399d13aa96b8b3dc23360cdb303d17f907c746ef1c7d8d00c1a21a97ea0c8ab6fc6f0ecb0aa3cc1272d6a4bfc42b656bb2640047e7a5c4fa048c0e1e1c62a43c76c5896d7df40e5107b483bcf9e65a8ace74dc2ad838c213026f79aea1d539f008c5d3f860d0b3a36790d4274e91981dda585c3b634186fe90ff81ee0003efe381004dd2afefc9ceb3fe190c249f0bcb4a00cdc0f79ec8a39e98ea4cf6266e06d62ac2395f24d4eb53e0938bd27abb8183d300082a8457e9e0226e4eb7c2e101fd71f151f7282a39065ffd56fceae217d4e38b83f6e0e4fbe1252770337a899974b4c12f442228324ee291ac2cb883f396e3b9835aa1c254461be47e48566dacfda20b105af477253ad7cdddbe3a8f0e460f6813f7bcb4eff1cd4b66bb358cc7a46087c943808c42bc0ff69883264f4ef41fedffcff05cab4fd68d27e95d6271c0cd00229b40148b0251edffd948e767b25ab8bf1869a350d4a24eb776667a7aa6cc4bb044a38d010a517c61a0c1502f2cf66b3eda8384032ae15220d0b4bae97d872b27294e8e22b625d8a533f14576255087700110765e9287f569a177fce14f84de844ff04b4d11b930cfe4337cbcc706d7350488d4b441b0326d0972785c725844b16ff0cdbd36163accff9104305633642855e3c70216f1622827e74f1bded81b77d66be34c975f33dcb25780a4da3bd1cc6de02f1ada4159c6e87b0631728570114f8e7b3c2c43dacee49f3d5c36f2710e77f2afa618c8955495c0046742a1aba6c899680c80a04ae64f87b7caff1491e864d49876b7904d97060345f0710ad33da2a9e130b3d460cc28e26f0a10d1510913c59427be8c64c640f5ba29339fc9c1e96f2fb88e9176dd650ac4e37942253c11b5aeeddb40030427a2f36dca7c62640222b9171447de19d02ed76971623d2fef02a6a67a2bb9b58b8658f0aa2f9e46752830e80a9b0288abe76b8bf3ca4302ebe1e4a483e39defd2a5967b71c602c2c022bb7b9fdc2adeb973cc80ef0556a226564c8b8d42f6ec374f10c8251034c85488952ae600c551d1799f315396e0eef52cdc699250f7c479a9697c12efd248c95fe73810b302507efe0d349d616ee8d6a4a56ac03e4cac3ca1973f165eb01132704b228a082de7d9cdd598c8134b44699820856219b1df72dc19c53b23c4db66d4dfdb71953d83a9471aac9b6c3b9ba7a99e58aacae756b2be86cefdb8282b50fa554bdfd961956925b808c894c2309014c0053489f1767afa35c997eb3571e3f2f6d65f48860fbd57ab4b7e88a8b1177a182a410f0ac888702b2b8328fdc7864f3b43d0992530307a731da86bfd525d39e375c22dae4cc4b15bf9d7710dc39edbb7a438243b7d861c263ce4fd6328c6f2b414148e70006193bd5d77556796b953b20e60878c72ce8fbd4b7fe7f7c74945ef0b90a88b53847f7995ce9411744f916bdd67ba5dacfc0c7869c18d1fdd2e26d42a0c0874d58f92a2504ababc3325fb62bedb60e905a6ae8d39a9c7ff90d54374c2beb5835d3e1ee75f3d3918471d2e30e981d0bbec5199a673f932935b25cfcd36960c9c288a6dcce90208b37d3d64ade8c938d4a63178723b527a50a86a7e43994c9e735c40328bbfe060482ec4f8780b39879bd1c307d006caf12470e34cf5bba87caa1d2bd9d581f552a3aee0e915677298afaa3d0727b1d69f7703915b1db41380850521ef3e126e557b6390284cea8d46382902f7403d32d686214736a4c57937de0c956e5dcb804b6008fd9c423b307166a1087e858d6f3a2fd71a6f057529ea9a1333bb81f8c4750da09ac4f5dea7bf04c2dc4857167daf5ae3763ea911b9589c90e09f9d02269079a66ffb7e3a6d7c19d5352bf6c1ad2605c52069a511ca7eb8a3d7c8974714e6143c67435a43d67affd015999002de35a2801235a397a4fdb2ae129b9fe40833ab7b6847a410c66097e2d94fe18f1bf091ced95a070afa70a0ec07f661b4be6108b6c30d96d55e1e69cc271e84af685796d478290b828c3e5d42c33607cc22033b03a2f0f7657a8833685414ee0bc5e9deacb065bf86061b8275e66c40935987826f55d8aaa5a645bbf189ab7d239a25b4a3a8c2a450d947c83a369e0a7e0b2645a9149e40c9e3a9f2317fbddf50d0679a7b7459de33a716e1f23303e57da1925bf74084995ad52cdc2c182a8184f94cf7e07d4da021e59319ca5068c2b8027cd0a0178f6d93952f36ce64816f54cccb7fcea1d51e9e76a192cee53cfeea26ed983890e0f722e9eda7b3f4226b289abd398ef12ca29f3d3ad8cc6a219e7597522df3228b7c8b816835c57959ccebe7533e119c102e8fdda510712d8c1ef1dce6139b1573ce7872c20731582c64ea4e04e23f3b2c0b56fdac7bfbf4c928f67211f0b54efe68bd236857723350a55c7efb3b32339f367f6fa08c2c49dc330b0ef5269f1133298006d0b22e0cad89036701958cb011ac0d46c9077ca49e7e08e5e6e3d6d32c456c35b2dba3740446ce8a265c945e5f8f538766aaa0538e2fdf8cb661f29630f73d7346366c1dab3f81b1e2cec8968508dc58e2c7ddba82ace25ffdba93fa780c2a959aa45a94eabfbe985c5dce85540efe5ead808eca1f406d5b5aa15155ea724444f70b2d485287dea6fea741f5ef2eb4ea6ab87888d20acce69f96389dd5cae0a720dc07fe671d1711d9f2a6a7cfa32593eefa71646cf3f1ab36ab94cdbc0813f7cd03563f52c227b7fe6a5f55dba348f1bb1298dd91544611ff52b7bd8eef3db8fa677da278d54c4657f454a38f1b9d86be6a40ca442f9e1912ee20316c670ff24c1a0a12ff5a3c6645440ea1c684404250afa25aacabff2b0eb58925f9d16e3894e4ff943d8c35e36d076a9e882f2a85b302ce7ff05f0553b49a7111cea4e43e87ccbfda96f92549d5b2111fb89594ef2d9f805a1a8c3fd3ce56bd6268bd026e5159a78dc050479ac3d9f7ef7d45239bba35347878d9cd285058f2d87facccabb9857e91b00084a45fd85d64a31b9e34fddedc2421493d7b58316f37c26da6975b80f04a9cd8861d6faafece85f950d1fa00b413a561668edd3863562a6e631a3b3099eb8cde156538ec765b84af737a7e514b3854d46f11a1533b04071621cd775b74403e16948b86adccdad4e00f5133e8c1f5a43138a4c7d37cfded1ee93a5f3090294399493826dc5b1a1cee7ab564040917c80625a5e29a88766e96dfd24aa5eb9d36f54ce1a4093298e43a55940ed490518df2a810d2c348f820d887fcb0fff6c1d6e623c31edf5c30850abec8fba59a4d3e0104d7ea90adc502cc2d29e1a1dc76335782dde171c3548617ecd3f55619c4c19fce98a5c9696397ba069e0fbeb37af05375762130d2c4bb6c3aa31e2e17c070e9912b1cb3c26865d07c660236e3220ce6e84ebeedffa7b71fd3ced40488d9acbd1dd880a52a8d4943244062bbc67cc68f96dbbcfe1a9201211b17a7f677c9b2d324b94f933a1d016e3fed6a82ad6025509ec75543cb9e80103ef32661b70358e87bb352eac12d18c9e7fe08a5b7295b87d0253b314e8bd22820fc0028e5d6bfcc8b83413bc922f92d5518b34f0e466f4ccdf4a5c3c523ca2f16f0d98b668ecbb144724bf596dd10ee107f6ef37a5bb273c56a4098889d0ef892c050dcc5f55d44541b905ed327fea4d80f39dffe82ca7a112975546a8be853079e31a4be9e7bea5626bec11b5ba11e5bb637a33f230c4808c0d18b814853665cf34b6608b7df0b879f206e4afe17d12f5d7c0e160a427f57ab0bc7a8e2e577162a0e396b8e469de075048dac4887982fc11b6ace0c739b42494d1177d1b15315d2ef28317663fe72a7b670aab57bcf8b1845505b7dcf7948bee57878f77f0491bd5bcefebe6636c6e8f141a8db68a366396e1582062c4f49d081d21d9c119c5eb087f2014f35759303df3720bf2fab74c82e3ba69686fbc217eb482972fca3131d046fe66fb97f2ab1266b132b178819fce762e60101b3c33fe9327fe37917fbe8bbee5d5ef4972dfd5d3afaf31cb05fae65249a99421ed705d41fbed191db27a4c3f2acc75c56871ac08ff6669deb5434c27e438be2a4c8a6b47dff5017ea80e7e57090aa926dd2876bbbe67d13c9e5ee4c7e1de74cd4c4bdaacdf3bd7360d02f151dcd281425d38277ca897525e6370fc3934c149223e5934f09305ab7936ed824dbf03cfd7eaa7430f93a7f04afbe8aeea5ff5cf2fbd7e52c47b89300bf7af47c9ccd716d2ea8dc16aa2880b3b7abaf4467f9ac0bdee56f578ae288270c8fb6ec000b3e749883ac45e4d51c9d725544281e80c961c5e3567754bd8c3f16ca8b279a68491693c8f06ea09a64ce058f11c2bd9fef8c8a49da346face503d7d57ac46c330575c267ad29e6462439c6006ab316825544d9161880a4db3cd03e0530099a5f11606636660bed90ced3fda06021a79673df988758f5bc8287e7df58158bde6f396a385944ca86552383bbb161c0dcb9d222b909f714e777dd1b4a1edffe52b4c90128b7dcfcb9320eaf093dfbf2aaf0036b299f238ab31ce4e34d88265dd552aef31807b6b614698cd643e8e4f161823b1c29644dd322c35955bf4db786b6af880443e71afcf5175b5afa144ff13ed64a3b2643aafa3679617bdc6c0630ecf00753dd936ef06fc5938449f0b640afa96198e9dffc54eee5d4d7ee9f1d953f3a1fbd27da0d81e7b1fdfaaa9aa833e95bb8e54d080b4dbb3917c310aa9ab3d9fc6811d4c1ecfb204efee41354b233e8acd17b1928c7d8b0177a5646892949f6ce7d4616f71713ba36797f1641143d2e5b3785ec1ba4c35a2938e8c6fcd09350fe3c6a59884e101a36b5198794f492b64574718cf83b83e8239267366aa06bc42b4d3923231aaa7defead03690ff64f4a08ef73e3f45e61e042453fa70195513111def21b598d5278d242a857a6e265e96e925e88efb3551f80c97d4c0a6d38e43b69b03c12af34e190f72a91864cd741b5ea7c9cbc35195b5271b23aa4f211df4376e4be2ecf3b1d5be84d0c8fdbdfc3cbbc3a8b9418f26564a96aec379283bfd9394486598d498705025266524ded67d83fb1e44651548197eb6d8d291340ba067f402ef1c7bc169715426c536b61bf76638638e77016e7f4ee128fe41110a466135877599d1eae8adc10f08f2024e5162b119a7f94984fa10ea76e20ab3335bfe40aadb376c3573f31803a1af8d7f45cbb10b0820ed64cd30a4757b75ca0543a9724e0e34f9d559ad37c7e55ebf7eb702ff168ee591494f8fae9c2eb4b05d690c89914b5b7a59e0d41f57d8d7a7614573bbddccc774f39459677c6d774b69deefe77adceb018dfc6725a9be75170e22e860db1050790984862e38b8ced1524ceb0efa6c50989f4ee01c79b239f2aea4c50d8f87f513dd9663b0e2e3babc870e2d215a34018b6c5c5f7d6c77b66e6891d5b847b8c2f3fa4aa99c10b47e28445d8087263dac26cadfeba13b3f50a3bdfcf88e0a271df0609f626a19cc3f0d34eaaad1ba06b2e6fdc19a845b8a1f47f3452fcd5ec2f32fe6cee207b3a3f9062dc6a982f7f25c083d87cad6f8179a5900136119917d801033d587b8a496b34ccc0b1f57d29f3812d116e435072938ebc0fbff27de90970bcaf1795f9e404b6df6a1fa4ea5478405109f029cada31c2cd458e3c2b85560a4510250baed7e57896423b6648f62ed248341c8850e655fab736e81ffaf97597d5208f1b96556823dfdb0ce123f1baf2f1db0ee3ef43bc412e0883e504c43377dd06bd1612374f0fb0e4ec9d22e07c67ad4b48e39ee9c67c336ec76f6ccbe6881b722f5ae258e6efa860eac41a1ce3544594e88e61d2548c10121ad742282f33106aa570af1fe11a14e0bd3a71f018a449ef02e3b170763414ed18282626ff93908a8a7698d78c8fe1f37cd2f0d3a55a4add847475a49e0aa8d8bd9c077d676f41f508b14959de920c15712606fd4f5d4bb30d67dfcb07b06d4eb3165ab8ea8610d4979366a0765e407851f4ad98f03b015f9324703a5b7ee87107b4989ae50c0126b5601da3f37120feeea5590a1b23d9cdf7a661e0c484fdeda08e352247778a8304106ae1ea83ed626b86770b9296ef72ba9ff849d66a7a9b2c3c85d2609159cac67e9aa74b63eb70cdb7be830fe3cf2e649ebd0377c0c63a960aa70c69b4e5082cc5075ce15b320472e8ada1b24cb3736c968ffd1bed24fff54a56f38b92ddae9716d69a9892882e9c7b0edf76f0d0cafae8ce7ff8746a25aff0e00bfc7853e31c2d2300f7e0fb18fc0116cec628485f4b80c1e468c8e9f13b772919cac100e23447d54e8336a03cf37faec262f07a60898eb959dabe3b7d8198fbe9b8a648b4ae73a568b8f4997cc7299c4ef8732819e4acddb836cd0cc26cb2ec1cc43ad21d1552583799bf44930aa7fe6ee2f963ab2de3524b9848acb397deaf2b8b953b5c07f7b5937cf6c324e33c98a1ce10a0d9b6c469d6f63dec62f8c5203098b9ce405dd798de8d5c91b31905e84206c3768c76eb74aec54d80c38150122d1e14e49af34b3a7017506963b4dfac0adb002daa037621a84e6149933d8b5cadd10829edbdf7889a8bd5d5a4a5bfe8a94e2b775cb91a8fa7cd9f390dc072e31ac63870546a902f51b8b9a034729746e5e1e7635d963a0b4156bdd0ece2e5520b9f60e4902647cfcd32074cc7e016e494b472c383f7ec77757d3e3f86ea3b83abb299d136f69d246e4d0c512799c2310677db17e9c6594044a0acb3f52e08f2e45e0df872dc6ae385ea9221e3c449e157de1a3c4688ce6ef0898e98b49342abdc151c98cb9f4c5be7471d230e1fe699e66013ede23f5bf21b3857ce0e056a986f5762624557a21f8b7238cdcc658ede61f23be2bb45b0622e988ac06b3790cab9a2bad8ac904262289d71cedc4d69b7519027cee3085e9b25855c20bb79a9b32a629cddbe4f7991923e14ef53d441b17477e0efcab790ea558513307965e07e22471a57eea55b5ecc277a416e22b2218d8643357e802f8d4fd5fc76cdff739b7faddb5175dba5a7b47b4b36f0ae59813834c7c7e7f5ced1c8ce36c35a5dab893a98564a260d8d9a927e1a3364b788b1703524ba0f04de347e6035b2777f6046af43b5ff6d6c7a5532af0cf037bd190958d32421dfa61ab2cce176979e6fa05bb80408c49e0abb321a006253817543320570a16005234f37c4fd9d53beebc286f8713b6ce3fb9a1fe6b9b7355d22a4a1a14eae9759ba58900bc247ae947ffadb94b4933f5bb6fcb730393991b04f69ed31ea86d52cd9cc7bcfddd8075d05ad0254fe3279108082a0c3844ec88c4659afea82707b5d4712ff8d1d8d868c83609fc067e56aa798c3898bf3b27b2af70c6f7a69591cc2c10172d1b69386b7aa03367fd309c92830521ab048738ef436153d05c00dbe1320efdac2350e49d1116d21ec08ab33d367e2a558972149bece9775d1b1b73d9b160cca9665f150eea7e2d7f99eab5b2434831f714845406e408784e6b72e3300ff571616beb15ea3ff2d8c0d345bf3c7d6e356c24aaf6a910bf3929755c218e0676e46cebe402f45f7488930be77e68d6e88d1703ac9f58d2be4db6d159dc76c228b579d76fc3426667bade64d7fa10958a7aa85d83188889629f5c66061580c062773543b2714f12e6e85069a6f85923aeec41b7ebd9cf6c4a5e5f5cda1d263a50a0801ecd1e7ebf218827593b5e60511fbaec8227758ea311f7a2d41a4327c0b956c0002d26003792a4f51a25e6a346614867125c22e478b199b08502a4724222967887fe3f5aa1185304fb3b5c541d3d64007a3c5bb28566f0888e3b011fb0aab7c19c5851823f763d0bac82869f4f065adc0b8eee102ba5f2724a876f19481d049ef0f404f286776ef826fddeb6b86529a05379fb70505df37dfcb60326d93480842a9192f0c3a42f7f6574079b96440a8fa471bc97ab54f19e952b5c20f27c7eb006b5d938286cccf432edf4732afb0a2d4a4e6e0293b93607976579c2936c17d2287baf6590421e501d4f0c95033a5b27e308cbbf7be93ff01f1b1957aeed9103ced9470769bc500bb3370e5e8b841ff8f68a8ddbc1a1994740e3789b1309144876bc3a216297d12ccb81ee40f7fa1cbbec501a2a0d1b604b38024548e4cbb4f1c98f357ac28b74ed6568796f8aba03277cef778b266518214e4e63c47ad50d804965e0f98acff0adeb392a879419a3b1eaecd555d0af6edb986cea51fd0b0db854b827c762b93e99ce354b1bbc74993f15361ec350dc1f51aae38ae249f3e594ecfc1ab1ab90d09cb7e47daa0ea570e1906213847882ede3a62fbc98d65458a1242725982c8ac0fd40d15b867d360feb05de0b844f0aaf4d3638e4ef647dd1913f45227625d13c750435a6a823aefb30cad820feca19f2f0efbf7d90f2621acf68736c0d92fa7baea51e56ddab195634417caf0b46021705c5a92dbc83b1880910b8a316b4784386085d5a70c1db6aa17e112893f805b9050413501e534873f517f2ff4f922244e21e5640edcf91a23fa7e496f5a459392420b3a0dee51744172cdb54c826accfa30aac200e856d32337406ed843bdd440f2336e88c54369ae30b33628989bfdf8a172107635464b3ae06331052d5d2141e890dd558b8b3ec27f7c19ea9b0e4161460ce1d542eedbeb30ed4afafafe4edb77f4b9800fe4b3071d946e4493ce63ad60fa8ac1460ebe694fa22d47327baa4d1c2eb0f55bf2b12b2efa2a8f2ebca097b14fab01a7a40bac4776adfe335345ae0505c458e37006ac07d3f4e87a28299430a2e2d4ff4652e401a3ac25a527012ec624dc86eec094b7f09e045bae8a039dd151db0cf7279b29f003f5f1a46800308fcff3654269c80289538469656d5ca4cb34acc777dbf36ebcca5c5cd5e005e711e22917335c191062ad60d8a6168dafce539fea1f5f8dc7ae32a65571648d9e2daf543e3a15b5a8c42dd118a32e87e0d40ef95805fad875a50fbfc7b642f8a9e7230b7901c7931145e6d1228e81f51637e31340eb1576d81b238f6ec6636bc1330aaf117b52c233d7eed146554153cb42b3d7df43e3a5567fd428c658c2a62985b0aaae65cc5cc0c426b1f04dd799d01dc9f65caa59d0758a6336f8458439c26f4169af8108640ba455521fdfa6dc68a5a26113cbd009ca2b564b2dd3985371f96dc1e351af8e03eedfd6787ba98c43d5e818fdc7d93f3b22f506c0217bd3fc3793e264abb5de1ebc91a422e1222c1f8b7a0387537e1ad5d4d330f1dff818abd5d51a6f103ad37aa4eed44d368f6cbc7d7218ed76343e751ac293c5f7a52664f2081d413bc43a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">您好, 这里需要密码.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>输入密码后查看该博客</title>
      <link href="/2016/03/30/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E5%90%8E%E6%9F%A5%E7%9C%8B/"/>
      <url>/2016/03/30/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E5%90%8E%E6%9F%A5%E7%9C%8B/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉, 这个密码看着不太对, 请再试试." data-whm="抱歉, 这个文章不能被校验, 不过您还是能看看解密后的内容.">  <script id="hbeData" type="hbeData" data-hmacdigest="1ac909b7d512a02cda7bb61ca79413ab403513b1c503305ccc393008acff0933">b55082ff7ac8ae3c8d91f4bf8c798b5857dbb99ab567c0d6b7d1baf38c13555b586a396087a0ea355ddcbf98d8df9470191e146c65714819e66b5041d85d2530ddfe7f9887620cb631def9a86fab2b10</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">您好, 这里需要密码.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> 作为日记加密 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
