<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Busæ¶ˆæ¯æ€»çº¿</title>
      <link href="/2023/06/12/Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/"/>
      <url>/2023/06/12/Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="Bus-æ¶ˆæ¯æ€»çº¿"><a href="#Bus-æ¶ˆæ¯æ€»çº¿" class="headerlink" title="Bus æ¶ˆæ¯æ€»çº¿"></a>Bus æ¶ˆæ¯æ€»çº¿</h1><h2 id="1ã€SpringCloud-Bus-ä»‹ç»"><a href="#1ã€SpringCloud-Bus-ä»‹ç»" class="headerlink" title="1ã€SpringCloud Bus ä»‹ç»"></a>1ã€SpringCloud Bus ä»‹ç»</h2><h3 id="1-1ã€æ¶ˆæ¯æ€»çº¿çš„ç”±æ¥"><a href="#1-1ã€æ¶ˆæ¯æ€»çº¿çš„ç”±æ¥" class="headerlink" title="1-1ã€æ¶ˆæ¯æ€»çº¿çš„ç”±æ¥"></a>1-1ã€æ¶ˆæ¯æ€»çº¿çš„ç”±æ¥</h3><p>å›é¡¾ä¸Šä¸€ç¯‡æ–‡ç«  Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒå­˜åœ¨çš„é—®é¢˜</p><ul><li><p>å‡å¦‚æœ‰å¤šä¸ªå¾®æœåŠ¡å®¢æˆ·ç«¯ 3355/3366/3377â€¦â€¦ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰§è¡Œä¸€æ¬¡ post è¯·æ±‚ï¼Œæ‰‹åŠ¨åˆ·æ–°ï¼Ÿ</p></li><li><p>å¯å¦å¹¿æ’­ï¼Œä¸€æ¬¡é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆï¼Ÿ</p></li><li>æˆ‘ä»¬æƒ³å¤§èŒƒå›´çš„è‡ªåŠ¨åˆ·æ–°ï¼Œæ±‚æ–¹æ³•</li></ul><p>ä»¥ä¸Šå°±æ˜¯æ¶ˆæ¯æ€»çº¿çš„äº§ç”Ÿç”±æ¥</p><p>Spring Cloud Bus é…åˆ Spring Cloud Config ä½¿ç”¨å¯ä»¥å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°</p><h3 id="1-2ã€æ˜¯ä»€ä¹ˆ"><a href="#1-2ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-2ã€æ˜¯ä»€ä¹ˆ"></a>1-2ã€æ˜¯ä»€ä¹ˆ</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_1.png" alt=""></p><p>Spring Cloud Bus æ˜¯ç”¨æ¥<font color='red'><strong>å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶</strong></font>ï¼Œå®ƒæ•´åˆäº† Java çš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚</p><p>Spring Cloud Bus ç›®å‰æ”¯æŒ RabbitMQ å’Œ Kafkaã€‚</p><h3 id="1-3ã€èƒ½å¹²å˜›"><a href="#1-3ã€èƒ½å¹²å˜›" class="headerlink" title="1-3ã€èƒ½å¹²å˜›"></a>1-3ã€èƒ½å¹²å˜›</h3><p>Spring Cloud Bus èƒ½ç®¡ç†å’Œä¼ æ’­åˆ†å¸ƒå¼ç³»ç»Ÿé—´çš„æ¶ˆæ¯ï¼Œå°±åƒä¸€ä¸ªåˆ†å¸ƒå¼æ‰§è¡Œå™¨ï¼Œå¯ç”¨äºå¹¿æ’­çŠ¶æ€æ›´æ”¹ã€äº‹ä»¶æ¨é€ç­‰ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¾®æœåŠ¡é—´çš„é€šä¿¡é€šé“ã€‚<br><img src="https://picbed.jnchan.top/springcloudImages/17bus_2.png" alt=""></p><h3 id="1-4ã€æ€»çº¿"><a href="#1-4ã€æ€»çº¿" class="headerlink" title="1-4ã€æ€»çº¿"></a>1-4ã€æ€»çº¿</h3><h4 id="ä»€ä¹ˆæ˜¯æ€»çº¿"><a href="#ä»€ä¹ˆæ˜¯æ€»çº¿" class="headerlink" title="ä»€ä¹ˆæ˜¯æ€»çº¿"></a>ä»€ä¹ˆæ˜¯æ€»çº¿</h4><p>åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œ<font color='red'><strong>é€šå¸¸ä¼šä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜ï¼Œå¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥ã€‚ç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ã€‚</strong></font></p><p>åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹ï¼Œéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯ã€‚</p><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>ConfigClient å®ä¾‹éƒ½ç›‘å¬ MQ ä¸­åŒä¸€ä¸ª topic(é»˜è®¤æ˜¯ springCloudBus)ã€‚<font color='red'><strong>å½“ä¸€ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ° Topic ä¸­ï¼Œè¿™æ ·å…¶å®ƒç›‘å¬åŒä¸€ Topic çš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚</strong></font></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/" title="Streamæ¶ˆæ¯é©±åŠ¨">Streamæ¶ˆæ¯é©±åŠ¨</a></p><h2 id="2ã€RabbitMQ-ç¯å¢ƒé…ç½®"><a href="#2ã€RabbitMQ-ç¯å¢ƒé…ç½®" class="headerlink" title="2ã€RabbitMQ ç¯å¢ƒé…ç½®"></a>2ã€RabbitMQ ç¯å¢ƒé…ç½®</h2><p>å®‰è£… Erlangï¼Œä¸‹è½½åœ°å€ï¼š<a href="http://erlang.org/download/otp_win64_21.3.exe">http://erlang.org/download/otp_win64_21.3.exe</a></p><p>å®‰è£… RabbitMQï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.14/rabbitmq-server-3.7.14.exe">https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.14/rabbitmq-server-3.7.14.exe</a></p><p>è¿›å…¥ RabbitMQ å®‰è£…ç›®å½•ä¸‹çš„ sbin ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ç®¡ç†åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><p>è®¿é—®åœ°å€æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š<a href="http://localhost:15672/">http://localhost:15672/</a></p><p>è¾“å…¥è´¦å·å¯†ç å¹¶ç™»å½•ï¼šguest guest</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_ç•Œé¢.png" alt=""></p><h2 id="3ã€åŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­"><a href="#3ã€åŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­" class="headerlink" title="3ã€åŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­"></a>3ã€åŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­</h2><h3 id="3-1ã€æ­å»ºå®¢æˆ·ç«¯å¾®æœåŠ¡-3366"><a href="#3-1ã€æ­å»ºå®¢æˆ·ç«¯å¾®æœåŠ¡-3366" class="headerlink" title="3-1ã€æ­å»ºå®¢æˆ·ç«¯å¾®æœåŠ¡ 3366"></a>3-1ã€æ­å»ºå®¢æˆ·ç«¯å¾®æœåŠ¡ 3366</h3><p>å¿…é¡»å…ˆå…·å¤‡è‰¯å¥½çš„ RabbitMQ ç¯å¢ƒå…ˆï¼Œæ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ï¼Œå†ä»¥ 3355 ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª 3366</p><p>æ–°å»º cloud-config-client-3366</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-config-client-3366<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="bootstrap-yml"><a href="#bootstrap-yml" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3366</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="comment">#Configå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">            <span class="attr">label:</span> <span class="string">master</span> <span class="comment">#åˆ†æ”¯åç§°</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">config</span> <span class="comment">#é…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="attr">profile:</span> <span class="string">test</span> <span class="comment">#è¯»å–åç¼€åç§°   ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-test.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">http://localhost:3344</span> <span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">            <span class="comment"># ç»¼åˆä¸Šé¢å››ä¸ª å³è¯»å–é…ç½®æ–‡ä»¶åœ°å€ä¸ºï¼š http://config-3344.com:3344/master/config-test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡æ³¨å†Œåˆ°eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´éœ²ç›‘æ§ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientMain3366</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConfigClientMain3366.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-å±‚"><a href="#controller-å±‚" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span> <span class="comment">//giteeé‡Œçš„ymlæ–‡ä»¶é‡Œçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;serverPort: &quot;</span>+serverPort+<span class="string">&quot;\t\n\n configInfo: &quot;</span>+configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2ã€è®¾è®¡æ€æƒ³"><a href="#3-2ã€è®¾è®¡æ€æƒ³" class="headerlink" title="3-2ã€è®¾è®¡æ€æƒ³"></a>3-2ã€è®¾è®¡æ€æƒ³</h3><p>ï¼ˆ1ï¼‰åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯/bus/refresh,è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_3.png" alt=""></p><p>ï¼ˆ2ï¼‰åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªæœåŠ¡ç«¯ ConfigServer çš„/bus/refresh ç«¯ç‚¹ï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_4.png" alt=""></p><p>å›¾äºŒçš„æ¶æ„æ˜¾ç„¶æ›´åŠ é€‚åˆï¼Œå›¾ä¸€ä¸é€‚åˆçš„åŸå› å¦‚ä¸‹ï¼š</p><ul><li>æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§ï¼Œå› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œå®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£ã€‚</li><li>ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§ã€‚</li><li>æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå¾®æœåŠ¡åœ¨è¿ç§»æ—¶ï¼Œå®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å¦‚æœæƒ³è¦åšåˆ°è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£å°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹</li></ul><h3 id="3-3ã€é…ç½®ä¸­å¿ƒ-3344-æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"><a href="#3-3ã€é…ç½®ä¸­å¿ƒ-3344-æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ" class="headerlink" title="3-3ã€é…ç½®ä¸­å¿ƒ 3344 æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"></a>3-3ã€é…ç½®ä¸­å¿ƒ 3344 æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</h3><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><p>æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œé…ç½® rabbitmq å¹¶ä¸”æš´éœ²ç«¯ç‚¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="comment">#rabbitmqç›¸å…³é…ç½® 15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼›5672æ˜¯MQè®¿é—®çš„ç«¯å£</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹ actuatoråˆ·æ–°é…ç½®</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;bus-refresh&#x27;</span> <span class="comment">#Post /bus/refresh å®˜ç½‘æ¶æ„å›¾</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>å› ä¸ºæ‰‹åŠ¨åˆ·æ–°éœ€è¦è‡ªå·±è°ƒç”¨ä¸€ä¸ªç±»ä¼¼äºå¥åº·æ£€æŸ¥çš„ç«¯ç‚¹ï¼ˆæ¥å£ï¼‰ï¼Œæ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªç«¯ç‚¹ç»™æš´éœ²å‡ºæ¥ï¼Œä»¥ä¾¿å¤–éƒ¨å¯è®¿é—®ã€‚</p><h3 id="3-4ã€å®¢æˆ·ç«¯-3355ï¼Œ3366-æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"><a href="#3-4ã€å®¢æˆ·ç«¯-3355ï¼Œ3366-æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ" class="headerlink" title="3-4ã€å®¢æˆ·ç«¯ 3355ï¼Œ3366 æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ"></a>3-4ã€å®¢æˆ·ç«¯ 3355ï¼Œ3366 æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</h3><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="bootstrap-yml-1"><a href="#bootstrap-yml-1" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><p>æ·»åŠ  Rabbitmq ç›¸å…³é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="comment">#rabbitmqç›¸å…³é…ç½® 15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼›5672æ˜¯MQè®¿é—®çš„ç«¯å£</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><h3 id="3-5ã€æµ‹è¯•"><a href="#3-5ã€æµ‹è¯•" class="headerlink" title="3-5ã€æµ‹è¯•"></a>3-5ã€æµ‹è¯•</h3><p>ä¿®æ”¹ Gitee ä¸Šé…ç½®æ–‡ä»¶å¢åŠ ç‰ˆæœ¬å·</p><p>å‘é€ POST è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3344/actuator/bus-refresh&quot;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼šä¸€æ¬¡ä¿®æ”¹ï¼Œå¹¿æ’­é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆ</p><h2 id="4ã€åŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥"><a href="#4ã€åŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥" class="headerlink" title="4ã€åŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥"></a>4ã€åŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥</h2><p>ä¸æƒ³å…¨éƒ¨é€šçŸ¥ï¼Œåªæƒ³å®šç‚¹é€šçŸ¥ï¼šåªé€šçŸ¥ 3355ï¼Œä¸é€šçŸ¥ 3366</p><p>ç®€å•ä¸€å¥è¯ï¼šæŒ‡å®šå…·ä½“æŸä¸€ä¸ªå®ä¾‹ç”Ÿæ•ˆè€Œä¸æ˜¯å…¨éƒ¨</p><p><strong>å…¬å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/&#123;destination&#125;</span></span><br></pre></td></tr></table></figure><p>/bus-refresh è¯·æ±‚ä¸å†å‘é€åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œè€Œæ˜¯å‘ç»™ config server å¹¶é€šè¿‡ destination å‚æ•°ç±»æŒ‡å®šéœ€è¦æ›´æ–°é…ç½®çš„æœåŠ¡æˆ–å®ä¾‹</p><h3 id="4-1ã€æ¡ˆä¾‹"><a href="#4-1ã€æ¡ˆä¾‹" class="headerlink" title="4-1ã€æ¡ˆä¾‹"></a>4-1ã€æ¡ˆä¾‹</h3><p>æˆ‘ä»¬è¿™é‡Œä»¥åˆ·æ–°è¿è¡Œåœ¨ 3355 ç«¯å£ä¸Šçš„ config-client ä¸ºä¾‹ï¼šåªé€šçŸ¥ 3355ï¼Œä¸é€šçŸ¥ 3366</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3344/actuator/bus-refresh/config-client:3355&quot;</span></span><br></pre></td></tr></table></figure><p>é€šçŸ¥æ€»ç»“ All</p><p><img src="https://picbed.jnchan.top/springcloudImages/17bus_5.png" alt=""></p><h2 id="5ã€é¢å¤–å†…å®¹ï¼šSpringboot-Actuator-çš„è¯´æ˜"><a href="#5ã€é¢å¤–å†…å®¹ï¼šSpringboot-Actuator-çš„è¯´æ˜" class="headerlink" title="5ã€é¢å¤–å†…å®¹ï¼šSpringboot Actuator çš„è¯´æ˜"></a>5ã€é¢å¤–å†…å®¹ï¼šSpringboot Actuator çš„è¯´æ˜</h2><h3 id="5-1ã€æ˜¯ä»€ä¹ˆ"><a href="#5-1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="5-1ã€æ˜¯ä»€ä¹ˆ"></a>5-1ã€æ˜¯ä»€ä¹ˆ</h3><p>ç›‘æ§ä¸­å¿ƒæ˜¯é’ˆå¯¹å¾®æœåŠ¡æœŸé—´</p><ul><li><p>æŸ¥çœ‹æœåŠ¡å™¨å†…å­˜å˜åŒ–(å¯¹å†…å­˜,çº¿ç¨‹,æ—¥å¿—ç®¡ç†ç­‰)</p></li><li><p>æ£€æµ‹æœåŠ¡é…ç½®è¿æ¥æ± åœ°å€æ˜¯å¦å¯ç”¨(æ¨¡æ‹Ÿè®¿é—®,æ‡’åŠ è½½)</p></li><li>ç»Ÿè®¡ç°åœ¨æœ‰å¤šä¸ª bean(æ˜¯ Spring å®¹å™¨ä¸­çš„ bean)</li><li>ç»Ÿè®¡ SpringMVC@RequestMapping(ç»Ÿè®¡ http æ¥å£)</li></ul><p>ä½¿ç”¨ Actuator æ¥æŸ¥çœ‹è¿™äº›ä¿¡æ¯,å®ƒæ˜¯æ²¡æœ‰ç•Œé¢çš„è¿”å›çš„æ˜¯ json æ ¼å¼çš„æ•°æ®</p><p>AdminUi åº•å±‚ä½¿ç”¨çš„æ˜¯ Actuator å®ç°çš„,åªä¸è¿‡ç»™å®ƒåŠ äº†ä¸ªå¯è§†åŒ–ç•Œé¢</p><h3 id="5-2ã€åº”ç”¨åœºæ™¯"><a href="#5-2ã€åº”ç”¨åœºæ™¯" class="headerlink" title="5-2ã€åº”ç”¨åœºæ™¯"></a>5-2ã€åº”ç”¨åœºæ™¯</h3><p>ç”Ÿäº§ç¯å¢ƒ</p><p>ä½¿ç”¨å®ƒçš„åŸå› ï¼šå®ƒæ˜¯ springboot çš„ä¸€ä¸ªé™„åŠ åŠŸèƒ½ï¼Œå¯å¸®åŠ©ä½ åœ¨åº”ç”¨ç¨‹åºç”Ÿäº§ç¯å¢ƒæ—¶<font color='red'><strong>ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºï¼Œå¯ä½¿ç”¨ Http çš„å„ç§è¯·æ±‚æ¥ç›‘ç®¡ï¼Œå®¡è®¡ï¼Œæ”¶é›†åº”ç”¨çš„è¿è¡Œæƒ…å†µï¼Œ</strong></font>ç‰¹åˆ«å¯¹äºå¾®æœåŠ¡ç®¡ç†ååˆ†æœ‰æ„ä¹‰ã€‚</p><p>å»ºè®®ä½¿ç”¨ springboot2.0.5ï¼Œå› ä¸ºå®ƒé‡Œé¢è¿”å›çš„ä¿¡æ¯æ›´åŠ å…¨é¢ã€‚</p><p>springboot æä¾›äº†å¯¹é¡¹ç›®çš„ç›‘æ§åŠŸèƒ½ã€‚</p><h3 id="5-3ã€å¦‚ä½•ä½¿ç”¨"><a href="#5-3ã€å¦‚ä½•ä½¿ç”¨" class="headerlink" title="5-3ã€å¦‚ä½•ä½¿ç”¨"></a>5-3ã€å¦‚ä½•ä½¿ç”¨</h3><h4 id="å¯¼å…¥ä¾èµ–åŒ…"><a href="#å¯¼å…¥ä¾èµ–åŒ…" class="headerlink" title="å¯¼å…¥ä¾èµ–åŒ…"></a>å¯¼å…¥ä¾èµ–åŒ…</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®ç«¯ç‚¹"><a href="#é…ç½®ç«¯ç‚¹" class="headerlink" title="é…ç½®ç«¯ç‚¹"></a>é…ç½®ç«¯ç‚¹</h4><p>åœ¨ application.properties ä¸­é…ç½®ç«¯ç‚¹ï¼Œ</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">æš´éœ²éƒ¨åˆ†ç«¯ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">info,health,beans,env</span></span><br><span class="line"></span><br><span class="line"><span class="attr">æš´éœ²æ‰€æœ‰ç«¯ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=<span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ä¸æš´éœ²beansç«¯ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.exclude</span>=<span class="string">beans</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ management.endpoints.web.exposure.include æš´éœ²æ‰€æœ‰çš„ç«¯ç‚¹ï¼Œæ¥ç€ä½¿ç”¨ management.endpoints.web.exposure.exclud æ’é™¤ beans ç«¯ç‚¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæš´éœ²é™¤ beans å¤–çš„æ‰€æœ‰ actuator ç«¯ç‚¹äº†ã€‚</p><h4 id="æµè§ˆå™¨è®¿é—®"><a href="#æµè§ˆå™¨è®¿é—®" class="headerlink" title="æµè§ˆå™¨è®¿é—®"></a>æµè§ˆå™¨è®¿é—®</h4><p>å¦‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8080/actuator/health</span><br></pre></td></tr></table></figure><p>è®¿é—®é¡¹ç›®ç›‘æ§éœ€è¦åŠ å‰ç¼€ /actuator</p><h3 id="5-4-ç«¯ç‚¹è¯´æ˜"><a href="#5-4-ç«¯ç‚¹è¯´æ˜" class="headerlink" title="5-4.ç«¯ç‚¹è¯´æ˜"></a>5-4.ç«¯ç‚¹è¯´æ˜</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17actuatorç«¯ç‚¹è¯´æ˜.png" alt=""></p><h3 id="5-5ã€æ€»ç»“"><a href="#5-5ã€æ€»ç»“" class="headerlink" title="5-5ã€æ€»ç»“"></a>5-5ã€æ€»ç»“</h3><p>ä¸Šé¢åˆ©ç”¨ SpringCloud Config åˆ·æ–°å®¢æˆ·ç«¯é…ç½®ï¼Œä»¥åŠæ¶ˆæ¯æ€»çº¿è§¦å‘æœåŠ¡ç«¯ ConfigServer çš„/bus-refresh ç«¯ç‚¹ï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®ï¼Œåˆ©ç”¨çš„å°±æ˜¯ actuator åˆ·æ–°é…ç½®æ–‡ä»¶ã€‚</p><p>å› ä¸ºæ‰‹åŠ¨åˆ·æ–°éœ€è¦è‡ªå·±è°ƒç”¨ä¸€ä¸ªç±»ä¼¼äºå¥åº·æ£€æŸ¥çš„ç«¯ç‚¹ï¼ˆæ¥å£ï¼‰ï¼Œæ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªç«¯ç‚¹ç»™æš´éœ²å‡ºæ¥ï¼Œä»¥ä¾¿å¤–éƒ¨å¯è®¿é—®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3355/actuator/refresh&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3344/actuator/bus-refresh&quot;</span></span><br></pre></td></tr></table></figure><p>Actuator å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/munangs/article/details/123639480">https://blog.csdn.net/munangs/article/details/123639480</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°ğŸ˜¶</title>
      <link href="/2023/06/12/Consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%F0%9F%98%B6/"/>
      <url>/2023/06/12/Consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%F0%9F%98%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="Consul-æœåŠ¡æ³¨å†Œä¸å‘ç°-ğŸ˜¶"><a href="#Consul-æœåŠ¡æ³¨å†Œä¸å‘ç°-ğŸ˜¶" class="headerlink" title="Consul æœåŠ¡æ³¨å†Œä¸å‘ç° ğŸ˜¶"></a>Consul æœåŠ¡æ³¨å†Œä¸å‘ç° ğŸ˜¶</h1><h2 id="1ã€Consul-ç®€ä»‹"><a href="#1ã€Consul-ç®€ä»‹" class="headerlink" title="1ã€Consul ç®€ä»‹"></a>1ã€Consul ç®€ä»‹</h2><h3 id="1-1ã€æ˜¯ä»€ä¹ˆ"><a href="#1-1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-1ã€æ˜¯ä»€ä¹ˆ"></a>1-1ã€æ˜¯ä»€ä¹ˆ</h3><p>Consul æ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘ã€‚</p><p>æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨ä»¥æ„å»ºå…¨æ–¹ä½çš„æœåŠ¡ç½‘æ ¼ï¼Œæ€»ä¹‹ Consul æä¾›äº†ä¸€ç§å®Œæ•´çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚</p><p>å®ƒå…·æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚åŒ…æ‹¬ï¼š åŸºäº raft åè®®ï¼Œæ¯”è¾ƒç®€æ´ï¼› æ”¯æŒå¥åº·æ£€æŸ¥, åŒæ—¶æ”¯æŒ HTTP å’Œ DNS åè®® æ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„ WAN é›†ç¾¤ æä¾›å›¾å½¢ç•Œé¢ è·¨å¹³å°ï¼Œæ”¯æŒ Linuxã€Macã€Windowsã€‚</p><h3 id="1-2ã€èƒ½å¹²å˜›"><a href="#1-2ã€èƒ½å¹²å˜›" class="headerlink" title="1-2ã€èƒ½å¹²å˜›"></a>1-2ã€èƒ½å¹²å˜›</h3><ul><li>æœåŠ¡å‘ç°ï¼šæä¾› HTTP å’Œ DNS ä¸¤ç§å‘ç°æ–¹å¼</li><li>å¥åº·ç›‘æµ‹ï¼šæ”¯æŒå¤šç§æ–¹å¼ï¼ŒHTTPã€TCPã€Dockerã€Shell è„šæœ¬å®šåˆ¶åŒ–ç›‘æ§</li><li>KV å­˜å‚¨ï¼šKeyã€Value çš„å­˜å‚¨æ–¹å¼</li><li>å¤šæ•°æ®ä¸­å¿ƒï¼šConsul æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ</li><li>å¯è§†åŒ– Web ç•Œé¢</li></ul><h3 id="1-3ã€å»å“ªä¸‹"><a href="#1-3ã€å»å“ªä¸‹" class="headerlink" title="1-3ã€å»å“ªä¸‹"></a>1-3ã€å»å“ªä¸‹</h3><p><a href="https://www.consul.io/downloads.html">https://www.consul.io/downloads.html</a></p><h3 id="1-4ã€ä½¿ç”¨æ–¹æ³•"><a href="#1-4ã€ä½¿ç”¨æ–¹æ³•" class="headerlink" title="1-4ã€ä½¿ç”¨æ–¹æ³•"></a>1-4ã€ä½¿ç”¨æ–¹æ³•</h3><p><a href="https://zhuanlan.zhihu.com/p/330373440">consul å®‰è£…æ•™ç¨‹ï¼ˆlinux ç³»ç»Ÿï¼‰ - çŸ¥ä¹ (zhihu.com)</a></p><h2 id="2ã€æœåŠ¡æä¾›è€…æ³¨å†Œè¿›-Consul"><a href="#2ã€æœåŠ¡æä¾›è€…æ³¨å†Œè¿›-Consul" class="headerlink" title="2ã€æœåŠ¡æä¾›è€…æ³¨å†Œè¿› Consul"></a>2ã€æœåŠ¡æä¾›è€…æ³¨å†Œè¿› Consul</h2><p>æ–°å»º Module æ”¯ä»˜æœåŠ¡ cloud-providerconsul-payment8006</p><p>pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8006<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springcloud consul server--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springbootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¸¸é€šç”¨jaråŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">consul:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8006</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/18 10:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8006</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8006.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>controller ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/18 10:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/payment/consul&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentzk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with consul: &quot;</span> + serverPort + <span class="string">&quot;\t&quot;</span> + UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/9consul.png" alt=""></p><h2 id="3ã€æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œè¿›-consul"><a href="#3ã€æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œè¿›-consul" class="headerlink" title="3ã€æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œè¿› consul"></a>3ã€æœåŠ¡æ¶ˆè´¹è€…æ³¨å†Œè¿› consul</h2><p><strong>æ–°å»º Module æ¶ˆè´¹æœåŠ¡ cloud-consumerconsul-order80</strong></p><p><strong>pomï¼Œymlï¼Œä¸»å¯åŠ¨ç±»å‚è€ƒæœåŠ¡æä¾›è€…</strong></p><p><strong>config ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/17 19:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Controller ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/18 11:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://consul-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/consul&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL+<span class="string">&quot;/payment/consul&quot;</span>,String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h1 id="å…­ã€ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹-â­â­â­"><a href="#å…­ã€ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹-â­â­â­" class="headerlink" title="å…­ã€ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹ â­â­â­"></a>å…­ã€ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹ â­â­â­</h1><p><img src="https://picbed.jnchan.top/springcloudImages/10ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹.png" alt=""></p><h2 id="1ã€CAP"><a href="#1ã€CAP" class="headerlink" title="1ã€CAP"></a>1ã€CAP</h2><p>Cï¼šConsistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰</p><p>Aï¼šAvailabilityï¼ˆå¯ç”¨æ€§ï¼‰</p><p>Pï¼šPartition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</p><p>CAP ç†è®ºå…³æ³¨ç²’åº¦æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä½“ç³»ç»Ÿè®¾è®¡çš„ç­–ç•¥</p><h2 id="2ã€ç»å…¸-CAP-å›¾"><a href="#2ã€ç»å…¸-CAP-å›¾" class="headerlink" title="2ã€ç»å…¸ CAP å›¾"></a>2ã€ç»å…¸ CAP å›¾</h2><p>æœ€å¤šåªèƒ½åŒæ—¶è¾ƒå¥½çš„æ»¡è¶³ä¸¤ä¸ªã€‚</p><p>CAP ç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ã€‚</p><p>å› æ­¤ï¼Œæ ¹æ® CAP åŸç†å°† NoSQL æ•°æ®åº“åˆ†æˆäº†æ»¡è¶³ CA åŸåˆ™ã€æ»¡è¶³ CP åŸåˆ™å’Œæ»¡è¶³ AP åŸåˆ™ä¸‰å¤§ç±»ï¼š</p><p>CA - å•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¤ªå¼ºå¤§<br>CP - æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«é«˜<br>AP - æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸å¯èƒ½å¯¹ä¸€è‡´æ€§è¦æ±‚ä½ä¸€äº›<br><img src="https://picbed.jnchan.top/springcloudImages/10cap.png" alt=""></p><h3 id="AP-Eureka-ï¼š"><a href="#AP-Eureka-ï¼š" class="headerlink" title="AP(Eureka)ï¼š"></a>AP(Eureka)ï¼š</h3><p>AP æ¶æ„ï¼š</p><p>å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼Œç³»ç»Ÿ B å¯ä»¥è¿”å›æ—§å€¼ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p>ç»“è®ºï¼šè¿èƒŒäº†ä¸€è‡´æ€§ C çš„è¦æ±‚ï¼Œåªæ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ AP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10ap.png" alt=""></p><h3 id="CP-Zookeeper-Consul"><a href="#CP-Zookeeper-Consul" class="headerlink" title="CP(Zookeeper/Consul)"></a><strong>CP(Zookeeper/Consul)</strong></h3><p>CP æ¶æ„ï¼š</p><p>å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»æ‹’æ¥è¯·æ±‚ï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸€è‡´æ€§</p><p>ç»“è®ºï¼šè¿èƒŒäº†å¯ç”¨æ€§ A çš„è¦æ±‚ï¼Œåªæ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ CP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10cp.png" alt=""></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%BC%82%E5%90%8C%E7%82%B9%E2%AD%90%E2%AD%90%E2%AD%90/" title="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹â­â­â­">ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹â­â­â­</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</title>
      <link href="/2023/06/12/Config%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"/>
      <url>/2023/06/12/Config%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/</url>
      
        <content type="html"><![CDATA[<h1 id="Config-åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ"><a href="#Config-åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ" class="headerlink" title="Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ"></a>Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</h1><h2 id="1ã€Config-åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒä»‹ç»"><a href="#1ã€Config-åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒä»‹ç»" class="headerlink" title="1ã€Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒä»‹ç»"></a>1ã€Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒä»‹ç»</h2><h3 id="1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é…ç½®é—®é¢˜"><a href="#1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é…ç½®é—®é¢˜" class="headerlink" title="1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é…ç½®é—®é¢˜"></a>1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é…ç½®é—®é¢˜</h3><p>å¾®æœåŠ¡æ„å‘³ç€è¦å°†å•ä½“åº”ç”¨ä¸­çš„ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸ªå­æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„ç²’åº¦ç›¸å¯¹è¾ƒå°ï¼Œå› æ­¤ç³»ç»Ÿä¸­ä¼šå‡ºç°å¤§é‡çš„æœåŠ¡ã€‚ç”±äºæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œï¼Œæ‰€ä»¥ä¸€å¥—é›†ä¸­å¼çš„ã€åŠ¨æ€çš„é…ç½®ç®¡ç†è®¾æ–½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>SpringCloud æä¾›äº† ConfigServer æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªå¾®æœåŠ¡è‡ªå·±å¸¦ç€ä¸€ä¸ª application.ymlï¼Œä¸Šç™¾ä¸ªé…ç½®æ–‡ä»¶çš„ç®¡ç†â€¦/(ã„’ o ã„’)/~~</p><h3 id="1-2ã€æ˜¯ä»€ä¹ˆ"><a href="#1-2ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-2ã€æ˜¯ä»€ä¹ˆ"></a>1-2ã€æ˜¯ä»€ä¹ˆ</h3><p>SpringCloud Config ä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ª<font color='red'><strong>ä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚</strong></font><br><img src="https://picbed.jnchan.top/springcloudImages/17config1.png" alt=""></p><h3 id="1-3ã€æ€ä¹ˆç©"><a href="#1-3ã€æ€ä¹ˆç©" class="headerlink" title="1-3ã€æ€ä¹ˆç©"></a>1-3ã€æ€ä¹ˆç©</h3><p>SpringCloud Config åˆ†ä¸º æœåŠ¡ç«¯ å’Œ å®¢æˆ·ç«¯ ä¸¤éƒ¨åˆ†ã€‚</p><ul><li>æœåŠ¡ç«¯ä¹Ÿç§°ä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£</li><li>å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯é…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨ git æ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ git å®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚</li></ul><h3 id="1-4ã€èƒ½å¹²å˜›"><a href="#1-4ã€èƒ½å¹²å˜›" class="headerlink" title="1-4ã€èƒ½å¹²å˜›"></a>1-4ã€èƒ½å¹²å˜›</h3><ul><li>é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶</li><li>ä¸åŒç¯å¢ƒä¸åŒé…ç½®ï¼Œ<strong>åŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°</strong>ï¼Œåˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚ dev/test/prod/beta/release</li><li>è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯</li><li>å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½®</li><li>å°†é…ç½®ä¿¡æ¯ä»¥ REST æ¥å£çš„å½¢å¼æš´éœ²ï¼špostã€curl è®¿é—®åˆ·æ–°å‡å¯â€¦</li></ul><h3 id="1-5ã€ä¸-GitHub-æ•´åˆé…ç½®"><a href="#1-5ã€ä¸-GitHub-æ•´åˆé…ç½®" class="headerlink" title="1-5ã€ä¸ GitHub æ•´åˆé…ç½®"></a>1-5ã€ä¸ GitHub æ•´åˆé…ç½®</h3><p>ç”±äº SpringCloud Config é»˜è®¤ä½¿ç”¨ Git æ¥å­˜å‚¨é…ç½®æ–‡ä»¶(ä¹Ÿæœ‰å…¶å®ƒæ–¹å¼ï¼Œæ¯”å¦‚æ”¯æŒ SVN å’Œæœ¬åœ°æ–‡ä»¶)ï¼Œä½†æœ€æ¨èçš„è¿˜æ˜¯ Gitï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯ http/https è®¿é—®çš„å½¢å¼</p><p>å®˜ç½‘ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/</a></p><h2 id="2ã€Config-é…ç½®æ€»æ§ä¸­å¿ƒæ­å»º"><a href="#2ã€Config-é…ç½®æ€»æ§ä¸­å¿ƒæ­å»º" class="headerlink" title="2ã€Config é…ç½®æ€»æ§ä¸­å¿ƒæ­å»º"></a>2ã€Config é…ç½®æ€»æ§ä¸­å¿ƒæ­å»º</h2><h3 id="2-1ã€æœåŠ¡ç«¯è¿œç¨‹ä»“åº“é…ç½®"><a href="#2-1ã€æœåŠ¡ç«¯è¿œç¨‹ä»“åº“é…ç½®" class="headerlink" title="2-1ã€æœåŠ¡ç«¯è¿œç¨‹ä»“åº“é…ç½®"></a>2-1ã€æœåŠ¡ç«¯è¿œç¨‹ä»“åº“é…ç½®</h3><p>ç”¨ä½ è‡ªå·±çš„è´¦å·åœ¨ Gitee ä¸Šæ–°å»ºä¸€ä¸ªåä¸º springcloud-config çš„æ–° Repository</p><p>ç”±ä¸Šä¸€æ­¥è·å¾—åˆšæ–°å»ºçš„ git åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP:https://github.com/***/SpringCloudStudy.git</span><br><span class="line">SSH:git@github.com:***/SpringCloudStudy.git</span><br></pre></td></tr></table></figure><p>åœ¨ä»“åº“ä¸‹æ–°å»ºä¸‰ä¸ªæ–‡ä»¶</p><p>config-dev.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-dev</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><p>config-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-prod</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure><p>config-test.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-test</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure><h3 id="2-2ã€é…ç½®æ¨¡å—-cloud-config-center-3344"><a href="#2-2ã€é…ç½®æ¨¡å—-cloud-config-center-3344" class="headerlink" title="2-2ã€é…ç½®æ¨¡å— cloud-config-center-3344"></a>2-2ã€é…ç½®æ¨¡å— cloud-config-center-3344</h3><p>æ–°å»º Module æ¨¡å— cloud-config-center-3344ï¼Œå®ƒå³ä¸º Cloud çš„é…ç½®ä¸­å¿ƒæ¨¡å—</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-config-center-3344<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- config Server --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--eureka-client config Serverä¹Ÿè¦æ³¨å†Œè¿›æœåŠ¡ä¸­å¿ƒ--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-config-center</span> <span class="comment">#æ³¨å†Œè¿›eurkeaæœåŠ¡å™¨çš„å¾®æœåŠ¡å</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">            <span class="attr">server:</span></span><br><span class="line">                <span class="attr">git:</span></span><br><span class="line">                    <span class="attr">uri:</span> <span class="string">https://github.com/***/SpringCloudStudy.git</span> <span class="comment">#githubä¸Šé¢çš„ä»“åº“å ***ä¸ºè‡ªå·±çš„ç”¨æˆ·å</span></span><br><span class="line">                    <span class="comment"># æœç´¢ç›®å½•</span></span><br><span class="line">                    <span class="attr">search-paths:</span></span><br><span class="line">                        <span class="bullet">-</span> <span class="string">springcloud-config</span> <span class="comment">###ç›®å½•åç§°</span></span><br><span class="line">                <span class="comment"># è¯»å–åˆ†æ”¯</span></span><br><span class="line">                <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡æ³¨å†Œåˆ°eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.config.server.EnableConfigServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ConfigCenterMain3344</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/21 15:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigCenterMain3344</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConfigCenterMain3344.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/17config_æµ‹è¯•.png" alt=""></p><h3 id="2-3ã€æ–‡ä»¶å‘½åè§„åˆ™"><a href="#2-3ã€æ–‡ä»¶å‘½åè§„åˆ™" class="headerlink" title="2-3ã€æ–‡ä»¶å‘½åè§„åˆ™"></a>2-3ã€æ–‡ä»¶å‘½åè§„åˆ™</h3><p>{application} æ˜¯åº”ç”¨åç§°ï¼Œå¯¹åº”åˆ°é…ç½®æ–‡ä»¶ä¸Šæ¥ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶çš„åç§°éƒ¨åˆ†ã€‚</p><p>{profile} æ˜¯é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬çš„é¡¹ç›®æœ‰å¼€å‘ç‰ˆæœ¬ã€æµ‹è¯•ç¯å¢ƒç‰ˆæœ¬ã€ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬ï¼Œå¯¹åº”åˆ°é…ç½®æ–‡ä»¶ä¸Šæ¥å°±æ˜¯ä»¥ application-{profile}.yml åŠ ä»¥åŒºåˆ†ï¼Œä¾‹å¦‚ application-dev.ymlï¼Œapplication-prod.ymlã€‚</p><h3 id="2-4ã€æ–‡ä»¶è®¿é—®è§„åˆ™"><a href="#2-4ã€æ–‡ä»¶è®¿é—®è§„åˆ™" class="headerlink" title="2-4ã€æ–‡ä»¶è®¿é—®è§„åˆ™"></a><strong>2-4ã€æ–‡ä»¶è®¿é—®è§„åˆ™</strong></h3><p><img src="https://picbed.jnchan.top/springcloudImages/17config2.png" alt=""></p><p>ä¸åŠ åˆ†æ”¯åé»˜è®¤æ˜¯ master</p><p><img src="https://picbed.jnchan.top/springcloudImages/17config3.png" alt=""></p><p>æ³¨æ„ï¼š/{application}/{profile}[/{label}]å‡ºçš„æ˜¯ json å­—ç¬¦ä¸²</p><h2 id="3ã€Config-å®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•"><a href="#3ã€Config-å®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•" class="headerlink" title="3ã€Config å®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•"></a>3ã€Config å®¢æˆ·ç«¯é…ç½®ä¸æµ‹è¯•</h2><p>æ–°å»º cloud-config-client-3355</p><h3 id="2-1ã€pom-xml"><a href="#2-1ã€pom-xml" class="headerlink" title="2-1ã€pom.xml"></a>2-1ã€pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-config-client-3355<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2ã€bootstrap-yml"><a href="#2-2ã€bootstrap-yml" class="headerlink" title="2-2ã€bootstrap.yml"></a>2-2ã€bootstrap.yml</h3><p>appllication.yml æ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹<br>bootstrap.yml æ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜<br>SpringCloud ä¼šåˆ›å»ºä¸€ä¸ªâ€Bootstrap Contextâ€ä½œä¸º Spring åº”ç”¨çš„ ApplicationContext çš„çˆ¶ä¸Šä¸‹æ–‡ã€‚</p><p>åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒBootstrap Context è´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„ Environmentã€‚</p><p>Bootstrap å±æ€§æœ‰é«˜ä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚BootstrapContext å’Œ ApplicationContextã€æœ‰ç€ä¸åŒçš„çº¦å®šï¼Œæ‰€ä»¥æ–°å¢äº†ä¸€ä¸ª bootstrap.yml æ–‡ä»¶ï¼Œä¿è¯ BootstrapContext å’Œ ApplicationContext é…ç½®çš„åˆ†ç¦»ã€‚</p><p>bootstrap.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3355</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="comment">#Configå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line">        <span class="attr">config:</span></span><br><span class="line">            <span class="attr">label:</span> <span class="string">master</span> <span class="comment">#åˆ†æ”¯åç§°</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">config</span> <span class="comment">#é…ç½®æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="attr">profile:</span> <span class="string">test</span> <span class="comment">#è¯»å–åç¼€åç§°   ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-test.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–</span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">http://localhost:3344</span> <span class="comment">#é…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">            <span class="comment"># ç»¼åˆä¸Šé¢å››ä¸ª å³è¯»å–é…ç½®æ–‡ä»¶åœ°å€ä¸ºï¼š http://localhost:3344/master/config-test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><h3 id="3ã€ä¸»å¯åŠ¨ç±»"><a href="#3ã€ä¸»å¯åŠ¨ç±»" class="headerlink" title="3ã€ä¸»å¯åŠ¨ç±»"></a>3ã€ä¸»å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientMain3355</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(ConfigClientMain3355.class, args);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€controller-å±‚"><a href="#4ã€controller-å±‚" class="headerlink" title="4ã€controller å±‚"></a>4ã€controller å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span> <span class="comment">//giteeé‡Œçš„ymlæ–‡ä»¶é‡Œçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€-æµ‹è¯•"><a href="#5ã€-æµ‹è¯•" class="headerlink" title="5ã€ æµ‹è¯•"></a>5ã€ æµ‹è¯•</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17config_æµ‹è¯•2.png" alt=""></p><h3 id="6ã€ä¿®æ”¹è¿œç¨‹ä»“åº“é…ç½®æ–‡ä»¶å†…å®¹"><a href="#6ã€ä¿®æ”¹è¿œç¨‹ä»“åº“é…ç½®æ–‡ä»¶å†…å®¹" class="headerlink" title="6ã€ä¿®æ”¹è¿œç¨‹ä»“åº“é…ç½®æ–‡ä»¶å†…å®¹"></a>6ã€ä¿®æ”¹è¿œç¨‹ä»“åº“é…ç½®æ–‡ä»¶å†…å®¹</h3><p>åœ¨æœ¬åœ°çš„æ–‡ä»¶å¤¹ä¸‹å°† springcloud-config ä»“åº“çš„å…‹éš†ä¸‹æ¥ï¼Œæ–¹ä¾¿ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä»“åº“ç›´æ¥ä¿®æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//gitee.com/ç”¨æˆ·å/springcloud-config.git</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ config-dev.yml æ–‡ä»¶å†…å®¹ï¼Œå…¶ä½™ä¸¤ä¸ªç±»ä¼¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">springcloud-config-dev</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">    <span class="attr">info:</span> <span class="string">master</span> <span class="string">branch,</span> <span class="string">springcloud-config/config-dev.yml</span> <span class="string">version=2</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨æœ¬åœ°ä¿®æ”¹åæäº¤åˆ°è¿œç¨‹ä»“åº“</p><ul><li>git add .</li><li>git commit . -m â€œinit ymlâ€</li><li>git push origin master</li></ul><h3 id="7ã€å†æ¬¡æµ‹è¯•"><a href="#7ã€å†æ¬¡æµ‹è¯•" class="headerlink" title="7ã€å†æ¬¡æµ‹è¯•"></a>7ã€å†æ¬¡æµ‹è¯•</h3><p><img src="https://picbed.jnchan.top/springcloudImages/17config_æµ‹è¯•3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/17config_æµ‹è¯•4.png" alt=""></p><h3 id="8ã€-å­˜åœ¨é—®é¢˜"><a href="#8ã€-å­˜åœ¨é—®é¢˜" class="headerlink" title="8ã€ å­˜åœ¨é—®é¢˜"></a><strong>8ã€ å­˜åœ¨é—®é¢˜</strong></h3><p>å½“è¿œç¨‹ä»“åº“é…ç½®æ–‡ä»¶è¢«ä¿®æ”¹åï¼Œ3344 å’Œ 3355 éƒ½è¦å˜ï¼Œ3344 å˜äº†ï¼Œä½†æ˜¯ 3355 å¿…é¡»è¦é‡å¯æ‰å¯ä»¥æ›´æ–°ã€‚</p><h2 id="4ã€Config-å®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°"><a href="#4ã€Config-å®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°" class="headerlink" title="4ã€Config å®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°"></a>4ã€Config å®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°</h2><p>é¿å…æ¯æ¬¡æ›´æ–°é…ç½®éƒ½è¦é‡å¯å®¢æˆ·ç«¯å¾®æœåŠ¡ 3355ï¼Œæˆ‘ä»¬éœ€è¦å®ƒèƒ½åŠ¨æ€åˆ·æ–°ï¼Œä¸‹é¢æ¥ä¿®æ”¹ 3355 æ¨¡å—</p><h3 id="4-1ã€pom-xml-å¼•å…¥-actuator-ç›‘æ§"><a href="#4-1ã€pom-xml-å¼•å…¥-actuator-ç›‘æ§" class="headerlink" title="4-1ã€pom.xml å¼•å…¥ actuator ç›‘æ§"></a>4-1ã€pom.xml å¼•å…¥ actuator ç›‘æ§</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-2ã€ä¿®æ”¹-YMLï¼Œæš´éœ²ç›‘æ§ç«¯å£"><a href="#4-2ã€ä¿®æ”¹-YMLï¼Œæš´éœ²ç›‘æ§ç«¯å£" class="headerlink" title="4-2ã€ä¿®æ”¹ YMLï¼Œæš´éœ²ç›‘æ§ç«¯å£"></a>4-2ã€ä¿®æ”¹ YMLï¼Œæš´éœ²ç›‘æ§ç«¯å£</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æš´éœ²ç›‘æ§ç«¯ç‚¹ actuatoråˆ·æ–°é…ç½®</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå› ä¸ºæ‰‹åŠ¨åˆ·æ–°éœ€è¦è‡ªå·±è°ƒç”¨ä¸€ä¸ªç±»ä¼¼äºå¥åº·æ£€æŸ¥çš„ç«¯ç‚¹ï¼ˆæ¥å£ï¼‰ï¼Œæ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªç«¯ç‚¹ç»™æš´éœ²å‡ºæ¥ï¼Œä»¥ä¾¿å¤–éƒ¨å¯è®¿é—®</p><h3 id="4-3ã€Controller-ç±»æ·»åŠ -RefreshScope"><a href="#4-3ã€Controller-ç±»æ·»åŠ -RefreshScope" class="headerlink" title="4-3ã€Controller ç±»æ·»åŠ @RefreshScope"></a>4-3ã€Controller ç±»æ·»åŠ @RefreshScope</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span> <span class="comment">//giteeé‡Œçš„ymlæ–‡ä»¶é‡Œçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/configInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4ã€é—®é¢˜å’Œè§£å†³"><a href="#4-4ã€é—®é¢˜å’Œè§£å†³" class="headerlink" title="4-4ã€é—®é¢˜å’Œè§£å†³"></a>4-4ã€é—®é¢˜å’Œè§£å†³</h3><p>æ­¤æ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹ï¼Œå†æµ‹ï¼š<a href="http://localhost:3355/configInfoï¼Œå‘ç°">http://localhost:3355/configInfoï¼Œå‘ç°</a> 3355 è¿˜æ˜¯æ²¡æœ‰å˜åŒ–</p><p>éœ€è¦è¿ç»´äººå‘˜å‘é€ Post è¯·æ±‚åˆ·æ–° 3355</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST <span class="string">&quot;http://localhost:3355/actuator/refresh&quot;</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡è¯·æ±‚ï¼š<a href="http://localhost:3355/configInfoï¼ŒæˆåŠŸå®ç°äº†å®¢æˆ·ç«¯">http://localhost:3355/configInfoï¼ŒæˆåŠŸå®ç°äº†å®¢æˆ·ç«¯</a> 3355 åˆ·æ–°åˆ°æœ€æ–°é…ç½®å†…å®¹ï¼Œé¿å…äº†æœåŠ¡é‡å¯</p><h3 id="4-5ã€æ€è€ƒ"><a href="#4-5ã€æ€è€ƒ" class="headerlink" title="4-5ã€æ€è€ƒ"></a>4-5ã€æ€è€ƒ</h3><p>æƒ³æƒ³è¿˜æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><ul><li>å‡å¦‚æœ‰å¤šä¸ªå¾®æœåŠ¡å®¢æˆ·ç«¯ 3355/3366/3377â€¦â€¦ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰§è¡Œä¸€æ¬¡ post è¯·æ±‚ï¼Œæ‰‹åŠ¨åˆ·æ–°ï¼Ÿ</li><li>å¯å¦å¹¿æ’­ï¼Œä¸€æ¬¡é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆï¼Ÿ</li><li>æˆ‘ä»¬æƒ³å¤§èŒƒå›´çš„è‡ªåŠ¨åˆ·æ–°ï¼Œæ±‚æ–¹æ³•</li></ul><p>äºæ˜¯å°±æœ‰ä¸‹é¢çš„æ¶ˆæ¯æ€»çº¿ï¼</p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" title="Busæ¶ˆæ¯æ€»çº¿">Busæ¶ˆæ¯æ€»çº¿</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Dockerç¬”è®°</title>
      <link href="/2023/06/12/Docker/"/>
      <url>/2023/06/12/Docker/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p><img src="/images/dockerimages/image-20200606203315597.png" alt="image-20200606203315597"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/docker-for-windows/">https://docs.docker.com/docker-for-windows/</a></p><p>ã€å®˜æ–¹æ–‡æ¡£è¶…çº§è¯¦ç»†ã€‘</p><p>ä»“åº“åœ°å€ï¼š<a href="https://hub.docker.com/">https://hub.docker.com/</a></p><p>ã€å‘å¸ƒåˆ°ä»“åº“ï¼Œgit pull pushã€‘</p><p>è¿™ä¸ªç¬”è®° b ç«™æ•™ç¨‹ï¼š<a href="https://www.bilibili.com/video/BV1og4y1q7M4?">https://www.bilibili.com/video/BV1og4y1q7M4?</a></p><h2 id="å‰æœŸåŸºç¡€"><a href="#å‰æœŸåŸºç¡€" class="headerlink" title="å‰æœŸåŸºç¡€"></a>å‰æœŸåŸºç¡€</h2><p>linux åŸºæœ¬å‘½ä»¤</p><h2 id="Docker-æ¦‚è¿°"><a href="#Docker-æ¦‚è¿°" class="headerlink" title="Docker æ¦‚è¿°"></a>Docker æ¦‚è¿°</h2><p>ä½¿ç”¨ Docker åçš„æµç¨‹ï¼š</p><p>å¼€å‘ï¼šå»ºç«‹æ¨¡å‹â€”ç¯å¢ƒâ€”æ‰“åŒ…å¸¦ä¸Šç¯å¢ƒï¼Œå³é•œåƒâ€”æ”¾åˆ° Docker ä»“åº“</p><p>éƒ¨ç½²ï¼šä¸‹è½½ Docker ä¸­çš„é•œåƒï¼Œç›´æ¥è¿è¡Œå³å¯</p><p>Docker çš„æ€æƒ³æ¥è‡ªäºé›†è£…ç®±ï¼Œé›†è£…ç®±ï¼Œå¯¹ç¯å¢ƒè¿›è¡Œéš”ç¦»</p><p>Docker é€šè¿‡éš”ç¦»æœºåˆ¶ï¼Œå¯ä»¥å°†æœåŠ¡å™¨åˆ©ç”¨åˆ°æè‡´ã€‚</p><h2 id=""><a href="#" class="headerlink" title="#"></a>#</h2><h2 id="Docker-å®‰è£…"><a href="#Docker-å®‰è£…" class="headerlink" title="Docker å®‰è£…"></a>Docker å®‰è£…</h2><h3 id="Docker-çš„åŸºæœ¬ç»„æˆ"><a href="#Docker-çš„åŸºæœ¬ç»„æˆ" class="headerlink" title="Docker çš„åŸºæœ¬ç»„æˆ"></a>Docker çš„åŸºæœ¬ç»„æˆ</h3><p><img src="/images/dockerimages/image-20200606212250845.png" alt="image-20200606212250845"></p><p>æ˜ç¡®å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><p>é•œåƒ(image)ï¼šdocker é•œåƒå¥½æ¯”ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ¨¡æ¿æ¥åˆ›å»ºå®¹å™¨(container)ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼Œç±»ä¼¼ Python ä¸­çš„ Class</p></li><li><p>å®¹å™¨(container)ï¼šç±»ä¼¼ Python ä¸­é€šè¿‡ Class åˆ›å»ºçš„å®ä¾‹ï¼ŒObjectï¼›å®¹å™¨å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç®€æ˜“çš„ç³»ç»Ÿ</p></li><li><p>ä»“åº“(repository)ï¼šå­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œ</p><p> åˆ†ä¸ºå…±æœ‰ä»“åº“å’Œç§æœ‰ä»“åº“</p><ul><li><p>Docker Hubï¼šå›½å¤–çš„</p></li><li><p>é˜¿é‡Œäº‘ï¼šé…ç½®é•œåƒåŠ é€Ÿ</p></li></ul></li></ol><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>æˆ‘ä»¬è¦æœ‰ä¸€å°æœåŠ¡å™¨ï¼Œå¹¶ä¸”å¯ä»¥æ“ä½œå®ƒ</p><ol><li>Linux å‘½ä»¤åŸºç¡€ï¼Œè´­ä¹° linux é˜¿é‡Œäº‘çš„æœåŠ¡å™¨</li><li>CentOS 7</li><li>ä½¿ç”¨ Xshell é“¾æ¥è¿œç¨‹æœåŠ¡å™¨</li></ol><h3 id="å®‰è£…-xshell"><a href="#å®‰è£…-xshell" class="headerlink" title="å®‰è£… xshell"></a>å®‰è£… xshell</h3><p>ä¸‹è½½ CentOS7 <a href="https://www.jianshu.com/p/a63f47e096e8">https://www.jianshu.com/p/a63f47e096e8</a></p><p>xshell é“¾æ¥æœåŠ¡å™¨ <a href="https://blog.csdn.net/zzy1078689276/article/details/77280814">https://blog.csdn.net/zzy1078689276/article/details/77280814</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# cd /</span><br><span class="line">[root@192 /]# pwd</span><br><span class="line">/</span><br><span class="line">[root@192 /]# ls</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@192 /]# uname -r</span><br><span class="line">3.10.0-1127.el7.x86_64</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200608091950655.png" alt="image-20200608091950655"></p><h3 id="Centos-å®‰è£…"><a href="#Centos-å®‰è£…" class="headerlink" title="Centos å®‰è£…"></a>Centos å®‰è£…</h3><p><a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p><h3 id="å¸è½½æ—§çš„ç‰ˆæœ¬"><a href="#å¸è½½æ—§çš„ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§çš„ç‰ˆæœ¬"></a>å¸è½½æ—§çš„ç‰ˆæœ¬</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># å¸è½½æ—§çš„ç‰ˆæœ¬</span><br><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200608092628498.png" alt="image-20200608092628498"></p><h3 id="å®‰è£…åŸºæœ¬ç¯å¢ƒ"><a href="#å®‰è£…åŸºæœ¬ç¯å¢ƒ" class="headerlink" title="å®‰è£…åŸºæœ¬ç¯å¢ƒ"></a>å®‰è£…åŸºæœ¬ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…åŸºæœ¬çš„å®‰è£…åŒ…</span><br><span class="line">$ sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure><p>!</p><p><img src="/images/dockerimages/image-20200608093114774.png" alt="image-20200608093114774"></p><h3 id="è®¾ç½®é•œåƒçš„ä»“åº“"><a href="#è®¾ç½®é•œåƒçš„ä»“åº“" class="headerlink" title="è®¾ç½®é•œåƒçš„ä»“åº“"></a>è®¾ç½®é•œåƒçš„ä»“åº“</h3><p>æ³¨æ„ï¼ï¼ä¸‹è½½é»˜è®¤ç”¨å›½å¤–çš„ï¼Œå¤ªæ…¢ä¸è¦ç”¨ï¼</p><p>ç”¨å›½å†…é•œåƒï¼Œç™¾åº¦æœç´¢ï¼Œdocker çš„é˜¿é‡Œäº‘é•œåƒåœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># ä¸è¦ç”¨å®˜ç½‘é»˜è®¤è¿™ä¸ªï¼</span><br><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo # é»˜è®¤æ˜¯å›½å¤–çš„</span><br><span class="line"></span><br><span class="line"># æ¢æˆä¸‹é¢çš„</span><br><span class="line"></span><br><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # é˜¿é‡Œäº‘é•œåƒ</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616145430166.png" alt="image-20200616145430166"></p><p>ç›´æ¥å¤åˆ¶ç²˜è´´å°± OK äº†</p><p>æ›´åƒè½¯ä»¶åŒ…ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616150014082.png" alt="image-20200616150014082"></p><p>æ²¡æœ‰é—®é¢˜çš„è¯å°±æ˜¯å¯ä»¥ç”¨çš„</p><h3 id="å®‰è£…-docker-å¼•æ“"><a href="#å®‰è£…-docker-å¼•æ“" class="headerlink" title="å®‰è£… docker å¼•æ“"></a>å®‰è£… docker å¼•æ“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io <span class="comment"># docker-ce ç¤¾åŒºç‰ˆ ee ä¼ä¸šç‰ˆ</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œä¼šæœ‰å‡ ä¸ªä¸ª y/n çš„åˆ¤æ–­</p><p><img src="/images/dockerimages/image-20200616150818860.png" alt="image-20200616150818860"></p><p><img src="/images/dockerimages/image-20200616150922549.png" alt="image-20200616150922549"></p><p>è¦çœ‹åˆ° Complet å†æ”¶æ‰‹ï¼</p><h3 id="å¯åŠ¨-Docker"><a href="#å¯åŠ¨-Docker" class="headerlink" title="å¯åŠ¨ Docker"></a>å¯åŠ¨ Docker</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker # ä»£è¡¨å¯åŠ¨æˆåŠŸ</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.11</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.10</span><br><span class="line"> Git commit:        42e35e61f3</span><br><span class="line"> Built:             Mon Jun  1 09:13:48 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.11</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.10</span><br><span class="line">  Git commit:       42e35e61f3</span><br><span class="line">  Built:            Mon Jun  1 09:12:26 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.2.13</span><br><span class="line">  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616151641013.png" alt="image-20200616151641013"></p><p>ä¸­é—´ä¸€å †æ˜¯ç­¾åä¿¡æ¯</p><p>run çš„è¿è¡Œæµç¨‹å›¾</p><p><img src="/images/dockerimages/image-20200616161441669.png" alt="image-20200616161441669"></p><p>æŸ¥çœ‹ä¸‹è½½çš„é•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616151913277.png" alt="image-20200616151913277"></p><h3 id="å¸è½½-Docker"><a href="#å¸è½½-Docker" class="headerlink" title="å¸è½½ Docker"></a>å¸è½½ Docker</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å¸è½½ä¾èµ–</span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"># åˆ é™¤èµ„æº</span><br><span class="line">rm -rf /var/lib/docker # docker çš„é»˜è®¤å·¥ä½œè·¯å¾„</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"><a href="#é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ" class="headerlink" title="é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ"></a>é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker # åˆ›å»ºä¸€ä¸ªé™Œè·¯</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://uyfgafsw.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF # ç¼–å†™é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload # é‡å¯æœåŠ¡</span><br><span class="line">sudo systemctl restart docker # é‡å¯docker</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616160315298.png" alt="image-20200616160315298"></p><p><a href="https://www.processon.com/">åœ¨çº¿ç”»å›¾è½¯ä»¶ ProcessOn</a></p><h2 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h2><p>Docker æ˜¯çœŸä¹ˆå·¥ä½œçš„ï¼Ÿ</p><p>Docker æ˜¯ä¸€ä¸ª Client-Server ç»“æ„çš„ç³»ç»Ÿï¼ŒDocker çš„å®ˆæŠ¤è¿›ç¨‹åœ¨ä¸»æœºä¸Šã€‚é€šè¿‡ Socket ä»å®¢æˆ·ç«¯è®¿é—®ï¼</p><p>DockerServer æ¥å—åˆ° Docker-Client çš„æŒ‡ä»¤ï¼Œ</p><p><img src="/images/dockerimages/image-20200616162107363.png" alt="image-20200616162107363"></p><p>Docker ä¸ºä»€ä¹ˆæ¯” VM å¿«ï¼Ÿ</p><ol><li>Docker æœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚</li><li>docker ä¸»è¦ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œvm éœ€è¦ Guest OS</li></ol><p><img src="/images/dockerimages/image-20200616162302653.png" alt="image-20200616162302653"></p><p>æ‰€ä»¥è¯´æ–°å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œdocker ä¸éœ€è¦åƒè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œé¿å…å¼•å¯¼</p><h2 id="Docker-å‘½ä»¤"><a href="#Docker-å‘½ä»¤" class="headerlink" title="Docker å‘½ä»¤"></a>Docker å‘½ä»¤</h2><h3 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version # æ˜¾ç¤ºdockerçš„åŸºæœ¬ä¿¡æ¯</span><br><span class="line">docker info # ç³»ç»Ÿä¿¡æ¯ï¼Œé•œåƒå’Œå®¹å™¨çš„æ•°é‡</span><br><span class="line">docker å‘½ä»¤ --help # å…¨éƒ¨ä¿¡æ¯</span><br></pre></td></tr></table></figure><p><a href="https://docs.docker.com/reference/">å®˜ç½‘æ–‡æ¡£</a></p><p><img src="/images/dockerimages/image-20200616163338187.png" alt="image-20200616163338187"></p><h3 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h3><h4 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a>docker images</h4><p>æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># docker images</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616172056530.png" alt="image-20200616172056530"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># è§£é‡Š</span><br><span class="line">REPOSITORY  # é•œåƒä»“åº“æº</span><br><span class="line">TAG                 # é•œåƒçš„æ ‡ç­¾</span><br><span class="line">IMAGE ID           # é•œåƒçš„ID</span><br><span class="line">CREATED           # é•œåƒçš„åˆ›å»ºæ—¶é—´</span><br><span class="line">SIZE # é•œåƒçš„å¤§å°</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--all , -aShow all images (default hides intermediate images) <span class="comment"># æ˜¾ç¤ºæ‰€æœ‰</span></span><br><span class="line">--digestsShow digests</span><br><span class="line">--filter , -fFilter output based on conditions provided</span><br><span class="line">--formatPretty-<span class="built_in">print</span> images using a Go template</span><br><span class="line">--no-truncDonâ€™t <span class="built_in">truncate</span> output</span><br><span class="line">--quiet , -qOnly show numeric IDs <span class="comment"># åªæ˜¾ç¤ºid</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616172651835.png" alt="image-20200616172651835"></p><h4 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h4><p>æœç´¢ä»“åº“ä¸­çš„é•œåƒï¼Œç›¸å½“äºç½‘é¡µæœç´¢</p><p><a href="http://hub.docker.com">ç½‘é¡µæœç´¢</a></p><p><img src="/images/dockerimages/image-20200616173009473.png" alt="image-20200616173009473"></p><p>mysql</p><p><img src="/images/dockerimages/image-20200616173050756.png" alt="image-20200616173050756"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616173308194.png" alt="image-20200616173308194"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search --help</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616173740981.png" alt="image-20200616173740981"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è§£é‡Š</span></span><br><span class="line">Options:</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-<span class="built_in">print</span> search using a Go template</span><br><span class="line">      --<span class="built_in">limit</span> int       Max number of search results (default 25)</span><br><span class="line">      --no-trunc        Don<span class="string">&#x27;t truncate output</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql --filter=STARS=3000 # æœç´¢å‡ºStarså¤§äº3000çš„</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200616174440284.png" alt="image-20200616174440284"></p><p>ã€è§†é¢‘ä¹¦ç­¾ï¼Œ<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=9ã€‘">https://www.bilibili.com/video/BV1og4y1q7M4?p=9ã€‘</a></p><h4 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h4><p>ä¸‹è½½é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql <span class="comment"># ä¸‹è½½mysqlé•œåƒï¼Œdefault tagï¼Œé»˜è®¤æœ€æ–°ç‰ˆlatest</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># sudo systemctl daemon-reload</span></span><br><span class="line">[root@192 ~]<span class="comment"># sudo systemctl restart docker</span></span><br><span class="line">[root@192 ~]<span class="comment"># docker pull mysql</span></span><br><span class="line">Using default tag: latest <span class="comment"># ä¸å†™tagé»˜è®¤æœ€æ–°ç‰ˆ</span></span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">8559a31e96f4: Pull complete  <span class="comment"># layer åˆ†å±‚ä¸‹è½½ï¼Œdocker imageçš„æ ¸å¿ƒ è”åˆæ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">d51ce1c2e575: Pull complete</span><br><span class="line">c2344adc4858: Pull complete</span><br><span class="line">fcf3ceff18fc: Pull complete</span><br><span class="line">16da0c38dc5b: Pull complete</span><br><span class="line">b905d1797e97: Pull complete</span><br><span class="line">4b50d1c6b05c: Pull complete</span><br><span class="line">c75914a65ca2: Pull complete</span><br><span class="line">1ae8042bdd09: Pull complete</span><br><span class="line">453ac13c00a3: Pull complete</span><br><span class="line">9e680cd72f08: Pull complete</span><br><span class="line">a6b5dc864b6c: Pull complete</span><br><span class="line">Digest: sha256:8b7b328a7ff6de46ef96bcf83af048cb00a1c86282bfca0cb119c84568b4caf6<span class="comment">#ç­¾å</span></span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:latest</span><br><span class="line">docker.io/library/mysql:latest <span class="comment"># çœŸå®åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å³</span></span><br><span class="line">docker pull mysql</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç‰ˆæœ¬ä¸‹è½½</span></span><br><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure><p>ç‰ˆæœ¬æ¥è‡ªäºå®˜ç½‘ï¼Œç‰ˆæœ¬åº“<a href="https://hub.docker.com/_/mysql">https://hub.docker.com/_/mysql</a></p><p><img src="/images/dockerimages/image-20200617094339687.png" alt="image-20200617094339687"></p><p><img src="/images/dockerimages/image-20200617100948088.png" alt="image-20200617100948088"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æŸ¥çœ‹é•œåƒï¼Œå¯ä»¥çœ‹åˆ°æ–°ä¸‹è½½çš„ä¸¤ä¸ª</p><p><img src="/images/dockerimages/image-20200617101105899.png" alt="image-20200617101105899"></p><h4 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h4><p>remove images</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ä¸€ä¸ª å¯ä»¥é€šè¿‡åç§° ä¹Ÿå¯ä»¥æŒ‡å®šid -fè¡¨ç¤ºåˆ é™¤æ‰€æœ‰</span></span><br><span class="line">docker rmi -f 9cfcce23593a</span><br><span class="line"><span class="comment"># åˆ é™¤å¤šä¸ª ç”¨ç©ºæ ¼åˆ†éš”id</span></span><br><span class="line">docker rmi -f <span class="built_in">id</span> <span class="built_in">id</span> <span class="built_in">id</span></span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰</span></span><br><span class="line">docker rmi -f $(docker images -aq) <span class="comment"># images -aqå°±æ˜¯æŸ¥æ‰€æœ‰é•œåƒidï¼Œä»è€Œé€’å½’åˆ é™¤</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617102049613.png" alt="image-20200617102049613"></p><p><img src="/images/dockerimages/image-20200617102126526.png" alt="image-20200617102126526"></p><h3 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h3><p>è¯´æ˜ï¼šæœ‰äº†é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œlinuxï¼Œä¸‹è½½ä¸€ä¸ª centos é•œåƒæ¥æµ‹è¯•å­¦ä¹ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617103406974.png" alt="image-20200617103406974"></p><h4 id="æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨"><a href="#æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨" class="headerlink" title="æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨"></a>æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run [å¯é€‰å‚æ•°] image</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‚æ•°è¯´æ˜</span></span><br><span class="line">--name=â€œNameâ€ # å®¹å™¨åå­—ï¼Œç”¨äºåŒºåˆ†å®¹å™¨</span><br><span class="line">-d åå°æ–¹å¼è¿è¡Œ</span><br><span class="line">-it ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹</span><br><span class="line">-p æŒ‡å®šå®¹å™¨çš„ç«¯å£ å¦‚-p 8080::8080</span><br><span class="line">-p ip:ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£</span><br><span class="line">-p ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span><br><span class="line">-p å®¹å™¨ç«¯å£</span><br><span class="line"></span><br><span class="line">-p éšæœºæŒ‡å®šç«¯å£</span><br></pre></td></tr></table></figure><h4 id="è¿›å…¥é€€å‡ºå®¹å™¨"><a href="#è¿›å…¥é€€å‡ºå®¹å™¨" class="headerlink" title="è¿›å…¥é€€å‡ºå®¹å™¨"></a>è¿›å…¥é€€å‡ºå®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥</span></span><br><span class="line">docker run -it centos /bin/bash</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç›®å½•</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="comment"># é€€å‡º</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617104004004.png" alt="image-20200617104004004"></p><p>æ³¨æ„è¿™é‡Œé¢ä¸»æœºåï¼Œç¼–ç¨‹äº† centos çš„ id</p><p>è¿™é‡Œé¢å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¥—å¨ƒå•Š</p><h4 id="æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨"><a href="#æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨" class="headerlink" title="æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨"></a>æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker ps</span><br><span class="line"># æŸ¥çœ‹æ›¾ç»è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker ps -a</span><br><span class="line"># æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ï¼Œè®¾ç½®æ˜¾ç¤ºä¸ªæ•°</span><br><span class="line">docker ps -a - n=?</span><br><span class="line"># åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·</span><br><span class="line">docker ps -aq</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@192 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">9939864fa2e6        centos              &quot;bin/bash&quot;          4 minutes ago       Exited (0) 4 minutes ago                       unruffled_knuth</span><br><span class="line">5f42e9930435        centos              &quot;/bin/bash&quot;         8 minutes ago       Exited (0) 4 minutes ago                       lucid_cannon</span><br><span class="line">a89ddb393d3d        bf756fb1ae65        &quot;/hello&quot;            19 hours ago        Exited (0) 19 hours ago                        gracious_bhabha</span><br><span class="line">[root@192 ~]# docker ps -a -n=2</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">9939864fa2e6        centos              &quot;bin/bash&quot;          6 minutes ago       Exited (0) 6 minutes ago                       unruffled_knuth</span><br><span class="line">5f42e9930435        centos              &quot;/bin/bash&quot;         10 minutes ago      Exited (0) 7 minutes ago</span><br><span class="line">[root@192 ~]# docker ps -aq</span><br><span class="line">9939864fa2e6</span><br><span class="line">5f42e9930435</span><br><span class="line">a89ddb393d3d</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="é€€å‡ºå®¹å™¨"><a href="#é€€å‡ºå®¹å™¨" class="headerlink" title="é€€å‡ºå®¹å™¨"></a>é€€å‡ºå®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®¹å™¨åœæ­¢é€€å‡º</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®¹å™¨ä¸åœæ­¢é€€å‡º æ³¨æ„å¿…é¡»åœ¨è‹±æ–‡è¾“å…¥æ³•ä¸‹ï¼Œä¸­æ–‡è¾“å…¥æ³•ä¸è¡Œ</span></span><br><span class="line">Ctrl + P + Q</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@bfcea13c40cd /]# [root@192 ~]# docker ps ##æ³¨æ„è¿™é‡Œä¼šè‡ªåŠ¨ç»™ä¸ªå‘½ä»¤ï¼Œåˆ æ‰</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES</span><br><span class="line">bfcea13c40cd        centos              &quot;/bin/bash&quot;         About a minute ago   Up About a minute                       stoic_wilson</span><br><span class="line">edbd9366d959        centos              &quot;/bin/bash&quot;         7 minutes ago        Up 7 minutes                            affectionate_bartik</span><br><span class="line">[root@192 ~]# docker exec -it edbd9366d959 /bin/bash ## å†æ¬¡è¿›å…¥</span><br><span class="line">[root@edbd9366d959 /]# exit ##åœæ­¢å¹¶æ¨å‡º</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€æ¬¡å¯åŠ¨é•œåƒç”¨run</span><br><span class="line">å†æ¬¡å¯åŠ¨å®¹å™¨ç”¨exec</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æŒ‡å®šå®¹å™¨ ä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¦‚æœå¼ºåˆ¶åˆ é™¤ <span class="built_in">rm</span> -f</span></span><br><span class="line">docker rm å®¹å™¨id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker ps -a -q|xargs docker rm</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">bfcea13c40cd        centos              &quot;/bin/bash&quot;         29 minutes ago      Up 29 minutes                                   stoic_wilson</span><br><span class="line">edbd9366d959        centos              &quot;/bin/bash&quot;         35 minutes ago      Up 35 minutes                                   affectionate_bartik</span><br><span class="line">9939864fa2e6        centos              &quot;bin/bash&quot;          48 minutes ago      Exited (0) 48 minutes ago                       unruffled_knuth</span><br><span class="line">5f42e9930435        centos              &quot;/bin/bash&quot;         52 minutes ago      Exited (0) 49 minutes ago                       lucid_cannon</span><br><span class="line">a89ddb393d3d        bf756fb1ae65        &quot;/hello&quot;            20 hours ago        Exited (0) 20 hours ago                         gracious_bhabha</span><br><span class="line">[root@192 ~]# docker rm 5f42e9930435</span><br><span class="line">5f42e9930435</span><br><span class="line">[root@192 ~]# docker rm edbd9366d959      # æ³¨æ„æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸èƒ½åˆ é™¤</span><br><span class="line">Error response from daemon: You cannot remove a running container edbd9366d9596c744dd449119269b04de2f2a494e7fc471f6396bcefd94c33fe. Stop the container before attempting removal or force remove</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker ps -aq # æ‰€æœ‰å®¹å™¨id</span><br><span class="line">bfcea13c40cd</span><br><span class="line">edbd9366d959</span><br><span class="line">9939864fa2e6</span><br><span class="line">a89ddb393d3d</span><br><span class="line">[root@192 ~]# docker rm -f $(docker ps -aq) # å…¨éƒ¨åˆ é™¤</span><br><span class="line">bfcea13c40cd</span><br><span class="line">edbd9366d959</span><br><span class="line">9939864fa2e6</span><br><span class="line">a89ddb393d3d</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ"><a href="#å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ" class="headerlink" title="å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ"></a>å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start</span><br><span class="line">docker restart</span><br><span class="line">docker stop</span><br><span class="line">docker kill</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@7b1a7dd10ea4 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@192 ~]# docker ps #æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@192 ~]# docker ps -a # æŸ¥çœ‹å†å²è¿è¡Œè¿‡çš„</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;         54 seconds ago      Exited (0) 42 seconds ago                       fervent_mirzakhani</span><br><span class="line">[root@192 ~]# docker start 7b1a7dd10ea4 # å¯åŠ¨å½“å‰è¿™ä¸ªå®¹å™¨ container id ç²˜è¿‡ æ¥</span><br><span class="line">7b1a7dd10ea4</span><br><span class="line">[root@192 ~]# docker ps # æŸ¥çœ‹å½“å‰è¿è¡Œå®¹å™¨ å‘ç°å¯åŠ¨æˆåŠŸ</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;         2 minutes ago       Up 28 seconds                           fervent_mirzakhani</span><br><span class="line">[root@192 ~]# docker stop 7b1a7dd10ea4 # åœæ­¢è¿è¡Œ</span><br><span class="line">7b1a7dd10ea4</span><br><span class="line">[root@192 ~]# docker ps # å†æ¬¡æŸ¥çœ‹ æ²¡æœ‰è¿™ä¸ªå®¹å™¨äº†</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å…¶ä»–å‘½ä»¤"><a href="#å¸¸ç”¨å…¶ä»–å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å…¶ä»–å‘½ä»¤"></a>å¸¸ç”¨å…¶ä»–å‘½ä»¤</h3><p>ã€è§†é¢‘ä¹¦ç­¾ï¼š<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=11ã€‘">https://www.bilibili.com/video/BV1og4y1q7M4?p=11ã€‘</a></p><h4 id="åå°å¯åŠ¨-docker"><a href="#åå°å¯åŠ¨-docker" class="headerlink" title="åå°å¯åŠ¨ docker"></a>åå°å¯åŠ¨ docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d é•œåƒå</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”¨docker ps æŸ¥çœ‹çš„æ—¶å€™ å‘ç°åœæ­¢äº†</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åå°è¿è¡Œï¼Œdockerå‘ç°å‰å°æ²¡æœ‰ï¼Œå®¹å™¨å¯åŠ¨åï¼Œå‘ç°è‡ªå·±æ²¡æœ‰æä¾›æœåŠ¡ï¼Œä¼šç«‹åˆ»åœæ­¢</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Last login: Wed Jun 17 19:47:35 2020</span><br><span class="line">[root@192 ~]# systemctl start docker # å…³æœºåé‡å¯äº†ï¼Œéœ€è¦å¯åŠ¨docker</span><br><span class="line">[root@192 ~]# docker run -d centos # è¿è¡Œ</span><br><span class="line">8ce188e5fee31c2fac93c0a405ee1a95c38dbc50cb47c35b19c0039c27558ded</span><br><span class="line">[root@192 ~]# docker ps -a # æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">8ce188e5fee3        centos              &quot;/bin/bash&quot;         19 seconds ago      Exited (0) 18 seconds ago                       tender_dirac</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;         8 hours ago         Exited (0) 8 hours ago                          fervent_mirzakhani</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker logs</span><br><span class="line">docker logs -f -t --tail n ã€idã€‘</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617161744298.png" alt="image-20200617161744298"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker logs --help</span><br><span class="line"></span><br><span class="line">Usage:docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">Fetch the logs of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow log output</span><br><span class="line">      --since string   Show logs since timestamp (e.g.</span><br><span class="line">                       2013-01-02T13:23:37) or relative</span><br><span class="line">                       (e.g. 42m for 42 minutes)</span><br><span class="line">      --tail string    Number of lines to show from the</span><br><span class="line">                       end of the logs (default &quot;all&quot;)</span><br><span class="line">  -t, --timestamps     Show timestamps # æ—¶é—´æˆ³</span><br><span class="line">      --until string   Show logs before a timestamp (e.g.</span><br><span class="line">                       2013-01-02T13:23:37) or relative</span><br><span class="line">                       (e.g. 42m for 42 minutes)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whiel true;do echo shen;sleep</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿è¡Œä¸€ä¸ª</span></span><br><span class="line">[root@192 ~]# docker run -it centos /bin/bash</span><br><span class="line"></span><br><span class="line">[root@c2887d35c71d /]# [root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;         57 seconds ago      Up 56 seconds                           vigorous_kare</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ—¥å¿—ï¼Œç”±äºæ²¡æœ‰è¿è¡Œè„šæœ¬ï¼Œæ‰€ä»¥å•¥ä¹Ÿæ²¡æ˜¾ç¤º</span></span><br><span class="line">[root@192 ~]# docker logs -f -t --tail 10 c2887d35c71d</span><br><span class="line">^C # ctrl+cé€€å‡º</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿è¡Œcentosé‡Œé¢åŠ ä¸ªè„šæœ¬</span></span><br><span class="line">[root@192 ~]# docker run -d centos /bin/sh -c &quot;while true;do echo shenzai;sleep 1;done&quot;</span><br><span class="line">cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388</span><br><span class="line"></span><br><span class="line">[root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">cb6d7fbc3f27        centos              &quot;/bin/sh -c &#x27;while tâ€¦&quot;   7 seconds ago       Up 6 seconds                            dreamy_almeida</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;              3 minutes ago       Up 3 minutes                            vigorous_kare</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ—¥å¿— å‘ç°éš”ä¸€ç§’æ‰“å°ä¸€æ¡</span></span><br><span class="line">[root@192 ~]# docker logs -f -t --tail 10 cb6d7fbc3f27</span><br><span class="line">2020-06-17T12:02:11.293765084Z shen</span><br><span class="line">2020-06-17T12:02:12.297675608Z shen</span><br><span class="line">2020-06-17T12:02:13.301845582Z shen</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿¡æ¯"><a href="#æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿¡æ¯"></a>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]# docker inspect cb6d7fbc3f27</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        # å®¹å™¨çš„å®Œæ•´id</span><br><span class="line">        &quot;Id&quot;: &quot;cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388&quot;,</span><br><span class="line"></span><br><span class="line">        # åˆ›å»ºæ—¶é—´</span><br><span class="line">        &quot;Created&quot;: &quot;2020-06-17T12:00:50.706906186Z&quot;,</span><br><span class="line"></span><br><span class="line">        # è„šæœ¬ä½ç½®</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line"></span><br><span class="line">        # è¿è¡Œçš„è„šæœ¬</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo shenzai;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;, # çŠ¶æ€ï¼Œæ­£åœ¨è¿è¡Œ</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 1909, # çˆ¶è¿›ç¨‹id</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-06-17T12:00:51.093617477Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        # æ¥æºé•œåƒ</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:831691599b88ad6cc2a4abbd0e89661a121aff14cfa289ad840fd3946f274f1f&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388/cb6d7fbc3f27a064137d58282de97b97365dea2705211ebfbad642079cc1b388-json.log&quot;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &quot;Name&quot;: &quot;/dreamy_almeida&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line"></span><br><span class="line">        # ä¸»æœºé…ç½®</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Capabilities&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        # å…¶ä»–é…ç½®</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907-init/diff:/var/lib/docker/overlay2/7f79322e0f58d651a84a555dadd83d92537788172525945d3f538dd95dce336c/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/3675586ebbd79cd72d2562a90c9380627a331c563724c0dac091f92600af4907/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &quot;Mounts&quot;: [], # æŒ‚è½½</span><br><span class="line"></span><br><span class="line">        # åŸºæœ¬é…ç½®</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;cb6d7fbc3f27&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ], # åŸºæœ¬ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæ²¡æœ‰Java</span><br><span class="line"></span><br><span class="line">            # åŸºæœ¬å‘½ä»¤</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo shenzai;sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20200611&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        # ç½‘å¡ï¼Œæ¯”å¦‚ç°åœ¨ç”¨çš„æ˜¯æ¡¥æ¥çš„ç½‘å¡</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;4d701985d7e77aa153790b697b2f38a61e20555c224b7675e4bf650b82799882&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/4d701985d7e7&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;8a6c71e2bafb19ca7dfd85445ccc4bef6d17467360a243d624089e676a24a018&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;22b0fd2290ccbc4e066a75d3f01bd8bf32ee4352c5bbcfc9f911287219219571&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;8a6c71e2bafb19ca7dfd85445ccc4bef6d17467360a243d624089e676a24a018&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœæ­¢æ­£åœ¨ç–¯ç‹‚è¾“å‡ºçš„é‚£ä¸ªå®¹å™¨</span></span><br><span class="line">[root@192 ~]# docker stop cb6d7fbc3f27</span><br><span class="line">cb6d7fbc3f27</span><br></pre></td></tr></table></figure><h4 id="è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨"><a href="#è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨" class="headerlink" title="è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨"></a>è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ‘ä»¬é€šå¸¸å®¹å™¨éƒ½æ˜¯ä½¿ç”¨åå°æ–¹å¼è¿è¡Œçš„e</span></span><br><span class="line"></span><br><span class="line">docker exec -it å®¹å™¨id bashSHELL</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æµ‹è¯•</span></span><br><span class="line">[root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;         35 minutes ago      Up 35 minutes                           vigorous_kare</span><br><span class="line">[root@192 ~]# docker exec -it c2887d35c71d /bin/bash</span><br><span class="line">[root@c2887d35c71d /]# ls</span><br><span class="line">bin  etc   lib  lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line">[root@c2887d35c71d /]# ps -ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 11:57 pts/0    00:00:00 /bin/bash</span><br><span class="line">root         14      0  0 12:32 pts/1    00:00:00 /bin/bash</span><br><span class="line">root         28     14  0 12:32 pts/1    00:00:00 ps -ef</span><br><span class="line">[root@c2887d35c71d /]# c2887d35c71d</span><br><span class="line">[root@c2887d35c71d /]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–¹å¼äºŒ</span></span><br><span class="line">[root@192 ~]# docker attach c2887d35c71d</span><br><span class="line">[root@c2887d35c71d /]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒºåˆ«</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">exec</span> <span class="comment"># è¿›å…¥å®¹å™¨åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ“ä½œ(å¸¸ç”¨)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker attach è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š"><a href="#ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š" class="headerlink" title="ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š"></a>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿è¡Œ</span></span><br><span class="line">[root@192 ~]# docker run -it centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ctrl P Q ä¸å…³é—­é€€å‡ºï¼ŒæŸ¥çœ‹</span></span><br><span class="line">[root@0569081aa89c /]# [root@192 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">0569081aa89c        centos              &quot;/bin/bash&quot;         19 seconds ago      Up 19 seconds</span><br><span class="line">hopeful_chebyshev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ä¸»æœºhomeä¸‹æ— æ–‡ä»¶</span></span><br><span class="line">[root@192 ~]# cd /home</span><br><span class="line">[root@192 home]# ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">[root@192 home]# docker attach 0569081aa89c</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å®¹å™¨homeç›®å½•</span></span><br><span class="line">[root@0569081aa89c /]# cd /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨ç›®å½•ä¸­åˆ›å»ºjavaæ–‡ä»¶</span></span><br><span class="line">[root@0569081aa89c home]# touch test.java</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€€å‡ºå¹¶åœæ­¢å®¹å™¨</span></span><br><span class="line">[root@0569081aa89c home]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç°åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">[root@192 home]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®¹å™¨è™½ç„¶è¢«åœæ­¢ï¼Œä½†æ˜¯æ•°æ®éƒ½ä¼šä¿ç•™</span></span><br><span class="line">[root@192 home]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                         PORTS               NAMES</span><br><span class="line">0569081aa89c        centos              &quot;/bin/bash&quot;              3 minutes ago       Exited (0) 8 seconds ago                           hopeful_chebyshev</span><br><span class="line">f589e5684a01        centos              &quot;/bin/bash&quot;              44 minutes ago      Exited (0) 44 minutes ago                          cranky_easley</span><br><span class="line">cb6d7fbc3f27        centos              &quot;/bin/sh -c &#x27;while tâ€¦&quot;   54 minutes ago      Exited (137) 42 minutes ago                        dreamy_almeida</span><br><span class="line">c2887d35c71d        centos              &quot;/bin/bash&quot;              58 minutes ago      Exited (127) 16 minutes ago                        vigorous_kare</span><br><span class="line">8ce188e5fee3        centos              &quot;/bin/bash&quot;              About an hour ago   Exited (0) About an hour ago                       tender_dirac</span><br><span class="line">7b1a7dd10ea4        centos              &quot;/bin/bash&quot;              9 hours ago         Exited (0) 9 hours ago                             fervent_mirzakhani</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®¹å™¨æ•°æ®æ‹·è´åˆ°ä¸»æœº</span></span><br><span class="line">[root@192 home]# docker cp 0569081aa89c:/home/test.java /home</span><br><span class="line">[root@192 home]# ls</span><br><span class="line">test.java</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‹·è´æ˜¯ä¸€ä¸ªæ‰‹åŠ¨è¿‡ç¨‹ï¼Œæœªæ¥æˆ‘ä»¬ä½¿ç”¨ -v å·çš„æŠ€æœ¯ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒæ­¥ /home /home</span></span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å†…å®¹å ç”¨"><a href="#æŸ¥çœ‹å†…å®¹å ç”¨" class="headerlink" title="æŸ¥çœ‹å†…å®¹å ç”¨"></a>æŸ¥çœ‹å†…å®¹å ç”¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stats</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p><img src="/images/dockerimages/image-20200617210554147.png" alt="image-20200617210554147"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">[root@192 home]# docker --help</span><br><span class="line"></span><br><span class="line">Usage:docker [OPTIONS] COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime for containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config</span><br><span class="line">                           files (default &quot;/root/.docker&quot;)</span><br><span class="line">  -c, --context string     Name of the context to use to</span><br><span class="line">                           connect to the daemon</span><br><span class="line">                           (overrides DOCKER_HOST env var</span><br><span class="line">                           and default context set with</span><br><span class="line">                           &quot;docker context use&quot;)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to</span><br><span class="line">  -l, --log-level string   Set the logging level</span><br><span class="line">                           (&quot;debug&quot;|&quot;info&quot;|&quot;warn&quot;|&quot;error&quot;|&quot;fatal&quot;) (default &quot;info&quot;)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by</span><br><span class="line">                           this CA (default</span><br><span class="line">                           &quot;/root/.docker/ca.pem&quot;)</span><br><span class="line">      --tlscert string     Path to TLS certificate file</span><br><span class="line">                           (default &quot;/root/.docker/cert.pem&quot;)</span><br><span class="line">      --tlskey string      Path to TLS key file (default</span><br><span class="line">                           &quot;/root/.docker/key.pem&quot;)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  builder     Manage builds</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers</span><br><span class="line">  context     Manage contexts</span><br><span class="line">  engine      Manage the docker engine</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach local standard input, output, and error streams to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container&#x27;s changes</span><br><span class="line">  cp          Copy files/folders between a container and the local filesystem</span><br><span class="line">  create      Create a new container</span><br><span class="line">  diff        Inspect changes to files or directories on a container&#x27;s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  exec        Run a command in a running container</span><br><span class="line">  export      Export a container&#x27;s filesystem as a tar archive</span><br><span class="line">  history     Show the history of an image</span><br><span class="line">  images      List images</span><br><span class="line">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">  info        Display system-wide information</span><br><span class="line">  inspect     Return low-level information on Docker objects</span><br><span class="line">  kill        Kill one or more running containers</span><br><span class="line">  load        Load an image from a tar archive or STDIN</span><br><span class="line">  login       Log in to a Docker registry</span><br><span class="line">  logout      Log out from a Docker registry</span><br><span class="line">  logs        Fetch the logs of a container</span><br><span class="line">  pause       Pause all processes within one or more containers</span><br><span class="line">  port        List port mappings or a specific mapping for the container</span><br><span class="line">  ps          List containers</span><br><span class="line">  pull        Pull an image or a repository from a registry</span><br><span class="line">  push        Push an image or a repository to a registry</span><br><span class="line">  rename      Rename a container</span><br><span class="line">  restart     Restart one or more containers</span><br><span class="line">  rm          Remove one or more containers</span><br><span class="line">  rmi         Remove one or more images</span><br><span class="line">  run         Run a command in a new container</span><br><span class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">  search      Search the Docker Hub for images</span><br><span class="line">  start       Start one or more stopped containers</span><br><span class="line">  stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">  stop        Stop one or more running containers</span><br><span class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line">  top         Display the running processes of a container</span><br><span class="line">  unpause     Unpause all processes within one or more containers</span><br><span class="line">  update      Update configuration of one or more containers</span><br><span class="line">  version     Show the Docker version information</span><br><span class="line">  wait        Block until one or more containers stop, then print their exit codes</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200617210932306.png" alt="image-20200617210932306"></p><p><img src="/images/dockerimages/image-20200617211021003.png" alt="image-20200617211021003"></p><p><img src="/images/dockerimages/image-20200617211039508.png" alt="image-20200617211039508"></p><h4 id="ä½œä¸šç»ƒä¹ "><a href="#ä½œä¸šç»ƒä¹ " class="headerlink" title="ä½œä¸šç»ƒä¹ "></a>ä½œä¸šç»ƒä¹ </h4><h5 id="éƒ¨ç½²-Nginx"><a href="#éƒ¨ç½²-Nginx" class="headerlink" title="éƒ¨ç½² Nginx"></a>éƒ¨ç½² Nginx</h5><p><img src="/images/dockerimages/image-20200618100621199.png" alt="image-20200618100621199"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®˜ç½‘æœç´¢nginxï¼Œå¯ä»¥çœ‹åˆ°å¸®åŠ©æ–‡æ¡£</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹è½½é•œåƒ</span></span><br><span class="line">[root@192 home]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">8559a31e96f4: Pull complete</span><br><span class="line">8d69e59170f7: Pull complete</span><br><span class="line">3f9f1ec1d262: Pull complete</span><br><span class="line">d1f5ff4f210d: Pull complete</span><br><span class="line">1e22bfa8652e: Pull complete</span><br><span class="line">Digest: sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é•œåƒ</span></span><br><span class="line">[root@192 home]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              831691599b88        13 hours ago        215MB</span><br><span class="line">nginx               latest              2622e6cca7eb        7 days ago          132MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿è¡Œæµ‹è¯•</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d åå°è¿è¡Œï¼Œ--name å‘½åï¼Œ-p æš´éœ²ç«¯å£ï¼Œ3344æœåŠ¡å™¨ã€å®¿ä¸»æœºçš„ç«¯å£ï¼Œå®¹å™¨å†…éƒ¨ç«¯å£</span></span><br><span class="line">[root@192 home]# docker run -d --name nginx01 -p:3344:80 nginx</span><br><span class="line">38dbf7bdcaef232d269b7184d91e44e06087181b5ee929494e177ad526810fa8</span><br><span class="line">[root@192 home]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">38dbf7bdcaef        nginx               &quot;/docker-entrypoint.â€¦&quot;   7 seconds ago       Up 6 seconds        0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½¿ç”¨3344å¯ä»¥è®¿é—®æˆåŠŸ</span></span><br><span class="line">[root@192 home]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç«¯å£æš´éœ²</p><p><img src="/images/dockerimages/image-20200617212310709.png" alt="image-20200617212310709"></p><p>å¯ä»¥å…¬ç½‘è®¿é—®</p><p>æ‰¾åˆ°æœåŠ¡å™¨åœ°å€</p><p><img src="/images/dockerimages/image-20200617213213721.png" alt="image-20200617213213721"></p><p>æµè§ˆå™¨è¾“å…¥ 192.168.147.132:3344/</p><p><img src="/images/dockerimages/image-20200617213142079.png" alt="image-20200617213142079"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@192 home]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">38dbf7bdcaef        nginx               &quot;/docker-entrypoint.â€¦&quot;   21 minutes ago      Up 21 minutes       0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@192 home]# docker exec -it nginx01 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥ä¸€ä¸‹nginxåœ¨å“ª</span></span><br><span class="line">root@38dbf7bdcaef:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ°è¿™ä¸ªç›®å½•</span></span><br><span class="line">root@38dbf7bdcaef:/# cd /etc/nginx</span><br><span class="line">root@38dbf7bdcaef:/etc/nginx# ls</span><br><span class="line">conf.dkoi-utf  mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_paramskoi-win  modules     scgi_params  win-utf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€€å‡º</span></span><br><span class="line">root@38dbf7bdcaef:/etc/nginx# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœæ­¢</span></span><br><span class="line">[root@192 home]# docker stop 38dbf7bdcaef</span><br><span class="line">38dbf7bdcaef</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†æ¬¡åˆ·æ–°ç½‘é¡µï¼ŒæœåŠ¡å…³é—­</p><p>æ€è€ƒé—®é¢˜ï¼šæ¯æ¬¡æ”¹åŠ¨ nginx é…ç½®æ–‡ä»¶ï¼Œéƒ½éœ€è¦è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œååˆ†éº»çƒ¦ï¼Œè¦æ˜¯å¯ä»¥åœ¨å®¹å™¨å¤–éƒ¨æä¾›ä¸€ä¸ªæ˜ å°„è·¯å¾„ï¼Œè¾¾åˆ°åœ¨å®¹å™¨ä¿®æ”¹æ–‡ä»¶åï¼Œå®¹å™¨å†…éƒ¨å°±å¯ä»¥è‡ªåŠ¨ä¿®æ”¹ï¼Ÿ-v æ•°æ®å·æŠ€æœ¯ï¼</p><h5 id="éƒ¨ç½²-tomcat"><a href="#éƒ¨ç½²-tomcat" class="headerlink" title="éƒ¨ç½² tomcat"></a>éƒ¨ç½² tomcat</h5><p><img src="/images/dockerimages/image-20200618100551587.png" alt="image-20200618100551587"></p><p>ã€è§†é¢‘ä¹¦ç­¾ï¼š<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=15ã€‘">https://www.bilibili.com/video/BV1og4y1q7M4?p=15ã€‘</a></p><p>ã€20200618 æ¯•ç«Ÿç”Ÿäº§åŠ›å·¥å…·ï¼ŒåŠ æ²¹æï¼Œè¿™å‘¨ä¸€å®šåˆ·å®Œï¼ï¼æ¯æ¬¡å…³æœºéƒ½è¦é‡è¿ï¼Œéº»çƒ¦(<em>â•¹â–½â•¹</em>)ã€‘</p><p>åœ¨ docker hub ä¸ŠæŸ¥çœ‹ç‰ˆæœ¬å·å’Œä½¿ç”¨æ–¹æ³•</p><p><img src="/images/dockerimages/image-20200618100319796.png" alt="image-20200618100319796"></p><p>å®˜æ–¹æ–‡æ¡£ä¸€å®šè¦ç¿»çƒ‚ï¼Œè¶…å¤šç‰ˆæœ¬ï¼Œæˆ‘çš„å¤©å‘~</p><h6 id="å®˜æ–¹æ–¹æ³•"><a href="#å®˜æ–¹æ–¹æ³•" class="headerlink" title="å®˜æ–¹æ–¹æ³•"></a>å®˜æ–¹æ–¹æ³•</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run å¯ä»¥ä¸ç”¨pullï¼Œèƒ½è‡ªåŠ¨ä¸‹è½½</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it ç›´æ¥è¿›å»è¿è¡Œ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--<span class="built_in">rm</span> æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå…¥é—¨çš„æ„æ€ï¼Ÿ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ‘ä»¬ä¹‹å‰çš„å¯åŠ¨éƒ½æ˜¯åå°ï¼Œåœæ­¢äº†å®¹å™¨ä¹‹åï¼Œå®¹å™¨è¿˜æ˜¯å¯ä»¥æŸ¥åˆ°</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å†™äº†--<span class="built_in">rm</span>ï¼Œç±»ä¼¼é˜…åå³ç„šæ¨¡å¼ï¼Œç”¨å®Œå³åˆ é™¤ï¼Œè¿™ç§é€šå¸¸ç”¨æ¥æµ‹è¯•</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœ€åå†’å·æŸ¥å¥½çš„ç‰ˆæœ¬å·</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618101811914.png" alt="image-20200618101811914"></p><p><img src="/images/dockerimages/image-20200618101849917.png" alt="image-20200618101849917"></p><p>ctrl+c é€€å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618102022167.png" alt="image-20200618102022167"></p><p>å¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰ tomcatï¼Œå°è¯é˜…åå³ç„šæ¨¡å¼ï¼Œå®¹å™¨ä¼šåˆ é™¤ï¼Œé•œåƒä¸ä¼šåˆ é™¤</p><p>å¹³æ—¶ä¸å»ºè®®è¿™æ ·æ</p><h6 id="æ­£å¸¸æ–¹æ³•"><a href="#æ­£å¸¸æ–¹æ³•" class="headerlink" title="æ­£å¸¸æ–¹æ³•"></a>æ­£å¸¸æ–¹æ³•</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat:9.0 # ä¹‹å‰ä¸‹è¿‡äº†ï¼Œåº”è¯¥ä¸ç”¨ä¸‹äº†ï¼Œè¿™é‡Œè€å¸ˆè®²é”™äº†</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618102544564.png" alt="image-20200618102544564"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨è¿è¡Œï¼Œåº”è¯¥åŠ ä¸Šç‰ˆæœ¬å·</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618102837397.png" alt="image-20200618102837397"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker exec -it tomcat01 /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618103109004.png" alt="image-20200618103109004"></p><p>å‘ç°é—®é¢˜</p><ol><li>linux å‘½ä»¤å°‘äº†</li><li>æ²¡æœ‰ webapps</li></ol><p><img src="/images/dockerimages/image-20200618103407205.png" alt="image-20200618103407205"></p><p>è¿™æ˜¯é˜¿é‡Œäº‘é•œåƒçš„åŸå› ï¼šé»˜è®¤ä½¿ç”¨æœ€å°é•œåƒï¼Œæ‰€æœ‰ä¸å¿…è¦çš„éƒ½å‰”é™¤äº†ï¼Œä¿è¯æœ€å°å¯è¿è¡Œç¯å¢ƒ</p><p><img src="C:\Users\Null\AppData\Roaming\Typora\typora-user-images\image-20200820152110088.png" alt="image-20200820152110088"></p><p>å†æ¬¡æ‰¾åˆ°ç»“æ„</p><p><img src="/images/dockerimages/image-20200618104052242.png" alt="image-20200618104052242"></p><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š<a href="http://192.168.147.132:3355/">http://192.168.147.132:3355/</a></p><p><img src="/images/dockerimages/image-20200618103958168.png" alt="image-20200618103958168"></p><p>æ€è€ƒé—®é¢˜ï¼šæˆ‘ä»¬ä»¥åéƒ¨ç½²é¡¹ç›®ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦è¿›å…¥å®¹å™¨æ˜¯ä¸æ˜¯èº«ä»½éº»çƒ¦ï¼Ÿæˆ‘è¦æ˜¯å¯ä»¥åœ¨å®¹å™¨å¤–éƒ¨æä¾›ä¸€ä¸ªæ˜ å°„è·¯å¾„ï¼Œwebappsï¼Œæˆ‘ä»¬åœ¨å¤–éƒ¨æ”¾ç½®é¡¹ç›®ï¼Œå°±è‡ªåŠ¨åŒæ­¥åˆ°å†…éƒ¨å°±å¥½äº†ï¼</p><p>docker å®¹å™¨ tomcat+ç½‘ç«™</p><p>docker mysql</p><h5 id="éƒ¨ç½²-es-kibana"><a href="#éƒ¨ç½²-es-kibana" class="headerlink" title="éƒ¨ç½² es+kibana"></a>éƒ¨ç½² es+kibana</h5><p><img src="/images/dockerimages/image-20200618104950722.png" alt="image-20200618104950722"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es æš´éœ²çš„ç«¯å£å¾ˆå¤š</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es ååˆ†è€—å†…å­˜</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es çš„æ•°æ®ä¸€èˆ¬éœ€è¦æ”¾ç½®åˆ°å®‰å…¨ç›®å½•ï¼æŒ‚è½½</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨ elasticsearch</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d --name elasticsearch01 -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:7.6.2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å†…å­˜å ç”¨æƒ…å†µ</span></span><br><span class="line">docker stats</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618111713885.png" alt="image-20200618111713885"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…ˆæ„Ÿè§‰stopä¸€ä¸‹</span></span><br><span class="line">docker stop ba18713ca536</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618105057785.png" alt="image-20200618105057785"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡ -e é™åˆ¶å†…å­˜</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -d --name elasticsearch02 -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=â€œ-Xms64m -Xmx512mâ€ elasticsearch:7.6.2</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618113018622.png" alt="image-20200618113018622"></p><p>æ²¡æˆåŠŸå•Šï¼ŒSEI èƒ½å‘Šè¯‰æˆ‘ä¸ºå•¥ï¼ï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch02 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br></pre></td></tr></table></figure><blockquote><p>py0003null å¤§ä½¬:<br>â€œES_JAVA_OPTS=-Xms64m -Xmx512mâ€</p><p>py0003null å¤§ä½¬:<br>å¼•å·æå‰è¯•è¯•</p></blockquote><p>åŸå› æ˜¯å¼•å·ï¼ï¼ä½ æ²¡è§‰å¾—æ€ªæ€ªçš„å˜›</p><p><img src="/images/dockerimages/image-20200618115302656.png" alt="image-20200618115302656"></p><p>æ­¤æ—¶æŸ¥çœ‹ statsï¼Œå‘ç°å†…å­˜å ç”¨åœ¨æ§åˆ¶èŒƒå›´å†…</p><p><img src="/images/dockerimages/image-20200618115149971.png" alt="image-20200618115149971"></p><p>ctrl + C é€€å‡ºï¼Œè®°å¾— stop</p><p><img src="/images/dockerimages/image-20200618115921069.png" alt="image-20200618115921069"></p><h5 id="æ€è€ƒï¼šç”¨-kibana-é“¾æ¥-elasticsearch"><a href="#æ€è€ƒï¼šç”¨-kibana-é“¾æ¥-elasticsearch" class="headerlink" title="æ€è€ƒï¼šç”¨ kibana é“¾æ¥ elasticsearch"></a>æ€è€ƒï¼šç”¨ kibana é“¾æ¥ elasticsearch</h5><p><img src="/images/dockerimages/image-20200618113556445.png" alt="image-20200618113556445"></p><h3 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h3><ul><li>portainer(å…ˆç”¨è¿™ä¸ª)</li><li>Rancher(CI/CD æ—¶ç”¨)</li></ul><h4 id="portainer"><a href="#portainer" class="headerlink" title="portainer"></a>portainer</h4><p>Docker å›¾åƒåŒ–ç•Œé¢ç®¡ç†å·¥å…·ï¼Œæä¾›ä¸€ä¸ªåå°é¢æ¿ä¾›æˆ‘ä»¬æ“ä½œï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618114542622.png" alt="image-20200618114542622"></p><p>è®¿é—®å¤–ç½‘ 8088</p><p><img src="/images/dockerimages/image-20200618114902169.png" alt="image-20200618114902169"></p><p>ç”¨æˆ·å</p><p>å¯†ç </p><p><img src="/images/dockerimages/image-20200618134706491.png" alt="image-20200618134706491"></p><p>å¤±è´¥ï¼Œä¸çŸ¥é“å‘ç”Ÿäº†å•¥</p><p><img src="/images/dockerimages/image-20200618135424706.png" alt="image-20200618135424706"></p><p><img src="/images/dockerimages/image-20200618135450037.png" alt="image-20200618135450037"></p><h2 id="-1"><a href="#-1" class="headerlink" title="#"></a>#</h2><h2 id="Docker-é•œåƒ"><a href="#Docker-é•œåƒ" class="headerlink" title="Docker é•œåƒ"></a>Docker é•œåƒ</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>UnionFS è”åˆæ–‡ä»¶ç³»ç»Ÿ</p><p><img src="/images/dockerimages/image-20200618140242423.png" alt="image-20200618140242423"></p><p>bootfsï¼šboot file system</p><p>rootfsï¼šroot file system</p><p><img src="/images/dockerimages/image-20200618140907894.png" alt="image-20200618140907894"></p><p><img src="/images/dockerimages/image-20200618140932621.png" alt="image-20200618140932621"></p><p><img src="/images/dockerimages/image-20200618141014511.png" alt="image-20200618141014511"></p><p><img src="/images/dockerimages/image-20200618153329894.png" alt="image-20200618153329894"></p><p>Docker é•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œå½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ åˆ°é•œåƒçš„é¡¶éƒ¨ï¼Œè¿™ä¸€å±‚å°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„å®¹å™¨å±‚ï¼Œå®¹å™¨å±‚ä¹‹ä¸‹çš„éƒ½å«é•œåƒå±‚</p><p><img src="/images/dockerimages/image-20200618153855605.png" alt="image-20200618153855605"></p><h3 id="commit-æäº¤é•œåƒ"><a href="#commit-æäº¤é•œåƒ" class="headerlink" title="commit æäº¤é•œåƒ"></a>commit æäº¤é•œåƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit # æäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„å‰¯æœ¬</span><br><span class="line">docker commit -m=&quot;æäº¤çš„æè¿°ä¿¡æ¯&quot; -a=&quot;ä½œè€…&quot; å®¹å™¨id ç›®æ ‡é•œåƒåï¼š[TAG]</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618154457286.png" alt="image-20200618154457286"></p><p>è¿™æ˜¯ä¸€ä¸ªå‰å°ç¨‹åº</p><p><img src="/images/dockerimages/image-20200618154736475.png" alt="image-20200618154736475"></p><p>å°† webapps.dist é‡Œé¢æ‰€æœ‰çš„æ–‡ä»¶æ‹·è´åˆ° webapps é‡Œé¢ï¼Œå…¶ä¸­-r å¿…é¡»æœ‰ï¼Œè¡¨ç¤ºç›®å½•é€’å½’æ‹·è´</p><p><img src="/images/dockerimages/image-20200618154943194.png" alt="image-20200618154943194"></p><p><img src="/images/dockerimages/image-20200618155750591.png" alt="image-20200618155750591"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -a=&quot;paidaxing&quot; -m=&quot;add webapps app&quot; å½“å‰å®¹å™¨çš„id tomcat02:1.0</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618160425265.png" alt="image-20200618160425265"></p><p>å‘ç°æ–°çš„ç‰ˆæœ¬ï¼Œæ¯”ä¹‹å‰çš„å¤§äº†ä¸€äº›ï¼Œå› ä¸ºé‡Œé¢è®°å½•äº†æˆ‘ä»¬çš„æ”¹åŠ¨</p><blockquote><p>å¦‚æœæƒ³ä¿å­˜å½“å‰å®¹å™¨çš„çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ commit æäº¤ï¼Œè·å¾—ä¸€ä¸ªé•œåƒ</p><p>å¥½æ¯”æˆ‘ä»¬ä»¥å‰å­¦ä¹  VM çš„æ—¶å€™çš„å¿«ç…§</p><p>åˆ°è¿™é‡Œç®—æ˜¯å…¥é—¨äº†</p><p>æ¥ä¸‹æ¥ä¸‰ä¸ªéƒ¨åˆ†æ˜¯ docker çš„ç²¾é«“</p></blockquote><h2 id="å®¹å™¨æ•°æ®å·"><a href="#å®¹å™¨æ•°æ®å·" class="headerlink" title="å®¹å™¨æ•°æ®å·"></a>å®¹å™¨æ•°æ®å·</h2><h3 id="ä»€ä¹ˆæ˜¯å®¹å™¨å·"><a href="#ä»€ä¹ˆæ˜¯å®¹å™¨å·" class="headerlink" title="ä»€ä¹ˆæ˜¯å®¹å™¨å·"></a>ä»€ä¹ˆæ˜¯å®¹å™¨å·</h3><p>docker æ˜¯è¦å°†åº”ç”¨å’Œç¯å¢ƒæ‰“åŒ…æˆä¸€ä¸ªé•œåƒ</p><p>è¿™æ ·ï¼Œæ•°æ®å°±ä¸åº”è¯¥åœ¨å®¹å™¨ä¸­ï¼Œå¦åˆ™å®¹å™¨åˆ é™¤ï¼Œæ•°æ®å°±ä¼šä¸¢å¤±ï¼Œè¿™å°±æ˜¯åˆ åº“è·‘è·¯</p><p>æ•…å®¹å™¨ä¹‹é—´è¦æœ‰ä¸€ä¸ªæ•°æ®å…±äº«æŠ€æœ¯</p><p>åœ¨ Docker å®¹å™¨ä¸­äº§ç”Ÿçš„æ•°æ®ï¼ŒåŒæ­¥åˆ°æœ¬åœ°ï¼Œè¿™å°±æ˜¯å·æŠ€æœ¯</p><p>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç›®å½•æŒ‚è½½ï¼Œå°†å®¹å™¨å†…çš„ç›®å½•æŒ‚è½½åˆ°è™šæ‹Ÿæœºä¸Š</p><p><img src="/images/dockerimages/image-20200618162917672.png" alt="image-20200618162917672"></p><p>ç›®çš„ï¼šå®¹å™¨çš„æŒä¹…åŒ–å’ŒåŒæ­¥æ“ä½œ</p><p>å®¹å™¨é—´å¯ä»¥æ•°æ®å…±äº«</p><h3 id="ä½¿ç”¨æ•°æ®å·"><a href="#ä½¿ç”¨æ•°æ®å·" class="headerlink" title="ä½¿ç”¨æ•°æ®å·"></a>ä½¿ç”¨æ•°æ®å·</h3><p>æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤æ¥æŒ‚è½½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v -p</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it äº¤äº’å¼è¿›å…¥</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v volumeå·æŠ€æœ¯</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p ä¸»æœºç«¯å£</span></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618163659503.png" alt="image-20200618163659503"></p><p>æ–°å¼€ä¸€ä¸ªçª—å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect å®¹å™¨id</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618163938466.png" alt="image-20200618163938466"></p><p>æ‰¾åˆ°æŒ‚è½½ä¿¡æ¯ Mounts</p><p><img src="/images/dockerimages/image-20200618164148642.png" alt="image-20200618164148642"></p><p>æµ‹è¯•</p><p><img src="/images/dockerimages/image-20200618164818624.png" alt="image-20200618164818624"></p><p>å®¹å™¨åœæ­¢åï¼Œä¿®æ”¹ä¸»æœºæ–‡ä»¶ï¼Œå†å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œæ•°æ®åŒæ ·æ”¹å˜</p><p>åŒå‘åŒæ­¥</p><h3 id="å®æˆ˜å®‰è£…-mysql"><a href="#å®æˆ˜å®‰è£…-mysql" class="headerlink" title="å®æˆ˜å®‰è£… mysql"></a>å®æˆ˜å®‰è£… mysql</h3><p>MySQL çš„æ•°æ®æŒä¹…åŒ–å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‹‰å–</span></span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‚è½½</span></span><br><span class="line">docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql5.7</span><br><span class="line"></span><br><span class="line">-d åå°è¿è¡Œ</span><br><span class="line">-p ç«¯å£æ˜ å°„</span><br><span class="line">-v å·æŒ‚è½½</span><br><span class="line">-e ç¯å¢ƒé…ç½® å®‰è£…å¯åŠ¨mysqléœ€è¦é…ç½®å¯†ç </span><br><span class="line">--name å®¹å™¨åå­—</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618171353336.png" alt="image-20200618171353336"></p><p>é“¾æ¥æµ‹è¯•ï¼šæ‰“å¼€ SQLyog</p><p><img src="/images/dockerimages/image-20200618173234347.png" alt="image-20200618173234347"></p><p>ç‚¹ æµ‹è¯•é“¾æ¥</p><p><img src="/images/dockerimages/image-20200618173300551.png" alt="image-20200618173300551"></p><p>ç‚¹ é“¾æ¥</p><p><img src="/images/dockerimages/image-20200618173729692.png" alt="image-20200618173729692"></p><h3 id="å…·åå’ŒåŒ¿åæŒ‚è½½"><a href="#å…·åå’ŒåŒ¿åæŒ‚è½½" class="headerlink" title="å…·åå’ŒåŒ¿åæŒ‚è½½"></a>å…·åå’ŒåŒ¿åæŒ‚è½½</h3><p>ã€è§†é¢‘ä¹¦ç­¾ï¼š<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=23ã€‘">https://www.bilibili.com/video/BV1og4y1q7M4?p=23ã€‘</a></p><p><img src="/images/dockerimages/image-20200618203452205.png" alt="image-20200618203452205"></p><p><img src="/images/dockerimages/image-20200618203744983.png" alt="image-20200618203744983"></p><h2 id="-2"><a href="#-2" class="headerlink" title="#"></a>#</h2><p>DockerFile ä½¿ç”¨æ¥æ„å»º docker é•œåƒçš„æ–‡ä»¶</p><p><img src="/images/dockerimages/image-20200618211547398.png" alt="image-20200618211547398"></p><blockquote><p>kas:<br>æ²¡æœ‰å®‰è£…å§ï¼Ÿ</p><p>kas:<br>å®‰è£…ä¸€ä¸‹å°±å¯ä»¥äº†</p><p>py9001021 æ›¾å™åš:<br>centos é»˜è®¤ä½¿ç”¨ vi å†™å†…å®¹ï¼Œvim éœ€è¦ä¸‹è½½</p><p>py9001021 æ›¾å™åš:<br>æ˜¯çš„ï¼Œéœ€è¦ä¸‹è½½ vim æ‰èƒ½ä½¿ç”¨</p><p>YF:<br>é…ç½®å¯ä»¥æ”¹ä¸‹ï¼Œå­—ä½“å°±å¾ˆç‚«é…·äº†</p><p>éƒ½å»ºæ°‘:<br>ç”¨ vi è¯•è¯•</p><p>éƒ½å»ºæ°‘:<br>ä½ æ²¡æœ‰å®‰è£… vim</p><p>éƒ½å»ºæ°‘:<br>yum install vim</p><p>éƒ½å»ºæ°‘:<br>è¯•è¯•è¿™ä¸ªå‘½ä»¤</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vim # ç¼–è¾‘æ–‡ä»¶çš„ï¼Œæ²¡æœ‰è£…ä¸€ä¸‹</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618211516566.png" alt="image-20200618211516566"></p><p>å®‰è£…å®Œä¹‹åå°±å¯ä»¥è¿è¡Œè¿™ä¸ªå‘½ä»¤äº†</p><p><img src="/images/dockerimages/image-20200618211803012.png" alt="image-20200618211803012"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é•œåƒæ˜¯ä¸€å±‚ä¸€å±‚çš„ï¼Œè„šæœ¬æ˜¯ä¸€è¡Œä¸€è¡Œçš„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡ä»¤éƒ½æ˜¯å¤§å†™çš„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œçš„æ¯ä¸ªå‘½ä»¤å¯ä»¥ç†è§£ä¸ºé•œåƒçš„ä¸€å±‚</span></span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;] # å†åˆ›å»ºé•œåƒçš„æ—¶å€™å°±æŒ‚è½½å‡ºæ¥</span><br><span class="line"></span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618211023834.png" alt="image-20200618211023834"></p><p>æƒ³ä¿å­˜å¹¶é€€å‡º</p><blockquote><p>Wesley.:<br>shift åŠ  å†’å·</p></blockquote><p><img src="/images/dockerimages/image-20200618211318410.png" alt="image-20200618211318410"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat dockerfile1</span><br><span class="line"></span><br><span class="line">docker build -f dockerfile1 -t padaxing/centos:1.0 .  # æœ€åçš„ç‚¹å¾ˆé‡è¦ é•œåƒåä¸èƒ½æœ‰/</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618212936481.png" alt="image-20200618212936481"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200618213310752.png" alt="image-20200618213310752"></p><p>å¯åŠ¨ç”Ÿæˆçš„é•œåƒ</p><p><img src="/images/dockerimages/image-20200618220658979.png" alt="image-20200618220658979"></p><p>åœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</p><p><img src="/images/dockerimages/image-20200618221801103.png" alt="image-20200618221801103"></p><p>æŸ¥çœ‹ Mountsï¼ŒSource å¯¹åº”å®¹å™¨å¤–ç›®å½•ï¼ŒåŒ¿åæŒ‚è½½å·</p><p><img src="/images/dockerimages/image-20200618221837895.png" alt="image-20200618221837895"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨ container volume01 ä¸‹ç”Ÿæˆæ–‡ä»¶</p><p><img src="/images/dockerimages/image-20200618222224352.png" alt="image-20200618222224352"></p><p>åœ¨ä¸»æœºæŒ‚è½½è·¯å¾„ä¸‹ï¼Œä¹ŸåŒæ ·ç”Ÿæˆ</p><h3 id="å¤šä¸ªå®¹å™¨æ•°æ®å…±äº«"><a href="#å¤šä¸ªå®¹å™¨æ•°æ®å…±äº«" class="headerlink" title="å¤šä¸ªå®¹å™¨æ•°æ®å…±äº«"></a>å¤šä¸ªå®¹å™¨æ•°æ®å…±äº«</h3><p>ã€è§†é¢‘ä¹¦ç­¾ï¼š<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=25ã€‘">https://www.bilibili.com/video/BV1og4y1q7M4?p=25ã€‘</a></p><p><img src="/images/dockerimages/image-20200621165403842.png" alt="image-20200621165403842"></p><p>çœ‹ä¸€ä¸‹æœ‰å•¥ images</p><p><img src="/images/dockerimages/image-20200621165733780.png" alt="image-20200621165733780"></p><p>å¯åŠ¨ docker01ï¼Œç”¨ä¹‹å‰å»ºçš„ padaxing/centos 1.0 é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker01 padaxing/centos:1.0 # 1.0å¿…é¡»å†™</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621170429658.png" alt="image-20200621170429658"></p><p>å½“å‰è¿™ä¸ª ctrl+p+q ä¸åœæ­¢é€€å‡º</p><p><img src="/images/dockerimages/image-20200621170540593.png" alt="image-20200621170540593"></p><p>ä¾æ¬¡å¯åŠ¨ docker02ã€docker03</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker02 --volumes-from docker01 padaxing/centos:1.0</span><br></pre></td></tr></table></figure><p>docker02 ç»§æ‰¿ docker01 çš„ volumes</p><p>å¯ä»¥éªŒè¯ï¼Œåœ¨ docker01 ä¸‹åŠ ä¸€ä¸ªæ•°æ®ï¼Œåœ¨ docker02 ä¸‹ä¹Ÿä¼šå‡ºç°</p><p><img src="/images/dockerimages/image-20200621171513650.png" alt="image-20200621171513650"></p><p>åˆ›å»º docker03ï¼ŒåŒæ ·ç»§æ‰¿ docker01</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker03 --volumes-from docker01 padaxing/centos:1.0</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621172333639.png" alt="image-20200621172333639"></p><p>åœ¨ docker03 çš„ volume01 ä¸‹å»ºç«‹æ–‡ä»¶ï¼Œåœ¨ docker01 çš„ volume01 ä¸‹åŒæ ·ä¹Ÿæœ‰</p><p>å³é€šè¿‡â€”volumes-from å¯ä»¥å®ç°ä¸åŒå®¹å™¨é—´çš„æ•°æ®å…±äº«</p><p>åˆ é™¤ docker01ï¼Œæ•°æ®è¿˜åœ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621172830779.png" alt="image-20200621172830779"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ é™¤ docker01ï¼Œè¿›å…¥ docker02ï¼Œæ•°æ®ä¾ç„¶åœ¨</p><p>ç»“è®ºï¼š</p><p>å®¹å™¨ä¹‹é—´é…ç½®ä¿¡æ¯çš„ä¼ é€’ï¼Œæ•°æ®å·å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨ä½ç½®</p><p>ä½†æ˜¯å¦‚æœæŒä¹…åŒ–åˆ°äº†æœ¬åœ°ï¼Œå³ä½¿æ‰€æœ‰å®¹å™¨åˆ é™¤äº†ï¼Œæœ¬åœ°æ•°æ®æ˜¯ä¸ä¼šåˆ é™¤çš„</p><hr><h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><p>æ˜¯ç”¨æ¥æ„å»º docker é•œåƒçš„æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºå‘½ä»¤å‚æ•°è„šæœ¬</p><p>æ„å»ºæ­¥éª¤ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ª dockerfile æ–‡ä»¶</li><li>docker build æ„å»ºæˆä¸ºä¸€ä¸ªé•œåƒ</li><li>docker run è¿è¡Œé•œåƒ</li><li>docker push å‘å¸ƒé•œåƒï¼ˆDockerHubã€é˜¿é‡Œäº‘é•œåƒä»“åº“ ç§æœ‰/å…±æœ‰ï¼‰</li></ol><p>è¿™ä¸ªå†™ä¸€ä¸ªé¡¹ç›®æ—¶ä¸€æ ·çš„</p><h3 id="å®˜æ–¹-DockerFile-ç¤ºä¾‹"><a href="#å®˜æ–¹-DockerFile-ç¤ºä¾‹" class="headerlink" title="å®˜æ–¹ DockerFile ç¤ºä¾‹"></a>å®˜æ–¹ DockerFile ç¤ºä¾‹</h3><p>çœ‹ä¸€ä¸‹å®˜æ–¹çš„ DockerFile</p><p><img src="/images/dockerimages/image-20200621174204807.png" alt="image-20200621174204807"></p><p>å¯ä»¥çœ‹åˆ°å®˜æ–¹é•œåƒéƒ½æ˜¯åŸºç¡€åŒ…ï¼Œå¾ˆå¤šåŠŸèƒ½æ²¡æœ‰ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè‡ªå·±æ­å»ºè‡ªå·±çš„é•œåƒ</p><p>å®˜æ–¹æ—¢ç„¶å¯ä»¥åˆ¶ä½œé•œåƒï¼Œæˆ‘ä»¬äº¦å¯ä»¥</p><hr><h3 id="DockerFile-åŸºç¡€çŸ¥è¯†"><a href="#DockerFile-åŸºç¡€çŸ¥è¯†" class="headerlink" title="DockerFile åŸºç¡€çŸ¥è¯†"></a>DockerFile åŸºç¡€çŸ¥è¯†</h3><ol><li>æ¯ä¸ªæŒ‡ä»¤éƒ½å¿…é¡»æ˜¯å¤§å†™å­—æ¯</li><li>æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ</li><li><em>#</em>è¡¨ç¤ºæ³¨é‡Š</li><li>æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä½“æ£€ä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œå¹¶æäº¤</li></ol><p><img src="/images/dockerimages/image-20200621174948310.png" alt="image-20200621174948310"></p><p>docker æ˜¯é¢å‘å¼€å‘çš„ï¼Œæˆ‘ä»¬ä»¥åè¦å‘å¸ƒé¡¹ç›®ï¼Œåšé•œåƒï¼Œå°±è¦ç¼–å†™ dockerfile æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ååˆ†ç®€å•ï¼</p><p>Docker é•œåƒé€æ¸æˆä¸ºä¼ä¸šçš„äº¤ä»˜æ ‡å‡†ï¼Œå¿…é¡»æŒæ¡ï¼</p><hr><h3 id="DockerFile-å‘½ä»¤"><a href="#DockerFile-å‘½ä»¤" class="headerlink" title="DockerFile å‘½ä»¤"></a>DockerFile å‘½ä»¤</h3><p><img src="http://www.yunweipai.com/wp-content/uploads/2016/09/171.jpg" alt="Ã¦ÂŸÂ¥Ã§ÂœÂ‹Ã¦ÂºÂÃ¥Â›Â¾Ã¥ÂƒÂ"></p><h2 id="-3"><a href="#-3" class="headerlink" title="#"></a>#</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM # åŸºç¡€é•œåƒ æ¯”å¦‚centos</span><br><span class="line">MAINTAINER # é•œåƒæ˜¯è°å†™çš„ å§“å+é‚®ç®±</span><br><span class="line">RUN # é•œåƒæ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤</span><br><span class="line">ADD # æ·»åŠ ï¼Œæ¯”å¦‚æ·»åŠ ä¸€ä¸ªtomcatå‹ç¼©åŒ…</span><br><span class="line">WORKDIR # é•œåƒçš„å·¥ä½œç›®å½•</span><br><span class="line">VOLUME # æŒ‚è½½çš„ç›®å½•</span><br><span class="line">EXPOSE # æŒ‡å®šæš´éœ²ç«¯å£ï¼Œè·Ÿ-pä¸€ä¸ªé“ç†</span><br><span class="line">RUN # æœ€ç»ˆè¦è¿è¡Œçš„</span><br><span class="line">CMD # æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œè€Œä¸”å¯è¢«æ›¿ä»£</span><br><span class="line">ENTRYPOINT # æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥è¿½åŠ å‘½ä»¤</span><br><span class="line">ONBUILD # å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿Dockerfile è¿™ä¸ªæ—¶å€™è¿è¡ŒONBUILDæŒ‡å®šï¼Œè§¦å‘æŒ‡ä»¤</span><br><span class="line">COPY # å°†æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line">ENV # æ„å»ºçš„æ—¶å€™è®¾ç½®ç¯å¢ƒå˜é‡</span><br></pre></td></tr></table></figure><h3 id="å®æˆ˜æ„å»ºè‡ªå·±çš„-centos"><a href="#å®æˆ˜æ„å»ºè‡ªå·±çš„-centos" class="headerlink" title="å®æˆ˜æ„å»ºè‡ªå·±çš„ centos"></a>å®æˆ˜æ„å»ºè‡ªå·±çš„ centos</h3><p>Docker Hub ä¸­ 99%çš„é•œåƒéƒ½æ˜¯ä» FROM scratch å¼€å§‹çš„</p><p>æ·»åŠ  centos7 çš„å‹ç¼©åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„centos</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥homeç›®å½•</span></span><br><span class="line">cd /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¹‹åçš„ä¸œè¥¿éƒ½ä¿å­˜åˆ°è¿™é‡Œ</span></span><br><span class="line">mkdir dockerfile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥è¿™ä¸ªç›®å½•</span></span><br><span class="line">cd dockerfile/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªdockerfileï¼Œåå­—å«mydockerfile</span></span><br><span class="line">vim mydockerfile-centos</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>xshell æ–°å¼€ä¸€ä¸ªç•Œé¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®˜æ–¹é»˜è®¤centos</span></span><br><span class="line">docker run -it centos</span><br><span class="line">pwd # å®˜æ–¹é»˜è®¤æœ‰pwdå‘½ä»¤</span><br><span class="line">vim # å®˜æ–¹é»˜è®¤æ²¡æœ‰vimå‘½ä»¤</span><br><span class="line">ifconfig # å®˜æ–¹é»˜è®¤æ²¡æœ‰ifconfigå‘½ä»¤</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621184333206.png" alt="image-20200621184333206"></p><p>å›åˆ° mydockerfile</p><p><img src="/images/dockerimages/image-20200621184847524.png" alt="image-20200621184847524"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹é¢ç»™å®˜æ–¹centosåŠ ä¸Šè‡ªå®šä¹‰çš„å†…å®¹</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER padaxing&lt;010301200@hai.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621185539523.png" alt="image-20200621185539523"></p><p>ESC, shif + : è¾“å…¥ wq ä¿å­˜å¹¶é€€å‡º</p><p>å¦‚æœå†™é”™äº†éœ€è¦ä¿®æ”¹ã€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim mydockerfile-centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥ä¹‹åæŒ‰iæˆ–è€…INSERTé”®å³å¯ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢é€šè¿‡è¿™ä¸ªè¿™ä¸ªæ–‡ä»¶åˆ›å»ºé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f dockerfile-centos -t mycentos:0.1 .</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621190219978.png" alt="image-20200621190219978"></p><p>ä¾æ¬¡æ‰§è¡Œå‘½ä»¤</p><p><img src="/images/dockerimages/image-20200621190439448.png" alt="image-20200621190439448"></p><p>æœ€ç»ˆè¿”å› Successfully è¡¨ç¤ºæˆåŠŸ</p><p><img src="/images/dockerimages/image-20200621190524848.png" alt="image-20200621190524848"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it mycentos:0.1 # ç‰ˆæœ¬å·å¿…é¡»å†™ï¼Œä¸ç„¶ä»–ä¼šå»æ‰¾æœ€æ–°çš„</span><br><span class="line">pwd</span><br><span class="line">vim</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200621190812481.png" alt="image-20200621190812481"></p><p>è¿™æ—¶å¯ä»¥çœ‹åˆ°è¿™äº›åŠŸèƒ½éƒ½æœ‰äº†</p><p>å¯ä»¥é€šè¿‡æŸ¥çœ‹ docker æ„å»ºå†å²</p><p><img src="/images/dockerimages/image-20200621192103460.png" alt="image-20200621192103460"></p><p>å¯ä»¥çœ‹åˆ°å½“å‰è¿™ä¸ªé•œåƒæ˜¯æ€ä¹ˆä¸€æ­¥ä¸€æ­¥æ„å»ºèµ·æ¥çš„</p><p>æˆ‘ä»¬å¹³æ—¶æ‹¿åˆ°ä¸€ä¸ªé•œåƒä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•ç ”ç©¶ä¸€ä¸‹ä»–æ˜¯æ€ä¹ˆåšçš„</p><h3 id="CMD-ä¸-ENTRYPOINT"><a href="#CMD-ä¸-ENTRYPOINT" class="headerlink" title="CMD ä¸ ENTRYPOINT"></a>CMD ä¸ ENTRYPOINT</h3><p>ã€è§†é¢‘ä¹¦ç­¾ï¼Œ<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=29ã€‘">https://www.bilibili.com/video/BV1og4y1q7M4?p=29ã€‘</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;] # å¯åŠ¨centoså±•ç¤ºç›®å½•</span><br></pre></td></tr></table></figure><p><img src="/images/dockerimages/image-20200622075427103.png" alt="image-20200622075427103"></p><p>æµ‹è¯• ENTRYPOINT</p><p><img src="/images/dockerimages/image-20200622075653789.png" alt="image-20200622075653789"></p><p>run çš„æ—¶å€™å¯ä»¥ç›´æ¥åŠ å‘½ä»¤</p><p><img src="/images/dockerimages/image-20200622075802180.png" alt="image-20200622075802180"></p><p>Docker ä¸­è®¸å¤šå‘½ä»¤éƒ½ååˆ†ç›¸ä¼¼ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä»–ä»¬çš„åŒºåˆ«ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯è¿™æ ·å¯¹æ¯”æµ‹è¯•</p><hr><h3 id="å®æˆ˜-Tomcat-é•œåƒ"><a href="#å®æˆ˜-Tomcat-é•œåƒ" class="headerlink" title="å®æˆ˜ Tomcat é•œåƒ"></a>å®æˆ˜ Tomcat é•œåƒ</h3><p>ã€è§†é¢‘ä¹¦ç­¾ï¼Œ<a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=30ã€‘">https://www.bilibili.com/video/BV1og4y1q7M4?p=30ã€‘</a></p><h2 id="IDEA-æ•´åˆ-Docker"><a href="#IDEA-æ•´åˆ-Docker" class="headerlink" title="IDEA æ•´åˆ Docker"></a>IDEA æ•´åˆ Docker</h2><h2 id="Docker-æ•´åˆ-Docker"><a href="#Docker-æ•´åˆ-Docker" class="headerlink" title="Docker æ•´åˆ Docker"></a>Docker æ•´åˆ Docker</h2><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒğŸ˜¶</title>
      <link href="/2023/06/12/Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/"/>
      <url>/2023/06/12/Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="Eureka-æœåŠ¡æ³¨å†Œä¸­å¿ƒ-ğŸ˜¶"><a href="#Eureka-æœåŠ¡æ³¨å†Œä¸­å¿ƒ-ğŸ˜¶" class="headerlink" title="Eureka æœåŠ¡æ³¨å†Œä¸­å¿ƒ ğŸ˜¶"></a>Eureka æœåŠ¡æ³¨å†Œä¸­å¿ƒ ğŸ˜¶</h1><p><strong>ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†ï¼š</strong></p><p>SpringCloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç†</p><p>åœ¨ä¼ ç»Ÿçš„ rpc è¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡äºæœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚</p><p><strong>ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼š</p><p>Eureka é‡‡ç”¨äº† CS çš„è®¾è®¡ç»“æ„ï¼ŒEureka Server æœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨ Eureka çš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Server å¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚è¿™ç‚¹å’Œ zookeeper å¾ˆç›¸ä¼¼</p><p>åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯ æ¯”å¦‚æœåŠ¡åœ°å€ é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…æœåŠ¡æä¾›è€…ï¼‰ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ° RPC è°ƒç”¨ã€‚RPC è¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä¾¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»ï¼ˆæœåŠ¡æ²»ç†æ¦‚å¿µ)ã€‚åœ¨ä»»ä½• rpc è¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼ˆå­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯ï¼ˆæ¥å£åœ°å€ï¼‰ï¼‰</p><p><img src="https://picbed.jnchan.top/springcloudImages/8da648937c52bff1a3690b6520c3f540.png" alt=""></p><p><strong>Eureka åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼šEureka Server å’Œ Eureka Client</strong></p><blockquote><p>Eureka å®˜æ–¹åœæ›´ä¸åœç”¨ï¼Œä»¥åå¯èƒ½ç”¨çš„è¶Šæ¥è¶Šå°‘ã€‚</p><p>Eureka æ˜¯ Netflix å¼€å‘çš„ï¼Œä¸€ä¸ªåŸºäº REST æœåŠ¡çš„ï¼ŒæœåŠ¡æ³¨å†Œä¸å‘ç°çš„ç»„ä»¶ï¼Œä»¥å®ç°ä¸­é—´å±‚æœåŠ¡å™¨çš„è´Ÿè½½å¹³è¡¡å’Œæ•…éšœè½¬ç§»ã€‚</p><p>Eureka åˆ†ä¸º Eureka Server å’Œ Eureka Client åŠæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚</p><p><strong>Eureka Server ä¸ºæ³¨å†Œä¸­å¿ƒï¼Œæ˜¯æœåŠ¡ç«¯ï¼Œè€ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…å³ä¸ºå®¢æˆ·ç«¯ï¼Œæ¶ˆè´¹è€…ä¹Ÿå¯ä»¥æ˜¯æœåŠ¡è€…ï¼ŒæœåŠ¡è€…ä¹Ÿå¯ä»¥æ˜¯æ¶ˆè´¹è€…</strong>ã€‚åŒæ—¶ Eureka Server åœ¨å¯åŠ¨æ—¶é»˜è®¤ä¼šæ³¨å†Œè‡ªå·±ï¼Œæˆä¸ºä¸€ä¸ªæœåŠ¡ï¼Œæ‰€ä»¥ Eureka Server ä¹Ÿæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™æ˜¯æ­å»º Eureka é›†ç¾¤çš„åŸºç¡€ã€‚</p><p><strong>Eureka Clientï¼š</strong>ä¸€ä¸ª Java å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–ä¸ Eureka Server çš„äº¤äº’ï¼ˆé€šå¸¸å°±æ˜¯å¾®æœåŠ¡ä¸­çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼‰ã€‚é€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®ã€‚æ˜¯ä¸€ä¸ª Java å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ– Eureka Server çš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢ï¼ˆroundrobinï¼‰è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘ Eureka Server å‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸä¸º 30 ç§’ï¼‰ã€‚å¦‚æœ Eureka Server åœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Server å°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤ï¼ˆé»˜è®¤ 90 ç§’ï¼‰</p><p><strong>Eureka Serverï¼š</strong>æä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡ï¼Œå„ä¸ªå¾®æœåŠ¡èŠ‚ï¼Œé€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨ Eureka Serverc ä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ · Eureka Server ä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚<br>æœåŠ¡åœ¨ Eureka ä¸Šæ³¨å†Œï¼Œç„¶åæ¯éš” 30 ç§’å‘é€å¿ƒè·³æ¥æ›´æ–°å®ƒä»¬çš„ç§Ÿçº¦ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸èƒ½å¤šæ¬¡ç»­è®¢ç§Ÿçº¦ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨å¤§çº¦ 90 ç§’å†…ä»æœåŠ¡å™¨æ³¨å†Œè¡¨ä¸­å‰”é™¤ã€‚æ³¨å†Œä¿¡æ¯å’Œæ›´æ–°è¢«å¤åˆ¶åˆ°é›†ç¾¤ä¸­çš„æ‰€æœ‰ eureka èŠ‚ç‚¹ã€‚æ¥è‡ªä»»ä½•åŒºåŸŸçš„å®¢æˆ·ç«¯éƒ½å¯ä»¥æŸ¥æ‰¾æ³¨å†Œè¡¨ä¿¡æ¯ï¼ˆæ¯ 30 ç§’å‘ç”Ÿä¸€æ¬¡ï¼‰æ¥å®šä½å®ƒä»¬çš„æœåŠ¡ï¼ˆå¯èƒ½åœ¨ä»»ä½•åŒºåŸŸï¼‰å¹¶è¿›è¡Œè¿œç¨‹è°ƒç”¨</p><p>æœåŠ¡<strong>æä¾›è€…</strong>å‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡ï¼Œå¹¶<strong>æ¯éš” 30 ç§’å‘é€ä¸€æ¬¡å¿ƒè·³</strong>ï¼Œå°±å¦‚åŒäººè¿˜æ´»ç€å­˜åœ¨çš„ä¿¡å·ä¸€æ ·ï¼Œå¦‚æœ Eureka åœ¨ 90 ç§’åè¿˜æœªæ”¶åˆ°æœåŠ¡æä¾›è€…å‘æ¥çš„å¿ƒè·³æ—¶ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè®¤å®šè¯¥æœåŠ¡å·²ç»æ­»äº¡å°±ä¼šæ³¨é”€è¿™ä¸ªæœåŠ¡ã€‚è¿™é‡Œæ³¨é”€å¹¶ä¸æ˜¯ç«‹å³æ³¨é”€ï¼Œè€Œæ˜¯ä¼šåœ¨ 60 ç§’ä»¥åå¯¹åœ¨è¿™ä¸ªä¹‹é—´æ®µå†…â€œæ­»äº¡â€çš„æœåŠ¡é›†ä¸­æ³¨é”€ï¼Œå¦‚æœç«‹å³æ³¨é”€ï¼ŒåŠ¿å¿…ä¼šå¯¹ Eureka é€ æˆæå¤§çš„è´Ÿæ‹…ã€‚è¿™äº›æ—¶é—´å‚æ•°éƒ½å¯ä»¥äººä¸ºé…ç½®ã€‚</p><p>Eureka è¿˜æœ‰è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œå¦‚æœåœ¨ 15 åˆ†é’Ÿå†…è¶…è¿‡ 85%çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰æ­£å¸¸çš„å¿ƒè·³ï¼Œé‚£ä¹ˆ Eureka å°±è®¤ä¸ºå®¢æˆ·ç«¯ä¸æ³¨å†Œä¸­å¿ƒå‡ºç°äº†ç½‘ç»œæ•…éšœï¼Œæ‰€ä»¥ä¸ä¼šå†æ¥æ”¶å¿ƒè·³ï¼Œä¹Ÿä¸ä¼šåˆ é™¤æœåŠ¡ã€‚</p><p>å®¢æˆ·ç«¯æ¶ˆè´¹è€…ä¼šå‘æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå› ä¸ºä¸€ä¸ªæœåŠ¡å™¨çš„æ‰¿è½½é‡æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥åŒä¸€ä¸ªæœåŠ¡ä¼šéƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„æœåŠ¡éƒ½ä¼šå»æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡ï¼Œä»–ä»¬ä¼šæœ‰ç›¸åŒçš„æœåŠ¡åç§°ä½†æœ‰ä¸åŒçš„å®ä¾‹ idï¼Œæ‰€ä»¥æ‹‰å–çš„æ˜¯æœåŠ¡åˆ—è¡¨ã€‚æˆ‘ä»¬æœ€ç»ˆé€šè¿‡è´Ÿè½½å‡è¡¡æ¥è·å–ä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·å¯ä»¥å‡è¡¡å„ä¸ªæœåŠ¡å™¨ä¸Šçš„æœåŠ¡ã€‚</p></blockquote><h2 id="1ã€å•æœº-Eureka-æ„å»ºæ­¥éª¤"><a href="#1ã€å•æœº-Eureka-æ„å»ºæ­¥éª¤" class="headerlink" title="1ã€å•æœº Eureka æ„å»ºæ­¥éª¤"></a>1ã€å•æœº Eureka æ„å»ºæ­¥éª¤</h2><p>æ¶ˆè´¹è€…ç«¯å£ 80ï¼Œæä¾›è€…ç«¯å£ 8001ï¼ŒEureka ç«¯å£ 7001</p><p>1ã€åˆ›å»ºå•æœº Eureka æ¨¡å— cloud-eureka-server7001</p><p>2ã€ç¼–å†™ pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-eureka-server7001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯æŒEntity--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka-server--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3ã€ç¼–å†™ application.yml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 7001</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: localhost  # eureka æœåŠ¡ç«¯çš„å®ä¾‹åç§°</span><br><span class="line"></span><br><span class="line">  client:</span><br><span class="line">    # false ä»£è¡¨ä¸å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯æœåŠ¡ä¸­å¿ƒ</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    # false ä»£è¡¨è‡ªå·±å°±æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè‡ªå·±çš„ä½œç”¨å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡ å’Œ æ³¨å†ŒæœåŠ¡éƒ½ä¾èµ–è¿™ä¸ªåœ°å€ http://localhost:7001/eureka/</span><br><span class="line">      defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></pre></td></tr></table></figure><p>4ã€ç¼–å†™ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> EurekaMain7001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 15:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span><span class="comment">//æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaMain7001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5ã€è¿è¡Œ localhost:7001ï¼ŒéªŒè¯æ˜¯å¦æˆåŠŸ</p><h4 id="1-1ã€8001-æ³¨å†Œè¿›-Eureka-æˆä¸ºæä¾›è€…"><a href="#1-1ã€8001-æ³¨å†Œè¿›-Eureka-æˆä¸ºæä¾›è€…" class="headerlink" title="1-1ã€8001 æ³¨å†Œè¿› Eureka æˆä¸ºæä¾›è€…"></a>1-1ã€8001 æ³¨å†Œè¿› Eureka æˆä¸ºæä¾›è€…</h4><ul><li><p>æ”¹ pom æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å†™ YML</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># æ³¨å†Œè¿› Eureka çš„æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># æ£€ç´¢æœåŠ¡ä¸­å¿ƒçš„å…¶å®ƒæœåŠ¡</span></span><br><span class="line">        <span class="comment"># å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br></pre></td></tr></table></figure></li><li><p>æ”¹ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 17:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/8æµ‹è¯•eureka.png" alt=""></p></li></ul><h4 id="1-2ã€80-æ³¨å†Œè¿›-Eureka-æˆä¸ºæ¶ˆè´¹è€…"><a href="#1-2ã€80-æ³¨å†Œè¿›-Eureka-æˆä¸ºæ¶ˆè´¹è€…" class="headerlink" title="1-2ã€80 æ³¨å†Œè¿› Eureka æˆä¸ºæ¶ˆè´¹è€…"></a>1-2ã€80 æ³¨å†Œè¿› Eureka æˆä¸ºæ¶ˆè´¹è€…</h4><ul><li><p>æ”¹ pom æ–‡ä»¶ å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å†™ YML</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2ã€Eureka-é›†ç¾¤æ„å»ºæ­¥éª¤"><a href="#2ã€Eureka-é›†ç¾¤æ„å»ºæ­¥éª¤" class="headerlink" title="2ã€Eureka é›†ç¾¤æ„å»ºæ­¥éª¤"></a>2ã€Eureka é›†ç¾¤æ„å»ºæ­¥éª¤</h2><p><strong>é›†ç¾¤åŸç†è¯´æ˜</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/8Eurekaé›†ç¾¤åŸç†.png" alt=""></p><h4 id="2-1ã€åˆ›å»ºæ¨¡å—-cloud-eureka-server7002"><a href="#2-1ã€åˆ›å»ºæ¨¡å—-cloud-eureka-server7002" class="headerlink" title="2-1ã€åˆ›å»ºæ¨¡å— cloud-eureka-server7002"></a>2-1ã€åˆ›å»ºæ¨¡å— cloud-eureka-server7002</h4><p>ä¸ 7001 ç±»ä¼¼ï¼Œå°±ä¸å¤šå™è¿°äº†</p><p>ç¬¬ä¸€æ­¥</p><p>æ‰¾åˆ° C:\Windows\System32\drivers\etc è·¯å¾„ä¸‹çš„ hosts æ–‡ä»¶ï¼Œä¿®æ”¹æ˜ å°„é…ç½®æ·»åŠ è¿› hosts æ–‡ä»¶ï¼Œå› ä¸ºæµè§ˆå™¨ä¸è¯†åˆ« eureka7001.comï¼Œä¸æ·»åŠ ä¼šå¯¼è‡´åé¢çš„æœåŠ¡æ‰¾ä¸åˆ°æ³¨å†Œä¸­å¿ƒçš„åœ°å€ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/8hostsä¿®æ”¹.png" alt=""></p><p>ä¿®æ”¹ hosts å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#####springcloud2023é¡¹ç›®è¯•ç©#########</span><br><span class="line">127.0.0.1       eureka7001.com</span><br><span class="line">127.0.0.1       eureka7002.com</span><br><span class="line">127.0.0.1       eureka7003.com</span><br><span class="line">####ç»“æŸæ“ä½œ springcloud2023é¡¹ç›®è¯•ç©########</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ yml</p><p>7001yml</p><blockquote><p>ä¸»è¦é…ç½® defaultZone: <a href="http://eureka7002.com:7002/eureka/">http://eureka7002.com:7002/eureka/</a></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eureka æœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># false ä»£è¡¨ä¸å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># false ä»£è¡¨è‡ªå·±å°±æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè‡ªå·±çš„ä½œç”¨å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡ å’Œ æ³¨å†ŒæœåŠ¡éƒ½ä¾èµ–è¿™ä¸ªåœ°å€ http://eureka7002.com:7002/eureka/</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><p>7002yml</p><blockquote><p>ä¸»è¦é…ç½® defaultZone: <a href="http://eureka7001.com:7001/eureka/">http://eureka7001.com:7001/eureka/</a></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">7002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment"># eureka æœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># false ä»£è¡¨ä¸å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># false ä»£è¡¨è‡ªå·±å°±æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè‡ªå·±çš„ä½œç”¨å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡ å’Œ æ³¨å†ŒæœåŠ¡éƒ½ä¾èµ–è¿™ä¸ªåœ°å€ http://eureka7001.com:7001/eureka/</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><p>8001yml</p><blockquote><p>ä¸»è¦é…ç½® defaultZone: <a href="http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</a></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># æ³¨å†Œè¿› Eureka çš„æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># æ£€ç´¢æœåŠ¡ä¸­å¿ƒçš„å…¶å®ƒæœåŠ¡</span></span><br><span class="line">        <span class="comment"># å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># æ‰€æœ‰Entity åˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><h4 id="2-2ã€åˆ›å»ºæ¨¡å—-cloud-provider-payment8002"><a href="#2-2ã€åˆ›å»ºæ¨¡å—-cloud-provider-payment8002" class="headerlink" title="2-2ã€åˆ›å»ºæ¨¡å— cloud-provider-payment8002"></a>2-2ã€åˆ›å»ºæ¨¡å— cloud-provider-payment8002</h4><ul><li><p>pom æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8002<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯æŒEntity--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å›¾å½¢åŒ–æ˜¾ç¤º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  devtools--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8002</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 19:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8002</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8002.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># æ³¨å†Œè¿› Eureka çš„æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># æ£€ç´¢æœåŠ¡ä¸­å¿ƒçš„å…¶å®ƒæœåŠ¡</span></span><br><span class="line">        <span class="comment"># å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># æ‰€æœ‰Entity åˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure></li></ul><p>2ã€å…¶ä½™äº 8001 ç±»ä¼¼ï¼Œè¯·å‚ä¸­ 8001 æ¨¡å—</p><p>3ã€ä¿®æ”¹ 8001/8002 ä¸­çš„ controller ç±»</p><p>ä¸»è¦ä»£ç </p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br><span class="line">private String serverPort;</span><br></pre></td></tr></table></figure></blockquote><p>controller ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 19:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;*******æ’å…¥ç»“æœ&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æ’å…¥æ•°æ®æˆåŠŸ!&quot;</span>+serverPort,result);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æ’å…¥æ•°æ®å¤±è´¥&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;*******æ’å…¥ç»“æœ&quot;</span> + payment + <span class="string">&quot;å“ˆå“ˆå“ˆï¼ï¼ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (payment != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŸ¥è¯¢æˆåŠŸ!&quot;</span>+serverPort, payment);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æŸ¥è¯¢å¤±è´¥ï¼Œæ²¡æœ‰å¯¹åº”è®°å½•&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4ã€å¯¹ cloud-consumer-order80 æ¨¡å—è¿›è¡Œä¿®æ”¹</p><p><strong>controller ç±»</strong></p><p>ä¸»è¦ä»£ç </p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static final String PAYMENT_URL = &quot;http://CLOUD-PAYMENT-SERVICE&quot;;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:08</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="comment">//public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payment</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="comment">//payment å‚æ•°,CommonResult.classè¿”å›ç±»å‹</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ApplicationContextConfig ç±»</p><p>ä¸»è¦ä»£ç ï¼šä½¿ç”¨ LoadBalanced æ³¨è§£èµ‹äºˆ RestTemplate è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</p><blockquote><p>//ä½¿ç”¨ LoadBalanced æ³¨è§£èµ‹äºˆ RestTemplate è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›<br>@LoadBalanced</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//ä½¿ç”¨LoadBalancedæ³¨è§£èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"><a href="#3ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„" class="headerlink" title="3ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"></a>3ã€<a href="https://so.csdn.net/so/search?q=actuator&amp;spm=1001.2101.3001.7020">actuator</a>å¾®æœåŠ¡ä¿¡æ¯å®Œå–„</h2><p><strong>å«æœ‰ä¸»æœºåç§°è®¾ç½®</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/ä¸»æœºåç§°.png" alt=""></p><p>ä¿®æ”¹ 8001 å’Œ 8002 yml æ–‡ä»¶</p><p>8001 åŒç†</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">instance</span>:</span></span><br><span class="line"><span class="class">  <span class="keyword">instance</span>-id: payment8002 # æ¯ä¸ªæä¾›è€…çš„idä¸åŒï¼Œæ˜¾ç¤ºçš„ä¸å†æ˜¯é»˜è®¤çš„é¡¹ç›®å</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># æ³¨å†Œè¿› Eureka çš„æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># æ£€ç´¢æœåŠ¡ä¸­å¿ƒçš„å…¶å®ƒæœåŠ¡</span></span><br><span class="line">        <span class="comment"># å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">payment8002</span> <span class="comment"># æ¯ä¸ªæä¾›è€…çš„idä¸åŒï¼Œæ˜¾ç¤ºçš„ä¸å†æ˜¯é»˜è®¤çš„é¡¹ç›®å</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># æ‰€æœ‰Entity åˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><p><strong>è®¿é—®ä¿¡æ¯ P ä¿¡æ¯æç¤ºé…ç½®</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/ipä¿¡æ¯æç¤º.png" alt=""></p><p>ä¸ºäº†åœ¨å¾®æœåŠ¡ Eureka æ§åˆ¶å°èƒ½çœ‹åˆ°æˆ‘ä»¬çš„æŸä¸ªå…·ä½“æœåŠ¡æ˜¯åœ¨å“ªå°æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€äº›å†…å®¹</p><p>ä¿®æ”¹ 8001 å’Œ 8002 YAML æ–‡ä»¶</p><p>ä¸»è¦ä»£ç </p><blockquote><p>prefer-ip-address: true # å¯ä»¥æ˜¾ç¤º ip åœ°å€</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springcloud2023?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># æ³¨å†Œè¿› Eureka çš„æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># æ£€ç´¢æœåŠ¡ä¸­å¿ƒçš„å…¶å®ƒæœåŠ¡</span></span><br><span class="line">        <span class="comment"># å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">payment8001</span> <span class="comment"># æ¯ä¸ªæä¾›è€…çš„idä¸åŒï¼Œæ˜¾ç¤ºçš„ä¸å†æ˜¯é»˜è®¤çš„é¡¹ç›®å</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># å¯ä»¥æ˜¾ç¤ºipåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="comment"># æ‰€æœ‰Entity åˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><h2 id="4ã€æœåŠ¡å‘ç°-Discovery"><a href="#4ã€æœåŠ¡å‘ç°-Discovery" class="headerlink" title="4ã€æœåŠ¡å‘ç° Discovery"></a>4ã€æœåŠ¡å‘ç° Discovery</h2><p>å¯¹äºæ³¨å†Œè¿› eureka é‡Œé¢çš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯ã€‚</p><h3 id="4-1ã€ä¿®æ”¹-8001-å’Œ-8002-çš„-Controller"><a href="#4-1ã€ä¿®æ”¹-8001-å’Œ-8002-çš„-Controller" class="headerlink" title="4-1ã€ä¿®æ”¹ 8001 å’Œ 8002 çš„ Controller"></a><strong>4-1ã€ä¿®æ”¹ 8001 å’Œ 8002 çš„ Controller</strong></h3><p>æ·»åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.DiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 19:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;*******æ’å…¥ç»“æœ&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æ’å…¥æ•°æ®æˆåŠŸ!&quot;</span>+serverPort,result);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æ’å…¥æ•°æ®å¤±è´¥&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;*******æ’å…¥ç»“æœ&quot;</span> + payment + <span class="string">&quot;å“ˆå“ˆå“ˆï¼ï¼ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (payment != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŸ¥è¯¢æˆåŠŸ!&quot;</span>+serverPort, payment);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æŸ¥è¯¢å¤±è´¥ï¼Œæ²¡æœ‰å¯¹åº”è®°å½•&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/discovery&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è·å¾—æœåŠ¡æ¸…å•åˆ—è¡¨</span></span><br><span class="line">        List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">        <span class="keyword">for</span> (String service : services) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;*****element:&quot;</span> + service);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®å…·ä½“æœåŠ¡è¿›ä¸€æ­¥è·å¾—è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯</span></span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (ServiceInstance instance : instances) &#123;</span><br><span class="line">            log.info(instance.getServiceId() + <span class="string">&quot;\t&quot;</span> + instance.getHost() + <span class="string">&quot;\t&quot;</span> + instance.getPort() + <span class="string">&quot;\t&quot;</span> + instance.getUri());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.discoveryClient;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-2ã€ä¸»å¯åŠ¨ç±»"><a href="#4-2ã€ä¸»å¯åŠ¨ç±»" class="headerlink" title="4-2ã€ä¸»å¯åŠ¨ç±»"></a><strong>4-2ã€ä¸»å¯åŠ¨ç±»</strong></h3><p>ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼š@EnableDiscoveryClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 17:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>psï¼šåœ¨è¿™é‡Œè‡ªå·±é¡¹ç›®æ¼äº†ä¸€ä¸ªä¸œè¥¿ï¼Œå¯¼è‡´ cloud-consumer-order ä¸º unknow</strong></p><p>ä¿®æ”¹ cloud-consumer-order80 æ¨¡å—ä¸­çš„ application.yaml</p><p>ä¸»è¦é—æ¼ä»£ç ï¼š</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">application:</span><br><span class="line"> name: cloud-consumer-order # é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-consumer-order</span> <span class="comment"># é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><h2 id="5ã€Eureka-è‡ªæˆ‘ä¿æŠ¤"><a href="#5ã€Eureka-è‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="5ã€Eureka è‡ªæˆ‘ä¿æŠ¤"></a>5ã€Eureka è‡ªæˆ‘ä¿æŠ¤</h2><h3 id="5-1ã€æ•…éšœç°è±¡"><a href="#5-1ã€æ•…éšœç°è±¡" class="headerlink" title="5-1ã€æ•…éšœç°è±¡"></a><strong>5-1ã€æ•…éšœç°è±¡</strong></h3><p><strong>æ¦‚è¿°</strong></p><p>ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„å®¢æˆ·ç«¯å’Œ Eureka Server ä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ä¸‹çš„ä¿æŠ¤ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼ŒEureka Server å°†ä¼šå°è¯•ä¿æŠ¤å…¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ã€‚</p><p>å¦‚æœåœ¨ Eureka Server çš„é¦–é¡µçœ‹åˆ°ä»¥ä¸‹è¿™æ®µæç¤ºï¼Œåˆ™è¯´æ˜ Eureka è¿›å…¥äº†ä¿æŠ¤æ¨¡å¼ï¼š</p><blockquote><p>EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEYâ€™RE NOT.</p><p>RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE</p></blockquote><h3 id="5-2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Ÿ"><a href="#5-2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Ÿ" class="headerlink" title="5-2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Ÿ"></a>5-2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Ÿ</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ EurekaServer åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEurekaServer å°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤ 90 ç§’ï¼‰ã€‚ä½†æ˜¯å½“ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿ(å»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤)æ—¶ï¼Œå¾®æœåŠ¡ä¸ EurekaServer ä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†â€”â€”å› ä¸ºå¾®æœåŠ¡æœ¬èº«å…¶å®æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚Eureka é€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å½“ EurekaServer èŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚</p><p>åœ¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¸­ï¼ŒEureka Server ä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†æ³¨é”€ä»»ä½•æœåŠ¡å®ä¾‹ã€‚</p><p>ç»¼ä¸Šï¼Œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ˜¯ä¸€ç§åº”å¯¹ç½‘ç»œå¼‚å¸¸çš„å®‰å…¨ä¿æŠ¤æªæ–½ã€‚å®ƒçš„æ¶æ„å“²å­¦æ˜¯å®å¯åŒæ—¶ä¿ç•™æ‰€æœ‰å¾®æœåŠ¡ï¼ˆå¥åº·çš„å¾®æœåŠ¡å’Œä¸å¥åº·çš„å¾®æœåŠ¡éƒ½ä¼šä¿ç•™ï¼‰ä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¥åº·çš„å¾®æœåŠ¡ã€‚ä½¿ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå¯ä»¥è®© Eureka é›†ç¾¤æ›´åŠ çš„å¥å£®ã€ç¨³å®šã€‚</p><blockquote><p>ä¸€å¥è¯ï¼šæŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒEureka ä¸ä¼šç«‹åˆ»æ¸…ç†ï¼Œä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜</p><p>å±äº CAP é‡Œé¢çš„ AP åˆ†æ”¯</p></blockquote><h3 id="5-3ã€æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"><a href="#5-3ã€æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="5-3ã€æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"></a>5-3ã€æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤</h3><p>ç°åœ¨å¯ä»¥ä¸ç”¨é›†ç¾¤ç‰ˆäº†ï¼Œåªç”¨å¼€ä¸€ä¸ªã€‚</p><p>æ³¨å†Œä¸­å¿ƒ eureakeServer ç«¯ 7001</p><p>å‡ºå‚é»˜è®¤ï¼Œè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶æ˜¯å¼€å¯çš„ eureka.server.enable-self-preservation=trueï¼Œä½¿ç”¨ eureka.server.enable-self-preservation = false å¯ä»¥ç¦ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="comment"># å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨è¯¥æœåŠ¡è¢«åŠæ—¶å‰”é™¤</span></span><br><span class="line">  <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"> <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"> <span class="attr">instance:</span></span><br><span class="line">   <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>  <span class="comment"># eureka æœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">client:</span></span><br><span class="line">   <span class="comment"># false ä»£è¡¨ä¸å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">   <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">   <span class="comment"># false ä»£è¡¨è‡ªå·±å°±æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œè‡ªå·±çš„ä½œç”¨å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">   <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">service-url:</span></span><br><span class="line">     <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡ å’Œ æ³¨å†ŒæœåŠ¡éƒ½ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line">     <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"> <span class="attr">server:</span></span><br><span class="line">   <span class="comment"># å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨è¯¥æœåŠ¡è¢«åŠæ—¶å‰”é™¤</span></span><br><span class="line">   <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">   <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure><p><strong>ç”Ÿäº§è€…å®¢æˆ·ç«¯ eureakeClient ç«¯ 8001</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Eurekaå®¢æˆ·ç«¯åƒæœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½sï¼Œé»˜è®¤30s</span></span><br><span class="line"><span class="attr">least-renewal-interval-in-seconds:</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># RurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šçº¿ï¼Œå•ä½ä¸ºsï¼Œé»˜è®¤90sï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡</span></span><br><span class="line"><span class="attr">least-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment">#å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span> <span class="comment">#mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># æ³¨å†Œè¿› Eureka çš„æœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># æ£€ç´¢ æœåŠ¡ä¸­å¿ƒ çš„å…¶å®ƒæœåŠ¡</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment"># è®¾ç½®ä¸ Eureka Server äº¤äº’çš„åœ°å€</span></span><br><span class="line">            <span class="comment"># æä¾›è€…æ³¨å†Œåˆ°å¤šä¸ªeurekaä¸­</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="comment">#      defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">payment8001</span> <span class="comment"># æ¯ä¸ªæä¾›è€…çš„idä¸åŒï¼Œæ˜¾ç¤ºçš„ä¸å†æ˜¯é»˜è®¤çš„é¡¹ç›®å</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span></span><br><span class="line">            <span class="literal">true</span> <span class="comment"># å¯ä»¥æ˜¾ç¤ºipåœ°å€</span></span><br><span class="line">            <span class="comment"># Eurekaå®¢æˆ·ç«¯åƒæœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½sï¼Œé»˜è®¤30s</span></span><br><span class="line">        <span class="attr">least-renewal-interval-in-seconds:</span></span><br><span class="line">            <span class="number">1</span></span><br><span class="line">            <span class="comment"># RurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šçº¿ï¼Œå•ä½ä¸ºsï¼Œé»˜è®¤90sï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡</span></span><br><span class="line">        <span class="attr">least-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">    <span class="attr">type-aliases-package:</span> <span class="string">com.atguigu.springcloud.entities</span> <span class="comment"># æ‰€æœ‰Entity åˆ«åç±»æ‰€åœ¨åŒ…</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><p>å…ˆå¯åŠ¨ 7001 å†å¯åŠ¨ 8001ï¼Œå…³é—­ 8001ï¼Œé©¬ä¸Šè¢«åˆ é™¤äº†</p><p><strong>Eureka åœæ›´è¯´æ˜ï¼š2.0 ååœæ›´äº†ã€‚</strong><br>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/" title="zookeeperæœåŠ¡æ³¨å†Œä¸­å¿ƒğŸ˜¶">zookeeperæœåŠ¡æ³¨å†Œä¸­å¿ƒğŸ˜¶</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Gatewayç½‘å…³</title>
      <link href="/2023/06/12/Gateway%E7%BD%91%E5%85%B3/"/>
      <url>/2023/06/12/Gateway%E7%BD%91%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="Gateway-ç½‘å…³"><a href="#Gateway-ç½‘å…³" class="headerlink" title="Gateway ç½‘å…³"></a>Gateway ç½‘å…³</h1><h2 id="1ã€Gateway-ç®€ä»‹"><a href="#1ã€Gateway-ç®€ä»‹" class="headerlink" title="1ã€Gateway ç®€ä»‹"></a>1ã€Gateway ç®€ä»‹</h2><h3 id="1-1ã€å®˜ç½‘"><a href="#1-1ã€å®˜ç½‘" class="headerlink" title="1-1ã€å®˜ç½‘"></a>1-1ã€å®˜ç½‘</h3><p>ä¸Šä¸€ä»£ zuul 1.Xï¼š<a href="https://github.com/Netflix/zuul/wiki">https://github.com/Netflix/zuul/wiki</a></p><p>å½“å‰ gatewayï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</a></p><h3 id="1-2ã€æ˜¯ä»€ä¹ˆ"><a href="#1-2ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-2ã€æ˜¯ä»€ä¹ˆ"></a>1-2ã€æ˜¯ä»€ä¹ˆ</h3><p>SpringCloud Gateway æ˜¯ SpringCloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼ŒåŸºäº Spring5.O+Springboot 2.0 å’Œ ProjectReactor ç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p><p>SpringCloudGateway ä½œä¸º SpringCloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ Zuul,åœ¨ SpringCloud2.0 ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„ zuul2.0 ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„ Zuul 1.x é Reactor æ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼Œ<strong>SpringCloud Gateway æ˜¯åŸºäº WebFlux æ¡†æ¶å®ç°çš„ï¼Œè€Œ webFlux æ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„ Reactor æ¨¡å¼é€šä¿¡æ¡†æ¶ Nettyã€‚</strong></p><p>springCloudGateway çš„ç›®æ ‡æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡ï¼Œå’Œé™æµã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway1.png" alt=""></p><h3 id="1-3ã€èƒ½å¹²å˜›"><a href="#1-3ã€èƒ½å¹²å˜›" class="headerlink" title="1-3ã€èƒ½å¹²å˜›"></a>1-3ã€èƒ½å¹²å˜›</h3><ul><li>åå‘ä»£ç†</li><li>é‰´æƒ</li><li>æµé‡æ§åˆ¶</li><li>ç†”æ–­</li><li>æ—¥å¿—ç›‘æ§</li></ul><p>å¾®æœåŠ¡æ¶æ„ä¸­ç½‘å…³åœ¨å“ªé‡Œï¼Ÿ</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway2.png" alt=""></p><h3 id="1-4ã€æœ‰-Zuul-äº†æ€ä¹ˆåˆå‡ºæ¥äº†-gateway"><a href="#1-4ã€æœ‰-Zuul-äº†æ€ä¹ˆåˆå‡ºæ¥äº†-gateway" class="headerlink" title="1-4ã€æœ‰ Zuul äº†æ€ä¹ˆåˆå‡ºæ¥äº† gateway"></a>1-4ã€æœ‰ Zuul äº†æ€ä¹ˆåˆå‡ºæ¥äº† gateway</h3><p>neflix ä¸å¤ªé è°±ï¼Œzuul2.0 ä¸€ç›´è·³ç¥¨ï¼Œè¿Ÿè¿Ÿä¸å‘å¸ƒï¼Œä¸€æ–¹é¢å› ä¸º Zuul1.0 å·²ç»è¿›å…¥äº†ç»´æŠ¤é˜¶æ®µï¼Œè€Œä¸” Gateway æ˜¯ SpringCloud å›¢é˜Ÿç ”å‘çš„ï¼Œæ˜¯äº²å„¿å­äº§å“ï¼Œå€¼å¾—ä¿¡èµ–ã€‚è€Œä¸”å¾ˆå¤šåŠŸèƒ½ Zuul éƒ½æ²¡æœ‰ç”¨èµ·æ¥ä¹Ÿéå¸¸çš„ç®€å•ä¾¿æ·ã€‚Gateway æ˜¯åŸºäºå¼‚æ­¥éé˜»å¡æ¨¡å‹ä¸Šè¿›è¡Œå¼€å‘çš„ï¼Œæ€§èƒ½æ–¹é¢ä¸éœ€è¦æ‹…å¿ƒã€‚è™½ç„¶ Netflix æ—©å°±å‘å¸ƒäº†æœ€æ–°çš„ Zuul 2.xï¼Œä½† Spring Cloud è²Œä¼¼æ²¡æœ‰æ•´åˆè®¡åˆ’ã€‚è€Œä¸” Netflix ç›¸å…³ç»„ä»¶éƒ½å®£å¸ƒè¿›å…¥ç»´æŠ¤æœŸï¼›ä¸çŸ¥å‰æ™¯å¦‚ä½•ï¼Ÿå¤šæ–¹é¢ç»¼åˆè€ƒè™‘ Gateway æ˜¯å¾ˆç†æƒ³çš„ç½‘å…³é€‰æ‹©ã€‚</p><h3 id="5ã€Gateway-ç‰¹å¾"><a href="#5ã€Gateway-ç‰¹å¾" class="headerlink" title="5ã€Gateway ç‰¹å¾"></a>5ã€Gateway ç‰¹å¾</h3><ul><li>åŸºäº Spring Framework 5, Project Reactor å’Œ Spring Boot 2.0 è¿›è¡Œæ„å»º</li><li>åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§</li><li>å¯ä»¥å¯¹è·¯ç”±æŒ‡å®š Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰</li><li>é›†æˆ Hystrix çš„æ–­è·¯å™¨åŠŸèƒ½</li><li>é›†æˆ Spring Cloud æœåŠ¡å‘ç°åŠŸèƒ½</li><li>æ˜“äºç¼–å†™çš„ Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰</li><li>è¯·æ±‚é™æµåŠŸèƒ½</li><li>æ”¯æŒè·¯å¾„é‡å†™</li></ul><h3 id="1-6ã€SpringCloudGateway-ä¸-Zuul-çš„åŒºåˆ«ï¼š"><a href="#1-6ã€SpringCloudGateway-ä¸-Zuul-çš„åŒºåˆ«ï¼š" class="headerlink" title="1-6ã€SpringCloudGateway ä¸ Zuul çš„åŒºåˆ«ï¼š"></a>1-6ã€SpringCloudGateway ä¸ Zuul çš„åŒºåˆ«ï¼š</h3><p>åœ¨ SpringCloudFinchley æ­£å¼ç‰ˆä¹‹å‰ï¼ŒSpringCloud æ¨èçš„ç½‘å…³æ˜¯ Netflix æä¾›çš„ Zuulï¼š</p><ul><li>Zuul 1.x æ˜¯ä¸€ä¸ªåŸºäºé˜»å¡ I/O çš„ APIGateway</li><li>Zuul 1.x åŸºäº ServIet2.5 ä½¿ç”¨é˜»å¡æ¶æ„ï¼Œå®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥ï¼ˆå¦‚ WebSocket)ï¼ŒZuul çš„è®¾è®¡æ¨¡å¼å’Œ Nginx è¾ƒåƒï¼Œæ¯æ¬¡ I/O æ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯ Nginx ç”¨ C++å®ç°ï¼ŒZuul ç”¨ Java å®ç°ï¼Œè€Œ JVM æœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾— Zuul çš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚</li><li>Zuul 2.x ç†å¿µæ›´å…ˆè¿›æƒ³åŸºäº Netty éé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½† SpringCloud ç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚Zuul2.x çš„æ€§èƒ½è¾ƒ Zuul1.x æœ‰è¾ƒå¤§æå‡ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼ŒSpringCloudGateway çš„ RPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰æ˜¯ Zuul çš„ 1.6 å€ã€‚</li><li>SpringCloudGateway å»ºç«‹åœ¨ SpringFramework5ã€ProjectReactor å’Œ SpringB00t2ï¼ä¹‹ä¸Šï¼Œä½¿ç”¨éé˜»å¡ API</li><li>SpringCloudGateway è¿˜æ”¯æŒ WebSocket,å¹¶ä¸”ä¸ Spring ç´§å¯†é›†æˆæ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒ</li></ul><h3 id="1-7ã€Zuul1-x-æ¨¡å‹"><a href="#1-7ã€Zuul1-x-æ¨¡å‹" class="headerlink" title="1-7ã€Zuul1.x æ¨¡å‹"></a>1-7ã€Zuul1.x æ¨¡å‹</h3><p>springcloud ä¸­æ‰€é›†æˆçš„ zuul ç‰ˆæœ¬ï¼Œé‡‡ç”¨çš„æ˜¯ tomcat å®¹å™¨ï¼Œä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„ servlet IO å¤„ç†æ¨¡å‹ã€‚</p><p>Servlet çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿservlet ç”± servlet container è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><ul><li>container å¯åŠ¨æ—¶æ„é€  servlet å¯¹è±¡å¹¶è°ƒç”¨ servlet init()è¿›è¡Œåˆå§‹åŒ–ï¼Œ</li><li>container è¿è¡Œæ—¶æ¥å—è¯·æ±‚ï¼Œå¹¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸€èˆ¬ä»çº¿ç¨‹æ± ä¸­è·å–ç©ºé—²çº¿ç¨‹ï¼‰ç„¶åè°ƒç”¨ service()</li><li>container å…³é—­æ—¶è°ƒç”¨ servlet destory()é”€æ¯ servlet</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/15getway3.png" alt=""></p><p><strong>ä¸Šè¿°æ¨¡å¼çš„ç¼ºç‚¹</strong><br>servleteâ€”ä¸ªç®€å•çš„ç½‘ç»œ IO æ¨¡å‹ï¼Œå½“è¯·æ±‚è¿›å…¥ servlet container æ—¶ï¼Œservlet container å°±ä¼šä¸ºå…¶ç»‘å®šä¸€ä¸ªçº¿ç¨‹åœ¨å¹¶å‘ä¸é«˜çš„åœºæ™¯ä¸‹è¿™ç§æ¨¡å‹æ˜¯é€‚ç”¨çš„ã€‚ä½†æ˜¯ä¸€æ—¦é«˜å¹¶å‘ï¼ˆæ¯”å¦‚æŠ½é£ç”¨ jemeter å‹),çº¿ç¨‹æ•°é‡å°±ä¼šä¸Šæ¶¨ï¼Œè€Œçº¿ç¨‹èµ„æºä»£ä»·æ˜¯æ˜‚è´µçš„ï¼ˆä¸Šçº¿æ–‡åˆ‡æ¢ï¼Œå†…å­˜æ¶ˆè€—å¤§ï¼‰ä¸¥é‡å½±å“è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚</p><p>åœ¨ä¸€äº›ç®€å•ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¸å¸Œæœ›ä¸ºæ¯ä¸ª request åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œåªéœ€è¦ 1 ä¸ªæˆ–å‡ ä¸ªçº¿ç¨‹å°±èƒ½åº”å¯¹æå¤§å¹¶å‘çš„è¯·æ±‚ï¼Œè¿™ç§ä¸šåŠ¡åœºæ™¯ä¸‹ servlet æ¨¡å‹æ²¡æœ‰ä¼˜åŠ¿ã€‚</p><p>æ‰€ä»¥ Zuul 1.x æ˜¯åŸºäº servlet ä¹‹ä¸Šçš„ä¸€ä¸ªé˜»å¡å¼å¤„ç†æ¨¡å‹ï¼Œå³ spring å®ç°äº†å¤„ç†æ‰€æœ‰ request è¯·æ±‚çš„ä¸€ä¸ª servlet(DispatcherServlet)å¹¶ç”±è¯¥ servlet é˜»å¡å¼å¤„ç†å¤„ç†ã€‚æ‰€ä»¥ springcloudzuul æ— æ³•æ‘†è„± servlet æ¨¡å‹çš„å¼Šç«¯ã€‚</p><h3 id="1-8ã€GateWay-æ¨¡å‹"><a href="#1-8ã€GateWay-æ¨¡å‹" class="headerlink" title="1-8ã€GateWay æ¨¡å‹"></a>1-8ã€GateWay æ¨¡å‹</h3><p><img src="https://picbed.jnchan.top/springcloudImages/15getway4.png" alt=""></p><p>ä¼ ç»Ÿçš„ Web æ¡†æ¶æ¯”å¦‚è¯´ï¼šstruts2,springmvc ç­‰éƒ½æ˜¯åŸºäº Servlet API ä¸ Servlet å®¹å™¨åŸºç¡€ä¹‹ä¸Šè¿è¡Œçš„ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨ Servlet3.1 ä¹‹åæœ‰äº†å¼‚æ­¥éé˜»å¡çš„æ”¯æŒã€‚è€Œ<font color='red'><strong>WebFlux æ˜¯ä¸€ä¸ªå…¸å‹éé˜»å¡å¼‚æ­¥çš„æ¡†æ¶</strong></font>ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯åŸºäº Reactor çš„ç›¸å…³ API å®ç°çš„ã€‚ç›¸å¯¹äºä¼ ç»Ÿçš„ web æ¡†æ¶æ¥è¯´ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚ Nettyï¼ŒUndertow åŠæ”¯æŒ Servlet3.1 çš„å®¹å™¨ä¸Šã€‚éé˜»å¡å¼+å‡½æ•°å¼ç¼–ç¨‹(Spring5 å¿…é¡»è®©ä½ ä½¿ç”¨ java8)</p><p>SpringWebFlux æ˜¯ Spring5.0 å¼•å…¥çš„æ–°çš„å“åº”å¼æ¡†æ¶åŒºåˆ«äº SpringMVC,å®ƒä¸éœ€è¦ä¾èµ– ServletAPIï¼Œå®ƒæ˜¯å®Œå…¨å¼‚æ­¥éé˜»å¡çš„ï¼Œå¹¶ä¸”åŸºäº Reactor æ¥å®ç°å“åº”å¼æµè§„èŒƒã€‚</p><h2 id="2ã€Gateway-å·¥ä½œæµç¨‹"><a href="#2ã€Gateway-å·¥ä½œæµç¨‹" class="headerlink" title="2ã€Gateway å·¥ä½œæµç¨‹"></a>2ã€Gateway å·¥ä½œæµç¨‹</h2><h3 id="2-1ã€ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"><a href="#2-1ã€ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2-1ã€ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"></a>2-1ã€ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ</h3><p>ï¼ˆ1ï¼‰Route(è·¯ç”±)<br>è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”± IDï¼Œç›®æ ‡ URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸º true åˆ™åŒ¹é…è¯¥è·¯ç”±</p><p>ï¼ˆ2ï¼‰Predicate(æ–­è¨€)<br>å‚è€ƒçš„æ˜¯ Java8 çš„ java.util.function.Predicateï¼Œå¼€å‘äººå‘˜å¯ä»¥åŒ¹é… HTTP è¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°)ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</p><p>ï¼ˆ3ï¼‰Filter(è¿‡æ»¤)<br>æŒ‡çš„æ˜¯ Spring æ¡†æ¶ä¸­ GatewayFilter çš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway5.png" alt=""></p><p>web è¯·æ±‚é€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¹¶åœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚</p><p>predicate å°±æ˜¯æˆ‘ä»¬çš„åŒ¹é…æ¡ä»¶ï¼›è€Œ filterï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„æ‹¦æˆªå™¨ã€‚æœ‰äº†è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå†åŠ ä¸Šç›®æ ‡ uriï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±äº†ã€‚</p><h3 id="2-2ã€Gatewayå·¥ä½œæµç¨‹"><a href="#2-2ã€Gatewayå·¥ä½œæµç¨‹" class="headerlink" title="2-2ã€Gatewayå·¥ä½œæµç¨‹"></a><strong>2-2ã€Gat</strong>eway<strong>å·¥ä½œæµç¨‹</strong></h3><p>å®˜ç½‘æ€»ç»“</p><p><img src="https://picbed.jnchan.top/springcloudImages/15getway6.png" alt=""></p><p>å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚</p><p>Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚</p><p>è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</p><p>Filter åœ¨â€œpreâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ï¼Œåœ¨â€œpostâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p><p><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼šè·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾</p><h2 id="3ã€å…¥é—¨é…ç½®"><a href="#3ã€å…¥é—¨é…ç½®" class="headerlink" title="3ã€å…¥é—¨é…ç½®"></a>3ã€å…¥é—¨é…ç½®</h2><h3 id="3-1ã€Gateway9527-æ­å»º"><a href="#3-1ã€Gateway9527-æ­å»º" class="headerlink" title="3-1ã€Gateway9527 æ­å»º"></a>3-1ã€Gateway9527 æ­å»º</h3><p>æ–°å»º Moduleï¼šcloud-gateway-gateway9527</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-gateway-gateway9527<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--gateway--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†Œè¿› eureka Server # ç½‘å…³ä»–æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾®æœåŠ¡ï¼Œä¹Ÿè¦æ³¨å†Œè¿›æ³¨å†Œä¸»ä¸­å¿ƒ</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> GateWayMain9527</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/20 19:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayMain9527</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GateWayMain9527.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-2ã€9527-ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„å‘¢ï¼Ÿ"><a href="#3-2ã€9527-ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„å‘¢ï¼Ÿ" class="headerlink" title="3-2ã€9527 ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„å‘¢ï¼Ÿ"></a>3-2ã€9527 ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„å‘¢ï¼Ÿ</h3><p>æˆ‘ä»¬ç›®å‰ä¸æƒ³æš´éœ² 8001 ç«¯å£ï¼Œå¸Œæœ›åœ¨ 8001 å¤–é¢å¥—ä¸€å±‚ 9527</p><h4 id="YML-æ–°å¢ç½‘å…³é…ç½®"><a href="#YML-æ–°å¢ç½‘å…³é…ç½®" class="headerlink" title="YML æ–°å¢ç½‘å…³é…ç½®"></a>YML æ–°å¢ç½‘å…³é…ç½®</h4><p>8001 çœ‹ controller çš„è®¿é—®åœ°å€ï¼Œæˆ‘ä»¬ç›®å‰ä¸æƒ³æš´éœ² 8001 ç«¯å£ï¼Œå¸Œæœ›åœ¨ 8001 å¤–é¢å¥—ä¸€å±‚ 9527ã€‚è¿™æ ·åˆ«äººå°±æ”»å‡»ä¸äº† 8001ï¼Œæœ‰ç½‘å…³æŒ¡ç€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">    <span class="comment">## GateWayé…ç½®</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span> <span class="comment">#å¤šä¸ªè·¯ç”±</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment"># è·¯ç”±ID ï¼Œ æ²¡æœ‰å›ºå®šçš„è§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line"></span><br><span class="line">                  <span class="comment">#uri+predicates  è¦è®¿é—®è¿™ä¸ªè·¯å¾„å¾—å…ˆç»è¿‡9527å¤„ç†</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span> <span class="comment"># åŒ¹é…æˆåŠŸåæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span> <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†Œè¿› eureka Server # ç½‘å…³ä»–æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾®æœåŠ¡ï¼Œä¹Ÿè¦æ³¨å†Œè¿›æ³¨å†Œä¸»ä¸­å¿ƒ</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><h3 id="3-3ã€æµ‹è¯•"><a href="#3-3ã€æµ‹è¯•" class="headerlink" title="3-3ã€æµ‹è¯•"></a>3-3ã€æµ‹è¯•</h3><ol><li><p>å¯åŠ¨ 7001</p></li><li><p>å¯åŠ¨ 8001ï¼šcloud-provider-payment8001</p></li><li><p>å¯åŠ¨ 9527 ç½‘å…³</p><p> <img src="https://picbed.jnchan.top/springcloudImages/15getwayæµ‹è¯•_9527.png" alt=""></p></li></ol><p>è®¿é—®è¯´æ˜ï¼š</p><p>åŠ å…¥ç½‘å…³å‰ï¼š<a href="http://localhost:8001/payment/get/1">http://localhost:8001/payment/get/1</a><br>åŠ å…¥ç½‘å…³åï¼š<a href="http://localhost:9527/payment/get/1">http://localhost:9527/payment/get/1</a><br>ä¸¤è€…è®¿é—®æˆåŠŸï¼Œè¿”å›ç›¸åŒç»“æœ</p><h3 id="3-4ã€Gateway-é…ç½®è·¯ç”±çš„ä¸¤ç§æ–¹å¼"><a href="#3-4ã€Gateway-é…ç½®è·¯ç”±çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="3-4ã€Gateway é…ç½®è·¯ç”±çš„ä¸¤ç§æ–¹å¼"></a>3-4ã€Gateway é…ç½®è·¯ç”±çš„ä¸¤ç§æ–¹å¼</h3><p>Gateway ç½‘å…³è·¯ç”±æœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š</p><ul><li><p>åœ¨é…ç½®æ–‡ä»¶ yml ä¸­é…ç½®</p></li><li><p>ä»£ç ä¸­æ³¨å…¥ RouteLocator çš„ Bean</p></li></ul><p>è‡ªå·±å†™ä¸€ä¸ªæ¡ˆä¾‹ï¼šé€šè¿‡ 9527 ç½‘å…³è®¿é—®åˆ°å¤–ç½‘çš„è…¾è®¯æ–°é—»ç½‘å€ï¼š<a href="http://new.qq.com/ch/tech/">http://new.qq.com/ch/tech/</a></p><p>æ·»åŠ é…ç½®ç±»</p><p>å½“è®¿é—®åœ°å€ <a href="http://localhost:9527/ch/tech">http://localhost:9527/ch/tech</a> æ—¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼š<a href="http://new.qq.com/ch/tech/">http://new.qq.com/ch/tech/</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.RouteLocator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> GateWayConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/21 9:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouteLocator <span class="title function_">customRouteLocator</span><span class="params">(RouteLocatorBuilder routeLocatorBuilder)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RouteLocatorBuilder.<span class="type">Builder</span> <span class="variable">routes</span> <span class="operator">=</span> routeLocatorBuilder.routes();</span><br><span class="line"></span><br><span class="line">        routes.route(<span class="string">&quot;path_route_jcvv&quot;</span>,</span><br><span class="line">                r -&gt; r.path(<span class="string">&quot;/ch/tech&quot;</span>)</span><br><span class="line">                        .uri(<span class="string">&quot;http://new.qq.com/ch/tech/&quot;</span>)).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4ã€é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±"><a href="#4ã€é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±" class="headerlink" title="4ã€é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±"></a>4ã€é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±</h2><h3 id="4-1ã€ä»¥å‰çš„é…ç½®è¯´æ˜"><a href="#4-1ã€ä»¥å‰çš„é…ç½®è¯´æ˜" class="headerlink" title="4-1ã€ä»¥å‰çš„é…ç½®è¯´æ˜"></a>4-1ã€ä»¥å‰çš„é…ç½®è¯´æ˜</h3><p>è·¯å¾„å†™æ­»äº†</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getwayå†™æ­»äº†.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/16getwayè·¯ç”±åŒ¹é….png" alt=""></p><p>é»˜è®¤æƒ…å†µä¸‹ gateway ä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨ï¼Œä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½ã€‚</p><h3 id="4-2ã€é…ç½®åŠ¨æ€è·¯ç”±"><a href="#4-2ã€é…ç½®åŠ¨æ€è·¯ç”±" class="headerlink" title="4-2ã€é…ç½®åŠ¨æ€è·¯ç”±"></a>4-2ã€é…ç½®åŠ¨æ€è·¯ç”±</h3><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a><strong>application.yml</strong></h4><p>å¯¹ yml è¿›è¡Œé…ç½®ï¼šè®©å…¶å…ˆé€šè¿‡ gatewayï¼Œå†é€šè¿‡ gateway å»æ³¨å†Œä¸­å¿ƒæ‰¾æä¾›è€…</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_åŠ¨æ€è·¯ç”±é…ç½®.png" alt=""></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-gateway</span></span><br><span class="line">    <span class="comment">## GateWayé…ç½®</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">locator:</span></span><br><span class="line">                    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span></span><br><span class="line">            <span class="attr">routes:</span> <span class="comment">#å¤šä¸ªè·¯ç”±</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment"># è·¯ç”±ID ï¼Œ æ²¡æœ‰å›ºå®šçš„è§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line"></span><br><span class="line">                  <span class="comment">#uri+predicates  è¦è®¿é—®è¿™ä¸ªè·¯å¾„å¾—å…ˆç»è¿‡9527å¤„ç†</span></span><br><span class="line">                  <span class="comment">#uri: http://localhost:8001  # åŒ¹é…æˆåŠŸåæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span></span><br><span class="line">                  <span class="comment"># lb å±äºGateWay çš„å…³é”®å­—ï¼Œä»£è¡¨æ˜¯åŠ¨æ€uriï¼Œå³ä»£è¡¨ä½¿ç”¨çš„æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„å¾®æœåŠ¡åï¼Œå®ƒé»˜è®¤å¼€å¯ä½¿ç”¨è´Ÿè½½å‡è¡¡æœºåˆ¶</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span> <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">                  <span class="comment">#uri: http://localhost:8001</span></span><br><span class="line">                  <span class="comment"># lb å±äºGateWay çš„å…³é”®å­—ï¼Œä»£è¡¨æ˜¯åŠ¨æ€uriï¼Œå³ä»£è¡¨ä½¿ç”¨çš„æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„å¾®æœåŠ¡åï¼Œå®ƒé»˜è®¤å¼€å¯ä½¿ç”¨è´Ÿè½½å‡è¡¡æœºåˆ¶</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨å†Œè¿› eureka Server # ç½‘å…³ä»–æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾®æœåŠ¡ï¼Œä¹Ÿè¦æ³¨å†Œè¿›æ³¨å†Œä¸»ä¸­å¿ƒ</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¯åŠ¨ï¼šä¸€ä¸ª eureka7001 + ä¸¤ä¸ªæœåŠ¡æä¾›è€… 8001/8002</p><p>ç»“æœï¼š8001/8002 ä¸¤ä¸ªç«¯å£åˆ‡æ¢</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getwayåŠ¨æ€è·¯ç”±_é¡ºåºåˆ‡æ¢.png" alt=""></p><h2 id="5ã€GateWay-å¸¸ç”¨çš„-Predicate"><a href="#5ã€GateWay-å¸¸ç”¨çš„-Predicate" class="headerlink" title="5ã€GateWay å¸¸ç”¨çš„ Predicate"></a>5ã€GateWay å¸¸ç”¨çš„ Predicate</h2><h3 id="5-1ã€Route-Predicate-Factories-æ˜¯ä»€ä¹ˆ"><a href="#5-1ã€Route-Predicate-Factories-æ˜¯ä»€ä¹ˆ" class="headerlink" title="5-1ã€Route Predicate Factories æ˜¯ä»€ä¹ˆ?"></a>5-1ã€Route Predicate Factories æ˜¯ä»€ä¹ˆ?</h3><p>å¯åŠ¨ idea</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_p.png" alt=""></p><p>Spring Cloud Gateway å°†è·¯ç”±åŒ¹é…ä½œä¸º Spring WebFlux HandlerMapping åŸºç¡€æ¶æ„çš„ä¸€éƒ¨åˆ†</p><p>Spring Cloud Gateway åŒ…æ‹¬è®¸å¤šå†…ç½®çš„ Route Predicate å·¥å‚ï¼Œæ‰€æœ‰è¿™äº› Predicate éƒ½ä¸ HTTP è¯·æ±‚çš„ä¸åŒå±æ€§åŒ¹é…ï¼Œå¤šä¸ª Route Predicate å·¥å‚å¯ä»¥è¿›è¡Œç»„åˆã€‚</p><p>Spring Cloud Gateway åˆ›å»º Route å¯¹è±¡æ—¶ï¼Œä½¿ç”¨ RoutePredicateFactory åˆ›å»º Predicate å¯¹è±¡ï¼ŒPredicate å¯¹è±¡å¯ä»¥èµ‹å€¼ç»™ Routeã€‚ Spring Cloud Gateway åŒ…å«è®¸å¤šå†…ç½®çš„ Route Predicate Factoriesã€‚</p><p>æ‰€æœ‰è¿™äº›è°“è¯éƒ½åŒ¹é… HTTP è¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šç§è°“è¯å·¥å‚å¯ä»¥ç»„åˆï¼Œå¹¶é€šè¿‡é€»è¾‘ andã€‚</p><h3 id="5-2ã€å¸¸ç”¨çš„-Route-Predicate"><a href="#5-2ã€å¸¸ç”¨çš„-Route-Predicate" class="headerlink" title="5-2ã€å¸¸ç”¨çš„ Route Predicate"></a>5-2ã€å¸¸ç”¨çš„ Route Predicate</h3><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_predicateFactory.png" alt=""></p><p>æ¥ä¸‹æ¥è®¨è®ºå‡ ä¸ª Route Predicate Factory</p><h4 id="After-Route-Predicate"><a href="#After-Route-Predicate" class="headerlink" title="After Route Predicate"></a><strong>After Route Predicate</strong></h4><p>åœ¨è¿™ä¸ªæ—¶é—´ä¹‹åè¿™ä¸ªè·¯ç”±æ‰ç”Ÿæ•ˆ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">After=2024-01-03T19:53:19.185+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶é—´é€šè¿‡ä»¥ä¸‹ä»£ç äº§ç”Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ZonedDateTime</span> <span class="variable">now</span> <span class="operator">=</span> ZonedDateTime.now();</span><br><span class="line">        System.out.println(now);</span><br><span class="line">        <span class="comment">//2022-01-03T18:53:19.185+08:00[Asia/Shanghai]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šè®¿é—®æŠ¥é”™</p><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_after.png" alt=""></p><h4 id="Before-Route-Predicate"><a href="#Before-Route-Predicate" class="headerlink" title="Before Route Predicate"></a><strong>Before Route Predicate</strong></h4><p>åœ¨è¿™ä¸ªæ—¶é—´ä¹‹å‰è¿™ä¸ªè·¯ç”±æ‰ç”Ÿæ•ˆ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Before=2024-01-03T19:53:19.185+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><h4 id="Between-Route-Predicate"><a href="#Between-Route-Predicate" class="headerlink" title="Between Route Predicate"></a><strong>Between Route Predicate</strong></h4><p>åœ¨è¿™ä¸ªæ—¶é—´ä¹‹é—´è·¯ç”±ç”Ÿæ•ˆ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Between=2022-01-03T19:53:19.185+08:00[Asia/Shanghai],2022-01-03T19:53:19.185+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><h4 id="Cookie-Route-Predicate"><a href="#Cookie-Route-Predicate" class="headerlink" title="Cookie Route Predicate"></a><strong>Cookie Route Predicate</strong></h4><p>Cookie Route Predicate éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Cookie nameï¼Œä¸€ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p>è·¯ç”±è§„åˆ™ä¼šé€šè¿‡è·å–å¯¹åº”çš„ Cookie name å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šå°±ä¼šæ‰§è¡Œè·¯ç”±ï¼›å¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™ä¸æ‰§è¡Œ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Cookie=username,jcvv</span></span><br></pre></td></tr></table></figure><p>ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9527/payment/get/2 --cookie &quot;username=jcvv&quot;</span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_prdicate_cookie.png" alt=""></p><font color='red'>å¦‚æœä¸å¸¦ cookie è¿›è¡Œè®¿é—®ï¼Œåˆ™æŠ¥é”™</font><h4 id="Header-Route-Predicate"><a href="#Header-Route-Predicate" class="headerlink" title="Header Route Predicate"></a><strong>Header Route Predicate</strong></h4><p>ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><p>é…ç½®è¯´æ˜ï¼šè¯·æ±‚å¤´è¦æœ‰ X-Request-Id å±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9527/payment/get/2 -H &quot;X-Request-Id:123&quot;</span><br></pre></td></tr></table></figure><h4 id="Host-Route-Predicate"><a href="#Host-Route-Predicate" class="headerlink" title="Host Route Predicate"></a><strong>Host Route Predicate</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Host=**.atguigu.org,**.another.org</span></span><br></pre></td></tr></table></figure><p>Host Route Predicate æ¥æ”¶ä¸€ç»„å‚æ•°ï¼Œä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨ã€‚</p><p>å®ƒé€šè¿‡å‚æ•°ä¸­çš„ä¸»æœºåœ°å€ä½œä¸ºåŒ¹é…è§„åˆ™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9527/payment/get/2 -H &quot;Host: news.another.org&quot;</span><br></pre></td></tr></table></figure><h4 id="Method-Route-Predicate"><a href="#Method-Route-Predicate" class="headerlink" title="Method Route Predicate"></a><strong>Method Route Predicate</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Method=GET</span></span><br></pre></td></tr></table></figure><h4 id="Path-Route-Predicate"><a href="#Path-Route-Predicate" class="headerlink" title="Path Route Predicate"></a><strong>Path Route Predicate</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span></span><br></pre></td></tr></table></figure><h4 id="Query-Route-Predicate"><a href="#Query-Route-Predicate" class="headerlink" title="Query Route Predicate"></a><strong>Query Route Predicate</strong></h4><p>æ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å±æ€§åï¼Œä¸€ä¸ªä¸ºå±æ€§å€¼ï¼Œå±æ€§å€¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">predicates:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">Query=username,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><h2 id="6ã€Filter-çš„ä½¿ç”¨"><a href="#6ã€Filter-çš„ä½¿ç”¨" class="headerlink" title="6ã€Filter çš„ä½¿ç”¨"></a>6ã€Filter çš„ä½¿ç”¨</h2><h3 id="6-1ã€æ˜¯ä»€ä¹ˆ"><a href="#6-1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="6-1ã€æ˜¯ä»€ä¹ˆ"></a>6-1ã€æ˜¯ä»€ä¹ˆ</h3><p>è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„ HTTP è¯·æ±‚å’Œè¿”å›çš„ HTTP å“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”± GatewayFilter çš„å·¥å‚ç±»æ¥äº§ç”Ÿã€‚</p><h3 id="6-2ã€Spring-Cloud-Gateway-çš„-Filter"><a href="#6-2ã€Spring-Cloud-Gateway-çš„-Filter" class="headerlink" title="6-2ã€Spring Cloud Gateway çš„ Filter"></a>6-2ã€Spring Cloud Gateway çš„ Filter</h3><h4 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h4><p>pre<br>post</p><h4 id="ç§ç±»"><a href="#ç§ç±»" class="headerlink" title="ç§ç±»"></a>ç§ç±»</h4><p>å…·ä½“çœ‹å®˜æ–¹æ–‡æ¡£</p><ul><li>GatewayFilterï¼šæœ‰ 31 ç§ Spring Cloud Gateway</li><li>GlobalFilterï¼šæœ‰ 10 ç§ Spring Cloud Gateway</li></ul><h4 id="å¸¸ç”¨çš„-GatewayFilter"><a href="#å¸¸ç”¨çš„-GatewayFilter" class="headerlink" title="å¸¸ç”¨çš„ GatewayFilter"></a>å¸¸ç”¨çš„ GatewayFilter</h4><p>AddRequestParameter</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">gateway:</span></span><br><span class="line">            <span class="attr">routes:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span></span><br><span class="line">                  <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">                  <span class="attr">filters:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">AddRequestParameter=X-Request-Id,1024</span> <span class="comment">#è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸ºX-Request-Idå€¼ä¸º1024</span></span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h4><p>2 ä¸ªä¸»è¦æ¥å£ï¼š<code>GlobalFilter,Ordered</code></p><p>èƒ½å¹²å˜›ï¼Ÿ</p><ul><li>å…¨å±€æ—¥å¿—è®°å½•</li><li>ç»Ÿä¸€ç½‘å…³é‰´æƒ</li><li>ã€‚ã€‚ã€‚ã€‚</li></ul><p>è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨é…ç½®ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogGateWayFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;************com in MyLogGateWayFilter:  &quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">uname</span> <span class="operator">=</span> exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆæ³•æ€§æ£€éªŒ</span></span><br><span class="line">        <span class="keyword">if</span>(uname==<span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;************ç”¨æˆ·åä¸ºnull, éæ³•ç”¨æˆ·, o(T~~T)o&quot;</span>);</span><br><span class="line">            <span class="comment">//è®¾ç½® response çŠ¶æ€ç  406</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="comment">//å®Œæˆè¯·æ±‚è°ƒç”¨</span></span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å€¼æ˜¯åŠ è½½é¡ºåºï¼Œä¸€èˆ¬å…¨å±€çš„éƒ½æ˜¯ç¬¬ä¸€ä½åŠ è½½</span></span><br><span class="line">    <span class="comment">//è¿™ä¸ªè¿”å›çš„æ•°å€¼è¶Šå°ï¼Œä¸Šé¢çš„filterä¼˜å…ˆçº§å°±è¶Šé«˜</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/16getway_filteræµ‹è¯•.png" alt=""></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Config%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" title="Configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ">Configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</title>
      <link href="/2023/06/12/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"/>
      <url>/2023/06/12/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/</url>
      
        <content type="html"><![CDATA[<h1 id="Nacos-æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"><a href="#Nacos-æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ" class="headerlink" title="Nacos æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ"></a>Nacos æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</h1><h2 id="1ã€SpringCloud-Alibaba-ç®€ä»‹"><a href="#1ã€SpringCloud-Alibaba-ç®€ä»‹" class="headerlink" title="1ã€SpringCloud Alibaba ç®€ä»‹"></a>1ã€SpringCloud Alibaba ç®€ä»‹</h2><h3 id="1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°-SpringCloud-alibaba"><a href="#1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°-SpringCloud-alibaba" class="headerlink" title="1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç° SpringCloud alibaba"></a>1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç° SpringCloud alibaba</h3><p>Spring Cloud Netflix é¡¹ç›®è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼š</p><p><a href="https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now">https://spring.io/blog/2018/12/12/spring-cloud-greenwich-rc1-available-now</a><br><img src="https://picbed.jnchan.top/springcloudImages/20springcloud_alibaba.png" alt=""></p><h4 id="ä»€ä¹ˆæ˜¯ç»´æŠ¤æ¨¡å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç»´æŠ¤æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç»´æŠ¤æ¨¡å¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç»´æŠ¤æ¨¡å¼ï¼Ÿ</h4><p>å°†æ¨¡å—ç½®äºç»´æŠ¤æ¨¡å¼ï¼Œæ„å‘³ç€ Spring Cloud å›¢é˜Ÿå°†ä¸ä¼šå†å‘æ¨¡å—æ·»åŠ æ–°åŠŸèƒ½ã€‚æˆ‘ä»¬å°†ä¿®å¤ block çº§åˆ«çš„ bug ä»¥åŠå®‰å…¨é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘å¹¶å®¡æŸ¥ç¤¾åŒºçš„å°å‹ pull requestã€‚</p><h4 id="è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ"></a>è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ</h4><p>è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„å‘³ç€ Spring Cloud Netflix å°†ä¸å†å¼€å‘æ–°çš„ç»„ä»¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ Spring Cloud ç‰ˆæœ¬è¿­ä»£ç®—æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œå› è€Œå‡ºç°äº†å¾ˆå¤šé‡å¤§ ISSUE éƒ½è¿˜æ¥ä¸åŠ Fix å°±åˆæ¨å¦ä¸€ä¸ª Release äº†ã€‚è¿›å…¥ç»´æŠ¤æ¨¡å¼æ„æ€å°±æ˜¯ç›®å‰ä¸€ç›´ä»¥åä¸€æ®µæ—¶é—´ Spring Cloud Netflix æä¾›çš„æœåŠ¡å’ŒåŠŸèƒ½å°±è¿™ä¹ˆå¤šäº†ï¼Œä¸åœ¨å¼€å‘æ–°çš„ç»„ä»¶å’ŒåŠŸèƒ½äº†ã€‚ä»¥åå°†ä»¥ç»´æŠ¤å’Œ Merge åˆ†æ”¯ Full Request ä¸ºä¸»ã€‚</p><p>æ–°ç»„ä»¶åŠŸèƒ½å°†ä»¥å…¶ä»–æ›¿ä»£å¹³ä»£æ›¿çš„æ–¹å¼å®ç°</p><h3 id="1-2ã€SpringCloud-alibaba-å¸¦æ¥äº†ä»€ä¹ˆ"><a href="#1-2ã€SpringCloud-alibaba-å¸¦æ¥äº†ä»€ä¹ˆ" class="headerlink" title="1-2ã€SpringCloud alibaba å¸¦æ¥äº†ä»€ä¹ˆ"></a>1-2ã€SpringCloud alibaba å¸¦æ¥äº†ä»€ä¹ˆ</h3><h4 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h4><p>å®˜ç½‘ï¼š<a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p><p>è¯ç”Ÿï¼š2018.10.31ï¼ŒSpring Cloud Alibaba æ­£å¼å…¥é©»äº† Spring Cloud å®˜æ–¹å­µåŒ–å™¨ï¼Œå¹¶åœ¨ Maven ä¸­å¤®åº“å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬</p><p><img src="https://picbed.jnchan.top/springcloudImages/20springcloud_alibaba2.png" alt=""></p><h4 id="èƒ½å¹²å˜›"><a href="#èƒ½å¹²å˜›" class="headerlink" title="èƒ½å¹²å˜›"></a>èƒ½å¹²å˜›</h4><ul><li>æœåŠ¡é™æµé™çº§ï¼šé»˜è®¤æ”¯æŒ Servletã€Feignã€RestTemplateã€Dubbo å’Œ RocketMQ é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚</li><li>æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒ</li><li>åˆ†å¸ƒå¼é…ç½®ç®¡ç†ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li><li>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</li><li>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li><li>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚</li><li>é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚</li></ul><h4 id="å»å“ªä¸‹"><a href="#å»å“ªä¸‹" class="headerlink" title="å»å“ªä¸‹"></a>å»å“ªä¸‹</h4><p><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p><h4 id="æ€ä¹ˆç©"><a href="#æ€ä¹ˆç©" class="headerlink" title="æ€ä¹ˆç©"></a>æ€ä¹ˆç©</h4><p><img src="https://picbed.jnchan.top/springcloudImages/20springcloud_alibaba3.png" alt=""></p><h3 id="1-3ã€SpringCloud-alibaba-å­¦ä¹ èµ„æ–™è·å–"><a href="#1-3ã€SpringCloud-alibaba-å­¦ä¹ èµ„æ–™è·å–" class="headerlink" title="1-3ã€SpringCloud alibaba å­¦ä¹ èµ„æ–™è·å–"></a>1-3ã€SpringCloud alibaba å­¦ä¹ èµ„æ–™è·å–</h3><p>å®˜ç½‘ï¼š<a href="https://spring.io/projects/spring-cloud-alibaba#overview">https://spring.io/projects/spring-cloud-alibaba#overview</a></p><p>Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨å¾®æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚ä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œå¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚</p><p>SpringCloud Alibaba è¿›å…¥äº† SpringCloud å®˜æ–¹å­µåŒ–å™¨ï¼Œè€Œä¸”æ¯•ä¸šäº†</p><p>è‹±æ–‡ï¼š</p><ul><li><p><a href="https://github.com/alibaba/spring-cloud-alibaba">https://github.com/alibaba/spring-cloud-alibaba</a></p></li><li><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html</a></p></li></ul><p>ä¸­æ–‡ï¼š</p><ul><li><a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></li></ul><h2 id="2ã€Nacos-ç®€ä»‹"><a href="#2ã€Nacos-ç®€ä»‹" class="headerlink" title="2ã€Nacos ç®€ä»‹"></a>2ã€Nacos ç®€ä»‹</h2><h3 id="2-1ã€ä¸ºä»€ä¹ˆå«-Nacos"><a href="#2-1ã€ä¸ºä»€ä¹ˆå«-Nacos" class="headerlink" title="2-1ã€ä¸ºä»€ä¹ˆå« Nacos"></a>2-1ã€ä¸ºä»€ä¹ˆå« Nacos</h3><p>å‰å››ä¸ªå­—æ¯åˆ†åˆ«ä¸º Naming å’Œ Configuration çš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œæœ€åçš„ s ä¸º Service</p><ul><li>Nacos: Dynamic Naming and Configuration Service</li></ul><h3 id="2-2ã€æ˜¯ä»€ä¹ˆ"><a href="#2-2ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="2-2ã€æ˜¯ä»€ä¹ˆ"></a>2-2ã€æ˜¯ä»€ä¹ˆ</h3><p>Nacos: Dynamic Naming and Configuration Service ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°</p><p>Nacos å°±æ˜¯æ³¨å†Œä¸­å¿ƒ + é…ç½®ä¸­å¿ƒçš„ç»„åˆ Nacos = Eureka+Config +Bus</p><h3 id="2-3ã€èƒ½å¹²å˜›"><a href="#2-3ã€èƒ½å¹²å˜›" class="headerlink" title="2-3ã€èƒ½å¹²å˜›"></a>2-3ã€èƒ½å¹²å˜›</h3><ul><li>æ›¿ä»£ Eureka åšæœåŠ¡æ³¨å†Œä¸­å¿ƒ</li><li>æ›¿ä»£ Config åšæœåŠ¡é…ç½®ä¸­å¿ƒ</li></ul><h3 id="2-4ã€å»å“ªä¸‹"><a href="#2-4ã€å»å“ªä¸‹" class="headerlink" title="2-4ã€å»å“ªä¸‹"></a>2-4ã€å»å“ªä¸‹</h3><p><a href="https://github.com/alibaba/Nacos">https://github.com/alibaba/Nacos</a></p><p>å®˜ç½‘æ–‡æ¡£ï¼š</p><ul><li><a href="https://nacos.io/zh-cn/index.html">https://nacos.io/zh-cn/index.html</a></li><li><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</a></li></ul><h3 id="2-5ã€å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ"><a href="#2-5ã€å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ" class="headerlink" title="2-5ã€å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ"></a>2-5ã€å„ç§æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ</h3><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_1.png" alt=""></p><p>æ®è¯´ Nacos åœ¨é˜¿é‡Œå·´å·´å†…éƒ¨æœ‰è¶…è¿‡ 10 ä¸‡çš„å®ä¾‹è¿è¡Œï¼Œå·²ç»è¿‡äº†ç±»ä¼¼åŒåä¸€ç­‰å„ç§å¤§å‹æµé‡çš„è€ƒéªŒ</p><h3 id="2-6ã€å›å¿†ä¸€ä¸‹-CAP-æ¨¡å‹"><a href="#2-6ã€å›å¿†ä¸€ä¸‹-CAP-æ¨¡å‹" class="headerlink" title="2-6ã€å›å¿†ä¸€ä¸‹ CAP æ¨¡å‹"></a>2-6ã€å›å¿†ä¸€ä¸‹ CAP æ¨¡å‹</h3><ul><li>Cï¼šConsistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰</li><li>Aï¼šAvailabilityï¼ˆå¯ç”¨æ€§ï¼‰</li><li>Pï¼šPartition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</li></ul><p>CAP ç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ï¼Œå› æ­¤ï¼Œæ ¹æ® CAP åŸç†å°† NoSQL æ•°æ®åº“åˆ†æˆäº†æ»¡è¶³ CA åŸåˆ™ã€æ»¡è¶³ CP åŸåˆ™å’Œæ»¡è¶³ AP åŸåˆ™ä¸‰å¤§ç±»ï¼š</p><ul><li><p>CA - å•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¤ªå¼ºå¤§</p></li><li><p>CP - æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹å¿å¿…çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«é«˜</p></li><li>AP - æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸å¯èƒ½å¯¹ä¸€è‡´æ€§è¦æ±‚ä½ä¸€äº›</li></ul><h4 id="AP-æ¶æ„-Eureka-Nacos-ï¼š"><a href="#AP-æ¶æ„-Eureka-Nacos-ï¼š" class="headerlink" title="AP æ¶æ„(Eureka/Nacos)ï¼š"></a>AP æ¶æ„(Eureka/Nacos)ï¼š</h4><p>å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼Œç³»ç»Ÿ B å¯ä»¥è¿”å›æ—§å€¼ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p>ç»“è®ºï¼šè¿èƒŒäº†ä¸€è‡´æ€§ C çš„è¦æ±‚ï¼Œåªæ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ AP<br><img src="https://picbed.jnchan.top/springcloudImages/20nacos_2.png" alt=""></p><h4 id="CP-Zookeeper-Consul"><a href="#CP-Zookeeper-Consul" class="headerlink" title="CP(Zookeeper/Consul)"></a>CP(Zookeeper/Consul)</h4><p>CP æ¶æ„ï¼š</p><p>å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»æ‹’æ¥è¯·æ±‚ï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸€è‡´æ€§</p><p>ç»“è®ºï¼šè¿èƒŒäº†å¯ç”¨æ€§ A çš„è¦æ±‚ï¼Œåªæ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ CP</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_3.png" alt=""></p><h2 id="3ã€å®‰è£…å¹¶è¿è¡Œ-Nacos"><a href="#3ã€å®‰è£…å¹¶è¿è¡Œ-Nacos" class="headerlink" title="3ã€å®‰è£…å¹¶è¿è¡Œ Nacos"></a>3ã€å®‰è£…å¹¶è¿è¡Œ Nacos</h2><p>æœ¬åœ° Java8+Maven ç¯å¢ƒå·²ç» OK</p><p>å…ˆä»å®˜ç½‘ä¸‹è½½ Nacosï¼š<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>è§£å‹å®‰è£…åŒ…ï¼Œå¯åŠ¨çš„æ—¶å€™ä¸èƒ½ç›´æ¥åŒå‡» bin ç›®å½•ä¸‹çš„ startup.cmdï¼Œæˆ‘ä»¬è¦é€šè¿‡ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºæ˜¯å•æœºå¯åŠ¨ï¼Œä¸æ˜¯é›†ç¾¤ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ Windows ä¸‹ä¿®æ”¹/nacos/bin ç›®å½•ä¸‹çš„ startup.cmd è„šæœ¬æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set MODE=<span class="string">&quot;cluster&quot;</span> ä¿®æ”¹ä¸º set MODE=<span class="string">&quot;standalone&quot;</span></span><br></pre></td></tr></table></figure><p>å³å¯å®ç° Nacos çš„å•æœºå¯åŠ¨ï¼Œä»¥åç›´æ¥åŒå‡» bin ç›®å½•ä¸‹çš„ startup.cmd å³å¯ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_ä¿®æ”¹é…ç½®æ–‡ä»¶.png" alt=""></p><p>å‘½ä»¤è¿è¡ŒæˆåŠŸåç›´æ¥è®¿é—®ï¼š<a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a> é»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯ nacos</p><h2 id="4ã€Nacos-ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"><a href="#4ã€Nacos-ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="4ã€Nacos ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"></a>4ã€Nacos ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º</h2><h3 id="4-1ã€åŸºäº-Nacos-çš„æœåŠ¡æä¾›è€…-9001"><a href="#4-1ã€åŸºäº-Nacos-çš„æœåŠ¡æä¾›è€…-9001" class="headerlink" title="4-1ã€åŸºäº Nacos çš„æœåŠ¡æä¾›è€… 9001"></a>4-1ã€åŸºäº Nacos çš„æœåŠ¡æä¾›è€… 9001</h3><p>æ–°å»º Moduleï¼šcloudalibaba-provider-payment9001</p><h4 id="çˆ¶-pom-å¢åŠ ï¼š"><a href="#çˆ¶-pom-å¢åŠ ï¼š" class="headerlink" title="çˆ¶ pom å¢åŠ ï¼š"></a>çˆ¶ pom å¢åŠ ï¼š</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‡Œé¢å®šä¹‰äº†æ¥ä¸‹æ¥ä½ æ‰€ä½¿ç”¨çš„ç»„ä»¶ç‰ˆæœ¬å·</p><h4 id="æœ¬æ¨¡å—-pomï¼š"><a href="#æœ¬æ¨¡å—-pomï¼š" class="headerlink" title="æœ¬æ¨¡å— pomï¼š"></a>æœ¬æ¨¡å— pomï¼š</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-provider-payment9001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#nacosåœ°å€</span></span><br><span class="line"><span class="comment"># springboot ç›‘æ§ Actuator çš„è®¾ç½®ï¼Œæš´éœ²æ‰€æœ‰ç«¯ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain9001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/25 17:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-å±‚"><a href="#controller-å±‚" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/25 17:36</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;nacos registry, serverPort: &quot;</span> + serverPort + <span class="string">&quot;\t id&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>nacos æ§åˆ¶å°ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_test.png" alt=""></p><p>nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒ+æœåŠ¡æä¾›è€… 9001 éƒ½ OK äº†</p><p>ä¸ºäº†ä¸‹ä¸€ç« èŠ‚æ¼”ç¤º nacos çš„è´Ÿè½½å‡è¡¡ï¼Œå‚ç…§ 9001 æ–°å»º 9002ï¼Œæ–°å»º cloudalibaba-provider-payment9002</p><p>æˆ–è€…å–å·§ä¸æƒ³æ–°å»ºé‡å¤ä½“åŠ›åŠ³åŠ¨ï¼Œç›´æ¥æ‹·è´è™šæ‹Ÿç«¯å£æ˜ å°„</p><h3 id="4-2ã€åŸºäº-Nacos-çš„æœåŠ¡æ¶ˆè´¹è€…-83"><a href="#4-2ã€åŸºäº-Nacos-çš„æœåŠ¡æ¶ˆè´¹è€…-83" class="headerlink" title="4-2ã€åŸºäº Nacos çš„æœåŠ¡æ¶ˆè´¹è€… 83"></a>4-2ã€åŸºäº Nacos çš„æœåŠ¡æ¶ˆè´¹è€… 83</h3><p>æ–°å»º Moduleï¼šcloudalibaba-consumer-nacos-order83</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-consumer-nacos-order83<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#nacosåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">    <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»-1"><a href="#ä¸»å¯åŠ¨ç±»-1" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderNacosMain83</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/26 10:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderNacosMain83</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderNacosMain83.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="config-ç±»"><a href="#config-ç±»" class="headerlink" title="config ç±»"></a>config ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/26 10:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextBean</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-å±‚-1"><a href="#controller-å±‚-1" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/26 10:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.nacos-user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverURL;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverURL + <span class="string">&quot;/payment/nacos/&quot;</span> + id, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡çš„è°ƒç”¨ nacos-payment-provider æœåŠ¡</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_æµ‹è¯•1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_æµ‹è¯•2.png" alt=""></p><h3 id="4-3ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”-â­"><a href="#4-3ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”-â­" class="headerlink" title="4-3ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯” â­"></a>4-3ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯” â­</h3><p>Nacos å…¨æ™¯å›¾æ‰€ç¤º</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_å…¨æ™¯å›¾.png" alt=""></p><p>Nacos ä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒç‰¹æ€§å¯¹æ¯”</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_æ”¯æŒç±»å‹.png" alt=""></p><p>Nacos æœåŠ¡å‘ç°å®ä¾‹æ¨¡å‹</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_å®ä¾‹æ¨¡å‹.png" alt=""></p><p><strong>Nacos æ”¯æŒ AP å’Œ CP æ¨¡å¼çš„åˆ‡æ¢</strong></p><p>C æ˜¯æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼›è€Œ A çš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”</p><p><strong>ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼ï¼Ÿ</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡ nacos-client æ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹© AP æ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚ Spring cloud å’Œ Dubbo æœåŠ¡ï¼Œéƒ½é€‚ç”¨äº AP æ¨¡å¼ï¼ŒAP æ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤<font color='red'><strong>AP æ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚</strong></font></p><p>å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ï¼ŒK8S æœåŠ¡å’Œ DNS æœåŠ¡åˆ™é€‚ç”¨äº CP æ¨¡å¼ã€‚CP æ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p><p><strong>åˆ‡æ¢å‘½ä»¤ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT <span class="string">&#x27;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CP&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="5ã€Nacos-ä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"><a href="#5ã€Nacos-ä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="5ã€Nacos ä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"></a>5ã€Nacos ä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º</h2><h3 id="5-1ã€Nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ-3377-åŸºç¡€é…ç½®"><a href="#5-1ã€Nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ-3377-åŸºç¡€é…ç½®" class="headerlink" title="5-1ã€Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ 3377-åŸºç¡€é…ç½®"></a>5-1ã€Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ 3377-åŸºç¡€é…ç½®</h3><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-config-nacos-client3377<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- ä»¥ nacos åšæœåŠ¡é…ç½®ä¸­å¿ƒçš„ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springbootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¸¤ä¸ª ymlï¼Œä¸ºä»€ä¹ˆé…ç½®ä¸¤ä¸ªï¼Ÿ</strong></p><p>Nacos åŒ springcloud-config ä¸€æ ·ï¼Œåœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–ï¼Œæ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ã€‚</p><p>springboot ä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œbootstrap ä¼˜å…ˆçº§é«˜äº application</p><h4 id="bootstrap-yml"><a href="#bootstrap-yml" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">                <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span></span><br><span class="line">        <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»-2"><a href="#ä¸»å¯åŠ¨ç±»-2" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> NacosConfigMain3377</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/26 14:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigMain3377</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(NacosConfigMain3377.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚-2"><a href="#controller-å±‚-2" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><p>é€šè¿‡ Spring Cloud åŸç”Ÿæ³¨è§£ <code>@RefreshScope</code> å®ç°é…ç½®è‡ªåŠ¨åˆ·æ–°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.context.config.annotation.RefreshScope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ConfigClientController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/26 14:14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">//æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2ã€åœ¨-Nacos-ä¸­æ·»åŠ é…ç½®ä¿¡æ¯"><a href="#5-2ã€åœ¨-Nacos-ä¸­æ·»åŠ é…ç½®ä¿¡æ¯" class="headerlink" title="5-2ã€åœ¨ Nacos ä¸­æ·»åŠ é…ç½®ä¿¡æ¯"></a>5-2ã€åœ¨ Nacos ä¸­æ·»åŠ é…ç½®ä¿¡æ¯</h3><h4 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a><strong>ç†è®º</strong></h4><p>nacos ä¸­çš„ dataid çš„ç»„æˆæ ¼å¼åŠä¸ springboot é…ç½®æ–‡ä»¶ä¸­çš„åŒ¹é…è§„åˆ™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure><ul><li>prefix é»˜è®¤ä¸º spring.application.name çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.prefix æ¥é…ç½®</li><li>spring.profiles.active å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ Spring Boot æ–‡æ¡£ã€‚ æ³¨æ„ï¼šå½“ spring.profiles.active ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„è¿æ¥ç¬¦ - ä¹Ÿå°†ä¸å­˜åœ¨ï¼ŒdataId çš„æ‹¼æ¥æ ¼å¼å˜æˆ ${prefix}.${file-extension}</li><li>file-exetension ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.file-extension æ¥é…ç½®ã€‚ç›®å‰åªæ”¯æŒ properties å’Œ yaml ç±»å‹ï¼ˆæ³¨æ„ nacos é‡Œå¿…é¡»ä½¿ç”¨ yamlï¼‰</li></ul><p>æœ€åå…¬å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span><br></pre></td></tr></table></figure><h4 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a><strong>å®æ“</strong></h4><p>é…ç½®æ–°å¢ï¼šnacos-config-client-dev.yaml</p><blockquote><p>config:</p><p>info: â€œconfig info for dev,from nacos config center. version=v1.1â€</p></blockquote><p><img src="https://picbed.jnchan.top/springcloudImages/20nacosæ–°å»ºé…ç½®.png" alt=""></p><p>å†å²é…ç½®ï¼šNacos ä¼šè®°å½•é…ç½®æ–‡ä»¶çš„å†å²ç‰ˆæœ¬é»˜è®¤ä¿ç•™ 30 å¤©ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€é”®å›æ»šåŠŸèƒ½</p><h4 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a><strong>æµ‹è¯•</strong></h4><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_configinfo.png" alt=""></p><p>å½“ä¿®æ”¹é…ç½®å€¼ï¼Œä¼šå‘ç° 3377 ä¸Šä¹Ÿå·²ç»ä¿®æ”¹ï¼Œ<font color='red'><strong>Nacos è‡ªå¸¦è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼</strong></font></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_configinfo2.png" alt=""></p><h3 id="5-3ã€Nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®"><a href="#5-3ã€Nacos-ä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®" class="headerlink" title="5-3ã€Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®"></a>5-3ã€Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ-åˆ†ç±»é…ç½®</h3><h4 id="é—®é¢˜â€”â€”å¤šç¯å¢ƒå¤šé¡¹ç›®ç®¡ç†"><a href="#é—®é¢˜â€”â€”å¤šç¯å¢ƒå¤šé¡¹ç›®ç®¡ç†" class="headerlink" title="é—®é¢˜â€”â€”å¤šç¯å¢ƒå¤šé¡¹ç›®ç®¡ç†"></a>é—®é¢˜â€”â€”å¤šç¯å¢ƒå¤šé¡¹ç›®ç®¡ç†</h4><p>é—®é¢˜ 1ï¼š</p><p>å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¸€ä¸ªç³»ç»Ÿä¼šå‡†å¤‡ï¼šdev å¼€å‘ç¯å¢ƒã€test æµ‹è¯•ç¯å¢ƒã€prod ç”Ÿäº§ç¯å¢ƒï¼Œå¦‚ä½•ä¿è¯æŒ‡å®šç¯å¢ƒå¯åŠ¨æ—¶æœåŠ¡èƒ½æ­£ç¡®è¯»å–åˆ° Nacos ä¸Šç›¸åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ</p><p>é—®é¢˜ 2ï¼š</p><p>ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿä¼šæœ‰å¾ˆå¤šå¾®æœåŠ¡å­é¡¹ç›®ï¼Œæ¯ä¸ªå¾®æœåŠ¡é¡¹ç›®åˆéƒ½ä¼šæœ‰ç›¸åº”çš„å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æ­£å¼ç¯å¢ƒâ€¦é‚£æ€ä¹ˆå¯¹è¿™äº›å¾®æœåŠ¡é…ç½®è¿›è¡Œç®¡ç†å‘¢ï¼Ÿ</p><h4 id="Nacos-çš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢"><a href="#Nacos-çš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢" class="headerlink" title="Nacos çš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢"></a>Nacos çš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢</h4><p>å‘½åç©ºé—´ï¼š<br><img src="https://picbed.jnchan.top/springcloudImages/20nacos_å‘½åç©ºé—´.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_å‘½åç©ºé—´2.png" alt=""></p><h4 id="Namespace-Group-Data-ID-ä¸‰è€…å…³ç³»ï¼Ÿ"><a href="#Namespace-Group-Data-ID-ä¸‰è€…å…³ç³»ï¼Ÿ" class="headerlink" title="Namespace+Group+Data ID ä¸‰è€…å…³ç³»ï¼Ÿ"></a><strong>Namespace+Group+Data ID ä¸‰è€…å…³ç³»ï¼Ÿ</strong></h4><p>æ€è€ƒï¼šä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Ÿ</p><p><strong>â‘  æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>ç±»ä¼¼ Java é‡Œé¢çš„ package åå’Œç±»åï¼Œæœ€å¤–å±‚çš„ namespace æ˜¯å¯ä»¥ç”¨äºåŒºåˆ†éƒ¨ç½²ç¯å¢ƒçš„ï¼ŒGroup å’Œ DataID é€»è¾‘ä¸ŠåŒºåˆ†ä¸¤ä¸ªç›®æ ‡å¯¹è±¡</p><p><strong>â‘¡ ä¸‰è€…æƒ…å†µ</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_å‘½åç©ºé—´3.png" alt=""></p><p><strong>â‘¢ é»˜è®¤æƒ…å†µ</strong></p><p>Namespace=publicï¼ŒGroup=DEFAULT_GROUPï¼Œé»˜è®¤ Cluster æ˜¯ DEFAULT</p><p>Nacos é»˜è®¤çš„å‘½åç©ºé—´æ˜¯ publicï¼›Namespace ä¸»è¦ç”¨æ¥å®ç°éš”ç¦»</p><ul><li>æ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç¯å¢ƒï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ª Namespaceï¼Œä¸åŒçš„ Namespace ä¹‹é—´æ˜¯éš”ç¦»çš„</li></ul><p>Group é»˜è®¤æ˜¯ DEFAULT_GROUPï¼ŒGroup å¯ä»¥æŠŠä¸åŒçš„å¾®æœåŠ¡åˆ’åˆ†åˆ°åŒä¸€ä¸ªåˆ†ç»„é‡Œé¢å»</p><p>Service å°±æ˜¯å¾®æœåŠ¡ï¼›ä¸€ä¸ª Service å¯ä»¥åŒ…å«å¤šä¸ª Clusterï¼ˆé›†ç¾¤ï¼‰ï¼ŒNacos é»˜è®¤ Cluster æ˜¯ DEFAULTï¼ŒCluster æ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ã€‚</p><ul><li>æ¯”æ–¹è¯´ä¸ºäº†å®¹ç¾ï¼Œå°† Service å¾®æœåŠ¡åˆ†åˆ«éƒ¨ç½²åœ¨äº†æ­å·æœºæˆ¿å’Œå¹¿å·æœºæˆ¿ï¼Œè¿™æ—¶å°±å¯ä»¥ç»™æ­å·æœºæˆ¿çš„ Service å¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆHZï¼‰ï¼Œç»™å¹¿å·æœºæˆ¿çš„ Service å¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆGZï¼‰ï¼Œè¿˜å¯ä»¥å°½é‡è®©åŒä¸€ä¸ªæœºæˆ¿çš„å¾®æœåŠ¡äº’ç›¸è°ƒç”¨ï¼Œä»¥æå‡æ€§èƒ½ã€‚</li></ul><p>æœ€åæ˜¯ Instanceï¼Œå°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹</p><h4 id="ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®-Case"><a href="#ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®-Case" class="headerlink" title="ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½® Case"></a>ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½® Case</h4><p><strong>â‘  DataID æ–¹æ¡ˆï¼ˆå°±æ˜¯ nacos çš„æ–‡ä»¶åï¼‰ï¼š</strong></p><ul><li>æŒ‡å®š spring.profile.active å’Œé…ç½®æ–‡ä»¶çš„ DataID æ¥ä½¿ä¸åŒç¯å¢ƒä¸‹è¯»å–ä¸åŒçš„é…ç½®</li><li>é»˜è®¤ç©ºé—´+é»˜è®¤åˆ†ç»„+æ–°å»º dev å’Œ test ä¸¤ä¸ª DataID</li><li>æ–°å»º test é…ç½® DataIDï¼šnacos-config-client-test.yaml</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_config.png" alt=""></p><p><strong>â‘¡ Group æ–¹æ¡ˆï¼ˆé»˜è®¤ DEFAULT_GROUPï¼‰ï¼š</strong></p><ul><li>é€šè¿‡ Group å®ç°ç¯å¢ƒåŒºåˆ†ï¼Œæ–°å»º Groupï¼šTEST_GROUP</li><li>Data IDï¼šnacos-config-client-dev.yaml ä¸å˜</li><li>yml æ·»åŠ åˆ†ç»„åç§°</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_testgroup.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_testgroup_xml.png" alt=""></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8848</span> <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">                <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br><span class="line">                <span class="attr">group:</span> <span class="string">TEST_GROUP</span></span><br><span class="line"><span class="comment">#$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br><span class="line"><span class="comment"># nacos-config-client-dev.yaml</span></span><br></pre></td></tr></table></figure><p><strong>â‘¢ Namespace æ–¹æ¡ˆï¼ˆé»˜è®¤ publicï¼‰ï¼š</strong></p><ul><li>é€šè¿‡ Namespace å®ç°ç¯å¢ƒåŒºåˆ†ï¼Œæ–°å»º dev/test çš„ Namespace</li><li>Data IDï¼šnacos-config-client-dev.yaml ä¸å˜ï¼Œåˆ†ç»„é»˜è®¤</li><li>yml æ·»åŠ å‘½åç©ºé—´çš„ id</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_namespace.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_namespace2.png" alt=""></p><h2 id="5ã€Nacos-é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"><a href="#5ã€Nacos-é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®" class="headerlink" title="5ã€Nacos é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"></a>5ã€Nacos é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®</h2><h3 id="5-1ã€å®˜ç½‘è¯´æ˜"><a href="#5-1ã€å®˜ç½‘è¯´æ˜" class="headerlink" title="5-1ã€å®˜ç½‘è¯´æ˜"></a>5-1ã€å®˜ç½‘è¯´æ˜</h3><p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_é›†ç¾¤éƒ¨ç½²æ¶æ„å›¾.png" alt=""></p><p>ä¸Šå›¾å®˜ç½‘ç¿»è¯‘ï¼ŒçœŸå®æƒ…å†µ</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_é›†ç¾¤éƒ¨ç½²æ¶æ„å›¾2.png" alt=""></p><p>å®˜ç½‘è¯´æ˜ï¼š<a href="https://nacos.io/zh-cn/docs/deployment.html">https://nacos.io/zh-cn/docs/deployment.html</a></p><p>é»˜è®¤ Nacos ä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®ä¸‹çš„ Nacos èŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacos é‡‡ç”¨äº†é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ¥æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²ï¼Œç›®å‰åªæ”¯æŒ MySQL çš„å­˜å‚¨ã€‚</p><p>æŒ‰ç…§ä¸Šè¿°ï¼Œæˆ‘ä»¬éœ€è¦ mysql æ•°æ®åº“</p><p>Nacos æ”¯æŒä¸‰ç§éƒ¨ç½²æ¨¡å¼</p><ul><li>å•æœºæ¨¡å¼-ç”¨äºæµ‹è¯•å’Œå•æœºè¯•ç”¨ã€‚</li><li>é›†ç¾¤æ¨¡å¼-ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿é«˜å¯ç”¨ã€‚</li><li>å¤šé›†ç¾¤æ¨¡å¼-ç”¨äºå¤šæ•°æ®ä¸­å¿ƒåœºæ™¯ã€‚</li></ul><h3 id="5-2ã€Nacos-æŒä¹…åŒ–é…ç½®è§£é‡Š"><a href="#5-2ã€Nacos-æŒä¹…åŒ–é…ç½®è§£é‡Š" class="headerlink" title="5-2ã€Nacos æŒä¹…åŒ–é…ç½®è§£é‡Š"></a>5-2ã€Nacos æŒä¹…åŒ–é…ç½®è§£é‡Š</h3><p>Nacos é»˜è®¤è‡ªå¸¦çš„æ˜¯åµŒå…¥å¼æ•°æ®åº“ derby</p><p>derby åˆ° mysql åˆ‡æ¢é…ç½®æ­¥éª¤ï¼š</p><ul><li>nacos-server-1.1.4\nacos\conf ç›®å½•ä¸‹æ‰¾åˆ° sql è„šæœ¬ï¼Œæ‰§è¡Œ nacos-mysql.sql</li><li>ä¿®æ”¹ nacos/conf/application.properties æ–‡ä»¶(åˆ‡æ¢æ•°æ®åº“)ï¼Œå¢åŠ æ”¯æŒ mysql æ•°æ®æºé…ç½®ï¼ˆç›®å‰åªæ”¯æŒ mysqlï¼‰ï¼Œæ·»åŠ  mysql æ•°æ®æºçš„ urlã€ç”¨æˆ·åå’Œå¯†ç </li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢æ•°æ®åº“</span></span><br><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span>=<span class="string">12345</span></span><br></pre></td></tr></table></figure><ul><li>å†ä»¥å•æœºæ¨¡å¼å¯åŠ¨ nacos(é‡å¯)ï¼Œnacos æ‰€æœ‰å†™åµŒå…¥å¼æ•°æ®åº“çš„æ•°æ®éƒ½å†™åˆ°äº† mysql</li></ul><p>å•æœºçš„æ•°æ®åº“éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæˆ‘ä»¬å¾—è®©ä»–ä»¬å…±ç”¨ä¸€ä¸ªæ•°æ®åº“</p><h3 id="5-3ã€Nacos-é›†ç¾¤é…ç½®"><a href="#5-3ã€Nacos-é›†ç¾¤é…ç½®" class="headerlink" title="5-3ã€Nacos é›†ç¾¤é…ç½®"></a>5-3ã€Nacos é›†ç¾¤é…ç½®</h3><p>ç¯å¢ƒå‡†å¤‡ï¼š</p><ul><li>64 bit OS Linux/Unix/Macï¼Œæ¨èä½¿ç”¨ Linux ç³»ç»Ÿã€‚</li><li>64 bit JDK 1.8+ï¼›</li><li>Maven 3.2.x+ï¼›</li><li>3 ä¸ªæˆ– 3 ä¸ªä»¥ä¸Š Nacos èŠ‚ç‚¹æ‰èƒ½æ„æˆé›†ç¾¤ã€‚</li></ul><h4 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h4><p>å¼€å§‹é…ç½®é›†ç¾¤ï¼š</p><ul><li>é¦–å…ˆå¯¹ nacos è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œæ“ä½œå¦‚ä¸Šé¢ä¸€è‡´ã€‚</li><li>ä¿®æ”¹ nacos/conf ä¸‹çš„ cluster.conf æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘Šè¯‰è¿™3ä¸ªé›†ç¾¤ç»“ç‚¹æ˜¯ä¸€ç»„çš„ # ä¸èƒ½å†™127.0.0.1ï¼Œå¿…é¡»æ˜¯linux hostname -ièƒ½å¤Ÿè¯†åˆ«çš„ip</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:3333</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:4444</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span><span class="string">:5555</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ nacos/conf/application.properties æ–‡ä»¶ï¼Œæ·»åŠ è®¾ç½®æˆ‘ä»¬çš„æ•°æ®åº“ä¿¡æ¯</li><li>æ¨¡æ‹Ÿä¸‰å° nacos æœåŠ¡ï¼Œç¼–è¾‘ nacos çš„ startup.sh è„šæœ¬ï¼Œä½¿ä»–èƒ½å¤Ÿæ”¯æŒä¸åŒçš„ç«¯å£å¯åŠ¨å¤šæ¬¡ã€‚</li></ul><p>å¹³æ—¶å•æœºç‰ˆçš„å¯åŠ¨ï¼Œéƒ½æ˜¯./startup.sh å³å¯ã€‚é›†ç¾¤å¯åŠ¨ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥ç±»ä¼¼å…¶å®ƒè½¯ä»¶çš„ shell å‘½ä»¤ï¼Œä¼ é€’ä¸åŒçš„ç«¯å£å·å¯åŠ¨ä¸åŒçš„ nacos å®ä¾‹<br>ä¿®æ”¹å‰ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_é›†ç¾¤ä¿®æ”¹1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_é›†ç¾¤ä¿®æ”¹2.png" alt=""></p><p>ä¿®æ”¹åï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_é›†ç¾¤ä¿®æ”¹3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_é›†ç¾¤ä¿®æ”¹4.png" alt=""></p><h4 id="é‡ç‚¹ä¿®æ”¹"><a href="#é‡ç‚¹ä¿®æ”¹" class="headerlink" title="é‡ç‚¹ä¿®æ”¹"></a>é‡ç‚¹ä¿®æ”¹</h4><p>å› ä¸ºç›®å‰æ˜¯æµ‹è¯•æœåŠ¡å™¨ï¼Œå†…å­˜æ¯”è¾ƒå°ï¼Œè€Œ nacos é»˜è®¤è®¾ç½®åšå¤§ 2g å·¦å³ï¼Œæœ€å° 1g å·¦å³ï¼Œè€Œæˆ‘ä»¬è¦å¯åŠ¨ 3 ä»½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®¾ç½®å†…å­˜é™åˆ¶<br>åŸè®¾ç½®ï¼š<br><code>JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</code><br>ä¿®æ”¹åï¼š<br><code>JAVA_OPT=&quot;$&#123;JAVA_OPT&#125; -server -Xms300m -Xmx300m -Xmn100m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=160m&quot;</code><br>è¿™é‡Œæˆ‘ä»¬è®¾ç½®æœ€å¤§ä¸º 300m æœ€å°ä¸º 100mã€‚å¯æ ¹æ®è‡ªèº«æƒ…å†µè¿›è¡Œè®¾å®šã€‚ å¦‚æœå†…å­˜å¤§çš„è¯·å¿½ç•¥è¯¥ä¿®æ”¹ã€‚</p><p>ä¾æ¬¡æ‰§è¡Œå‘½ä»¤å¯åŠ¨ 3 ä¸ª nacos é›†ç¾¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./startup.sh -p <span class="number">3333</span> è¡¨ç¤ºå¯åŠ¨ç«¯å£å·ä¸º<span class="number">3333</span>çš„nacosæœåŠ¡å™¨å®ä¾‹</span><br><span class="line">./startup.sh -p <span class="number">4444</span></span><br><span class="line">./startup.sh -p <span class="number">5555</span></span><br></pre></td></tr></table></figure><p>å¦‚åƒæˆ‘ä¸€æ ·å‡ºé”™ï¼šidea è¿è¡Œé¡¹ç›® 9002 å‡ºé”™ï¼Œread time outã€‚åˆ™ç”¨ä¸€ä¸‹å‘½ä»¤è¿è¡Œ nacos é›†ç¾¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ./startup.sh -m standalone -p <span class="number">3333</span></span><br><span class="line">sudo ./startup.sh -m standalone -p <span class="number">4444</span></span><br><span class="line">sudo ./startup.sh -m standalone -p <span class="number">5555</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶ï¼Œç”±å®ƒä½œä¸ºè´Ÿè½½å‡è¡¡å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ./nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>nginx.confï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_nginxconfigä¿®æ”¹1.png" alt=""></p><p>æŒ‰ç…§æŒ‡å®šå¯åŠ¨</p><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_nginxconfigä¿®æ”¹2.png" alt=""></p><ul><li><pre><code class="lang-java">./nginx -c /usr/local/nginx/conf/nginx.conf</code></pre></li><li><p>é€šè¿‡ nginx è®¿é—®ï¼š119.3.211.104:8089/nacos/#/login</p></li><li><p>ä½¿ç”¨ 9002 æ¨¡å—æ³¨å†Œè¿› Nacos é›†ç¾¤ï¼Œå¹¶è·å–å®ƒä¸Šé¢é…ç½®æ–‡ä»¶çš„ä¿¡æ¯è¿›è¡Œæµ‹è¯•</p></li></ul><h3 id="5-4ã€é«˜å¯ç”¨å°æ€»ç»“"><a href="#5-4ã€é«˜å¯ç”¨å°æ€»ç»“" class="headerlink" title="5-4ã€é«˜å¯ç”¨å°æ€»ç»“"></a>5-4ã€é«˜å¯ç”¨å°æ€»ç»“</h3><p><img src="https://picbed.jnchan.top/springcloudImages/20nacos_end.png" alt=""></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Sentinel%E5%AE%9E%E7%8E%B0%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81/" title="Sentinelå®ç°ç†”æ–­ä¸é™æµ">Sentinelå®ç°ç†”æ–­ä¸é™æµ</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OpenFeignæœåŠ¡æ¥å£è°ƒç”¨ğŸ˜ğŸ˜</title>
      <link href="/2023/06/12/OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/"/>
      <url>/2023/06/12/OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/</url>
      
        <content type="html"><![CDATA[<h1 id="OpenFeign-æœåŠ¡æ¥å£è°ƒç”¨-ğŸ˜ğŸ˜"><a href="#OpenFeign-æœåŠ¡æ¥å£è°ƒç”¨-ğŸ˜ğŸ˜" class="headerlink" title="OpenFeign æœåŠ¡æ¥å£è°ƒç”¨ ğŸ˜ğŸ˜"></a>OpenFeign æœåŠ¡æ¥å£è°ƒç”¨ ğŸ˜ğŸ˜</h1><h2 id="1ã€OpenFeign-ç®€ä»‹"><a href="#1ã€OpenFeign-ç®€ä»‹" class="headerlink" title="1ã€OpenFeign ç®€ä»‹"></a>1ã€OpenFeign ç®€ä»‹</h2><h3 id="1-1ã€OpenFeign-æ˜¯ä»€ä¹ˆ"><a href="#1-1ã€OpenFeign-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-1ã€OpenFeign æ˜¯ä»€ä¹ˆ"></a>1-1ã€OpenFeign æ˜¯ä»€ä¹ˆ</h3><p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼ WebService å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ Feign èƒ½è®©ç¼–å†™ Web Service å®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚</p><p>å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ï¼ŒFeign ä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ï¼ŒSpring Cloud å¯¹ Feign è¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº† Spring MVC æ ‡å‡†æ³¨è§£å’Œ HttpMessageConvertersï¼ŒFeign å¯ä»¥ä¸ Eureka å’Œ Ribbon ç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</p><p>GitHubï¼š<a href="https://github.com/spring-cloud/spring-cloud-openfeign">https://github.com/spring-cloud/spring-cloud-openfeign</a></p><p>å®˜ç½‘è§£é‡Šï¼š<br><a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign">https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/#spring-cloud-openfeign</a></p><h3 id="1-2ã€èƒ½å¹²å˜›"><a href="#1-2ã€èƒ½å¹²å˜›" class="headerlink" title="1-2ã€èƒ½å¹²å˜›"></a>1-2ã€èƒ½å¹²å˜›</h3><p>Feign æ—¨åœ¨ä½¿ç¼–å†™ Java Http å®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ï¼Œå‰é¢åœ¨ä½¿ç”¨ Ribbon+RestTemplate æ—¶ï¼Œåˆ©ç”¨ RestTemplate å¯¹ http è¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆäº†ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒFeign åœ¨æ­¤åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œç”±ä»–æ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚</p><p>åœ¨ Feign çš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒ(ä»¥å‰æ˜¯ Dao æ¥å£ä¸Šé¢æ ‡æ³¨ Mapper æ³¨è§£ï¼Œç°åœ¨æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šé¢æ ‡æ³¨ä¸€ä¸ª Feign æ³¨è§£å³å¯)ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šï¼Œç®€åŒ–äº†ä½¿ç”¨ Spring cloud Ribbon æ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚</p><p>Feign é›†æˆäº† Ribbonï¼Œåˆ©ç”¨ Ribbon ç»´æŠ¤äº† Payment çš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°äº†å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚è€Œä¸ Ribbon ä¸åŒçš„æ˜¯ï¼Œé€šè¿‡ feign åªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨</p><h3 id="1-3ã€Feign-å’Œ-OpenFeign-ä¸¤è€…åŒºåˆ«"><a href="#1-3ã€Feign-å’Œ-OpenFeign-ä¸¤è€…åŒºåˆ«" class="headerlink" title="1-3ã€Feign å’Œ OpenFeign ä¸¤è€…åŒºåˆ«"></a>1-3ã€Feign å’Œ OpenFeign ä¸¤è€…åŒºåˆ«</h3><p>Feignï¼š</p><p>Feign æ˜¯ Spring Cloud ç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§ RESTful çš„ HTTP æœåŠ¡å®¢æˆ·ç«¯<br>Feign å†…ç½®äº† Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡<br>Feign çš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨ Feign çš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>OpenFeignï¼š</p><p>OpenFeign æ˜¯ Spring Cloud åœ¨ Feign çš„åŸºç¡€ä¸Šæ”¯æŒäº† SpringMVC çš„æ³¨è§£ï¼Œå¦‚@RequesMapping ç­‰ç­‰<br>OpenFeign çš„ @FeignClient å¯ä»¥è§£æ SpringMVC çš„ @RequestMapping æ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2ã€OpenFeign-ä½¿ç”¨æ­¥éª¤"><a href="#2ã€OpenFeign-ä½¿ç”¨æ­¥éª¤" class="headerlink" title="2ã€OpenFeign ä½¿ç”¨æ­¥éª¤"></a>2ã€OpenFeign ä½¿ç”¨æ­¥éª¤</h2><blockquote><p><strong>æ¥å£+æ³¨è§£ï¼šå¾®æœåŠ¡è°ƒç”¨æ¥å£+@FeignClient</strong></p></blockquote><h3 id="2-1ã€æ–°å»º-cloud-consumer-feign-order80"><a href="#2-1ã€æ–°å»º-cloud-consumer-feign-order80" class="headerlink" title="2-1ã€æ–°å»º cloud-consumer-feign-order80"></a>2-1ã€æ–°å»º cloud-consumer-feign-order80</h3><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-feign-order80<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Open Feignï¼Œä»–é‡Œé¢ä¹Ÿæœ‰ribbonï¼Œæ‰€ä»¥æœ‰è´Ÿè½½å‡è¡¡ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- eureka Client --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a><strong>application.yml</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># é…ç½®æœåŠ¡ä¸­å¿ƒï¼ŒopenFeignå»é‡Œé¢æ‰¾æœåŠ¡</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a><strong>ä¸»å¯åŠ¨ç±»</strong></h4><blockquote><p>@EnableFeignClients</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderFeginMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/18 19:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="service-å±‚"><a href="#service-å±‚" class="headerlink" title="service å±‚"></a><strong>service å±‚</strong></h4><p>æ–°å»º service æ¥å£å¹¶æ–°å¢æ³¨è§£ @FeignClientï¼Œåˆ«å¿˜äº†æ·»åŠ  @Component</p><p>@RequestMapping å¯¹åº”è°ƒç”¨æœåŠ¡ç«¯çš„è®¿é—®åœ°å€</p><p>@FeignClient å¯¹åº”è°ƒç”¨çš„æœåŠ¡ç«¯åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> feign.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFeignService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/18 19:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚"><a href="#controller-å±‚" class="headerlink" title="controller å±‚"></a><strong>controller å±‚</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeginController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeginService paymentFeginService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeginService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a><strong>æµ‹è¯•</strong></h4><p><img src="https://picbed.jnchan.top/springcloudImages/12feignæµ‹è¯•.png" alt=""></p><h2 id="3ã€OpenFeign-è¶…æ—¶æ§åˆ¶"><a href="#3ã€OpenFeign-è¶…æ—¶æ§åˆ¶" class="headerlink" title="3ã€OpenFeign è¶…æ—¶æ§åˆ¶"></a>3ã€OpenFeign è¶…æ—¶æ§åˆ¶</h2><p>è¶…æ—¶è®¾ç½®ï¼Œæ•…æ„è®¾ç½®è¶…æ—¶æ¼”ç¤ºå‡ºé”™æƒ…å†µï¼š</p><ul><li>æœåŠ¡æä¾›æ–¹ 8001 æ•…æ„å†™æš‚åœç¨‹åº</li><li>æœåŠ¡æ¶ˆè´¹æ–¹ 80 æ·»åŠ è¶…æ—¶æ–¹æ³• PaymentFeignService</li><li>æœåŠ¡æ¶ˆè´¹æ–¹ 80 æ·»åŠ è¶…æ—¶æ–¹æ³• OrderFeignControIIer</li></ul><h3 id="3-1ã€æœåŠ¡æ¶ˆè´¹æ–¹-80-æ·»åŠ è¶…æ—¶æ–¹æ³•"><a href="#3-1ã€æœåŠ¡æ¶ˆè´¹æ–¹-80-æ·»åŠ è¶…æ—¶æ–¹æ³•" class="headerlink" title="3-1ã€æœåŠ¡æ¶ˆè´¹æ–¹ 80 æ·»åŠ è¶…æ—¶æ–¹æ³•"></a>3-1ã€æœåŠ¡æ¶ˆè´¹æ–¹ 80 æ·»åŠ è¶…æ—¶æ–¹æ³•</h3><h4 id="service-å±‚-1"><a href="#service-å±‚-1" class="headerlink" title="service å±‚"></a>service å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/feign/timeout&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">paymentFeignTimeout</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentFeignTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//openfeign-ribbon ,å®¢æˆ·ç«¯é»˜è®¤ç­‰å¾…ä¸€ç§’é’Ÿ</span></span><br><span class="line">    <span class="keyword">return</span> paymentFeignService.paymentFeignTimeout();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2ã€æœåŠ¡æä¾›ç«¯-8001-æ·»åŠ è¶…æ—¶æ–¹æ³•"><a href="#3-2ã€æœåŠ¡æä¾›ç«¯-8001-æ·»åŠ è¶…æ—¶æ–¹æ³•" class="headerlink" title="3-2ã€æœåŠ¡æä¾›ç«¯ 8001 æ·»åŠ è¶…æ—¶æ–¹æ³•"></a>3-2ã€æœåŠ¡æä¾›ç«¯ 8001 æ·»åŠ è¶…æ—¶æ–¹æ³•</h3><p>controller å±‚ï¼Œå¯¹åº”æœåŠ¡ç«¯çš„è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentFeignTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3ã€æµ‹è¯•"><a href="#3-3ã€æµ‹è¯•" class="headerlink" title="3-3ã€æµ‹è¯•"></a>3-3ã€æµ‹è¯•</h3><p>è¶…æ—¶</p><p><img src="https://picbed.jnchan.top/springcloudImages/12openfeignè¶…æ—¶.png" alt=""></p><blockquote><p>Openfeign é»˜è®¤è¶…æ—¶ç­‰å¾…ä¸ºä¸€ç§’ï¼Œåœ¨æ¶ˆè´¹æ–¹ 80 é…ç½®è¶…æ—¶æ—¶é—´</p></blockquote><p>è®¾ç½®è¶…æ—¶æ—¶é™</p><blockquote><h1 id="è®¾ç½®-feign-å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´-OpenFeign-é»˜è®¤æ”¯æŒ-ribbon"><a href="#è®¾ç½®-feign-å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´-OpenFeign-é»˜è®¤æ”¯æŒ-ribbon" class="headerlink" title="è®¾ç½® feign å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeign é»˜è®¤æ”¯æŒ ribbon)"></a>è®¾ç½® feign å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeign é»˜è®¤æ”¯æŒ ribbon)</h1><p>ribbon: #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´<br>ReadTimeout: 5000 #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´<br>ConnectTimeout: 5000</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># é…ç½®æœåŠ¡ä¸­å¿ƒï¼ŒopenFeignå»é‡Œé¢æ‰¾æœåŠ¡</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">    <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">    <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">    <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">    <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure><h2 id="4ã€OpenFeign-å¼€å¯æ—¥å¿—æ‰“å°"><a href="#4ã€OpenFeign-å¼€å¯æ—¥å¿—æ‰“å°" class="headerlink" title="4ã€OpenFeign å¼€å¯æ—¥å¿—æ‰“å°"></a>4ã€OpenFeign å¼€å¯æ—¥å¿—æ‰“å°</h2><p>Feign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œäº†è§£ Feign ä¸­ Http è¯·æ±‚çš„ç»†èŠ‚ã€‚</p><p>è¯´ç™½äº†å°±æ˜¯å¯¹ Feign æ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º</p><p>æ—¥å¿—çº§åˆ«</p><ul><li>NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—</li><li>BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´</li><li>HEADERSï¼šé™¤äº† BASIC ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li>FULLï¼šé™¤äº† HEADERS ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®</li></ul><h3 id="4-1ã€æ·»åŠ -config-é…ç½®ç±»"><a href="#4-1ã€æ·»åŠ -config-é…ç½®ç±»" class="headerlink" title="4-1ã€æ·»åŠ  config é…ç½®ç±»"></a>4-1ã€æ·»åŠ  config é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> FeginConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 10:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeginConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-2ã€application-yml-é…ç½®"><a href="#4-2ã€application-yml-é…ç½®" class="headerlink" title="4-2ã€application.yml é…ç½®"></a>4-2ã€application.yml é…ç½®</h3><p>application.yml ä¸­å¼€å¯æ—¥å¿—æ‰“å°</p><blockquote><p>logging:<br>level:</p><h1 id="feign-æ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£"><a href="#feign-æ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£" class="headerlink" title="feign æ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£"></a>feign æ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</h1><p>â€‹ com.jcvv.springcloud.service.PaymentFeignService: debug</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># é…ç½®æœåŠ¡ä¸­å¿ƒï¼ŒopenFeignå»é‡Œé¢æ‰¾æœåŠ¡</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">    <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">    <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">    <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">    <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">    <span class="attr">level:</span></span><br><span class="line">        <span class="comment"># feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</span></span><br><span class="line">        <span class="attr">com.jcvv.springcloud.service.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><h3 id="4-3ã€æµ‹è¯•"><a href="#4-3ã€æµ‹è¯•" class="headerlink" title="4-3ã€æµ‹è¯•"></a>4-3ã€æµ‹è¯•</h3><p>è®¿é—®åœ°å€ï¼š<a href="http://localhost/consumer/payment/get/1">localhost/consumer/payment/get/1</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/13feignæ—¥å¿—è¾“å‡º.png" alt=""></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E2%80%94%E2%80%94Hystrix%E6%96%AD%E8%B7%AF%E5%99%A8/" title="æœåŠ¡é™çº§â€”â€”Hystrixæ–­è·¯å™¨">æœåŠ¡é™çº§â€”â€”Hystrixæ–­è·¯å™¨</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ğŸ˜ğŸ˜</title>
      <link href="/2023/06/12/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/"/>
      <url>/2023/06/12/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ğŸ˜ğŸ˜"><a href="#Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ğŸ˜ğŸ˜" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ğŸ˜ğŸ˜"></a>Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ğŸ˜ğŸ˜</h1><h2 id="1ã€Ribbonç®€ä»‹"><a href="#1ã€Ribbonç®€ä»‹" class="headerlink" title="1ã€Ribbonç®€ä»‹"></a>1ã€Ribbonç®€ä»‹</h2><h3 id="1-1ã€æ˜¯ä»€ä¹ˆ"><a href="#1-1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-1ã€æ˜¯ä»€ä¹ˆ"></a>1-1ã€æ˜¯ä»€ä¹ˆ</h3><p>Spring Cloud Ribbonæ˜¯åŸºäºNetflix Ribbonå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚</p><p>ç®€å•çš„è¯´ï¼ŒRibbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancerï¼ˆç®€ç§°LBï¼‰åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥è¿™äº›æœºå™¨ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p><h3 id="2-2ã€å®˜ç½‘èµ„æ–™"><a href="#2-2ã€å®˜ç½‘èµ„æ–™" class="headerlink" title="2-2ã€å®˜ç½‘èµ„æ–™"></a>2-2ã€å®˜ç½‘èµ„æ–™</h3><p><a href="https://github.com/Netflix/ribbon/wiki/Getting-Started">https://github.com/Netflix/ribbon/wiki/Getting-Started</a></p><p>Ribbonç›®å‰ä¹Ÿè¿›å…¥ç»´æŠ¤æ¨¡å¼ <a href="https://github.com/Netflix/ribbon">https://github.com/Netflix/ribbon</a><br><img src="https://picbed.jnchan.top/springcloudImages/11Ribbon.png" alt=""></p><p>æœªæ¥æ›¿æ¢æ–¹æ¡ˆ</p><p><img src="https://picbed.jnchan.top/springcloudImages/11ribbonæ›¿ä»£æ–¹æ¡ˆ.png" alt=""></p><h3 id="1-3ã€èƒ½å¹²å—"><a href="#1-3ã€èƒ½å¹²å—" class="headerlink" title="1-3ã€èƒ½å¹²å—"></a>1-3ã€èƒ½å¹²å—</h3><p><strong>LBè´Ÿè½½å‡è¡¡(Load Balance)æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>ç®€å•çš„è¯´å°±æ˜¯å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰ï¼Œå¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰è½¯ä»¶Nginxï¼ŒLVSï¼Œç¡¬ä»¶ F5ç­‰</p><p>Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ VS NginxæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡åŒºåˆ«ï¼Ÿ</p><p>Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginxï¼Œç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„<br>Ribbonæ˜¯æœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯<br><strong>é›†ä¸­å¼LB</strong></p><p>å³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½(å¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5, ä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚nginx), ç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹</p><p><strong>è¿›ç¨‹å†…LB</strong></p><p>å°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨ï¼Œç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨ã€‚Ribbonå°±å±äºè¿›ç¨‹å†…LBï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç±»åº“ï¼Œé›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€<br><strong>ä¸€å¥è¯</strong></p><blockquote><p>è´Ÿè½½å‡è¡¡+RestTemplateè°ƒç”¨</p></blockquote><h2 id="2ã€Ribbonè´Ÿè½½å‡è¡¡æ¼”ç¤º"><a href="#2ã€Ribbonè´Ÿè½½å‡è¡¡æ¼”ç¤º" class="headerlink" title="2ã€Ribbonè´Ÿè½½å‡è¡¡æ¼”ç¤º"></a>2ã€Ribbonè´Ÿè½½å‡è¡¡æ¼”ç¤º</h2><h3 id="2-1ã€æ¶æ„è¯´æ˜"><a href="#2-1ã€æ¶æ„è¯´æ˜" class="headerlink" title="2-1ã€æ¶æ„è¯´æ˜"></a>2-1ã€æ¶æ„è¯´æ˜</h3><p>Ribbonåœ¨å·¥ä½œæ—¶åˆ†æˆä¸¤æ­¥ï¼š</p><p>ç¬¬ä¸€æ­¥å…ˆé€‰æ‹© EurekaServer ,å®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server</p><p>ç¬¬äºŒæ­¥å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ï¼›å…¶ä¸­Ribbonæä¾›äº†å¤šç§ç­–ç•¥ï¼šæ¯”å¦‚è½®è¯¢ã€éšæœºå’Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒ<br><img src="https://picbed.jnchan.top/springcloudImages/11è´Ÿè½½å‡è¡¡.png" alt=""></p><p>æ€»ç»“ï¼šRibbonå…¶å®å°±æ˜¯ä¸€ä¸ªè½¯è´Ÿè½½å‡è¡¡çš„å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä»–å¯ä»¥å’Œå…¶ä»–æ‰€éœ€è¯·æ±‚çš„å®¢æˆ·ç«¯ç»“åˆä½¿ç”¨ï¼Œå’Œeurekaç»“åˆåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><h3 id="2-2ã€pomè¯´æ˜"><a href="#2-2ã€pomè¯´æ˜" class="headerlink" title="2-2ã€pomè¯´æ˜"></a>2-2ã€pomè¯´æ˜</h3><p>ä¹‹å‰å†™æ ·ä¾‹æ—¶å€™æ²¡æœ‰å¼•å…¥spring-cloud-starter-ribbonä¹Ÿå¯ä»¥ä½¿ç”¨ribbon</p><p>çŒœæµ‹spring-cloud-starter-netflix-eureka-clientè‡ªå¸¦äº†spring-cloud-starter-ribbonå¼•ç”¨ï¼Œ</p><p>è¯æ˜å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°spring-cloud-starter-netflix-eureka-client ç¡®å®å¼•å…¥äº†Ribbon</p><p><img src="https://picbed.jnchan.top/springcloudImages/11eurekaå­˜åœ¨ribbon.png" alt=""></p><h3 id="2-3ã€äºŒè¯´RestTemplateçš„ä½¿ç”¨"><a href="#2-3ã€äºŒè¯´RestTemplateçš„ä½¿ç”¨" class="headerlink" title="2-3ã€äºŒè¯´RestTemplateçš„ä½¿ç”¨"></a>2-3ã€äºŒè¯´RestTemplateçš„ä½¿ç”¨</h3><p>å®˜ç½‘</p><p><a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p><p>getForObjectæ–¹æ³•ï¼šè¿”å›å¯¹è±¡ä¸ºå“åº”ä½“ä¸­æ•°æ®è½¬åŒ–æˆçš„å¯¹è±¡ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºJson</p><p>getForEntityæ–¹æ³•ï¼šè¿”å›å¯¹è±¡ä¸ºResponseEntityå¯¹è±¡ï¼ŒåŒ…å«äº†å“åº”ä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚å“åº”å¤´ã€å“åº”çŠ¶æ€ç ã€å“åº”ä½“ </p><p><img src="https://picbed.jnchan.top/springcloudImages/11getForObjectä¸getForEtity.png" alt="åŒºåˆ«"></p><h3 id="2-4ã€ä¿®æ”¹cloud-consumer-order80ä¸­controllerç±»"><a href="#2-4ã€ä¿®æ”¹cloud-consumer-order80ä¸­controllerç±»" class="headerlink" title="2-4ã€ä¿®æ”¹cloud-consumer-order80ä¸­controllerç±»"></a>2-4ã€ä¿®æ”¹cloud-consumer-order80ä¸­controllerç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForObject/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment2</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForEntity/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment3</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity = restTemplate.</span><br><span class="line">            getForEntity(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        log.info(entity.getStatusCode()+<span class="string">&quot;\t&quot;</span>+entity);</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;æ“ä½œå¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5ã€æµ‹è¯•"><a href="#2-5ã€æµ‹è¯•" class="headerlink" title="2-5ã€æµ‹è¯•"></a>2-5ã€æµ‹è¯•</h3><p><img src="https://picbed.jnchan.top/springcloudImages/11ribbonæµ‹è¯•.png" alt=""></p><h2 id="3ã€Ribbonæ ¸å¿ƒç»„ä»¶IRuleâ­â­â­"><a href="#3ã€Ribbonæ ¸å¿ƒç»„ä»¶IRuleâ­â­â­" class="headerlink" title="3ã€Ribbonæ ¸å¿ƒç»„ä»¶IRuleâ­â­â­"></a>3ã€Ribbonæ ¸å¿ƒç»„ä»¶IRuleâ­â­â­</h2><h3 id="3-1ã€IRuleæ¥å£å®ç°ç±»è¯´æ˜â­"><a href="#3-1ã€IRuleæ¥å£å®ç°ç±»è¯´æ˜â­" class="headerlink" title="3-1ã€IRuleæ¥å£å®ç°ç±»è¯´æ˜â­"></a>3-1ã€IRuleæ¥å£å®ç°ç±»è¯´æ˜â­</h3><p>IRuleï¼šæ ¹æ®ç‰¹å®šç®—æ³•ä¸­ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡</p><p><img src="https://picbed.jnchan.top/springcloudImages/11ribbo_rule.png" alt=""></p><ul><li><p>com.netflix.loadbalancer.RoundRobinRuleï¼šè½®è¯¢</p></li><li><p>com.netflix.loadbalancer.RandomRuleï¼šéšæœº</p></li><li><p>com.netflix.loadbalancer.RetryRuleï¼šå…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…ä¼šè¿›è¡Œé‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡</p></li><li><p>WeightedResponseTimeRuleï¼šå¯¹RoundRobinRuleçš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹©</p></li><li><p>BestAvailableRuleï¼šä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡</p></li><li><p>AvailabilityFilteringRuleï¼šå…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘è¾ƒå°çš„å®ä¾‹</p></li><li><p>ZoneAvoidanceRuleï¼šé»˜è®¤è§„åˆ™,å¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨</p><p>â€‹            </p></li></ul><h3 id="3-2ã€Ribbonè´Ÿè½½è§„åˆ™æ›¿æ¢â­"><a href="#3-2ã€Ribbonè´Ÿè½½è§„åˆ™æ›¿æ¢â­" class="headerlink" title="3-2ã€Ribbonè´Ÿè½½è§„åˆ™æ›¿æ¢â­"></a>3-2ã€Ribbonè´Ÿè½½è§„åˆ™æ›¿æ¢â­</h3><p>ä¿®æ”¹cloud-consumer-order80</p><p><strong>æ³¨æ„é…ç½®ç»†èŠ‚</strong>â­</p><p>å®˜æ–¹æ–‡æ¡£æ˜ç¡®ç»™å‡ºäº†è­¦å‘Šï¼š</p><blockquote><p>è¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»<font color='red'>ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹</font>ï¼Œå¦åˆ™æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„äº†ã€‚</p></blockquote><p><strong>æ–°å»ºpackage</strong></p><p>com.jcvv.myrule</p><p>æ–°å»ºMySelfRuleè§„åˆ™ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyselfRule</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();<span class="comment">//å®šä¹‰ä¸ºéšæœº</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸»å¯åŠ¨ç±»æ·»åŠ <font color='red'>@RibbonClient</font></strong></p><p><font color='red'><strong>æ³¨æ„ï¼š</strong></font>@RibbonClient(name = â€œCLOUD-PAYMENT-SERVICEâ€,configuration = MyselfRule.class)ä¸­<strong>name</strong>å¿…é¡»<strong>å’Œcontrollerä¸­çš„åå­—ä¸€è‡´ï¼Œå¦‚controllerç±»ä¸­çš„PAYMENT_URLåå­—æ˜¯å¤§å†™ï¼Œåˆ™ä¸ºå¤§å†™</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.myrule.MyselfRule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.ribbon.RibbonClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;CLOUD-PAYMENT-SERVICE&quot;,configuration = MyselfRule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#4ã€Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="4ã€Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•"></a>4ã€Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•</h2><h3 id="4-1ã€åŸç†"><a href="#4-1ã€åŸç†" class="headerlink" title="4-1ã€åŸç†"></a>4-1ã€åŸç†</h3><p>è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">instances</span> <span class="operator">=</span> discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¦‚ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List [<span class="number">0</span>] instances = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span></span><br><span class="line">List [<span class="number">1</span>] instances = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8001</span></span><br></pre></td></tr></table></figure><p>8001+ 8002 ç»„åˆæˆä¸ºé›†ç¾¤ï¼Œå®ƒä»¬å…±è®¡2å°æœºå™¨ï¼Œé›†ç¾¤æ€»æ•°ä¸º2ï¼Œ æŒ‰ç…§è½®è¯¢ç®—æ³•åŸç†ï¼š</p><p>å½“æ€»è¯·æ±‚æ•°ä¸º1æ—¶ï¼š 1 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001</p><p>å½“æ€»è¯·æ±‚æ•°ä½2æ—¶ï¼š 2 % 2 =0 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º0 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8002</p><p>å½“æ€»è¯·æ±‚æ•°ä½3æ—¶ï¼š 3 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001</p><h3 id="4-2ã€ribbonæºç "><a href="#4-2ã€ribbonæºç " class="headerlink" title="4-2ã€ribbonæºç "></a>4-2ã€ribbonæºç </h3><p>com.netflix.loadbalancer.RoundRobinRuleç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (server == <span class="literal">null</span> &amp;&amp; count++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        List&lt;Server&gt; reachableServers = lb.getReachableServers();</span><br><span class="line">        List&lt;Server&gt; allServers = lb.getAllServers();</span><br><span class="line">        <span class="type">int</span> <span class="variable">upCount</span> <span class="operator">=</span> reachableServers.size();</span><br><span class="line">        <span class="type">int</span> <span class="variable">serverCount</span> <span class="operator">=</span> allServers.size();</span><br><span class="line"> </span><br><span class="line">        <span class="type">int</span> <span class="variable">nextServerIndex</span> <span class="operator">=</span> incrementAndGetModulo(serverCount);</span><br><span class="line">        server = allServers.get(nextServerIndex);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">/* Transient. */</span></span><br><span class="line">            Thread.<span class="keyword">yield</span>();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (server.isAlive() &amp;&amp; (server.isReadyToServe())) &#123;</span><br><span class="line">            <span class="keyword">return</span> (server);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Next.</span></span><br><span class="line">        server = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (count &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;No available alive servers after 10 tries from load balancer: &quot;</span>  + lb);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> server;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">incrementAndGetModulo</span><span class="params">(<span class="type">int</span> modulo)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> nextServerCyclicCounter.get();<span class="comment">//è·å–åŸå­çš„å€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> (current + <span class="number">1</span>) % modulo;</span><br><span class="line">        <span class="keyword">if</span> (nextServerCyclicCounter.compareAndSet(current, next)) <span class="comment">//CAS</span></span><br><span class="line">            <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3ã€æ‰‹å†™è´Ÿè½½å‡è¡¡å™¨"><a href="#4-3ã€æ‰‹å†™è´Ÿè½½å‡è¡¡å™¨" class="headerlink" title="4-3ã€æ‰‹å†™è´Ÿè½½å‡è¡¡å™¨"></a><strong>4-3ã€æ‰‹å†™è´Ÿè½½å‡è¡¡å™¨</strong></h3><p>80ç«¯å®ç°è½®è¯¢</p><p>æ¥å£ï¼šä»æœåŠ¡åˆ—è¡¨é€‰å‡ºä¸€å°æœºå™¨è¿›è¡Œè®¿é—®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoadBalancer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æœåŠ¡åˆ—è¡¨é€‰å‡ºä¸€å°æœºå™¨è¿›è¡Œè®¿é—®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceInstances æœåŠ¡åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLB</span> <span class="keyword">implements</span> <span class="title class_">LoadBalancer</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> current;</span><br><span class="line">        <span class="type">int</span> next;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            current = <span class="built_in">this</span>.atomicInteger.get();</span><br><span class="line">            next = current &gt;= Integer.MAX_VALUE ? <span class="number">0</span> : current+<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">while</span> (!<span class="built_in">this</span>.atomicInteger.compareAndSet(current,next));</span><br><span class="line">        <span class="comment">//atomicInteger.compareAndSet(expect, update),</span></span><br><span class="line">        <span class="comment">//æ¯”è¾ƒexceptå’Œupdateï¼Œå¦‚æœç›¸ç­‰è¿”å›trueï¼Œå¦åˆ™è¿”å›fasle</span></span><br><span class="line">        System.out.println(<span class="string">&quot;*********ç¬¬&quot;</span>+next+<span class="string">&quot;æ¬¡è®¿é—®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServiceInstance <span class="title function_">instances</span><span class="params">(List&lt;ServiceInstance&gt; serviceInstances)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> getAndIncrement() % serviceInstances.size();</span><br><span class="line">        <span class="keyword">return</span> serviceInstances.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹æ–¹80controllerç±»åŠ ä¸Šè‡ªå·±å®ç°çš„è½®è¯¢æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancer loadBalancer;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/lb&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//è·å¾—æœåŠ¡åˆ—è¡¨</span></span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(instances == <span class="literal">null</span> || instances.size()&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> loadBalancer.instances(instances);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> serviceInstance.getUri();</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">&quot; &quot;</span>+uri);</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(uri+<span class="string">&quot;/payment/lb&quot;</span>,String.class);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡æä¾›è€…8001ï¼Œ8002controlleråŠ ä¸Š80ç«¯è°ƒç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/lb&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæµ‹è¯•çš„æ—¶å€™æ³¨é‡Šæ‰è¿™ä¸¤ä¸ªæ³¨é‡Šï¼Œä¸ç„¶ restTemplate.getForObjectä¸çŸ¥é“è°ƒç”¨å“ªä¸ªæœåŠ¡ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼Œä»æŠ¥é”™æè¿°å¯çŸ¥æ²¡æœ‰åˆé€‚çš„è°ƒç”¨å¯¹è±¡ã€‚ </p><p><img src="https://picbed.jnchan.top/springcloudImages/12ribbonæ‰‹å†™è½®è¯¢æ³¨é‡Š1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/12ribbonæ‰‹å†™è½®è¯¢æ³¨é‡Š2.png" alt=""></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/OpenFeign%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/" title="OpenFeignæœåŠ¡æ¥å£è°ƒç”¨ğŸ˜ğŸ˜">OpenFeignæœåŠ¡æ¥å£è°ƒç”¨ğŸ˜ğŸ˜</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</title>
      <link href="/2023/06/12/Seata%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98/"/>
      <url>/2023/06/12/Seata%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><a href="#Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="headerlink" title="Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"></a>Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h1><h2 id="1ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ç”±æ¥"><a href="#1ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ç”±æ¥" class="headerlink" title="1ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ç”±æ¥"></a>1ã€<a href="https://so.csdn.net/so/search?q=åˆ†å¸ƒå¼äº‹åŠ¡&amp;spm=1001.2101.3001.7020">åˆ†å¸ƒå¼äº‹åŠ¡</a>é—®é¢˜ç”±æ¥</h2><p>åˆ†å¸ƒå¼å‰</p><ul><li>å•æœºå•åº“æ²¡è¿™ä¸ªé—®é¢˜</li><li>ä»1:1 -&gt; 1:N -&gt; N:N</li></ul><p>å•ä½“åº”ç”¨è¢«æ‹†åˆ†æˆå¾®æœåŠ¡åº”ç”¨ï¼ŒåŸæ¥çš„ä¸‰ä¸ªæ¨¡å—è¢«æ‹†åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„åº”ç”¨,åˆ†åˆ«ä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹çš„æ•°æ®æºï¼Œä¸šåŠ¡æ“ä½œéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡æ¥å®Œæˆã€‚æ­¤æ—¶<strong>æ¯ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯ï¼Œ ä½†æ˜¯å…¨å±€çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ²¡æ³•ä¿è¯</strong>ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_1.png" alt=""></p><h2 id="2ã€Seataç®€ä»‹"><a href="#2ã€Seataç®€ä»‹" class="headerlink" title="2ã€Seataç®€ä»‹"></a>2ã€<a href="https://so.csdn.net/so/search?q=Seata&amp;spm=1001.2101.3001.7020">Seata</a>ç®€ä»‹</h2><h3 id="2-1ã€æ˜¯ä»€ä¹ˆ"><a href="#2-1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="2-1ã€æ˜¯ä»€ä¹ˆ"></a>2-1ã€æ˜¯ä»€ä¹ˆ</h3><p>Seataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡</p><h3 id="2-2ã€èƒ½å¹²å˜›"><a href="#2-2ã€èƒ½å¹²å˜›" class="headerlink" title="2-2ã€èƒ½å¹²å˜›"></a>2-2ã€èƒ½å¹²å˜›</h3><p>ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹</p><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†è¿‡ç¨‹çš„ä¸€ä¸€ID+ä¸‰ç»„ä»¶æ¨¡å‹ï¼š</strong></p><ul><li>Transaction ID XID å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ID</li></ul><p>ä¸‰ç»„ä»¶æ¦‚å¿µ</p><ul><li>TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li><li>TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ï¼šå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li><li>RM (Resource Manager) - èµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li></ul><p><strong>å¤„ç†è¿‡ç¨‹</strong></p><ol><li>TMå‘TCç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„XIDï¼›</li><li>XIDåœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ï¼›</li><li>RMå‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥XIDå¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ï¼›</li><li>TMå‘TCå‘èµ·é’ˆå¯¹XIDçš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ï¼›</li><li>TCè°ƒåº¦XIDä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚</li></ol><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_2.png" alt=""></p><h2 id="3ã€Seata-Serverå®‰è£…"><a href="#3ã€Seata-Serverå®‰è£…" class="headerlink" title="3ã€Seata-Serverå®‰è£…"></a>3ã€Seata-Serverå®‰è£…</h2><h3 id="3-1ã€å»å“ªä¸‹"><a href="#3-1ã€å»å“ªä¸‹" class="headerlink" title="3-1ã€å»å“ªä¸‹"></a><strong>3-1ã€å»å“ªä¸‹</strong></h3><p>å‘å¸ƒè¯´æ˜: <a href="https://github.com/seata/seata/releases">https://github.com/seata/seata/releases</a></p><h3 id="3-2ã€æ€ä¹ˆç©"><a href="#3-2ã€æ€ä¹ˆç©" class="headerlink" title="3-2ã€æ€ä¹ˆç©"></a><strong>3-2ã€æ€ä¹ˆç©</strong></h3><ul><li>æœ¬åœ° @Transactional </li><li>å…¨å±€ @GlobalTransactional </li></ul><h3 id="3-3ã€SEATA-çš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ"><a href="#3-3ã€SEATA-çš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3-3ã€SEATA çš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ"></a><strong>3-3ã€SEATA çš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ</strong></h3><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_3.png" alt=""></p><p> æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸€ä¸ª <code>@GlobalTransactional</code> æ³¨è§£åœ¨ä¸šåŠ¡æ–¹æ³•ä¸Š</p><h3 id="3-4ã€Seata-Serverå®‰è£…"><a href="#3-4ã€Seata-Serverå®‰è£…" class="headerlink" title="3-4ã€Seata-Serverå®‰è£…"></a><strong>3-4ã€Seata-Serverå®‰è£…</strong></h3><p>å®˜ç½‘åœ°å€ - <a href="http://seata.io/zh-cn/">http://seata.io/zh-cn/</a></p><p>ä¸‹è½½ç‰ˆæœ¬ - 0.9.0</p><p>seata-server-0.9.0.zipè§£å‹åˆ°æŒ‡å®šç›®å½•å¹¶ä¿®æ”¹confç›®å½•ä¸‹çš„file.confé…ç½®æ–‡ä»¶</p><p>å…ˆå¤‡ä»½åŸå§‹file.confæ–‡ä»¶</p><p>ä¸»è¦ä¿®æ”¹:è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°+äº‹åŠ¡æ—¥å¿—å­˜å‚¨æ¨¡å¼ä¸ºdb +æ•°æ®åº“è¿æ¥ä¿¡æ¯</p><p>serviceæ¨¡å—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">service &#123;</span><br><span class="line">  #vgroup-&gt;rgroup</span><br><span class="line">  #jcvv_tx_groupè‡ªå®šä¹‰çš„</span><br><span class="line">  vgroup_mapping.jcvv_tx_group = <span class="string">&quot;default&quot;</span></span><br><span class="line">  #only support single node</span><br><span class="line">  <span class="keyword">default</span>.grouplist = <span class="string">&quot;119.3.211.104:8091&quot;</span></span><br><span class="line">  #degrade current not <span class="type">support</span></span><br><span class="line">  <span class="variable">enableDegrade</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  #<span class="type">disable</span></span><br><span class="line">  <span class="variable">disable</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, <span class="keyword">default</span> permanent</span><br><span class="line">  max.commit.retry.timeout = <span class="string">&quot;-1&quot;</span></span><br><span class="line">  max.rollback.retry.timeout = <span class="string">&quot;-1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>storeæ¨¡å—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">## transaction log store</span><br><span class="line">store &#123;</span><br><span class="line">  ## store mode: fileã€<span class="type">db</span></span><br><span class="line">  <span class="variable">mode</span> <span class="operator">=</span> <span class="string">&quot;file&quot;</span></span><br><span class="line"> </span><br><span class="line">  ## file store</span><br><span class="line">  file &#123;</span><br><span class="line">    dir = <span class="string">&quot;sessionStore&quot;</span></span><br><span class="line"> </span><br><span class="line">    # branch session size , <span class="keyword">if</span> exceeded first <span class="keyword">try</span> compress lockkey, still exceeded <span class="keyword">throws</span> exceptions</span><br><span class="line">    max-branch-session-size = <span class="number">16384</span></span><br><span class="line">    # globe session size , <span class="keyword">if</span> exceeded <span class="keyword">throws</span> exceptions</span><br><span class="line">    max-global-session-size = <span class="number">512</span></span><br><span class="line">    # file buffer size , <span class="keyword">if</span> exceeded allocate <span class="keyword">new</span> <span class="title class_">buffer</span></span><br><span class="line">    file-write-buffer-cache-size = <span class="number">16384</span></span><br><span class="line">    # when recover batch read size</span><br><span class="line">    session.reload.read_size = <span class="number">100</span></span><br><span class="line">    # async, sync</span><br><span class="line">    flush-disk-mode = async</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  ## database store</span><br><span class="line">  db &#123;</span><br><span class="line">    ## the implement of javax.sql.DataSource, such as <span class="title function_">DruidDataSource</span><span class="params">(druid)</span>/BasicDataSource(dbcp) etc.</span><br><span class="line">    datasource = <span class="string">&quot;dbcp&quot;</span></span><br><span class="line">    ## mysql/oracle/h2/oceanbase etc.</span><br><span class="line">    db-type = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    driver-class-name = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    url = <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/seata&quot;</span></span><br><span class="line">    user = <span class="string">&quot;root&quot;</span></span><br><span class="line">    password = <span class="string">&quot;12345&quot;</span></span><br><span class="line">    min-conn = <span class="number">1</span></span><br><span class="line">    max-conn = <span class="number">3</span></span><br><span class="line">    global.table = <span class="string">&quot;global_table&quot;</span></span><br><span class="line">    branch.table = <span class="string">&quot;branch_table&quot;</span></span><br><span class="line">    lock-table = <span class="string">&quot;lock_table&quot;</span></span><br><span class="line">    query-limit = <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mysql5.7æ•°æ®åº“æ–°å»ºåº“seataï¼Œåœ¨seataåº“é‡Œå»ºè¡¨</p><p>å»ºè¡¨db_store.sqlåœ¨\seata-server-0.9.0\seata\confç›®å½•é‡Œé¢</p><p>ä¿®æ”¹seata-server-0.9.0\seata\confç›®å½•ä¸‹çš„registry.confé…ç½®æ–‡ä»¶ï¼Œæ”¹ç”¨ä¸ºnacos</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">registry &#123;</span><br><span class="line">  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€<span class="type">sofa</span></span><br><span class="line">  <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;nacos&quot;</span></span><br><span class="line"> </span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;119.3.211.104:8089&quot;</span>#nginxä»£ç†nacosåœ°å€</span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>linuxå¯åŠ¨seata</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh seata-server.sh -p <span class="number">8091</span> -h <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span> -m file</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/acmjiayou/article/details/123756335">seataé…ç½®å„ç§é—®é¢˜è§£å†³åŠæ³•ï¼ˆå‘¨é˜³è€å¸ˆç‰ˆï¼‰<em>seata setaipä¸ç”Ÿæ•ˆ</em>æ©™ç•™é¦™_çš„åšå®¢-CSDNåšå®¢</a></p><h2 id="4ã€Seataä¸šåŠ¡æ•°æ®åº“å‡†å¤‡"><a href="#4ã€Seataä¸šåŠ¡æ•°æ®åº“å‡†å¤‡" class="headerlink" title="4ã€Seataä¸šåŠ¡æ•°æ®åº“å‡†å¤‡"></a>4ã€Seataä¸šåŠ¡æ•°æ®åº“å‡†å¤‡</h2><p>è¿™é‡Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸‰ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªè®¢å•æœåŠ¡ï¼Œä¸€ä¸ªåº“å­˜æœåŠ¡ï¼Œä¸€ä¸ªè´¦æˆ·æœåŠ¡ã€‚</p><p>å½“ç”¨æˆ·ä¸‹å•æ—¶,ä¼šåœ¨è®¢å•æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªè®¢å•, ç„¶åé€šè¿‡è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ¥æ‰£å‡ä¸‹å•å•†å“çš„åº“å­˜ï¼Œå†é€šè¿‡è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ¥æ‰£å‡ç”¨æˆ·è´¦æˆ·é‡Œé¢çš„ä½™é¢ï¼Œæœ€ååœ¨è®¢å•æœåŠ¡ä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆã€‚</p><p>è¯¥æ“ä½œè·¨è¶Šä¸‰ä¸ªæ•°æ®åº“ï¼Œæœ‰ä¸¤æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œå¾ˆæ˜æ˜¾ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><p>åˆ›å»ºä¸šåŠ¡æ•°æ®åº“</p><ul><li>seata_ orderï¼šå­˜å‚¨è®¢å•çš„æ•°æ®åº“;</li><li>seata_ storageï¼šå­˜å‚¨åº“å­˜çš„æ•°æ®åº“;</li><li>seata_ accountï¼šå­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE seata_order;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE seata_storage;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE seata_account;</span><br></pre></td></tr></table></figure><p>seata_orderåº“ä¸‹å»ºt_orderè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USE seata_order;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order (</span><br><span class="line">    `id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    `user_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">    `product_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;äº§å“id&#x27;</span>,</span><br><span class="line">    `count` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ•°é‡&#x27;</span>,</span><br><span class="line">    `money` <span class="type">DECIMAL</span>(<span class="number">11</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‡‘é¢&#x27;</span>,</span><br><span class="line">    `status` <span class="type">INT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è®¢å•çŠ¶æ€: 0:åˆ›å»ºä¸­; 1:å·²å®Œç»“&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>seata_storageåº“ä¸‹å»ºt_storageè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">USE seata_storage;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_storage (</span><br><span class="line">`id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">`product_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;äº§å“id&#x27;</span>,</span><br><span class="line">`total` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ€»åº“å­˜&#x27;</span>,</span><br><span class="line">`used` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å·²ç”¨åº“å­˜&#x27;</span>,</span><br><span class="line">`residue` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å‰©ä½™åº“å­˜&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_storage.t_storage(`id`, `product_id`, `total`, `used`, `residue`)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;100&#x27;</span>);</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>seata_accountåº“ä¸‹å»ºt_accountè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">USE seata_account;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_account(</span><br><span class="line">`id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">`user_id` <span class="type">BIGINT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">`total` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ€»é¢åº¦&#x27;</span>,</span><br><span class="line">`used` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å·²ç”¨ä½™é¢&#x27;</span>,</span><br><span class="line">`residue` <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å‰©ä½™å¯ç”¨é¢åº¦&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> seata_account.t_account(`id`, `user_id`, `total`, `used`, `residue`)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1000&#x27;</span>);</span><br></pre></td></tr></table></figure><p> æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨</p><ul><li>è®¢å•-åº“å­˜-è´¦æˆ·3ä¸ªåº“ä¸‹<strong>éƒ½éœ€è¦å»ºå„è‡ªçš„å›æ»šæ—¥å¿—è¡¨</strong></li><li>\seata-server-0.9.0\seata\confç›®å½•ä¸‹çš„db<em> undo</em> log.sql</li><li>å»ºè¡¨SQL</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> `undo_log`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><h2 id="5ã€Moduleé…ç½®æ­å»º"><a href="#5ã€Moduleé…ç½®æ­å»º" class="headerlink" title="5ã€Moduleé…ç½®æ­å»º"></a>5ã€Moduleé…ç½®æ­å»º</h2><h3 id="5-1ã€Seataä¹‹Order-Moduleé…ç½®æ­å»º"><a href="#5-1ã€Seataä¹‹Order-Moduleé…ç½®æ­å»º" class="headerlink" title="5-1ã€Seataä¹‹Order-Moduleé…ç½®æ­å»º"></a>5-1ã€Seataä¹‹Order-Moduleé…ç½®æ­å»º</h3><p>cloudalibaba-seata-order2001</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2020<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-seata-order2001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- seata --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos ä¾èµ–,Nacos Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- open feign æœåŠ¡è°ƒç”¨ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- springbootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- æŒä¹…å±‚æ”¯æŒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¸¸é€šç”¨jaråŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.activation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata-order-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="comment"># è‡ªå®šä¹‰äº‹åŠ¡ç»„ï¼Œéœ€è¦å’Œå½“æ—¶åœ¨ seata/conf/file.conf ä¸­çš„ä¸€è‡´</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">fsp_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/seata_order</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">12345</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œè¿™æ˜¯è‡ªå®šä¹‰çš„ï¼ŒåŸæ¥çš„æ˜¯mapper_locations</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_4.png" alt=""></p><p>å°† seata/conf ä¸‹çš„ file.conf ï¼Œregistry.conf ç§»åˆ° rescources ç›®å½•ä¸‹</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_11.png" alt=""></p><h4 id="è®¢å•ç±»"><a href="#è®¢å•ç±»" class="headerlink" title="è®¢å•ç±»"></a>è®¢å•ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> BigDecimal money;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Daoæ¥å£åŠå®ç°"><a href="#Daoæ¥å£åŠå®ç°" class="headerlink" title="Daoæ¥å£åŠå®ç°"></a>Daoæ¥å£åŠå®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDao</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId, <span class="meta">@Param(&quot;status&quot;)</span> Integer status)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>OrderMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jcvv.springcloud.dao.OrderDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.jcvv.springcloud.domain.Order&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;product_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;productId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;count&quot;</span> <span class="attr">property</span>=<span class="string">&quot;count&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;money&quot;</span> <span class="attr">property</span>=<span class="string">&quot;money&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;create&quot;</span>&gt;</span></span><br><span class="line">        insert into t_order (id,user_id,product_id,count,money,status)</span><br><span class="line">        values (null,#&#123;userId&#125;,#&#123;productId&#125;,#&#123;count&#125;,#&#123;money&#125;,0);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update t_order set status = 1</span><br><span class="line">        where user_id=#&#123;userId&#125; and status = #&#123;status&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Serviceæ¥å£åŠå®ç°"><a href="#Serviceæ¥å£åŠå®ç°" class="headerlink" title="Serviceæ¥å£åŠå®ç°"></a>Serviceæ¥å£åŠå®ç°</h4><ul><li>OrderService<ul><li>OrderServiceImpl</li></ul></li><li>StorageService</li><li>AccountService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;seata-storage-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/storage/decrease&quot;)</span></span><br><span class="line">    CommonResult <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;productId&quot;)</span> Long productId, <span class="meta">@RequestParam(&quot;count&quot;)</span> Integer count)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;seata-account-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/account/decrease&quot;)</span></span><br><span class="line">    CommonResult <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * ç®€å•è¯´ï¼š</span></span><br><span class="line"><span class="comment">     * ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;å‡ä½™é¢-&gt;æ”¹çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;ä¸‹å•å¼€å§‹&quot;</span>);</span><br><span class="line">        <span class="comment">//æœ¬åº”ç”¨åˆ›å»ºè®¢å•</span></span><br><span class="line">        orderDao.create(order);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹&quot;</span>);</span><br><span class="line">        storageService.decrease(order.getProductId(),order.getCount());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡ä½™é¢</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢å¼€å§‹&quot;</span>);</span><br><span class="line">        accountService.decrease(order.getUserId(),order.getMoney());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢ç»“æŸ&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹&quot;</span>);</span><br><span class="line">        orderDao.update(order.getUserId(),<span class="number">0</span>);</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;ä¸‹å•ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controllerç±»"><a href="#controllerç±»" class="headerlink" title="controllerç±»"></a>controllerç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/order/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orderService.create(order);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;è®¢å•åˆ›å»ºæˆåŠŸ!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="configç±»"><a href="#configç±»" class="headerlink" title="configç±»"></a>configç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.jcvv.springcloud.dao&quot;)</span> <span class="comment">//è¡¨æ˜mybatiså’Œdaoå±‚ç›¸å…³</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> DataSourceProxyConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/3 15:17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>());</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="comment">//å–æ¶ˆæ•°æ®æºçš„è‡ªåŠ¨åˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå·±å®šä¹‰çš„</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataOrderMain2001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SeataOrderMain2001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2ã€Seataä¹‹Storage-Moduleé…ç½®æ­å»º"><a href="#5-2ã€Seataä¹‹Storage-Moduleé…ç½®æ­å»º" class="headerlink" title="5-2ã€Seataä¹‹Storage-Moduleé…ç½®æ­å»º"></a>5-2ã€Seataä¹‹Storage-Moduleé…ç½®æ­å»º</h3><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-storage-service2002<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--nacos--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--feign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata-storage-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">jcvv_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://119.3.211.104:3306/seata_storage?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><p>å°† seata/conf ä¸‹çš„ file.conf ï¼Œregistry.conf ç§»åˆ° rescources ç›®å½•ä¸‹</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_12.png" alt=""></p><h4 id="ä¸»å¯åŠ¨ç±»-1"><a href="#ä¸»å¯åŠ¨ç±»-1" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SeataStorageMain2002</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/3 16:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataStorageMain2002</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SeataStorageMain2002.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="åº“å­˜å®ä½“ç±»"><a href="#åº“å­˜å®ä½“ç±»" class="headerlink" title="åº“å­˜å®ä½“ç±»"></a>åº“å­˜å®ä½“ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº§å“id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ€»åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer total;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å·²ç”¨åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer used;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰©ä½™åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer residue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Daoæ¥å£åŠå®ç°-1"><a href="#Daoæ¥å£åŠå®ç°-1" class="headerlink" title="Daoæ¥å£åŠå®ç°"></a>Daoæ¥å£åŠå®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageDao</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(<span class="meta">@Param(&quot;productId&quot;)</span> Long productId, <span class="meta">@Param(&quot;count&quot;)</span> Integer count)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>StorageMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jcvv.springcloud.dao.StorageDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.jcvv.springcloud.domain.Storage&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;product_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;productId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total&quot;</span> <span class="attr">property</span>=<span class="string">&quot;total&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;used&quot;</span> <span class="attr">property</span>=<span class="string">&quot;used&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">property</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;decrease&quot;</span>&gt;</span></span><br><span class="line">        UPDATE t_storage</span><br><span class="line">        SET used    = used + #&#123;count&#125;,</span><br><span class="line">            residue = residue - #&#123;count&#125;</span><br><span class="line">        WHERE product_id = #&#123;productId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Serviceæ¥å£åŠå®ç°-1"><a href="#Serviceæ¥å£åŠå®ç°-1" class="headerlink" title="Serviceæ¥å£åŠå®ç°"></a>Serviceæ¥å£åŠå®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long productId, Integer count)</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(StorageServiceImpl.class);</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageDao storageDao;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long productId, Integer count)</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹&quot;</span>);</span><br><span class="line">        storageDao.decrease(productId,count);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerç±»"><a href="#Controllerç±»" class="headerlink" title="Controllerç±»"></a>Controllerç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡åº“å­˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/storage/decrease&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">decrease</span><span class="params">(Long productId, Integer count)</span> &#123;</span><br><span class="line">        storageService.decrease(productId, count);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;æ‰£å‡åº“å­˜æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Configé…ç½®"><a href="#Configé…ç½®" class="headerlink" title="Configé…ç½®"></a>Configé…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MyBatisConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/3 16:17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.jcvv.springcloud.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> DataSourceProxyConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/3 16:17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>());</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3ã€Seataä¹‹Account-Moduleé…ç½®æ­å»º"><a href="#5-3ã€Seataä¹‹Account-Moduleé…ç½®æ­å»º" class="headerlink" title="5-3ã€Seataä¹‹Account-Moduleé…ç½®æ­å»º"></a>5-3ã€Seataä¹‹Account-Moduleé…ç½®æ­å»º</h3><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-account-service2003<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--nacos--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--feign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2003</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata-account-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="comment"># è‡ªå®šä¹‰äº‹åŠ¡ç»„ï¼Œéœ€è¦å’Œå½“æ—¶åœ¨ seata/conf/file.conf ä¸­çš„ä¸€è‡´</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">jcvv_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://119.3.211.104:3306/seata_account?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œè¿™æ˜¯è‡ªå®šä¹‰çš„ï¼ŒåŸæ¥çš„æ˜¯mapper_locations</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure><p>å°† seata/conf ä¸‹çš„ file.conf ï¼Œregistry.conf ç§»åˆ° rescources ç›®å½•ä¸‹</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_13.png" alt=""></p><h4 id="ä¸»å¯åŠ¨ç±»-2"><a href="#ä¸»å¯åŠ¨ç±»-2" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SeataAccountMain2003</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/3 16:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataAccountMain2003</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">    &#123;</span><br><span class="line">        SpringApplication.run(SeataAccountMain2003.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="è´¦å·å®ä½“ç±»"><a href="#è´¦å·å®ä½“ç±»" class="headerlink" title="è´¦å·å®ä½“ç±»"></a>è´¦å·å®ä½“ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ€»é¢åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal total;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å·²ç”¨é¢åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal used;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰©ä½™é¢åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal residue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Daoæ¥å£åŠå®ç°-2"><a href="#Daoæ¥å£åŠå®ç°-2" class="headerlink" title="Daoæ¥å£åŠå®ç°"></a>Daoæ¥å£åŠå®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId, <span class="meta">@Param(&quot;money&quot;)</span> BigDecimal money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AccountMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.springcloud.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.springcloud.domain.Account&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total&quot;</span> <span class="attr">property</span>=<span class="string">&quot;total&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;used&quot;</span> <span class="attr">property</span>=<span class="string">&quot;used&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">property</span>=<span class="string">&quot;residue&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;decrease&quot;</span>&gt;</span></span><br><span class="line">        UPDATE t_account</span><br><span class="line">        SET</span><br><span class="line">          residue = residue - #&#123;money&#125;,used = used + #&#123;money&#125;</span><br><span class="line">        WHERE</span><br><span class="line">          user_id = #&#123;userId&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Serviceæ¥å£åŠå®ç°-2"><a href="#Serviceæ¥å£åŠå®ç°-2" class="headerlink" title="Serviceæ¥å£åŠå®ç°"></a>Serviceæ¥å£åŠå®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId ç”¨æˆ·id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(AccountServiceImpl.class);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AccountDao accountDao;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long userId, BigDecimal money)</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢å¼€å§‹&quot;</span>);</span><br><span class="line">        accountDao.decrease(userId,money);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controllerç±»-1"><a href="#Controllerç±»-1" class="headerlink" title="Controllerç±»"></a>Controllerç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AccountService accountService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/account/decrease&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">decrease</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> BigDecimal money)</span>&#123;</span><br><span class="line">        accountService.decrease(userId,money);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;æ‰£å‡è´¦æˆ·ä½™é¢æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Configé…ç½®-1"><a href="#Configé…ç½®-1" class="headerlink" title="Configé…ç½®"></a>Configé…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MyBatisConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/3 16:44</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.jcvv.springcloud.dao&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> DataSourceProxyConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/3 16:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>());</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6ã€Seataä¹‹-GlobalTransactionaléªŒè¯"><a href="#6ã€Seataä¹‹-GlobalTransactionaléªŒè¯" class="headerlink" title="6ã€Seataä¹‹@GlobalTransactionaléªŒè¯"></a>6ã€Seataä¹‹@GlobalTransactionaléªŒè¯</h2><h3 id="6-1ã€æ­£å¸¸æƒ…å†µæ¼”ç¤º"><a href="#6-1ã€æ­£å¸¸æƒ…å†µæ¼”ç¤º" class="headerlink" title="6-1ã€æ­£å¸¸æƒ…å†µæ¼”ç¤º"></a>6-1ã€æ­£å¸¸æƒ…å†µæ¼”ç¤º</h3><p>ä¸‹è®¢å• -&gt; å‡åº“å­˜ -&gt; æ‰£ä½™é¢ -&gt; æ”¹ï¼ˆè®¢å•ï¼‰çŠ¶æ€</p><p>å¯åŠ¨nacosï¼Œseataï¼ŒåŠä¸‰ä¸ªå¾®æœåŠ¡</p><p>æ•°æ®åº“åˆå§‹æƒ…å†µï¼š</p><p>åº“å­˜è¡¨ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_åº“å­˜è¡¨.png" alt=""></p><p>è®¢å•è¡¨ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_è®¢å•è¡¨.png" alt=""></p><p>è´¦æˆ·è¡¨ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_è´¦æˆ·è¡¨.png" alt=""></p><p>æ­£å¸¸ä¸‹å•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100</span></span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_5.png" alt=""></p><p>æ•°æ®åº“æ­£å¸¸ä¸‹å•åçŠ¶å†µï¼š</p><p>åº“å­˜è¡¨ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_æ­£å¸¸ä¸‹å•åº“å­˜è¡¨.png" alt=""></p><p>è®¢å•è¡¨ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_æ­£å¸¸ä¸‹å•è®¢å•è¡¨.png" alt=""></p><p>è´¦æˆ·è¡¨ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_æ­£å¸¸ä¸‹å•è´¦æˆ·è¡¨.png" alt=""></p><h3 id="6-2ã€è¶…æ—¶å¼‚å¸¸ï¼Œæ²¡åŠ -GlobalTransactional"><a href="#6-2ã€è¶…æ—¶å¼‚å¸¸ï¼Œæ²¡åŠ -GlobalTransactional" class="headerlink" title="6-2ã€è¶…æ—¶å¼‚å¸¸ï¼Œæ²¡åŠ @GlobalTransactional"></a>6-2ã€<strong>è¶…æ—¶å¼‚å¸¸ï¼Œæ²¡åŠ @GlobalTransactional</strong></h3><p>AccountServiceImplæ·»åŠ è¶…æ—¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(AccountServiceImpl.class);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AccountDao accountDao;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰£å‡è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrease</span><span class="params">(Long userId, BigDecimal money)</span> &#123;</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢å¼€å§‹&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿè¶…æ—¶å¼‚å¸¸ï¼Œå…¨å±€äº‹åŠ¡å›æ»š</span></span><br><span class="line">        <span class="comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">30</span>); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125;</span><br><span class="line">        accountDao.decrease(userId,money);</span><br><span class="line">        LOGGER.info(<span class="string">&quot;-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OpenFeignçš„è°ƒç”¨é»˜è®¤æ—¶é—´æ˜¯1sä»¥å†…ï¼Œæ‰€ä»¥æœ€åä¼šæŠ›å¼‚å¸¸ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_è¶…æ—¶å¼‚å¸¸.png" alt=""></p><p>æ•°æ®åº“æƒ…å†µï¼š</p><p>è´¦æˆ·è¡¨ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_è¶…æ—¶å¼‚å¸¸è´¦æˆ·è¡¨.png" alt=""></p><p>è®¢å•è¡¨ï¼š </p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_è¶…æ—¶å¼‚å¸¸è®¢å•è¡¨.png" alt=""></p><p>åº“å­˜è¡¨ï¼š </p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_è¶…æ—¶å¼‚å¸¸åº“å­˜è¡¨.png" alt=""></p><p><strong>æ•…éšœæƒ…å†µ</strong></p><ul><li>å½“åº“å­˜å’Œè´¦æˆ·é‡‘é¢æ‰£å‡åï¼Œè®¢å•çŠ¶æ€å¹¶æ²¡æœ‰è®¾ç½®ä¸ºå·²ç»å®Œæˆï¼Œæ²¡æœ‰ä»é›¶æ”¹ä¸º1</li><li>è€Œä¸”ç”±äºfeignçš„é‡è¯•æœºåˆ¶ï¼Œè´¦æˆ·ä½™é¢è¿˜æœ‰å¯èƒ½è¢«å¤šæ¬¡æ‰£å‡</li></ul><h3 id="6-3ã€è¶…æ—¶å¼‚å¸¸ï¼ŒåŠ äº†-GlobalTransactional"><a href="#6-3ã€è¶…æ—¶å¼‚å¸¸ï¼ŒåŠ äº†-GlobalTransactional" class="headerlink" title="6-3ã€è¶…æ—¶å¼‚å¸¸ï¼ŒåŠ äº†@GlobalTransactional"></a><strong>6-3ã€è¶…æ—¶å¼‚å¸¸ï¼ŒåŠ äº†@GlobalTransactional</strong></h3><p>ç”¨@GlobalTransactionalæ ‡æ³¨OrderServiceImplçš„create()æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderDao orderDao;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * ç®€å•è¯´ï¼š</span></span><br><span class="line"><span class="comment">     * ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;å‡ä½™é¢-&gt;æ”¹çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@GlobalTransactional(name = &quot;fsp-create-order&quot;,rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;ä¸‹å•å¼€å§‹&quot;</span>);</span><br><span class="line">        <span class="comment">//æœ¬åº”ç”¨åˆ›å»ºè®¢å•</span></span><br><span class="line">        orderDao.create(order);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹&quot;</span>);</span><br><span class="line">        storageService.decrease(order.getProductId(),order.getCount());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡ä½™é¢</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢å¼€å§‹&quot;</span>);</span><br><span class="line">        accountService.decrease(order.getUserId(),order.getMoney());</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢ç»“æŸ&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ</span></span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹&quot;</span>);</span><br><span class="line">        orderDao.update(order.getUserId(),<span class="number">0</span>);</span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">&quot;-------&gt;ä¸‹å•ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯æ¨¡æ‹ŸAccountServiceImplæ·»åŠ è¶…æ—¶ï¼Œä¸‹å•åæ•°æ®åº“æ•°æ®å¹¶æ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œè®°å½•éƒ½æ·»åŠ ä¸è¿›æ¥ï¼Œ<strong>è¾¾åˆ°å‡ºå¼‚å¸¸ï¼Œæ•°æ®åº“å›æ»šçš„æ•ˆæœ</strong>ã€‚</p><h2 id="7ã€Seataä¹‹åŸç†ç®€ä»‹"><a href="#7ã€Seataä¹‹åŸç†ç®€ä»‹" class="headerlink" title="7ã€Seataä¹‹åŸç†ç®€ä»‹"></a>7ã€Seataä¹‹åŸç†ç®€ä»‹</h2><p>2019å¹´1æœˆä»½èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p><p>Simple Extensible Autonomous Transaction Architectureï¼Œç®€å•å¯æ‰©å±•è‡ªæ²»äº‹åŠ¡æ¡†æ¶ã€‚</p><p>2020èµ·å§‹ï¼Œç”¨1.0ä»¥åçš„ç‰ˆæœ¬ã€‚Alina Gingertail</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_6.png" alt=""></p><ul><li>TC (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…</li><li>TM (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨</li><li>RM (Resource Manager) - èµ„æºç®¡ç†å™¨</li></ul><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡çš„æ‰§è¡Œæµç¨‹</strong></p><ul><li>TMå¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡(TMå‘TCæ³¨å†Œå…¨å±€äº‹åŠ¡è®°å½•) ;</li><li>æŒ‰ä¸šåŠ¡åœºæ™¯ï¼Œç¼–æ’æ•°æ®åº“ã€æœåŠ¡ç­‰äº‹åŠ¡å†…èµ„æº(RMå‘TCæ±‡æŠ¥èµ„æºå‡†å¤‡çŠ¶æ€) ;</li><li>TMç»“æŸåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€é˜¶æ®µç»“æŸ(TMé€šçŸ¥TCæäº¤/å›æ»šåˆ†å¸ƒå¼äº‹åŠ¡) ;</li><li>TCæ±‡æ€»äº‹åŠ¡ä¿¡æ¯ï¼Œå†³å®šåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼›</li><li>TCé€šçŸ¥æ‰€æœ‰RMæäº¤/å›æ»šèµ„æºï¼Œäº‹åŠ¡äºŒé˜¶æ®µç»“æŸã€‚</li></ul><p><strong>ATæ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥</strong></p><p>æ˜¯ä»€ä¹ˆ</p><blockquote><p>å‰æ</p><ul><li>åŸºäºæ”¯æŒæœ¬åœ° ACID äº‹åŠ¡çš„å…³ç³»å‹æ•°æ®åº“ã€‚</li><li>Java åº”ç”¨ï¼Œé€šè¿‡ JDBC è®¿é—®æ•°æ®åº“ã€‚</li></ul><p>æ•´ä½“æœºåˆ¶</p><p>ä¸¤é˜¶æ®µæäº¤åè®®çš„æ¼”å˜ï¼š</p><ul><li>ä¸€é˜¶æ®µï¼šä¸šåŠ¡æ•°æ®å’Œå›æ»šæ—¥å¿—è®°å½•åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤ï¼Œé‡Šæ”¾æœ¬åœ°é”å’Œè¿æ¥èµ„æºã€‚</li><li>äºŒé˜¶æ®µï¼š<ul><li>æäº¤å¼‚æ­¥åŒ–ï¼Œéå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚</li><li>å›æ»šé€šè¿‡ä¸€é˜¶æ®µçš„å›æ»šæ—¥å¿—è¿›è¡Œåå‘è¡¥å¿ã€‚</li></ul></li></ul></blockquote><p>ä¸€é˜¶æ®µåŠ è½½</p><p>åœ¨ä¸€é˜¶æ®µï¼ŒSeataä¼šæ‹¦æˆªâ€œä¸šåŠ¡SQLâ€</p><ol><li>è§£æSQLè¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡SQLâ€ è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€before imageâ€</li><li>æ‰§è¡Œâ€œä¸šåŠ¡SQLâ€ æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹å,</li><li>å…¶ä¿å­˜æˆâ€after imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚</li></ol><p>ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆ, è¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_7.png" alt=""></p><p>äºŒé˜¶æ®µæäº¤ </p><p>äºŒé˜¶æ®µå¦‚æœé¡ºåˆ©æäº¤çš„è¯ï¼Œå› ä¸ºâ€ä¸šåŠ¡SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œæ‰€ä»¥Seataæ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_8.png" alt=""></p><p>äºŒé˜¶æ®µå›æ»š</p><p>äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„ â€œä¸šåŠ¡SQLâ€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚</p><p>å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€before imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œâ€after imageâ€ã€‚</p><p>å¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œ å¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™, å‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_9.png" alt=""></p><p>è¡¥å……</p><p><img src="https://picbed.jnchan.top/springcloudImages/23seata_10.png" alt=""></p><h2 id="8ã€seataé—ç•™é”™è¯¯é—®é¢˜"><a href="#8ã€seataé—ç•™é”™è¯¯é—®é¢˜" class="headerlink" title="8ã€seataé—ç•™é”™è¯¯é—®é¢˜"></a>8ã€seataé—ç•™é”™è¯¯é—®é¢˜</h2><p>æŠ¥é”™å¦‚ä¸‹ï¼š</p><p><code>0101 can not connect to 119.3.211.104:8091 cause:can not register RM,err:can not connect to services-server.</code></p><p>è§£å†³æ–¹å¼ï¼š</p><p>æš‚æ— è§£å†³ï¼Œæ—¶å¥½æ—¶å</p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sentinelå®ç°ç†”æ–­ä¸é™æµ</title>
      <link href="/2023/06/12/Sentinel%E5%AE%9E%E7%8E%B0%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81/"/>
      <url>/2023/06/12/Sentinel%E5%AE%9E%E7%8E%B0%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h1 id="Sentinel-å®ç°ç†”æ–­ä¸é™æµ"><a href="#Sentinel-å®ç°ç†”æ–­ä¸é™æµ" class="headerlink" title="Sentinel å®ç°ç†”æ–­ä¸é™æµ"></a>Sentinel å®ç°ç†”æ–­ä¸é™æµ</h1><h2 id="1ã€Sentinel-ä»‹ç»"><a href="#1ã€Sentinel-ä»‹ç»" class="headerlink" title="1ã€Sentinel ä»‹ç»"></a>1ã€Sentinel ä»‹ç»</h2><p><a href="https://github.com/alibaba/Sentinel">å®˜æ–¹ Github</a></p><p><a href="https://sentinelguard.io/zh-cn/docs/introduction.html">å®˜æ–¹æ–‡æ¡£</a></p><h3 id="1-1ã€æ˜¯ä»€ä¹ˆ"><a href="#1-1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-1ã€æ˜¯ä»€ä¹ˆ"></a>1-1ã€æ˜¯ä»€ä¹ˆ</h3><p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚<font color='red'><strong>Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</strong></font></p><p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p><ul><li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ï¼š</strong>Sentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li><li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§ï¼š</strong>Sentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li><li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€ï¼š</strong>Sentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚</li><li><strong>å®Œå–„çš„ SPI æ‰©å±•ç‚¹ï¼š</strong>Sentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li></ul><p>Sentinel çš„ä¸»è¦ç‰¹æ€§ï¼š<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel.png" alt=""></p><p>â€”å¥è¯è§£é‡Šï¼Œä¹‹å‰æˆ‘ä»¬è®²è§£è¿‡çš„<strong>Hystrix</strong>ã€‚</p><h3 id="2-2ã€Hystrix-ä¸-Sentinel-æ¯”è¾ƒ"><a href="#2-2ã€Hystrix-ä¸-Sentinel-æ¯”è¾ƒ" class="headerlink" title="2-2ã€Hystrix ä¸ Sentinel æ¯”è¾ƒ"></a>2-2ã€Hystrix ä¸ Sentinel æ¯”è¾ƒ</h3><p>Hystrixï¼š</p><ul><li><p>éœ€è¦æˆ‘ä»¬ç¨‹åºå‘˜è‡ªå·±æ‰‹å·¥æ­å»ºç›‘æ§å¹³å°</p></li><li><p>æ²¡æœ‰ä¸€å¥— web ç•Œé¢å¯ä»¥ç»™æˆ‘ä»¬è¿›è¡Œæ›´åŠ ç»†ç²’åº¦åŒ–å¾—é…ç½®æµæ§ã€é€Ÿç‡æ§åˆ¶ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§</p></li></ul><p>Sentinelï¼š</p><ul><li>å•ç‹¬ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹å‡ºæ¥ã€‚</li><li>ç›´æ¥ç•Œé¢åŒ–çš„ç»†ç²’åº¦ç»Ÿä¸€é…ç½®ã€‚</li></ul><p>çº¦å®š &gt; é…ç½® &gt; ç¼–ç </p><p>éƒ½å¯ä»¥å†™åœ¨ä»£ç é‡Œé¢ï¼Œä½†æ˜¯æˆ‘ä»¬æœ¬æ¬¡è¿˜æ˜¯å¤§è§„æ¨¡çš„å­¦ä¹ ä½¿ç”¨é…ç½®å’Œæ³¨è§£çš„æ–¹å¼ï¼Œå°½é‡å°‘å†™ä»£ç </p><h2 id="2ã€Sentinel-ä¸‹è½½å®‰è£…è¿è¡Œ"><a href="#2ã€Sentinel-ä¸‹è½½å®‰è£…è¿è¡Œ" class="headerlink" title="2ã€Sentinel ä¸‹è½½å®‰è£…è¿è¡Œ"></a>2ã€Sentinel ä¸‹è½½å®‰è£…è¿è¡Œ</h2><p><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel">å®˜æ–¹æ–‡æ¡£</a></p><p>æœåŠ¡ä½¿ç”¨ä¸­çš„å„ç§é—®é¢˜ï¼š</p><ul><li><p>æœåŠ¡é›ªå´©</p></li><li><p>æœåŠ¡é™çº§</p></li><li>æœåŠ¡ç†”æ–­</li><li>æœåŠ¡é™æµ</li></ul><p>Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚</p></li><li><p>æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚</p></li></ul><h4 id="2-1ã€å®‰è£…æ­¥éª¤"><a href="#2-1ã€å®‰è£…æ­¥éª¤" class="headerlink" title="2-1ã€å®‰è£…æ­¥éª¤"></a>2-1ã€å®‰è£…æ­¥éª¤</h4><h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><p><a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel2.png" alt=""></p><h4 id="è¿è¡Œå‘½ä»¤"><a href="#è¿è¡Œå‘½ä»¤" class="headerlink" title="è¿è¡Œå‘½ä»¤"></a><strong>è¿è¡Œå‘½ä»¤</strong></h4><p>å‰æï¼šjava8 ç¯å¢ƒ OK + 8080 ç«¯å£ä¸èƒ½è¢«å ç”¨</p><p>è¿è¡Œå‘½ä»¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard-<span class="number">1.7</span><span class="number">.1</span>.jar</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘çš„ 8080 ç«¯å£è¢«å ç”¨ï¼Œæˆ‘æ¢æˆäº† 8888 ç«¯å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard-<span class="number">1.7</span><span class="number">.1</span>.jar --server.port=<span class="number">8888</span></span><br></pre></td></tr></table></figure><h4 id="è®¿é—®-sentinel-ç®¡ç†ç•Œé¢"><a href="#è®¿é—®-sentinel-ç®¡ç†ç•Œé¢" class="headerlink" title="è®¿é—® sentinel ç®¡ç†ç•Œé¢"></a><strong>è®¿é—® sentinel ç®¡ç†ç•Œé¢</strong></h4><p><a href="http://localhost:8080ï¼Œç™»å½•è´¦å·å¯†ç å‡ä¸º">http://localhost:8080ï¼Œç™»å½•è´¦å·å¯†ç å‡ä¸º</a> sentinel</p><p><img src="" alt=""></p><h2 id="3ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"><a href="#3ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" class="headerlink" title="3ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"></a>3ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹</h2><p>å¯åŠ¨ Nacos8848 æˆåŠŸ</p><h3 id="3-1ã€æ–°å»º-cloudalibaba-sentinel-service8401"><a href="#3-1ã€æ–°å»º-cloudalibaba-sentinel-service8401" class="headerlink" title="3-1ã€æ–°å»º cloudalibaba-sentinel-service8401"></a>3-1ã€æ–°å»º cloudalibaba-sentinel-service8401</h3><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-sentinel-service8401<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--         åç»­åšSentinelçš„æŒä¹…åŒ–ä¼šç”¨åˆ°çš„ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-transport-simple-http<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos ä¾èµ–,Nacos Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springbootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¸¸é€šç”¨jaråŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="comment"># æœåŠ¡æ³¨å†Œä¸­å¿ƒ # sentinelæ³¨å†Œè¿›nacos</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">transport:</span></span><br><span class="line">                <span class="comment"># é…ç½® Sentinel Dashboard çš„åœ°å€</span></span><br><span class="line">                <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">                <span class="comment"># é»˜è®¤8719 ï¼Œå¦‚æœç«¯å£è¢«å ç”¨ï¼Œç«¯å£å·ä¼šè‡ªåŠ¨ +1ï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ï¼Œæä¾›ç»™ sentinel çš„ç›‘æ§ç«¯å£</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">                <span class="attr">client-ip:</span> <span class="string">localhost</span> <span class="comment">#ç”µè„‘ipåœ°å€</span></span><br><span class="line">            <span class="attr">eager:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MainApp8401</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/27 14:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp8401</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        System.setProperty(TransportConfig.HEARTBEAT_CLIENT_IP, &quot;localhost&quot;);</span></span><br><span class="line">        SpringApplication.run(MainApp8401.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚"><a href="#controller-å±‚" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> FlowLimitController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/27 14:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowLimitController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testB</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;...testB&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ç©ºç©ºå¦‚ä¹Ÿï¼Œå•¥éƒ½æ²¡æœ‰</p><p>Sentinel é‡‡ç”¨çš„æ‡’åŠ è½½è¯´æ˜ï¼š</p><p>æ‰§è¡Œä¸€æ¬¡è®¿é—®å³å¯ï¼š<a href="http://localhost:8401/testAã€http://localhost:8401/testB">http://localhost:8401/testAã€http://localhost:8401/testB</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel_test.png" alt=""></p><p>ç»“è®ºï¼šsentinel8080 æ­£åœ¨ç›‘æ§å¾®æœåŠ¡ 8401</p><h5 id="é‡åˆ°é—®é¢˜"><a href="#é‡åˆ°é—®é¢˜" class="headerlink" title="é‡åˆ°é—®é¢˜"></a>é‡åˆ°é—®é¢˜</h5><ul><li>é—®é¢˜ 1</li></ul><p>â€‹ æ³¨æ„ï¼š<strong>äº‘æœåŠ¡å™¨</strong>çš„è¦å¼€æ”¾ 8719 ç«¯å£ï¼Œä¸”<strong>é¡¹ç›®ä¹Ÿå¿…é¡»åœ¨æœåŠ¡å™¨ä¸Š</strong>ã€‚</p><p>â€‹ <font color='red'><strong>ç™¾åº¦ä¸€ä¸‹ï¼Œç½‘ä¸Šå…³äºè§£å†³é”™è¯¯ç®€ç›´æ˜¯èƒ¡è¨€ä¹±è¯­ã€‚æ‰¯æ·¡æˆåˆ†å¤ªå¤šäº†ï¼Œå¦ˆäº†ä¸ªå·´å­çš„ï¼Œå®³çš„æˆ‘ç ”ç©¶äº†ä¸€å¤©</strong></font></p><p>â€‹ åŸå› ï¼šè¦ä½¿ç”¨ sentinelï¼Œå¿…é¡»åŒæ–¹éƒ½èƒ½è¿é€šï¼Œè€ŒæœåŠ¡å™¨ç½‘ç»œ ping ä¸é€šæœ¬æœºç½‘ç»œ</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://huaweicloud.csdn.net/633113d9d3efff3090b51790.html">https://huaweicloud.csdn.net/633113d9d3efff3090b51790.html</a></p><ul><li>é—®é¢˜ 2</li></ul><p>â€‹ é‡åˆ° timeout ä¹‹ç±»çš„é”™è¯¯</p><p>â€‹ è§£å†³æ–¹å¼ï¼šæ·»åŠ <code>client-ip</code> å³ <code>sentinel.transport.client-ip:192.168.43.116</code> å…¶ä¸­è¿™é‡Œçš„åœ°å€ä¸ºé¡¹ç›®å¯åŠ¨è®¾å¤‡çš„ ip åœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="comment"># æœåŠ¡æ³¨å†Œä¸­å¿ƒ # sentinelæ³¨å†Œè¿›nacos</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">transport:</span></span><br><span class="line">                <span class="comment"># é…ç½® Sentinel Dashboard çš„åœ°å€</span></span><br><span class="line">                <span class="attr">dashboard:</span> <span class="number">192.168</span><span class="number">.43</span><span class="number">.116</span><span class="string">:8080</span></span><br><span class="line">                <span class="comment"># é»˜è®¤8719 ï¼Œå¦‚æœç«¯å£è¢«å ç”¨ï¼Œç«¯å£å·ä¼šè‡ªåŠ¨ +1ï¼Œç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ï¼Œæä¾›ç»™ sentinel çš„ç›‘æ§ç«¯å£</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">                <span class="attr">client-ip:</span> <span class="number">192.168</span><span class="number">.43</span><span class="number">.116</span> <span class="comment">#ç”µè„‘ipåœ°å€</span></span><br><span class="line">            <span class="attr">eager:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="4ã€æµæ§è§„åˆ™"><a href="#4ã€æµæ§è§„åˆ™" class="headerlink" title="4ã€æµæ§è§„åˆ™"></a>4ã€æµæ§è§„åˆ™</h2><h3 id="4-1ã€åŸºæœ¬ä»‹ç»"><a href="#4-1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="4-1ã€åŸºæœ¬ä»‹ç»"></a>4-1ã€åŸºæœ¬ä»‹ç»</h3><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel3.png" alt=""></p><h4 id="è§£é‡Šè¯´æ˜"><a href="#è§£é‡Šè¯´æ˜" class="headerlink" title="è§£é‡Šè¯´æ˜"></a>è§£é‡Šè¯´æ˜</h4><ul><li><p>èµ„æºåï¼šå”¯ä¸€åç§°ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„</p></li><li><p>é’ˆå¯¹æ¥æºï¼šsentinel å¯ä»¥é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡åï¼Œé»˜è®¤ defaultï¼ˆä¸åŒºåˆ†æ¥æºï¼‰</p></li><li><p>é˜ˆå€¼ç±»å‹/å•æœºå€¼ï¼š</p><ul><li><p>QPSï¼ˆæ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼‰ï¼šå½“è°ƒç”¨è¯¥ api å°± QPS è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</p></li><li><p>çº¿ç¨‹æ•°ï¼å½“è°ƒç”¨è¯¥ api çš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</p></li></ul></li><li><p>æ˜¯å¦é›†ç¾¤ï¼šä¸éœ€è¦é›†ç¾¤</p></li><li><p>æµæ§æ¨¡å¼ï¼š</p><ul><li><p>ç›´æ¥ï¼šapi è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œç›´æ¥é™æµã€‚åˆ†ä¸º QPS å’Œçº¿ç¨‹æ•°</p></li><li><p>å…³è”ï¼šå½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ã€‚</p></li><li><p>é“¾è·¯ï¼šåªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼ˆæŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°±è¿›è¡Œé™æµï¼‰ã€api çº§åˆ«çš„é’ˆå¯¹æ¥æºã€‘</p></li></ul></li><li><p>æµæ§æ•ˆæœï¼š</p><ul><li>å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥æŠ›å¼‚å¸¸</li><li>warm upï¼šæ ¹æ® codeFactorï¼ˆå†·åŠ è½½å› å­ï¼Œé»˜è®¤ 3ï¼‰çš„å€¼ï¼Œä»é˜ˆå€¼ codeFactorï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œæ‰è¾¾åˆ°è®¾ç½®çš„ QPS é˜ˆå€¼</li><li>æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’æ¯’ï¼Œè®©è¯·æ±‚ä»¥åŒ€é€Ÿé€šè¿‡ï¼Œé˜ˆå€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸º QPSï¼Œå¦åˆ™æ— æ•ˆ</li></ul></li></ul><h4 id="QPS-å’Œçº¿ç¨‹æ•°çš„åŒºåˆ«"><a href="#QPS-å’Œçº¿ç¨‹æ•°çš„åŒºåˆ«" class="headerlink" title="QPS å’Œçº¿ç¨‹æ•°çš„åŒºåˆ«"></a>QPS å’Œçº¿ç¨‹æ•°çš„åŒºåˆ«</h4><ul><li>QPS ç±»ä¼¼äºé“¶è¡Œçš„ä¿å®‰ï¼šæ‰€æœ‰çš„è¯·æ±‚åˆ° Sentinel åï¼Œä»–ä¼šæ ¹æ®é˜ˆå€¼æ”¾è¡Œï¼Œè¶…è¿‡æŠ¥é”™</li><li>çº¿ç¨‹æ•°ç±»ä¼¼äºé“¶è¡Œçš„çª—å£ï¼šæ‰€æœ‰çš„è¯·æ±‚ä¼šè¢«æ”¾è¿›æ¥ï¼Œä½†å¦‚æœé˜ˆå€¼è®¾ç½®ä¸º 1ï¼Œé‚£ä¹ˆå…¶ä»–çš„è¯·æ±‚å°±ä¼šæŠ¥é”™ä¹Ÿå°±æ˜¯ï¼Œé“¶è¡Œé‡Œåªæœ‰ä¸€ä¸ªçª—å£ï¼Œä¸€ä¸ªäººåœ¨åŠç†ä¸šåŠ¡ä¸­ï¼Œå…¶ä»–äººè·‘è¿‡æ¥åˆ™ä¼šå‘Šè¯‰ä½ â€œç°åœ¨ä¸è¡Œï¼Œæ²¡åˆ°ä½ â€</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel4.png" alt=""></p><h4 id="é‡è¦å±æ€§"><a href="#é‡è¦å±æ€§" class="headerlink" title="é‡è¦å±æ€§"></a><strong>é‡è¦å±æ€§</strong></h4><div class="table-container"><table><thead><tr><th>Field</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>resource</td><td>èµ„æºåï¼Œèµ„æºåæ˜¯é™æµè§„åˆ™çš„ä½œç”¨å¯¹è±¡</td><td></td></tr><tr><td>count</td><td>é™æµé˜ˆå€¼</td><td></td></tr><tr><td>grade</td><td>é™æµé˜ˆå€¼ç±»å‹ï¼ŒQPS æ¨¡å¼ï¼ˆ1ï¼‰æˆ–å¹¶å‘çº¿ç¨‹æ•°æ¨¡å¼ï¼ˆ0ï¼‰</td><td>QPS æ¨¡å¼</td></tr><tr><td>limitApp</td><td>æµæ§é’ˆå¯¹çš„è°ƒç”¨æ¥æº</td><td>defaultï¼Œä»£è¡¨ä¸åŒºåˆ†è°ƒç”¨æ¥æº</td></tr><tr><td>strategy</td><td>è°ƒç”¨å…³ç³»é™æµç­–ç•¥ï¼šç›´æ¥ã€é“¾è·¯ã€å…³è”</td><td>æ ¹æ®èµ„æºæœ¬èº«ï¼ˆç›´æ¥ï¼‰</td></tr><tr><td>controlBehavior</td><td>æµæ§æ•ˆæœï¼ˆç›´æ¥æ‹’ç»/WarmUp/åŒ€é€Ÿ+æ’é˜Ÿç­‰å¾…ï¼‰ï¼Œä¸æ”¯æŒæŒ‰è°ƒç”¨å…³ç³»é™æµ</td><td>ç›´æ¥æ‹’ç»</td></tr><tr><td>clusterMode</td><td>æ˜¯å¦é›†ç¾¤é™æµ</td><td>å¦</td></tr></tbody></table></div><h3 id="4-2ã€æµæ§æ¨¡å¼"><a href="#4-2ã€æµæ§æ¨¡å¼" class="headerlink" title="4-2ã€æµæ§æ¨¡å¼"></a>4-2ã€æµæ§æ¨¡å¼</h3><h4 id="ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"><a href="#ç›´æ¥ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"></a><strong>ç›´æ¥ï¼ˆé»˜è®¤ï¼‰</strong></h4><ul><li>ç›´æ¥-&gt;å¿«é€Ÿå¤±è´¥ï¼šç³»ç»Ÿé»˜è®¤</li><li>é…ç½®åŠè¯´æ˜ï¼šè¡¨ç¤º 1 ç§’é’Ÿå†…æŸ¥è¯¢ 1 æ¬¡å°±æ˜¯ OKï¼Œè‹¥è¶…è¿‡æ¬¡æ•° 1ï¼Œå°±ç›´æ¥-å¿«é€Ÿå¤±è´¥ï¼ŒæŠ¥é»˜è®¤é”™è¯¯</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel5.png" alt=""><br>æµ‹è¯•</p><p>è®¿é—® testB æˆåŠŸ</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel5_2.png" alt=""></p><p>æ€è€ƒ</p><p>ç›´æ¥è°ƒç”¨é»˜è®¤æŠ¥é”™ä¿¡æ¯ï¼ŒæŠ€æœ¯æ–¹é¢ OKï¼Œä½†æ˜¯å¦åº”è¯¥æœ‰æˆ‘ä»¬è‡ªå·±çš„åç»­å¤„ç†ï¼Ÿç±»ä¼¼æœ‰ä¸ª fallback çš„å…œåº•æ–¹æ³•ï¼Ÿ</p><h4 id="å…³è”"><a href="#å…³è”" class="headerlink" title="å…³è”"></a>å…³è”</h4><p>å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±<br>å½“ä¸ A å…³è”çš„èµ„æº B è¾¾åˆ°é˜€å€¼åï¼Œå°±é™æµ A è‡ªå·±<br><strong>è®¾ç½® testA</strong></p><p>å½“å…³è”èµ„æº/testB çš„ qps é˜€å€¼è¶…è¿‡ 1 æ—¶ï¼Œå°±é™æµ/testA çš„ Rest è®¿é—®åœ°å€ï¼Œ<strong>å½“å…³è”èµ„æºåˆ°é˜ˆå€¼åé™åˆ¶é…ç½®å¥½çš„èµ„æºåã€‚</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel7.png" alt=""></p><p>æµ‹è¯•</p><p>è®¿é—® testB æˆåŠŸ</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel7_2.png" alt=""></p><p>postman é‡Œæ–°å»ºå¤šçº¿ç¨‹é›†åˆç»„ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel8.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel8_2.png" alt=""></p><p>Runï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel9.png" alt=""></p><p>20 ä¸ªçº¿ç¨‹ï¼Œæ¯éš” 0.3s è®¿é—®ä¸€æ¬¡</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel9_2.png" alt=""></p><p>è¿è¡Œåå‘ç° testA æŒ‚äº†ï¼Œç‚¹å‡»è®¿é—®ï¼š<a href="http://localhost:8401/testA">http://localhost:8401/testA</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel9_3.png" alt=""></p><h4 id="é“¾è·¯"><a href="#é“¾è·¯" class="headerlink" title="é“¾è·¯"></a>é“¾è·¯</h4><p>åªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼ˆæŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°±è¿›è¡Œé™æµ)ã€API çº§åˆ«çš„é’ˆå¯¹æ¥æºã€‘</p><h3 id="4-3ã€æµæ§æ•ˆæœ"><a href="#4-3ã€æµæ§æ•ˆæœ" class="headerlink" title="4-3ã€æµæ§æ•ˆæœ"></a>4-3ã€æµæ§æ•ˆæœ</h3><h4 id="å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤çš„æµæ§å¤„ç†ï¼‰"><a href="#å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤çš„æµæ§å¤„ç†ï¼‰" class="headerlink" title="å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤çš„æµæ§å¤„ç†ï¼‰"></a>å¿«é€Ÿå¤±è´¥ï¼ˆé»˜è®¤çš„æµæ§å¤„ç†ï¼‰</h4><p>ç›´æ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼šBlocked by Sentinel (flow limiting)</p><h4 id="é¢„çƒ­"><a href="#é¢„çƒ­" class="headerlink" title="é¢„çƒ­"></a>é¢„çƒ­</h4><p>Warm Upï¼ˆ<font color='red'><strong>RuleConstant.CONTROL_BEHAVIOR_WARM_UP</strong></font>ï¼‰æ–¹å¼ï¼Œå³é¢„çƒ­/å†·å¯åŠ¨æ–¹å¼ã€‚å½“ç³»ç»Ÿé•¿æœŸå¤„äºä½æ°´ä½çš„æƒ…å†µä¸‹ï¼Œå½“æµé‡çªç„¶å¢åŠ æ—¶ï¼Œç›´æ¥æŠŠç³»ç»Ÿæ‹‰å‡åˆ°é«˜æ°´ä½å¯èƒ½ç¬é—´æŠŠç³»ç»Ÿå‹å®ã€‚é€šè¿‡â€å†·å¯åŠ¨â€ï¼Œè®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®ã€‚è¯¦ç»†æ–‡æ¡£å¯ä»¥å‚è€ƒ <a href="https://github.com/alibaba/Sentinel/wiki/é™æµ---å†·å¯åŠ¨">æµé‡æ§åˆ¶ - Warm Up æ–‡æ¡£</a>ï¼Œå…·ä½“çš„ä¾‹å­å¯å‚è§<a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/WarmUpFlowDemo.java">WarmUpFlowDemo</a></p><p>é€šå¸¸å†·å¯åŠ¨çš„è¿‡ç¨‹ç³»ç»Ÿå…è®¸é€šè¿‡çš„ QPS æ›²çº¿å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel_qps.png" alt=""></p><h4 id="WarmUp-é…ç½®"><a href="#WarmUp-é…ç½®" class="headerlink" title="WarmUp é…ç½®"></a>WarmUp é…ç½®</h4><p>é»˜è®¤ coldFactor ä¸º 3ï¼Œå³è¯·æ±‚ QPS ä»(threshold / 3) å¼€å§‹ï¼Œç»å¤šå°‘é¢„çƒ­æ—¶é•¿æ‰é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼</p><p>ç³»ç»Ÿåˆå§‹åŒ–çš„é˜€å€¼ä¸º 10 / 3 çº¦ç­‰äº 3ï¼Œå³é˜€å€¼åˆšå¼€å§‹ä¸º 3ï¼›ç„¶åè¿‡äº† 5 ç§’åé˜€å€¼æ‰æ…¢æ…¢å‡é«˜æ¢å¤åˆ° 10ã€‚æ•ˆæœä¸ºï¼šå¼€å§‹è®¿é—® localhost:/testA æ—¶æ¯ç§’è¯·æ±‚åˆ«è¶…è¿‡ 10/3 ä¸ªæ‰èƒ½æ­£å¸¸è®¿é—®ï¼Œ5 ç§’åå¯ä»¥æ¥å—çš„è¯·æ±‚å¯ä»¥è¾¾åˆ°æ¯ç§’ 10 æ¬¡ã€‚<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel10.png" alt=""></p><p><strong>åº”ç”¨åœºæ™¯</strong></p><p>ç§’æ€ç³»ç»Ÿåœ¨å¼€å¯çš„ç¬é—´ï¼Œä¼šæœ‰å¾ˆå¤šæµé‡ä¸Šæ¥ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯æŠŠä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾è¿›æ¥ï¼Œæ…¢æ…¢çš„æŠŠé˜€å€¼å¢é•¿åˆ°è®¾ç½®çš„é˜€å€¼</p><h4 id="æ’é˜Ÿç­‰å¾…"><a href="#æ’é˜Ÿç­‰å¾…" class="headerlink" title="æ’é˜Ÿç­‰å¾…"></a>æ’é˜Ÿç­‰å¾…</h4><p>åŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜€å€¼ç±»å‹å¿…é¡»è®¾æˆ QPSï¼Œå¦åˆ™æ— æ•ˆ</p><p>è®¾ç½®å«ä¹‰ï¼š/testA æ¯ç§’ 1 æ¬¡è¯·æ±‚ï¼Œè¶…è¿‡çš„è¯å°±æ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…çš„è¶…æ—¶æ—¶é—´ä¸º 20000 æ¯«ç§’<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel11.png" alt=""></p><p>è¯´æ˜ï¼šåŒ€é€Ÿæ’é˜Ÿï¼Œé˜ˆå€¼å¿…é¡»è®¾ç½®ä¸º QPS</p><p>åŒ€é€Ÿæ’é˜Ÿï¼ˆ<font color='red'><strong>RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER</strong></font>ï¼‰æ–¹å¼ä¼šä¸¥æ ¼æ§åˆ¶è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•ã€‚è¯¦ç»†æ–‡æ¡£å¯ä»¥å‚è€ƒ<a href="https://github.com/alibaba/Sentinel/wiki/æµé‡æ§åˆ¶-åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼">æµé‡æ§åˆ¶ - åŒ€é€Ÿå™¨æ¨¡å¼</a> ï¼Œå…·ä½“çš„ä¾‹å­å¯ä»¥å‚è§ <a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/PaceFlowDemo.java">PaceFlowDemo</a>ã€‚</p><p>è¯¥æ–¹å¼çš„ä½œç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel12.png" alt=""></p><h2 id="5ã€é™çº§è§„åˆ™"><a href="#5ã€é™çº§è§„åˆ™" class="headerlink" title="5ã€é™çº§è§„åˆ™"></a>5ã€é™çº§è§„åˆ™</h2><h3 id="5-1ã€ç†”æ–­é™çº§æ¦‚è¿°"><a href="#5-1ã€ç†”æ–­é™çº§æ¦‚è¿°" class="headerlink" title="5-1ã€ç†”æ–­é™çº§æ¦‚è¿°"></a>5-1ã€ç†”æ–­é™çº§æ¦‚è¿°</h3><p>é™¤äº†æµé‡æ§åˆ¶ä»¥å¤–ï¼Œå¯¹è°ƒç”¨é“¾è·¯ä¸­ä¸ç¨³å®šçš„èµ„æºè¿›è¡Œç†”æ–­é™çº§ä¹Ÿæ˜¯ä¿éšœé«˜å¯ç”¨çš„é‡è¦æªæ–½ä¹‹ä¸€ã€‚ä¸€ä¸ªæœåŠ¡å¸¸å¸¸ä¼šè°ƒç”¨åˆ«çš„æ¨¡å—ï¼Œå¯èƒ½æ˜¯å¦å¤–çš„ä¸€ä¸ªè¿œç¨‹æœåŠ¡ã€æ•°æ®åº“ï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹ API ç­‰ã€‚ä¾‹å¦‚ï¼Œæ”¯ä»˜çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦è¿œç¨‹è°ƒç”¨é“¶è”æä¾›çš„ APIï¼›æŸ¥è¯¢æŸä¸ªå•†å“çš„ä»·æ ¼ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ã€‚ç„¶è€Œï¼Œè¿™ä¸ªè¢«ä¾èµ–æœåŠ¡çš„ç¨³å®šæ€§æ˜¯ä¸èƒ½ä¿è¯çš„ã€‚å¦‚æœä¾èµ–çš„æœåŠ¡å‡ºç°äº†ä¸ç¨³å®šçš„æƒ…å†µï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å˜é•¿ï¼Œé‚£ä¹ˆè°ƒç”¨æœåŠ¡çš„æ–¹æ³•çš„å“åº”æ—¶é—´ä¹Ÿä¼šå˜é•¿ï¼Œçº¿ç¨‹ä¼šäº§ç”Ÿå †ç§¯ï¼Œæœ€ç»ˆå¯èƒ½è€—å°½ä¸šåŠ¡è‡ªèº«çš„çº¿ç¨‹æ± ï¼ŒæœåŠ¡æœ¬èº«ä¹Ÿå˜å¾—ä¸å¯ç”¨ã€‚</p><p>ç°ä»£å¾®æœåŠ¡æ¶æ„éƒ½æ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±éå¸¸å¤šçš„æœåŠ¡ç»„æˆã€‚ä¸åŒæœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œç»„æˆå¤æ‚çš„è°ƒç”¨é“¾è·¯ã€‚ä»¥ä¸Šçš„é—®é¢˜åœ¨é“¾è·¯è°ƒç”¨ä¸­ä¼šäº§ç”Ÿæ”¾å¤§çš„æ•ˆæœã€‚å¤æ‚é“¾è·¯ä¸Šçš„æŸä¸€ç¯ä¸ç¨³å®šï¼Œå°±å¯èƒ½ä¼šå±‚å±‚çº§è”ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªé“¾è·¯éƒ½ä¸å¯ç”¨ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹ä¸ç¨³å®šçš„<strong>å¼±ä¾èµ–æœåŠ¡è°ƒç”¨</strong>è¿›è¡Œç†”æ–­é™çº§ï¼Œæš‚æ—¶åˆ‡æ–­ä¸ç¨³å®šè°ƒç”¨ï¼Œé¿å…å±€éƒ¨ä¸ç¨³å®šå› ç´ å¯¼è‡´æ•´ä½“çš„é›ªå´©ã€‚ç†”æ–­é™çº§ä½œä¸ºä¿æŠ¤è‡ªèº«çš„æ‰‹æ®µï¼Œé€šå¸¸åœ¨å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨ç«¯ï¼‰è¿›è¡Œé…ç½®ã€‚</p><h3 id="5-2ã€é™çº§ç­–ç•¥ä»‹ç»"><a href="#5-2ã€é™çº§ç­–ç•¥ä»‹ç»" class="headerlink" title="5-2ã€é™çº§ç­–ç•¥ä»‹ç»"></a>5-2ã€é™çº§ç­–ç•¥ä»‹ç»</h3><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel13.png" alt=""></p><p>RTï¼ˆå¹³å‡å“åº”æ—¶é—´ï¼Œç§’çº§ï¼‰</p><ul><li><p>å¹³å‡å“åº”æ—¶é—´<strong>è¶…å‡ºé˜ˆå€¼</strong>ä¸”<strong>åœ¨æ—¶é—´çª—å£å†…é€šè¿‡çš„è¯·æ±‚&gt;=5</strong>ï¼Œä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³åè§¦å‘é™çº§</p></li><li><p>çª—å£æœŸè¿‡åå…³é—­æ–­è·¯å™¨</p></li><li>RT æœ€å¤§ 4900ï¼ˆæ›´å¤§çš„éœ€è¦é€šè¿‡-Dcsp.sentinel.statistic.max.rt=XXXX æ‰èƒ½ç”Ÿæ•ˆï¼‰</li></ul><p>å¼‚å¸¸æ¯”åˆ—ï¼ˆç§’çº§ï¼‰</p><ul><li><strong>QPS &gt;= 5 ä¸”å¼‚å¸¸æ¯”ä¾‹ï¼ˆç§’çº§ç»Ÿè®¡ï¼‰è¶…è¿‡é˜ˆå€¼æ—¶</strong>ï¼Œè§¦å‘é™çº§ï¼›æ—¶é—´çª—å£ç»“æŸåï¼Œå…³é—­é™çº§</li></ul><p>å¼‚å¸¸æ•°ï¼ˆåˆ†é’Ÿçº§ï¼‰</p><ul><li>å¼‚å¸¸æ•°ï¼ˆåˆ†é’Ÿç»Ÿè®¡ï¼‰è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘é™çº§ï¼›æ—¶é—´çª—å£ç»“æŸåï¼Œå…³é—­é™çº§</li></ul><p>è¿›ä¸€æ­¥è¯´æ˜ï¼š</p><p>Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯</p><p>å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º DegradeExceptionï¼‰</p><p>Sentinel çš„æ–­è·¯å™¨æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ã€‚(Sentinei 1.8.0 å·²æœ‰åŠå¼€çŠ¶æ€)</p><p>åŠå¼€çš„çŠ¶æ€ç³»ç»Ÿè‡ªåŠ¨å»æ£€æµ‹æ˜¯å¦è¯·æ±‚æœ‰å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸å°±å…³é—­æ–­è·¯å™¨æ¢å¤ä½¿ç”¨ï¼›æœ‰å¼‚å¸¸åˆ™ç»§ç»­æ‰“å¼€æ–­è·¯å™¨ä¸å¯ç”¨ã€‚å…·ä½“å¯ä»¥å‚è€ƒ Hystrix</p><h3 id="5-3ã€RT"><a href="#5-3ã€RT" class="headerlink" title="5-3ã€RT"></a>5-3ã€RT</h3><h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><blockquote><p>å¹³å‡å“åº”æ—¶é—´(<font color='red'>DEGRADE_GRADE_RT</font>)ï¼šå½“ 1s å†…æŒç»­è¿›å…¥ 5 ä¸ªè¯·æ±‚ï¼Œå¯¹åº”æ—¶åˆ»çš„å¹³å‡å“åº”æ—¶é—´ï¼ˆç§’çº§ï¼‰å‡è¶…è¿‡é˜ˆå€¼ï¼ˆ <font color='red'>count</font>ï¼Œä»¥ ms ä¸ºå•ä½ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ï¼ˆ<font color='red'>DegradeRule</font>ä¸­çš„<font color='red'>timeWindow</font>ï¼Œä»¥ s ä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°ç†”æ–­(æŠ›å‡º<font color='red'>DegradeException</font> )ã€‚æ³¨æ„ Sentinel é»˜è®¤ç»Ÿè®¡çš„ RT ä¸Šé™æ˜¯ 4900 msï¼Œè¶…å‡ºæ­¤é˜ˆå€¼çš„éƒ½ä¼šç®—ä½œ 4900msï¼Œè‹¥éœ€è¦å˜æ›´æ­¤ä¸Šé™å¯ä»¥é€šè¿‡å¯åŠ¨é…ç½®é¡¹<font color='red'>-Dcsp.sentinel.statistic.max.rt=xxx</font>æ¥é…ç½®ã€‚</p></blockquote><p><strong>æ³¨æ„</strong>ï¼šSentinel 1.7.0 æ‰æœ‰<strong>å¹³å‡å“åº”æ—¶é—´</strong>ï¼ˆ<code>DEGRADE_GRADE_RT</code>ï¼‰ï¼ŒSentinel 1.8.0 çš„æ²¡æœ‰è¿™é¡¹ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<strong>æ…¢è°ƒç”¨æ¯”ä¾‹</strong> (<code>SLOW_REQUEST_RATIO</code>)ã€‚</p><blockquote><p>æ…¢è°ƒç”¨æ¯”ä¾‹ (<font color='red'>SLOW_REQUEST_RATIO</font>)ï¼šé€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RTï¼ˆå³æœ€å¤§çš„å“åº”æ—¶é—´ï¼‰ï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨ã€‚å½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆ<font color='red'>statIntervalMs</font>ï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚ç†”æ–­é™çº§ Â· <a href="https://github.com/alibaba/Sentinel/wiki/ç†”æ–­é™çº§#ç†”æ–­ç­–ç•¥">ç†”æ–­é™çº§ Â· alibaba/Sentinel Wiki Â· GitHub</a></p></blockquote><p>æ¥ä¸‹æ¥è®²è§£ Sentinel 1.7.0 çš„ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel14.png" alt=""></p><h4 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a>å®æ“</h4><p>åœ¨ controller ä¸­åŠ å…¥ textD</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testD</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;testD æµ‹è¯•RT&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testD&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel15.png" alt=""></p><p>jmeter å‹æµ‹ï¼šæ°¸è¿œä¸€ç§’é’Ÿæ‰“è¿›æ¥ 10 ä¸ªçº¿ç¨‹ï¼ˆå¤§äº 5 ä¸ªäº†ï¼‰è°ƒç”¨ testD</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel16.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel16_2.png" alt=""></p><p>å‹æµ‹æ—¶è®¿é—® /testD</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel17.png" alt=""></p><p>åœæ­¢å‹æµ‹åï¼š`</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel17_2.png" alt=""></p><p>ç»“è®ºï¼š</p><p>æŒ‰ç…§ä¸Šè¿°é…ç½®ï¼Œæ°¸è¿œä¸€ç§’é’Ÿæ‰“è¿›æ¥ 10 ä¸ªçº¿ç¨‹ï¼ˆå¤§äº 5 ä¸ªäº†ï¼‰è°ƒç”¨ testDï¼Œæˆ‘ä»¬å¸Œæœ› 200 æ¯«ç§’å¤„ç†å®Œæœ¬æ¬¡ä»»åŠ¡ï¼Œå¦‚æœè¶…è¿‡ 200 æ¯«ç§’è¿˜æ²¡å¤„ç†å®Œï¼Œåœ¨æœªæ¥ 1 ç§’é’Ÿçš„æ—¶é—´çª—å£å†…ï¼Œæ–­è·¯å™¨æ‰“å¼€(ä¿é™©ä¸è·³é—¸)å¾®æœåŠ¡ä¸å¯ç”¨ï¼Œä¿é™©ä¸è·³é—¸æ–­ç”µäº†ï¼Œåç»­åœæ­¢ jmeterï¼Œæ²¡æœ‰è¿™ä¹ˆå¤§çš„è®¿é—®é‡äº†ï¼Œæ–­è·¯å™¨å…³é—­(ä¿é™©ä¸æ¢å¤)ï¼Œå¾®æœåŠ¡æ¢å¤æ­£å¸¸ã€‚</p><h3 id="5-4ã€å¼‚å¸¸æ¯”ä¾‹"><a href="#5-4ã€å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="5-4ã€å¼‚å¸¸æ¯”ä¾‹"></a>5-4ã€å¼‚å¸¸æ¯”ä¾‹</h3><h4 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><blockquote><p>å¼‚å¸¸æ¯”ä¾‹(<font color='red'>DEGRADE_GRADE_EXCEPTION_RATIO</font>)ï¼šå½“èµ„æºçš„æ¯ç§’è¯·æ±‚é‡ &gt;= 5ï¼Œå¹¶ä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡é˜ˆå€¼ï¼ˆ<font color='red'> DegradeRule</font>ä¸­çš„ <font color='red'>count</font>ï¼‰ä¹‹åï¼Œèµ„æºè¿›å…¥é™çº§çŠ¶æ€ï¼Œå³åœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£( <font color='red'>DegradeRule</font> ä¸­çš„ <font color='red'>timeWindow</font>ï¼Œä»¥ s ä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯<font color='red'>[0.0, 1.0]</font>ï¼Œä»£è¡¨ 0% -100%ã€‚</p></blockquote><p><strong>æ³¨æ„</strong>ï¼Œä¸ Sentinel 1.8.0 ç›¸æ¯”ï¼Œæœ‰äº›ä¸åŒï¼ˆSentinel 1.8.0 æ‰æœ‰çš„åŠå¼€çŠ¶æ€ï¼‰ï¼ŒSentinel 1.8.0 çš„å¦‚ä¸‹ï¼š</p><blockquote><p>å¼‚å¸¸æ¯”ä¾‹ (<font color='red'>ERROR_RATIO</font>)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆ<font color='red'>statIntervalMs</font>ï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯<font color='red'> [0.0, 1.0]</font>ï¼Œä»£è¡¨ 0% - 100%ã€‚<a href="https://github.com/alibaba/Sentinel/wiki/ç†”æ–­é™çº§#ç†”æ–­ç­–ç•¥">ç†”æ–­é™çº§ Â· alibaba/Sentinel Wiki Â· GitHub</a></p></blockquote><p>æ¥ä¸‹æ¥è®²è§£ Sentinel 1.7.0 çš„ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel18.png" alt=""></p><h4 id="å®æ“-1"><a href="#å®æ“-1" class="headerlink" title="å®æ“"></a>å®æ“</h4><p>åœ¨ controller ä¸­åŠ å…¥ textE</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testE</span><span class="params">()</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;testE æµ‹è¯•å¼‚å¸¸æ•°&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testE&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel19.png" alt=""></p><p>å•ç‹¬ä¸€æ¬¡è®¿é—®ï¼š<a href="http://localhost:8401/testE">http://localhost:8401/testE</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel19_1.png" alt=""></p><p>jmeter å‹æµ‹åï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel19_2.png" alt=""></p><p>ç»“è®º</p><p>æŒ‰ç…§ä¸Šè¿°é…ç½®ï¼Œå•ç‹¬è®¿é—®ä¸€æ¬¡ï¼Œå¿…ç„¶æ¥ä¸€æ¬¡æŠ¥é”™ä¸€æ¬¡(int age = 10/0)ï¼Œè°ƒä¸€æ¬¡é”™ä¸€æ¬¡ï¼›å¼€å¯ jmeter åï¼Œç›´æ¥é«˜å¹¶å‘å‘é€è¯·æ±‚ï¼Œå¤šæ¬¡è°ƒç”¨è¾¾åˆ°æˆ‘ä»¬çš„é…ç½®æ¡ä»¶äº†ã€‚</p><p>æ–­è·¯å™¨å¼€å¯(ä¿é™©ä¸è·³é—¸)ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼Œä¸å†æŠ¥é”™ error è€Œæ˜¯æœåŠ¡é™çº§äº†</p><h3 id="5-5ã€å¼‚å¸¸æ•°"><a href="#5-5ã€å¼‚å¸¸æ•°" class="headerlink" title="5-5ã€å¼‚å¸¸æ•°"></a>5-5ã€å¼‚å¸¸æ•°</h3><h4 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a><strong>ä»‹ç»</strong></h4><blockquote><p>å¼‚å¸¸æ•°( <font color='red'>DEGRADE_GRADF_EXCEPTION_COUNT</font> )ï¼šå½“èµ„æºè¿‘ 1 åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­ã€‚æ³¨æ„ç”±äºç»Ÿè®¡æ—¶é—´çª—å£æ˜¯<strong>åˆ†é’Ÿçº§åˆ«</strong>çš„ï¼Œè‹¥<font color='red'>timeWindow</font>å°äº 60sï¼Œåˆ™ç»“æŸç†”æ–­çŠ¶æ€åå¯èƒ½å†è¿›å…¥ç†”æ–­çŠ¶æ€ã€‚</p><p>è¯´æ˜ï¼šå‡è®¾æ—¶é—´çª—å£æœŸä¸º 10 ç§’ï¼Œè®¾ç½®çš„å¼‚å¸¸æ•°ä¸èƒ½è¶…è¿‡ 5ï¼Œç»Ÿè®¡é˜¶æ®µç¬¬ 1 ç§’çš„æ—¶å€™æœ‰ 5 ä¸ªå¼‚å¸¸ï¼ŒæœåŠ¡ç†”æ–­åè¿›å…¥æ—¶é—´çª—å£æœŸï¼Œæ—¶é—´çª—å£æœŸç»“æŸï¼Œä½†æ˜¯ä¸€åˆ†é’Ÿè¿˜æ²¡ç»“æŸï¼Œé‚£ä¹ˆæ­¤æ—¶çš„å¼‚å¸¸æ•°è¿˜æ˜¯ 5 ä¸ªï¼Œåˆè¿›å…¥ç†”æ–­çŠ¶æ€ã€‚</p></blockquote><p>æ³¨æ„ï¼Œä¸ Sentinel 1.8.0 ç›¸æ¯”ï¼Œæœ‰äº›ä¸åŒï¼ˆSentinel 1.8.0 æ‰æœ‰çš„åŠå¼€çŠ¶æ€ï¼‰ï¼ŒSentinel 1.8.0 çš„å¦‚ä¸‹ï¼š</p><blockquote><p>å¼‚å¸¸æ•° (<font color='red'>ERROR_COUNT</font>)ï¼šå½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</p></blockquote><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel20â€˜.png" alt=""></p><p>æ¥ä¸‹æ¥è®²è§£ Sentinel 1.7.0 çš„ã€‚</p><p><strong>å¼‚å¸¸æ•°æ˜¯æŒ‰ç…§åˆ†é’Ÿç»Ÿè®¡çš„ï¼Œæ—¶é—´çª—å£ä¸€å®šè¦å¤§äºç­‰äº 60 ç§’</strong>ã€‚</p><h4 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h4><p>é…ç½®ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel21.png" alt=""></p><p>æµ‹è¯•ï¼š</p><p>ä¸€åˆ°äº”æ¬¡è®¿é—®ä¼šæŠ¥é”™ï¼Œç¬¬å…­æ¬¡è®¿é—®åä¼šæœåŠ¡é™çº§ï¼Œç›´åˆ°æ—¶é—´çª—å£æœŸç»“æŸï¼ŒæœåŠ¡æ‰å¼€å§‹æŠ¥é”™</p><h2 id="6ã€çƒ­ç‚¹-key-é™æµ"><a href="#6ã€çƒ­ç‚¹-key-é™æµ" class="headerlink" title="6ã€çƒ­ç‚¹ key é™æµ"></a>6ã€çƒ­ç‚¹ key é™æµ</h2><h3 id="6-1ã€åŸºæœ¬ä»‹ç»"><a href="#6-1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="6-1ã€åŸºæœ¬ä»‹ç»"></a>6-1ã€åŸºæœ¬ä»‹ç»</h3><p>ä½•ä¸ºçƒ­ç‚¹ï¼šçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æˆ–è€…é™åˆ¶æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top N æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™æµæˆ–è€…å…¶å®ƒæ“ä½œï¼š</p><ul><li>å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li><li>ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li></ul><p>çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel22.png" alt=""></p><p>Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚çƒ­ç‚¹å‚æ•°é™æµæ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚<a href="https://github.com/alibaba/Sentinel/wiki/çƒ­ç‚¹å‚æ•°é™æµ#overview">çƒ­ç‚¹å‚æ•°é™æµ Â· alibaba/Sentinel Wiki Â· GitHub</a></p><p><strong>æ‰¿ä¸Šå¯ä¸‹å¤ä¹ </strong></p><p>å…œåº•æ–¹æ³•ï¼Œåˆ†ä¸º ç³»ç»Ÿé»˜è®¤ å’Œ å®¢æˆ·è‡ªå®šä¹‰ ä¸¤ç§ã€‚</p><p>ä¹‹å‰çš„æ¡ˆä¾‹ï¼Œé™æµå‡ºé—®é¢˜åï¼Œéƒ½æ˜¯ç”¨ sentinel ç³»ç»Ÿé»˜è®¤çš„æç¤º: Blocked by Sentinel (flow limiting)</p><p>æˆ‘ä»¬èƒ½ä¸èƒ½è‡ªå®šï¼Ÿç±»ä¼¼ hystrixï¼ŒæŸä¸ªæ–¹æ³•å‡ºé—®é¢˜äº†ï¼Œå°±æ‰¾å¯¹åº”çš„å…œåº•é™çº§æ–¹æ³•?</p><p>ç»“è®º - <strong>ä» HystrixCommand åˆ°@SentinelResource</strong></p><h3 id="6-2ã€å®æ“"><a href="#6-2ã€å®æ“" class="headerlink" title="6-2ã€å®æ“"></a>6-2ã€å®æ“</h3><p>åœ¨ controller ä¸­åŠ å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testHotKey&quot;,blockHandler = &quot;deal_testHotKey&quot;)</span><span class="comment">//valueå¯ä»¥ä¸ä¸getmappingä¸€æ ·ï¼Œä½†å¿…é¡»å”¯ä¸€ã€‚å½“æ–°å¢çƒ­ç‚¹è§„åˆ™æ—¶ï¼Œèµ„æºåæœ‰æ–œæ ï¼Œæ‰¾çš„æ˜¯GetMappingï¼Œæ²¡æœ‰åˆ™æ‰¾çš„æ˜¯SentinelResource</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testHotKey</span><span class="params">(<span class="meta">@RequestParam(value = &quot;p1&quot;,required = false)</span>String p1,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestParam(value = &quot;p2&quot;,required = false)</span>String p2)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKty&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deal_testHotKey</span><span class="params">(String p1, String p2, BlockException exception)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKty,o(T~~T)o&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li>@SentinelResource(value = â€œtestHotKeyâ€)å¼‚å¸¸æ‰“åˆ°äº†å‰å°ç”¨æˆ·ç•Œé¢çœ‹åˆ°ï¼Œä¸å‹å¥½</li><li>@SentinelResource(value = â€œtestHotKeyâ€,blockHandler = â€œdeal_testHotKeyâ€)æ–¹æ³• testHotKey é‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°åªè¦ QPS è¶…è¿‡æ¯ç§’ 1 æ¬¡ï¼Œé©¬ä¸Šé™çº§å¤„ç†ï¼Œå¼‚å¸¸ç”¨äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å…œåº•æ–¹æ³•ã€‚</li><li><font color='red'>**å½“æ–°å¢çƒ­ç‚¹è§„åˆ™æ—¶ï¼Œèµ„æºåæœ‰æ–œæ ï¼Œæ‰¾çš„æ˜¯ GetMappingï¼Œæ²¡æœ‰åˆ™æ‰¾çš„æ˜¯ SentinelResource**</font></li></ul><p>é…ç½®ï¼š<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel23.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel24.png" alt=""></p><ul><li><p>é™æµæ¨¡å¼åªæ”¯æŒ QPS æ¨¡å¼ï¼Œå›ºå®šå†™æ­»äº†ã€‚ï¼ˆè¿™æ‰å«çƒ­ç‚¹ï¼‰</p></li><li><p>@SentinelResource æ³¨è§£çš„æ–¹æ³•å‚æ•°ç´¢å¼•ï¼Œ0 ä»£è¡¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ1 ä»£è¡¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå•æœºé˜€å€¼ä»¥åŠç»Ÿè®¡çª—å£æ—¶é•¿è¡¨ç¤ºåœ¨æ­¤çª—å£æ—¶é—´è¶…è¿‡é˜€å€¼å°±é™æµã€‚</p></li></ul><p>ä¸Šé¢çš„æŠ“å›¾è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°æœ‰å€¼çš„è¯ï¼Œ1 ç§’çš„ QPS ä¸º 1ï¼Œè¶…è¿‡å°±é™æµï¼Œé™æµåè°ƒç”¨ deal_testHotKey æ”¯æŒæ–¹æ³•ã€‚</p><p>æµ‹è¯•ï¼š<br><img src="https://picbed.jnchan.top/springcloudImages/21sentinel25.png" alt=""></p><h3 id="6-3ã€å‚æ•°ä¾‹å¤–é¡¹"><a href="#6-3ã€å‚æ•°ä¾‹å¤–é¡¹" class="headerlink" title="6-3ã€å‚æ•°ä¾‹å¤–é¡¹"></a>6-3ã€å‚æ•°ä¾‹å¤–é¡¹</h3><p>ä¸Šè¿°æ¡ˆä¾‹æ¼”ç¤ºäº†ç¬¬ä¸€ä¸ªå‚æ•° p1ï¼Œå½“ QPS è¶…è¿‡ 1 ç§’ 1 æ¬¡ç‚¹å‡»åé©¬ä¸Šè¢«é™æµ</p><p>ç‰¹ä¾‹æƒ…å†µï¼šæˆ‘ä»¬æœŸæœ› p1 å‚æ•°å½“å®ƒæ˜¯æŸä¸ªç‰¹æ®Šå€¼æ—¶ï¼Œå®ƒçš„é™æµå€¼å’Œå¹³æ—¶ä¸ä¸€æ ·</p><p>ç‰¹ä¾‹ï¼šå‡å¦‚å½“ p1 çš„å€¼ç­‰äº 5 æ—¶ï¼Œå®ƒçš„é˜ˆå€¼å¯ä»¥è¾¾åˆ° 200</p><blockquote><p>çƒ­ç‚¹å‚æ•°çš„æ³¨æ„ç‚¹ï¼Œå‚æ•°å¿…é¡»æ˜¯åŸºæœ¬ç±»å‹æˆ–è€… String</p></blockquote><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel26.png" alt=""></p><p>æµ‹è¯•ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel27.png" alt=""></p><p>è¯´æ˜ï¼š</p><ul><li>@SentinelResource ï¼šå¤„ç†çš„æ˜¯ Sentine æ§åˆ¶å°é…ç½®çš„è¿è§„æƒ…å†µï¼Œæœ‰ blockHandler æ–¹æ³•é…ç½®çš„å…œåº•å¤„ç†</li><li>@RuntimeExceptionï¼šint age=10/0ï¼Œè¿™ä¸ªæ˜¯ java è¿è¡Œæ—¶æŠ¥å‡ºçš„è¿è¡Œæ—¶å¼‚å¼‚å¸¸ RunTimeExceptionï¼Œ@SentineResource ä¸ç®¡</li></ul><h2 id="7ã€ç³»ç»Ÿè§„åˆ™"><a href="#7ã€ç³»ç»Ÿè§„åˆ™" class="headerlink" title="7ã€ç³»ç»Ÿè§„åˆ™"></a>7ã€ç³»ç»Ÿè§„åˆ™</h2><h3 id="7-1ã€å„é¡¹é…ç½®å‚æ•°è¯´æ˜"><a href="#7-1ã€å„é¡¹é…ç½®å‚æ•°è¯´æ˜" class="headerlink" title="7-1ã€å„é¡¹é…ç½®å‚æ•°è¯´æ˜"></a>7-1ã€å„é¡¹é…ç½®å‚æ•°è¯´æ˜</h3><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel28.png" alt=""></p><h3 id="7-2ã€-SentinelResource-é…ç½®"><a href="#7-2ã€-SentinelResource-é…ç½®" class="headerlink" title="7-2ã€@SentinelResource é…ç½®"></a>7-2ã€@SentinelResource é…ç½®</h3><h4 id="æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†"><a href="#æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†" class="headerlink" title="æŒ‰èµ„æºåç§°é™æµ+åç»­å¤„ç†"></a><strong>æŒ‰èµ„æºåç§°é™æµ+åç»­å¤„ç†</strong></h4><p>pom æ–‡ä»¶å¢åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–°å¢ controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/byResource&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byResource&quot;,blockHandler = &quot;handleException&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">byResource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK&quot;</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>,<span class="string">&quot;serial001&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleException</span><span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>,exception.getClass().getCanonicalName()+<span class="string">&quot;\t æœåŠ¡ä¸å¯ç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æµæ§è§„åˆ™</p><p>ç°‡ç‚¹é“¾è·¯ï¼šbyResource æ˜¯èµ„æº</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel29.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel30.png" alt=""></p><p>è¡¨ç¤º 1 ç§’é’Ÿå†…æŸ¥è¯¢æ¬¡æ•°å¤§äº 1ï¼Œå°±è·‘åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å…œåº•æ–¹æ³•</p><p>æµ‹è¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel31.png" alt=""></p><p><strong>é¢å¤–é—®é¢˜</strong></p><p>æ­¤æ—¶å…³é—­æœåŠ¡ 8401 çœ‹çœ‹ï¼šSentinel æ§åˆ¶å°ï¼Œæµæ§è§„åˆ™æ¶ˆå¤±äº†ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸´æ—¶/æŒä¹…ï¼Ÿ</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel32.png" alt=""></p><h4 id="æŒ‰ç…§-Url-åœ°å€é™æµ-åç»­å¤„ç†"><a href="#æŒ‰ç…§-Url-åœ°å€é™æµ-åç»­å¤„ç†" class="headerlink" title="æŒ‰ç…§ Url åœ°å€é™æµ+åç»­å¤„ç†"></a><strong>æŒ‰ç…§ Url åœ°å€é™æµ+åç»­å¤„ç†</strong></h4><p>é€šè¿‡è®¿é—®çš„ URL æ¥é™æµï¼Œä¼šè¿”å› Sentinel è‡ªå¸¦é»˜è®¤çš„é™æµå¤„ç†ä¿¡æ¯</p><p>RateLimitController æ–°å¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/byUrl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">byUrl</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;æŒ‰urlé™æµæµ‹è¯•&quot;</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>,<span class="string">&quot;serial002&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°‡ç‚¹é“¾è·¯ï¼šbyUrl æ˜¯èµ„æº</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel33.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel34.png" alt=""></p><p>æµ‹è¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel35.png" alt=""></p><h4 id="ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜"><a href="#ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜" class="headerlink" title="ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜"></a>ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜</h4><ul><li>ç³»ç»Ÿé»˜è®¤çš„ï¼Œæ²¡æœ‰ä½“ç°æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡è¦æ±‚</li><li><p>ä¾ç…§ç°æœ‰æ¡ä»¶ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„ç†æ–¹æ³•åˆå’Œä¸šåŠ¡ä»£ç è€¦åˆåœ¨ä¸€å—ï¼Œä¸ç›´è§‚</p></li><li><p>æ¯ä¸ªä¸šåŠ¡æ–¹æ³•éƒ½æ·»åŠ ä¸€ä¸ªå…œåº•çš„ï¼Œé‚£ä»£ç è†¨èƒ€åŠ å‰§</p></li><li><p>å…¨å±€ç»Ÿä¸€çš„å¤„ç†æ–¹æ³•æ²¡æœ‰ä½“ç°</p></li></ul><h4 id="å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"><a href="#å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" class="headerlink" title="å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"></a>å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</h4><p>åˆ›å»º CustomerBlockHandler ç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerBlockHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title function_">handlerException1</span><span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">4444</span>,<span class="string">&quot;æŒ‰ç”¨æˆ·è‡ªå®šä¹‰,global handlerException.......1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title function_">handlerException2</span><span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">4444</span>,<span class="string">&quot;æŒ‰ç”¨æˆ·è‡ªå®šä¹‰,global handlerException.......2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller æ–°å¢</p><p>æ‰¾ CustomerBlockHandler ç±»é‡Œçš„ handleException2 æ–¹æ³•è¿›è¡Œå…œåº•å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/customerBlockHandler&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;customerBlockHandler&quot;,</span></span><br><span class="line"><span class="meta">             blockHandlerClass = CustomerBlockHandler.class,</span></span><br><span class="line"><span class="meta">             blockHandler = &quot;handlerException2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">customerBlockHandler</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>,<span class="string">&quot;æŒ‰ç”¨æˆ·è‡ªå®šä¹‰&quot;</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>,<span class="string">&quot;serial003&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><p>å¯¹èµ„æºåç§°æµæ§</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel36.png" alt=""></p><p>å¯¹ URL åœ°å€æµæ§</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel37.png" alt=""></p><p>åœ¨è®¾ç½®äº† URL åœ°å€æµæ§çš„å‰æä¸‹ï¼Œè®¾ç½®æŒ‰èµ„æºåç§°æµæ§æ— æ•ˆ</p><p><img src="https://picbed.jnchan.top/springcloudImages/21sentinel38.png" alt=""></p><blockquote><p>URL åœ°å€æµæ§ä¼˜å…ˆçº§å¤§äºèµ„æºåç§°æµæ§</p></blockquote><h4 id="æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜"><a href="#æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜" class="headerlink" title="æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜"></a>æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜</h4><p>@SentinelResource æ³¨è§£æœ€ä¸»è¦çš„ä¸¤ä¸ªç”¨æ³•ï¼šé™æµæ§åˆ¶å’Œç†”æ–­é™çº§çš„å…·ä½“ä½¿ç”¨æ¡ˆä¾‹ä»‹ç»å®Œäº†ã€‚å¦å¤–ï¼Œè¯¥æ³¨è§£è¿˜æœ‰ä¸€äº›å…¶ä»–æ›´ç²¾ç»†åŒ–çš„é…ç½®ï¼Œæ¯”å¦‚å¿½ç•¥æŸäº›å¼‚å¸¸çš„é…ç½®ã€é»˜è®¤é™çº§å‡½æ•°ç­‰ç­‰ï¼Œå…·ä½“å¯è§å¦‚ä¸‹è¯´æ˜ï¼š</p><ul><li>valueï¼šèµ„æºåç§°ï¼Œå¿…éœ€é¡¹ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰</li><li>entryTypeï¼šentry ç±»å‹ï¼Œå¯é€‰é¡¹ï¼ˆé»˜è®¤ä¸º EntryType.OUTï¼‰</li><li>fallbackï¼šfallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾› fallback å¤„ç†é€»è¾‘ã€‚fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚ï¼š è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>fallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š fallbackClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚ defaultFallbackï¼ˆsince 1.6.0ï¼‰ï¼šé»˜è®¤çš„ fallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„ fallback é€»è¾‘ï¼ˆå³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•ï¼‰ã€‚é»˜è®¤ fallback å‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸ï¼ˆé™¤äº† exceptionsToIgnore é‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹ï¼‰è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº† fallback å’Œ defaultFallbackï¼Œåˆ™åªæœ‰ fallback ä¼šç”Ÿæ•ˆã€‚defaultFallback å‡½æ•°ç­¾åè¦æ±‚ï¼šè¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´ï¼›</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦ä¸ºç©ºï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ª Throwable ç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>defaultFallback å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š fallbackClass ä¸ºå¯¹åº”çš„ç±»çš„ Class å¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li><li>exceptionsToIgnoreï¼ˆsince 1.6.0ï¼‰ï¼šç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥ fallback é€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡ºã€‚</li></ul><h3 id="7-3ã€æœåŠ¡ç†”æ–­åŠŸèƒ½"><a href="#7-3ã€æœåŠ¡ç†”æ–­åŠŸèƒ½" class="headerlink" title="7-3ã€æœåŠ¡ç†”æ–­åŠŸèƒ½"></a>7-3ã€æœåŠ¡ç†”æ–­åŠŸèƒ½</h3><p>sentinel æ•´åˆ ribbon+openFeign+fallback</p><h4 id="Ribbon-ç³»åˆ—â€”â€”æä¾›è€…-9003-9004"><a href="#Ribbon-ç³»åˆ—â€”â€”æä¾›è€…-9003-9004" class="headerlink" title="Ribbon ç³»åˆ—â€”â€”æä¾›è€… 9003/9004"></a><strong>Ribbon ç³»åˆ—â€”â€”æä¾›è€… 9003/9004</strong></h4><p>å¯åŠ¨ nacos å’Œ sentinelï¼Œæ–°å»º cloudalibaba-provider-payment9003/9004 ä¸¤ä¸ªä¸€æ ·çš„åšæ³•</p><h5 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-provider-payment9003<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- springbootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¸¸é€šç”¨jaråŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="applition-yml"><a href="#applition-yml" class="headerlink" title="applition.yml"></a><strong>applition.yml</strong></h5><ul><li>9003</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9003</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>9004</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9004</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">    <span class="attr">endpoints:</span></span><br><span class="line">        <span class="attr">web:</span></span><br><span class="line">            <span class="attr">exposure:</span></span><br><span class="line">                <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="ä¸»å¯åŠ¨ç±»-1"><a href="#ä¸»å¯åŠ¨ç±»-1" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a><strong>ä¸»å¯åŠ¨ç±»</strong></h5><ul><li>9003</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain9003</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 14:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9003</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9003.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>9004</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain9004</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 14:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9004</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9004.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="controller-å±‚-1"><a href="#controller-å±‚-1" class="headerlink" title="controller å±‚"></a><strong>controller å±‚</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¨¡æ‹ŸsqlæŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Long, Payment&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        hashMap.put(<span class="number">1L</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">1L</span>, <span class="string">&quot;xcxcxcxcxcxcxcxcxcxcxcxcxc11111111&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">2L</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2L</span>, <span class="string">&quot;xcxcxcxcggggggggg2222222222222222&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">3L</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">3L</span>, <span class="string">&quot;xcxcxcxccxxcxcfafdgdgdsgdsgds33333&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> hashMap.get(id);</span><br><span class="line">        <span class="type">CommonResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;from mysql, server port : &quot;</span> + serverPort + <span class="string">&quot; ,æŸ¥è¯¢æˆåŠŸ&quot;</span>, payment);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Ribbon-ç³»åˆ—â€”â€”æ¶ˆè´¹è€…-84"><a href="#Ribbon-ç³»åˆ—â€”â€”æ¶ˆè´¹è€…-84" class="headerlink" title="Ribbon ç³»åˆ—â€”â€”æ¶ˆè´¹è€… 84"></a><strong>Ribbon ç³»åˆ—â€”â€”æ¶ˆè´¹è€… 84</strong></h4><p>æ–°å»º cloudalibaba-consumer-nacos-order84</p><h5 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloudalibaba-consumer-nacos-order84<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--         åç»­åšSentinelçš„æŒä¹…åŒ–ä¼šç”¨åˆ°çš„ä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-transport-simple-http<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springcloud alibaba nacos ä¾èµ–,Nacos Server æœåŠ¡æ³¨å†Œä¸­å¿ƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springbootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- æ—¥å¸¸é€šç”¨jaråŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a><strong>application.yml</strong></h5><p>å¦‚æœ 8080 ç«¯å£è¢«å ç”¨ï¼Œsentinel çš„ç«¯å£æ”¹æˆäº† 8888</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel.jar --server.port=<span class="number">8888</span></span><br><span class="line"></span><br><span class="line">sentinel.transport.dashboard: <span class="number">192.168</span><span class="number">.1</span><span class="number">.159</span>:<span class="number">8888</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">84</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">discovery:</span></span><br><span class="line">                <span class="attr">server-addr:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:8089</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">transport:</span></span><br><span class="line">                <span class="comment">#é…ç½®Sentinel dashboardåœ°å€</span></span><br><span class="line">                <span class="attr">dashboard:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.159</span><span class="string">:8080</span></span><br><span class="line">                <span class="comment">#é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">                <span class="attr">client-ip:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.159</span></span><br><span class="line">            <span class="attr">eager:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br></pre></td></tr></table></figure><h5 id="ä¸»å¯åŠ¨ç±»-2"><a href="#ä¸»å¯åŠ¨ç±»-2" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain84</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 15:08</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain84</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain84.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 15:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="controller-å±‚-2"><a href="#controller-å±‚-2" class="headerlink" title="controller å±‚"></a><strong>controller å±‚</strong></h5><p>fallback ç®¡è¿è¡Œå¼‚å¸¸ã€blockHandler ç®¡é…ç½®è¿è§„</p><h5 id="â‘ -æ— é…ç½®"><a href="#â‘ -æ— é…ç½®" class="headerlink" title="â‘  æ— é…ç½®"></a><strong>â‘  æ— é…ç½®</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 15:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL=<span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;)</span><span class="comment">//æ²¡æœ‰é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...éæ³•å‚æ•°å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(id &gt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ï¼š</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_1.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_1_2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_1_3.png" alt=""></p><h5 id="â‘¡-åªé…ç½®-fallback"><a href="#â‘¡-åªé…ç½®-fallback" class="headerlink" title="â‘¡ åªé…ç½® fallback"></a><strong>â‘¡ åªé…ç½® fallback</strong></h5><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_2_2.png" alt=""></p><h5 id="â‘¢-åªé…ç½®-blockHandler"><a href="#â‘¢-åªé…ç½®-blockHandler" class="headerlink" title="â‘¢ åªé…ç½® blockHandler"></a><strong>â‘¢ åªé…ç½® blockHandler</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 15:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;)//æ²¡æœ‰é…ç½®</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handleFallback&quot;) //fallbackåªå¤„ç†ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;, blockHandler = &quot;blockHandler&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...éæ³•å‚æ•°å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id &gt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…œåº•æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleFallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, Throwable e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;---å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹ï¼š&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">blockHandler</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, BlockException e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinelé™æµ,blockException:&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ¬ä¾‹ sentinel éœ€é…ç½®ï¼š</p><p>ç°‡ç‚¹é“¾è·¯ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3.png" alt=""></p><p>æœåŠ¡é™çº§ï¼š</p><p>å¼‚å¸¸è¶…è¿‡ 2 æ¬¡åï¼Œæ–­è·¯å™¨æ‰“å¼€</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_2.png" alt=""></p><p><strong>æµ‹è¯•</strong></p><p>ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è®¿é—®è¿˜æ˜¯æŠ¥å¼‚å¸¸ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_3.png" alt=""></p><p>ç¬¬ä¸‰æ¬¡è®¿é—®</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_4.png" alt=""></p><p>æ—¶é—´çª—å£æœŸ 10s è¿‡äº†ä¹‹åï¼šåˆæ¢å¤å¼‚å¸¸</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_3_5.png" alt=""></p><h5 id="â‘£fallback-å’Œ-blockHandler-éƒ½é…ç½®"><a href="#â‘£fallback-å’Œ-blockHandler-éƒ½é…ç½®" class="headerlink" title="â‘£fallback å’Œ blockHandler éƒ½é…ç½®"></a><strong>â‘£fallback å’Œ blockHandler éƒ½é…ç½®</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 15:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PAYMENT_URL=<span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;,fallback = &quot;handleFallback&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...éæ³•å‚æ•°å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(id &gt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…œåº•æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleFallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id, Throwable e)</span>&#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;---å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹ï¼š&quot;</span>+e.getMessage(),payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">blockHandler</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id, BlockException e)</span>&#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinelé™æµ,blockException:&quot;</span>+e.getMessage(),payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬ä¾‹ sentinel éœ€é…ç½®ï¼š</p><p>ç°‡ç‚¹é“¾è·¯ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4.png" alt=""></p><p>æœåŠ¡é™çº§ï¼š</p><p>å¼‚å¸¸è¶…è¿‡ 2 æ¬¡åï¼Œæ–­è·¯å™¨æ‰“å¼€</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4_2.png" alt=""></p><p><strong>æµ‹è¯•</strong></p><p>ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è®¿é—®ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4_3.png" alt=""></p><p>ç¬¬ä¸‰æ¬¡è®¿é—®</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_4_4.png" alt=""></p><p>ç»“è®ºï¼š</p><p>è‹¥ blockHandler å’Œ fallback éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡º BlockException æ—¶åªä¼šè¿›å…¥ blockHandler å¤„ç†é€»è¾‘</p><h5 id="å¿½ç•¥å¼‚å¸¸"><a href="#å¿½ç•¥å¼‚å¸¸" class="headerlink" title="å¿½ç•¥å¼‚å¸¸"></a><strong>å¿½ç•¥å¼‚å¸¸</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CircleBreakerController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 15:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CircleBreakerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;)//æ²¡æœ‰é…ç½®</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handleFallback&quot;) //fallbackåªå¤„ç†ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment">//    @SentinelResource(value = &quot;fallback&quot;, blockHandler = &quot;blockHandler&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handleFallback&quot;,</span></span><br><span class="line"><span class="meta">            blockHandler = &quot;blockHandler&quot;, exceptionsToIgnore = &#123;IllegalArgumentException.class&#125;)</span></span><br><span class="line">    <span class="comment">//exceptionsToIgnoreæœ‰è¿™ä¸ªå¼‚å¸¸ä¸èµ°å…œåº•æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException...éæ³•å‚æ•°å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id &gt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException...ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…œåº•æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleFallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, Throwable e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;---å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹ï¼š&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">blockHandler</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id, BlockException e)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinelé™æµ,blockException:&quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ï¼š</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_5.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_5_2.png" alt=""></p><h3 id="7-4ã€å…¨å±€é™çº§"><a href="#7-4ã€å…¨å±€é™çº§" class="headerlink" title="7-4ã€å…¨å±€é™çº§"></a>7-4ã€å…¨å±€é™çº§</h3><p>ä¸Šé¢æ˜¯å•ä¸ªè¿›è¡Œ fallback å’Œ blockhandler çš„æµ‹è¯•ï¼Œä¸‹é¢æ˜¯æ•´åˆ openfeign å®ç°æŠŠé™çº§æ–¹æ³•è§£è€¦ã€‚å’Œ Hystrix å‡ ä¹ä¸€æ‘¸ä¸€æ ·ï¼</p><p>æ·»åŠ  open-feign ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>yml è¿½åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ ï¼š @EnableFeignClients æ¿€æ´» open-feign</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain84</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/8/2 15:08</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain84</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain84.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>serviceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;,fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>;</span><br><span class="line">    <span class="comment">//æ–¹æ³•åä¹Ÿè¦å’Œprovider-payment9003/9004é‡Œçš„ä¸€æ ·</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">44444</span>,<span class="string">&quot;æœåŠ¡é™çº§è¿”å›,---PaymentFallbackService&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controllert æ·»åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">paymentSQL</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> paymentService.paymentSql(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ï¼š</strong></p><p>ä¸ºäº†æ¨¡æ‹Ÿå¼‚å¸¸ï¼Œåœ¨è¿œç¨‹è°ƒç”¨æ–¹æ·»åŠ å»¶æ—¶ï¼ˆopen-feign é»˜è®¤å»¶æ—¶å¤§äº 1 ç§’æ‰ä¼šå›è°ƒï¼‰ï¼Œå¦‚ä¸‹ã€‚</p><blockquote><p>æµ‹è¯•æ—¶å‘ç°å¦‚æœåªç»™ä¸€ä¸ªå¾®æœåŠ¡åŠ å»¶æ—¶ï¼Œå¦ä¸€ä¸ªä¸åŠ ï¼Œä¼šä¸€ç›´è°ƒç”¨æ²¡æœ‰å»¶æ—¶çš„å¾®æœåŠ¡ï¼Œæ‰€ä»¥è¦ä¹ˆä¸¤ä¸ªéƒ½åŠ å»¶æ—¶æˆ–è€…åœæ‰ä¸€ä¸ª</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">paymentSql</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> hashMap.get(id);</span><br><span class="line">    <span class="type">CommonResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;from mysql, server port : &quot;</span> + serverPort + <span class="string">&quot; ,æŸ¥è¯¢æˆåŠŸ&quot;</span>, payment);</span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_6.png" alt=""></p><h3 id="7-5ã€æŒä¹…åŒ–"><a href="#7-5ã€æŒä¹…åŒ–" class="headerlink" title="7-5ã€æŒä¹…åŒ–"></a>7-5ã€æŒä¹…åŒ–</h3><p>æ‹¿ cloudalibaba-sentinel-service8401 é¡¹ç›®æ“ä½œä¸¾ä¾‹å­</p><p>ç›®å‰çš„ sentinel å½“é‡å¯ä»¥åï¼Œæ•°æ®éƒ½ä¼šä¸¢å¤±ï¼Œå’Œ nacos ç±»ä¼¼åŸç†ã€‚éœ€è¦æŒä¹…åŒ–ã€‚å®ƒå¯ä»¥è¢«æŒä¹…åŒ–åˆ° nacos çš„æ•°æ®åº“ä¸­ã€‚</p><p><strong>pom æ–‡ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">sentinel:</span></span><br><span class="line">            <span class="attr">datasource:</span></span><br><span class="line">                <span class="attr">ds1:</span></span><br><span class="line">                    <span class="attr">nacos:</span></span><br><span class="line">                        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">                        <span class="attr">dataId:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">                        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">                        <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">                        <span class="attr">rule-type:</span> <span class="string">flow</span></span><br></pre></td></tr></table></figure><p>å» nacos ä¸Šåˆ›å»ºä¸€ä¸ª dataid ,åå­—å’Œ yml é…ç½®çš„ä¸€è‡´ï¼Œjson æ ¼å¼ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/22sentinel_7.png" alt=""></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/rateLimit/byUrl&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;limitApp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;grade&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;controlBehavior&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;clusterMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><ul><li>resourceï¼šèµ„æºåç§°</li><li>limitAppï¼šæ¥æºåº”ç”¨</li><li>gradeï¼šé˜ˆå€¼ç±»å‹ï¼Œ0 è¡¨ç¤ºçº¿ç¨‹æ•°ï¼Œ1 è¡¨ç¤º QPSï¼Œ</li><li>countï¼šå•æœºé˜ˆå€¼ï¼Œ</li><li>strategyï¼šæµæ§æ¨¡å¼ï¼Œ0 è¡¨ç¤ºç›´æ¥ï¼Œ1 è¡¨ç¤ºå…³è”ï¼Œ2 è¡¨ç¤ºé“¾è·¯</li><li>controlBehavior:æµæ§æ•ˆæœï¼Œ0 è¡¨ç¤ºå¿«é€Ÿå¤±è´¥ï¼Œ1 è¡¨ç¤º Warm Up,2 è¡¨ç¤ºæ’é˜Ÿç­‰å¾…ï¼›</li><li>cIusterM0de æ˜¯å¦é›†ç¾¤</li></ul><p>å¯åŠ¨åº”ç”¨ï¼Œå‘ç°å­˜åœ¨ å…³äºèµ„æº â€œ/rateLimit/byUrlâ€ çš„æµæ§è§„åˆ™.</p><blockquote><p>æ€»ç»“: å°±æ˜¯åœ¨ sentinel å¯åŠ¨çš„æ—¶å€™ï¼Œå» nacos ä¸Šè¯»å–ç›¸å…³è§„åˆ™é…ç½®ä¿¡æ¯ï¼Œå®é™…ä¸Šå®ƒè§„åˆ™çš„æŒä¹…åŒ–ï¼Œå°±æ˜¯ç¬¬ä¸‰æ­¥ï¼Œç²˜è´´åˆ° nacos ä¸Šä¿å­˜ä¸‹æ¥ï¼Œå°±ç®—ä»¥ååœ¨ sentinel ä¸Šé¢ä¿®æ”¹äº†ï¼Œé‡å¯åº”ç”¨ä»¥åä¹Ÿæ˜¯æ— æ•ˆã€‚</p></blockquote><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Seata%E8%A7%A3%E5%86%B3%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98/" title="Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜">Seataè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª</title>
      <link href="/2023/06/12/Sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"/>
      <url>/2023/06/12/Sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/</url>
      
        <content type="html"><![CDATA[<h1 id="Sleuth-åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª"><a href="#Sleuth-åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª" class="headerlink" title="Sleuth åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª"></a>Sleuth åˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª</h1><h2 id="1ã€Sleuth-ä»‹ç»"><a href="#1ã€Sleuth-ä»‹ç»" class="headerlink" title="1ã€Sleuth ä»‹ç»"></a>1ã€Sleuth ä»‹ç»</h2><h3 id="1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ"><a href="#1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ" class="headerlink" title="1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ"></a>1-1ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæŠ€æœ¯ï¼Ÿéœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ</h3><p>åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰æ®µè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥ã€‚</p><p>å®˜ç½‘ï¼š<a href="https://github.com/spring-cloud/spring-cloud-sleuth">https://github.com/spring-cloud/spring-cloud-sleuth</a></p><h3 id="1-2ã€æ˜¯ä»€ä¹ˆ"><a href="#1-2ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-2ã€æ˜¯ä»€ä¹ˆ"></a>1-2ã€æ˜¯ä»€ä¹ˆ</h3><p>Spring Cloud Sleuth æä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸”å…¼å®¹æ”¯æŒäº† zipkin</p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_1.png" alt=""></p><h2 id="2ã€æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤"><a href="#2ã€æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤" class="headerlink" title="2ã€æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤"></a>2ã€æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤</h2><h3 id="2-1ã€zipkin-æ­å»ºå®‰è£…"><a href="#2-1ã€zipkin-æ­å»ºå®‰è£…" class="headerlink" title="2-1ã€zipkin æ­å»ºå®‰è£…"></a>2-1ã€zipkin æ­å»ºå®‰è£…</h3><h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><p>SpringCloud ä» F ç‰ˆèµ·å·²ä¸éœ€è¦è‡ªå·±æ„å»º Zipkin Server äº†ï¼Œåªéœ€è°ƒç”¨ jar åŒ…å³å¯</p><p>zipkin ä¸‹è½½åœ°å€ï¼š<a href="https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/zipkin-server-2.12.9-exec.jar">https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/zipkin-server-2.12.9-exec.jar</a></p><h4 id="è¿è¡Œ-jar"><a href="#è¿è¡Œ-jar" class="headerlink" title="è¿è¡Œ jar"></a>è¿è¡Œ jar</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar zipkin-server-<span class="number">2.12</span><span class="number">.9</span>-exec.jar</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œæ§åˆ¶å°"><a href="#è¿è¡Œæ§åˆ¶å°" class="headerlink" title="è¿è¡Œæ§åˆ¶å°"></a>è¿è¡Œæ§åˆ¶å°</h4><p>æ§åˆ¶å°ï¼š<a href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a></p><h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><p>å®Œæ•´çš„è°ƒç”¨é“¾è·¯ï¼š ä¸€æ¡é“¾è·¯é€šè¿‡ Trace Id å”¯ä¸€æ ‡è¯†ï¼ŒSpan æ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ï¼Œå„ span é€šè¿‡ parent id å…³è”èµ·æ¥</p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_2.png" alt=""></p><p>â€”æ¡é“¾è·¯é€šè¿‡ Trace ld å”¯ä¸€æ ‡è¯†ï¼ŒSpan æ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ï¼Œå„ span é€šè¿‡ parent id å…³è”èµ·æ¥ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/19Sleuth_4.png" alt=""></p><p>åè¯è§£é‡Šï¼š</p><ul><li>Traceï¼šç±»ä¼¼äºæ ‘ç»“æ„çš„ Span é›†åˆï¼Œè¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯ï¼Œå­˜åœ¨å”¯ä¸€æ ‡è¯†</li><li>spanï¼šè¡¨ç¤ºè°ƒç”¨é“¾è·¯æ¥æºï¼Œé€šä¿—çš„ç†è§£ span å°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯</li></ul><h3 id="2-2ã€æœåŠ¡æä¾›è€…-cloud-provider-payment8001"><a href="#2-2ã€æœåŠ¡æä¾›è€…-cloud-provider-payment8001" class="headerlink" title="2-2ã€æœåŠ¡æä¾›è€… cloud-provider-payment8001"></a>2-2ã€æœåŠ¡æä¾›è€… cloud-provider-payment8001</h3><p>cloud-provider-payment8001</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>æ”¹ pom.xmlï¼Œå¢åŠ ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--åŒ…å«äº†sleuth+zipkin--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><p>æ”¹ application.ymlï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">zipkin:</span></span><br><span class="line">        <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span> <span class="comment"># zipkin åœ°å€</span></span><br><span class="line">        <span class="attr">sleuth:</span></span><br><span class="line">            <span class="attr">sampler:</span></span><br><span class="line">                <span class="comment"># é‡‡æ ·ç‡å€¼ ä»‹äº0-1ä¹‹é—´ ï¼Œ1è¡¨ç¤ºå…¨éƒ¨é‡‡é›†</span></span><br><span class="line">            <span class="attr">probability:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚"><a href="#controller-å±‚" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><p>æ”¹ä¸šåŠ¡ç±» PaymentController å¢åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/zipkin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentZipkin</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hi, i am paymentzipkin server fall back, welcome to ailuoHome, O(n_n)O å“ˆå“ˆ~&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3ã€æœåŠ¡æ¶ˆè´¹è€…ï¼ˆè°ƒç”¨æ–¹ï¼‰cloud-consumer-order80"><a href="#2-3ã€æœåŠ¡æ¶ˆè´¹è€…ï¼ˆè°ƒç”¨æ–¹ï¼‰cloud-consumer-order80" class="headerlink" title="2-3ã€æœåŠ¡æ¶ˆè´¹è€…ï¼ˆè°ƒç”¨æ–¹ï¼‰cloud-consumer-order80"></a>2-3ã€æœåŠ¡æ¶ˆè´¹è€…ï¼ˆè°ƒç”¨æ–¹ï¼‰cloud-consumer-order80</h2><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><p>æ”¹ pom.xmlï¼Œå¢åŠ ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--åŒ…å«äº†sleuth+zipkin--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><p>æ”¹ application.ymlï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">zipkin:</span></span><br><span class="line">        <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span> <span class="comment"># zipkin åœ°å€</span></span><br><span class="line">        <span class="attr">sleuth:</span></span><br><span class="line">            <span class="attr">sampler:</span></span><br><span class="line">                <span class="comment"># é‡‡æ ·ç‡å€¼ ä»‹äº0-1ä¹‹é—´ ï¼Œ1è¡¨ç¤ºå…¨éƒ¨é‡‡é›†</span></span><br><span class="line">            <span class="attr">probability:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚-1"><a href="#controller-å±‚-1" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><p>æ”¹ä¸šåŠ¡ç±» OrderControllerï¼Œå¢åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/zipkin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentZipkin</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(PAYMENT_URL+<span class="string">&quot;/payment/zipkin&quot;</span>,String.class);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>è®¿é—®ï¼šlocalhost/consumer/payment/zipkin</p><p>åœ¨æ§åˆ¶å°æŸ¥çœ‹è°ƒç”¨é“¾è·¯</p><p><img src="https://picbed.jnchan.top/springcloudImages/18zipkin.png" alt=""></p><font color='red'>**æœ‰åˆ†ç»„å±æ€§é…ç½®ï¼Œåå°æ‰“å‡ºæ¥äº† MQ ä¸Šçš„æ¶ˆæ¯**</font><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Nacos%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" title="NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ">NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Streamæ¶ˆæ¯é©±åŠ¨</title>
      <link href="/2023/06/12/Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"/>
      <url>/2023/06/12/Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Stream-æ¶ˆæ¯é©±åŠ¨"><a href="#Stream-æ¶ˆæ¯é©±åŠ¨" class="headerlink" title="Stream æ¶ˆæ¯é©±åŠ¨"></a>Stream æ¶ˆæ¯é©±åŠ¨</h1><h2 id="1ã€æ¶ˆæ¯é©±åŠ¨-Stream-ä»‹ç»"><a href="#1ã€æ¶ˆæ¯é©±åŠ¨-Stream-ä»‹ç»" class="headerlink" title="1ã€æ¶ˆæ¯é©±åŠ¨ Stream ä»‹ç»"></a>1ã€æ¶ˆæ¯é©±åŠ¨ Stream ä»‹ç»</h2><h3 id="1-1ã€Stream-ä¸ºä»€ä¹ˆè¢«å¼•å…¥"><a href="#1-1ã€Stream-ä¸ºä»€ä¹ˆè¢«å¼•å…¥" class="headerlink" title="1-1ã€Stream ä¸ºä»€ä¹ˆè¢«å¼•å…¥"></a>1-1ã€Stream ä¸ºä»€ä¹ˆè¢«å¼•å…¥</h3><p>å¸¸è§ MQ(æ¶ˆæ¯ä¸­é—´ä»¶)ï¼š</p><ul><li><p>ActiveMQ</p></li><li><p>RabbitMQ</p></li><li>RocketMQ</li><li>Kafka</li></ul><p>æœ‰æ²¡æœ‰ä¸€ç§æ–°çš„æŠ€æœ¯è¯ç”Ÿï¼Œè®©æˆ‘ä»¬ä¸å†å…³æ³¨å…·ä½“ MQ çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ä¸€ç§é€‚é…ç»‘å®šçš„æ–¹å¼ï¼Œè‡ªåŠ¨çš„ç»™æˆ‘ä»¬åœ¨å„ç§ MQ å†…åˆ‡æ¢ã€‚ï¼ˆç±»ä¼¼äº Hibernateï¼‰</p><p>2ã€æ˜¯ä»€ä¹ˆ</p><font color='red'>å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ã€‚</font><p>å®˜æ–¹å®šä¹‰ Spring Cloud Stream æ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ã€‚</p><font color='red'>**åº”ç”¨ç¨‹åºé€šè¿‡ inputs æˆ–è€… outputs æ¥ä¸ Spring Cloud Stream ä¸­ binder å¯¹è±¡äº¤äº’ã€‚é€šè¿‡æˆ‘ä»¬é…ç½®æ¥ binding(ç»‘å®š)ï¼Œè€Œ Spring Cloud Stream çš„ binder å¯¹è±¡è´Ÿè´£ä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’ã€‚**</font>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ææ¸…æ¥šå¦‚ä½•ä¸ Spring Cloud Stream äº¤äº’å°±å¯ä»¥æ–¹ä¾¿ä½¿ç”¨æ¶ˆæ¯é©±åŠ¨çš„æ–¹å¼ã€‚é€šè¿‡ä½¿ç”¨ Spring Integration æ¥è¿æ¥æ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶ä»¥å®ç°æ¶ˆæ¯äº‹ä»¶é©±åŠ¨ã€‚Spring Cloud Stream ä¸ºä¸€äº›ä¾›åº”å•†çš„æ¶ˆæ¯ä¸­é—´ä»¶äº§å“æä¾›äº†ä¸ªæ€§åŒ–çš„è‡ªåŠ¨åŒ–é…ç½®å®ç°ï¼Œå¼•ç”¨äº†<font color='red'>**å‘å¸ƒ-è®¢é˜…ã€æ¶ˆè´¹ç»„ã€åˆ†åŒº**</font>çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚ç›®å‰ä»…æ”¯æŒ RabbitMQã€ Kafkaã€‚### 1-3ã€è®¾è®¡æ€æƒ³#### æ ‡å‡† MQ![](https://picbed.jnchan.top/springcloudImages/18stream_1.png)-   ç”Ÿäº§è€…/æ¶ˆè´¹è€…ä¹‹é—´é æ¶ˆæ¯åª’ä»‹ä¼ é€’ä¿¡æ¯å†…å®¹-   æ¶ˆæ¯å¿…é¡»èµ°ç‰¹å®šçš„é€šé“ - æ¶ˆæ¯é€šé“ Message Channel-   æ¶ˆæ¯é€šé“é‡Œçš„æ¶ˆæ¯å¦‚ä½•è¢«æ¶ˆè´¹å‘¢ï¼Œè°è´Ÿè´£æ”¶å‘å¤„ç† - æ¶ˆæ¯é€šé“ MessageChannel çš„å­æ¥å£ SubscribableChannelï¼Œç”± MessageHandler æ¶ˆæ¯å¤„ç†å™¨æ‰€è®¢é˜…ã€‚#### **ä¸ºä»€ä¹ˆç”¨ Cloud Stream**æ¯”æ–¹è¯´æˆ‘ä»¬ç”¨åˆ°äº† RabbitMQ å’Œ Kafkaï¼Œç”±äºè¿™ä¸¤ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶çš„æ¶æ„ä¸Šçš„ä¸åŒï¼Œåƒ RabbitMQ æœ‰ exchangeï¼Œkafka æœ‰ Topic å’Œ Partitions åˆ†åŒºã€‚![](https://picbed.jnchan.top/springcloudImages/18stream_2.png)è¿™äº›ä¸­é—´ä»¶çš„å·®å¼‚æ€§å¯¼è‡´æˆ‘ä»¬å®é™…é¡¹ç›®å¼€å‘ç»™æˆ‘ä»¬é€ æˆäº†ä¸€å®šçš„å›°æ‰°ï¼Œæˆ‘ä»¬å¦‚æœç”¨äº†ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„å…¶ä¸­ä¸€ç§ï¼Œåé¢çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘æƒ³å¾€å¦å¤–ä¸€ç§æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¿ç§»ï¼Œè¿™æ—¶å€™æ— ç–‘å°±æ˜¯ä¸€ä¸ªç¾éš¾æ€§çš„ï¼Œä¸€å¤§å †ä¸œè¥¿éƒ½è¦é‡æ–°æ¨å€’é‡æ–°åšï¼Œå› ä¸ºå®ƒè·Ÿæˆ‘ä»¬çš„ç³»ç»Ÿè€¦åˆäº†ï¼Œè¿™æ—¶å€™ Spring Cloud Stream ç»™æˆ‘ä»¬æä¾›äº†â€”ç§è§£è€¦åˆçš„æ–¹å¼ã€‚#### Stream å‡­ä»€ä¹ˆå¯ä»¥ç»Ÿä¸€åº•å±‚å·®å¼‚ï¼Ÿåœ¨æ²¡æœ‰ç»‘å®šå™¨è¿™ä¸ªæ¦‚å¿µçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ SpringBoot åº”ç”¨è¦ç›´æ¥ä¸æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œä¿¡æ¯äº¤äº’çš„æ—¶å€™ï¼Œç”±äºå„æ¶ˆæ¯ä¸­é—´ä»¶æ„å»ºçš„åˆè¡·ä¸åŒï¼Œå®ƒä»¬çš„å®ç°ç»†èŠ‚ä¸Šä¼šæœ‰è¾ƒå¤§çš„å·®å¼‚æ€§ã€‚é€šè¿‡å®šä¹‰ç»‘å®šå™¨ä½œä¸ºä¸­é—´å±‚ï¼Œå®Œç¾åœ°å®ç°äº†åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ç»†èŠ‚ä¹‹é—´çš„éš”ç¦»ã€‚<font color='red'>**é€šè¿‡å‘åº”ç”¨ç¨‹åºæš´éœ²ç»Ÿä¸€çš„ Channel é€šé“ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸éœ€è¦å†è€ƒè™‘å„ç§ä¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶å®ç°ã€‚**</font><p><strong>ä¸€å¥è¯ï¼šå±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚ï¼Œé™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ã€‚</strong></p><p>Stream å¯¹æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿›ä¸€æ­¥å°è£…ï¼Œå¯ä»¥åšåˆ°ä»£ç å±‚é¢å¯¹ä¸­é—´ä»¶çš„æ— æ„ŸçŸ¥ï¼Œç”šè‡³äºåŠ¨æ€çš„åˆ‡æ¢ä¸­é—´ä»¶(rabbitmq åˆ‡æ¢ä¸º kafka)ï¼Œä½¿å¾—å¾®æœåŠ¡å¼€å‘çš„é«˜åº¦è§£è€¦ï¼ŒæœåŠ¡å¯ä»¥å…³æ³¨æ›´å¤šè‡ªå·±çš„ä¸šåŠ¡æµç¨‹</p><p>é€šè¿‡å®šä¹‰ç»‘å®šå™¨ Binder ä½œä¸ºä¸­é—´å±‚ï¼Œå®ç°äº†åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ç»†èŠ‚ä¹‹é—´çš„éš”ç¦»ã€‚</p><h4 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h4><p>Binder å¯ä»¥ç”Ÿæˆ Bindingï¼ŒBinding ç”¨æ¥ç»‘å®šæ¶ˆæ¯å®¹å™¨çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œå®ƒæœ‰ä¸¤ç§ç±»å‹</p><ul><li><p>INPUT å¯¹åº”äºæ¶ˆè´¹è€…</p></li><li><p>OUTPUT å¯¹åº”äºç”Ÿäº§è€…</p></li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_3.png" alt=""></p><h4 id="Stream-ä¸­çš„æ¶ˆæ¯é€šä¿¡æ–¹å¼éµå¾ªäº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><a href="#Stream-ä¸­çš„æ¶ˆæ¯é€šä¿¡æ–¹å¼éµå¾ªäº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼" class="headerlink" title="Stream ä¸­çš„æ¶ˆæ¯é€šä¿¡æ–¹å¼éµå¾ªäº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼"></a>Stream ä¸­çš„æ¶ˆæ¯é€šä¿¡æ–¹å¼éµå¾ªäº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼</h4><p>Topic ä¸»é¢˜è¿›è¡Œå¹¿æ’­</p><ul><li>åœ¨ RabbitMQ å°±æ˜¯ Exchange</li><li>åœ¨ Kakfa ä¸­å°±æ˜¯ Topic</li></ul><h3 id="1-4ã€Stream-æ ‡å‡†æµç¨‹å¥—è·¯"><a href="#1-4ã€Stream-æ ‡å‡†æµç¨‹å¥—è·¯" class="headerlink" title="1-4ã€Stream æ ‡å‡†æµç¨‹å¥—è·¯"></a>1-4ã€Stream æ ‡å‡†æµç¨‹å¥—è·¯</h3><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_4.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_5.png" alt=""></p><ul><li>Binderï¼šå¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå±è”½å·®å¼‚</li><li>Channelï¼šé€šé“ï¼Œæ˜¯é˜Ÿåˆ— Queue çš„ä¸€ç§æŠ½è±¡ï¼Œåœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹ï¼Œé€šè¿‡ Channel å¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½®</li><li>Source å’Œ Sinkï¼šç®€å•çš„å¯ç†è§£ä¸ºå‚ç…§å¯¹è±¡æ˜¯ Spring Cloud Stream è‡ªèº«ï¼Œä» Stream å‘å¸ƒæ¶ˆæ¯å°±æ˜¯è¾“å‡ºï¼Œæ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥</li></ul><h3 id="ç¼–ç -API-å’Œå¸¸ç”¨æ³¨è§£"><a href="#ç¼–ç -API-å’Œå¸¸ç”¨æ³¨è§£" class="headerlink" title="ç¼–ç  API å’Œå¸¸ç”¨æ³¨è§£"></a>ç¼–ç  API å’Œå¸¸ç”¨æ³¨è§£</h3><div class="table-container"><table><thead><tr><th>ç»„æˆ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Middleware</td><td>ä¸­é—´ä»¶ï¼Œç›®å‰åªæ”¯æŒ RabbitMQ å’Œ Kafka</td></tr><tr><td>Binder</td><td>Binder æ˜¯åº”ç”¨ä¸æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹é—´çš„å°è£…ï¼Œç›®å‰å®è¡Œäº† Kafka å’Œ RabbitMQ çš„ Binderï¼Œé€šè¿‡ Binder å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå¯ä»¥åŠ¨æ€çš„æ”¹å˜æ¶ˆæ¯ç±»å‹(å¯¹åº”äº Kafka çš„ topic,RabbitMQ çš„ exchange)ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç°</td></tr><tr><td>@Input</td><td>æ³¨è§£æ ‡è¯†è¾“å…¥é€šé“ï¼Œé€šè¿‡è¯¥è¾“ä¹é€šé“æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›å…¥åº”ç”¨ç¨‹åº</td></tr><tr><td>@Output</td><td>æ³¨è§£æ ‡è¯†è¾“å‡ºé€šé“ï¼Œå‘å¸ƒçš„æ¶ˆæ¯å°†é€šè¿‡è¯¥é€šé“ç¦»å¼€åº”ç”¨ç¨‹åº</td></tr><tr><td>@StreamListener</td><td>ç›‘å¬é˜Ÿåˆ—ï¼Œç”¨äºæ¶ˆè´¹è€…çš„é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶</td></tr><tr><td>@EnableBinding</td><td>æŒ‡ä¿¡é“ channel å’Œ exchange ç»‘å®šåœ¨ä¸€èµ·</td></tr></tbody></table></div><h2 id="2ã€æ¡ˆä¾‹è¯´æ˜"><a href="#2ã€æ¡ˆä¾‹è¯´æ˜" class="headerlink" title="2ã€æ¡ˆä¾‹è¯´æ˜"></a>2ã€æ¡ˆä¾‹è¯´æ˜</h2><p>RabbitMQ ç¯å¢ƒå·²ç» OKï¼Œå·¥ç¨‹ä¸­æ–°å»ºä¸‰ä¸ªå­æ¨¡å—</p><ul><li><p>cloud-stream-rabbitmq-provider8801ï¼Œä½œä¸ºç”Ÿäº§è€…è¿›è¡Œå‘æ¶ˆæ¯æ¨¡å—</p></li><li><p>cloud-stream-rabbitmq-consumer8802ï¼Œä½œä¸ºæ¶ˆæ¯æ¥æ”¶æ¨¡å—</p></li><li>cloud-stream-rabbitmq-consumer8803 ä½œä¸ºæ¶ˆæ¯æ¥æ”¶æ¨¡å—</li></ul><h3 id="2-1ã€æ¶ˆæ¯é©±åŠ¨ä¹‹ç”Ÿäº§è€…-provider8801"><a href="#2-1ã€æ¶ˆæ¯é©±åŠ¨ä¹‹ç”Ÿäº§è€…-provider8801" class="headerlink" title="2-1ã€æ¶ˆæ¯é©±åŠ¨ä¹‹ç”Ÿäº§è€… provider8801"></a>2-1ã€æ¶ˆæ¯é©±åŠ¨ä¹‹ç”Ÿäº§è€… provider8801</h3><p>cloud-stream-rabbitmq-provider8801</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-stream-rabbitmq-provider8801<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- stream-rabbit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--eureka-client ç›®å‰ï¼Œè¿™ä¸ªä¸æ˜¯å¿…é¡»çš„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">stream:</span></span><br><span class="line">            <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤é…ç½®è¦ç»‘å®šçš„rabbitMQçš„æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">                <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºå’Œbindingæ•´åˆ</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">                    <span class="attr">environment:</span> <span class="comment"># è®¾ç½®rabbitmqçš„ç›¸å…³ç¯å¢ƒé…ç½®</span></span><br><span class="line">                        <span class="attr">spring:</span></span><br><span class="line">                            <span class="attr">rabbitmq:</span></span><br><span class="line">                                <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">                                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                                <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">                                <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line">            <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">                <span class="attr">output:</span> <span class="comment"># è¡¨ç¤ºæ˜¯ç”Ÿäº§è€…ï¼Œå‘rabbitMQå‘é€æ¶ˆæ¯</span></span><br><span class="line">                    <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°</span></span><br><span class="line">                    <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡æ˜¯jsonï¼Œæ–‡æœ¬æ˜¯ &quot;text/plain&quot;</span></span><br><span class="line">                    <span class="attr">binder:</span> <span class="string">defaultRabbit</span> <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³æ—¶é—´ï¼Œé»˜è®¤æ˜¯30ç§’</span></span><br><span class="line">        <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># æœ€å¤§å¿ƒè·³é—´éš”ä¸èƒ½è¶…è¿‡5ç§’,é»˜è®¤90ç§’</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">send-8801.com</span> <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># è®¿é—®è·¯å¾„å˜ä¸ºipåœ°å€</span></span><br></pre></td></tr></table></figure><h4 id="ç‰¹åˆ«æ³¨æ„-â­â­â­"><a href="#ç‰¹åˆ«æ³¨æ„-â­â­â­" class="headerlink" title="ç‰¹åˆ«æ³¨æ„:â­â­â­"></a>ç‰¹åˆ«æ³¨æ„:â­â­â­</h4><p>ä½¿ç”¨äº† spring.cloud.stream.binders.defaultRabbit.environment.spring.rabbitmq.xx æ¥é…ç½® rabbitmq çš„ç¯å¢ƒ</p><p>å¦‚æœä½ æ˜¯ç”¨çš„å…¶ä»–æœåŠ¡å™¨ä¸Šçš„ rabbitmqï¼Œæ¯”å¦‚æˆ‘ä½¿ç”¨çš„æˆ‘è‡ªå·±çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ç„¶ååˆ›å»º docker å®¹å™¨æ¥è¿è¡Œ rabbitmqã€‚<br>æŒ‰ç…§è§†é¢‘ä¸­çš„é…ç½®æ–¹å¼çš„è¯ï¼Œå¯åŠ¨æ—¶ä¼šè¯•å›¾è¿æ¥ä¸¤æ¬¡ rabbitmq ç¨‹åº<br>ç¬¬ä¸€æ¬¡è¯•å›¾è¿æ¥è®¿é—®çš„å°±æ˜¯ application.yml ä¸­é…ç½®çš„åœ°å€ï¼Œæ­¤æ—¶å·²ç»è®¢é˜…æˆåŠŸäº†<br>ä½†æ˜¯ç¨‹åºè¿˜ä¼šåœ¨ä¹‹åè¿›è¡Œç¬¬äºŒæ¬¡è¿æ¥ï¼Œæ­¤æ—¶è®¿é—®çš„åœ°å€å°±æ˜¯ localhost:5672ï¼Œåœ¨æˆ‘çš„ç¯å¢ƒä¸­ï¼Œæˆ‘æœ¬åœ°æ²¡æœ‰ rabbitmq ç¯å¢ƒï¼Œæ‰€ä»¥ç›´æ¥æŠ¥ IOExceptionã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæ˜¯ä½¿ç”¨çš„è‡ªå·±çš„æœåŠ¡å™¨æ¥é…ç½®ï¼Œåˆ™éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°† rabbitmq çš„é…ç½®ä¿¡æ¯ç§»åŠ¨åˆ° application.yml ä¸­çš„ spring èŠ‚ç‚¹ä¸‹<br>ä¿®æ”¹åçš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">stream:</span></span><br><span class="line">            <span class="attr">binders:</span> <span class="comment"># åœ¨æ­¤é…ç½®è¦ç»‘å®šçš„rabbitMQçš„æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">                <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºå’Œbindingæ•´åˆ</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">                <span class="attr">output:</span> <span class="comment"># è¡¨ç¤ºæ˜¯ç”Ÿäº§è€…ï¼Œå‘rabbitMQå‘é€æ¶ˆæ¯</span></span><br><span class="line">                    <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°</span></span><br><span class="line">                    <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡æ˜¯jsonï¼Œæ–‡æœ¬æ˜¯ &quot;text/plain&quot;</span></span><br><span class="line">                    <span class="attr">binder:</span> &#123; <span class="string">defaultRabbit</span> &#125; <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³æ—¶é—´ï¼Œé»˜è®¤æ˜¯30ç§’</span></span><br><span class="line">        <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># æœ€å¤§å¿ƒè·³é—´éš”ä¸èƒ½è¶…è¿‡5ç§’,é»˜è®¤90ç§’</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">send-8801.com</span> <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># è®¿é—®è·¯å¾„å˜ä¸ºipåœ°å€</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamMQMain8801</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(StreamMQMain8801.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-å±‚"><a href="#service-å±‚" class="headerlink" title="service å±‚"></a>service å±‚</h4><p>å‘é€æ¶ˆæ¯æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IMessageProvider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘é€æ¶ˆæ¯æ¥å£å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableBinding(Source.class)</span><span class="comment">//å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“ //ä¸æ˜¯å’Œcontrolleræ‰“äº¤é“çš„service,è€Œæ˜¯å‘é€æ¶ˆæ¯çš„æ¨é€æœåŠ¡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessasgeProviderImpl</span> <span class="keyword">implements</span> <span class="title class_">IMessageProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MessageChannel output; <span class="comment">//æ¶ˆæ¯å‘é€ç®¡é“</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serial</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        output.send(MessageBuilder.withPayload(serial).build());</span><br><span class="line">        System.out.println(<span class="string">&quot;*******serial: &quot;</span>+serial);</span><br><span class="line">        <span class="keyword">return</span> serial;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-å±‚"><a href="#controller-å±‚" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMessageController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IMessageProvider messageProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/sendMessage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendMessage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> messageProvider.send();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_exchange.png" alt=""></p><h3 id="2-2ã€æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…-consumer8802"><a href="#2-2ã€æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…-consumer8802" class="headerlink" title="2-2ã€æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€… consumer8802"></a>2-2ã€æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€… consumer8802</h3><p>cloud-stream-rabbitmq-consumer8802</p><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-stream-rabbitmq-consumer8802<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- stream-rabbit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8802</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-stream-provider</span></span><br><span class="line">    <span class="attr">rabbitmq:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">cj</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">stream:</span></span><br><span class="line">            <span class="attr">binders:</span> <span class="comment"># é…ç½®è¦ç»‘å®šçš„rabbitMQçš„æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">                <span class="attr">defaultRabbit:</span> <span class="comment"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºå’Œbindingæ•´åˆ</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span></span><br><span class="line">            <span class="attr">bindings:</span> <span class="comment"># æœåŠ¡çš„æ•´åˆå¤„ç†</span></span><br><span class="line">                <span class="attr">input:</span> <span class="comment"># è¡¨ç¤ºæ˜¯æ¶ˆè´¹è€…ï¼Œè¿™é‡Œæ˜¯å”¯ä¸€å’Œç”Ÿäº§è€…ä¸åŒçš„åœ°æ–¹ï¼Œå‘rabbitMQå‘é€æ¶ˆæ¯</span></span><br><span class="line">                    <span class="attr">destination:</span> <span class="string">studyExchange</span> <span class="comment"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°</span></span><br><span class="line">                    <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡æ˜¯jsonï¼Œæ–‡æœ¬æ˜¯ &quot;text/plain&quot;</span></span><br><span class="line">                    <span class="attr">binder:</span> &#123; <span class="string">defaultRabbit</span> &#125; <span class="comment"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“é…ç½®</span></span><br><span class="line">                    <span class="attr">group:</span> <span class="string">ailuoA</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="attr">instance:</span></span><br><span class="line">        <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">2</span> <span class="comment"># è®¾ç½®å¿ƒè·³æ—¶é—´ï¼Œé»˜è®¤æ˜¯30ç§’</span></span><br><span class="line">        <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">5</span> <span class="comment"># æœ€å¤§å¿ƒè·³é—´éš”ä¸èƒ½è¶…è¿‡5ç§’,é»˜è®¤90ç§’</span></span><br><span class="line">        <span class="attr">instance-id:</span> <span class="string">receive-8802.com</span> <span class="comment"># åœ¨ä¿¡æ¯åˆ—è¡¨æ˜¾ç¤ºä¸»æœºåç§°</span></span><br><span class="line">        <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># è®¿é—®è·¯å¾„å˜ä¸ºipåœ°å€</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»-1"><a href="#ä¸»å¯åŠ¨ç±»-1" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamMQMain8802</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(StreamMQMain8802.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-ç±»"><a href="#controller-ç±»" class="headerlink" title="controller ç±»"></a>controller ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableBinding(Sink.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveMessageListenerController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(Sink.INPUT)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">input</span><span class="params">(Message&lt;String&gt; message)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1å·ï¼Œ--------&gt;æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯ï¼š &quot;</span>+message.getPayload()+<span class="string">&quot;\t port: &quot;</span>+serverPort);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_sendMessage2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_getMessage.png" alt=""></p><h3 id="2-3ã€åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–"><a href="#2-3ã€åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–" class="headerlink" title="2-3ã€åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–"></a>2-3ã€åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–</h3><h4 id="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><a href="#æ¶ˆæ¯é‡å¤æ¶ˆè´¹" class="headerlink" title="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"></a>æ¶ˆæ¯é‡å¤æ¶ˆè´¹</h4><p>ä¾ç…§ 8802ï¼Œclone å‡ºæ¥ä¸€ä»½è¿è¡Œ 8803</p><p>å¯åŠ¨</p><ul><li><p>åˆ†ç»„æ¶ˆè´¹ RabbitMQ</p></li><li><p>7001ï¼šæœåŠ¡æ³¨å†Œ</p></li><li>8801ï¼šæ¶ˆæ¯ç”Ÿäº§</li><li>8802ï¼šæ¶ˆæ¯æ¶ˆè´¹</li><li>8803ï¼šæ¶ˆæ¯æ¶ˆè´¹</li></ul><p>è¿è¡Œåæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>æœ‰é‡å¤æ¶ˆè´¹é—®é¢˜</li><li>æ¶ˆæ¯æŒä¹…åŒ–é—®é¢˜</li></ul><p>ç›®å‰æ˜¯ 8802/8803 åŒæ—¶éƒ½æ”¶åˆ°äº†ï¼Œå­˜åœ¨é‡å¤æ¶ˆè´¹é—®é¢˜<br><img src="https://picbed.jnchan.top/springcloudImages/18stream_é‡å¤æ¶ˆè´¹2.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/18stream_é‡å¤æ¶ˆè´¹1.png" alt=""></p><p><strong>ç”Ÿäº§å®é™…æ¡ˆä¾‹ï¼š</strong></p><p>æ¯”å¦‚åœ¨å¦‚ä¸‹åœºæ™¯ä¸­ï¼Œè®¢å•ç³»ç»Ÿæˆ‘ä»¬åšé›†ç¾¤éƒ¨ç½²ï¼Œéƒ½ä¼šä» RabbitMQ ä¸­è·å–è®¢å•ä¿¡æ¯ï¼Œé‚£å¦‚æœä¸€ä¸ªè®¢å•åŒæ—¶è¢«ä¸¤ä¸ªæœåŠ¡è·å–åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆæ•°æ®é”™è¯¯ï¼Œæˆ‘ä»¬å¾—é¿å…è¿™ç§æƒ…å†µã€‚è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Stream ä¸­çš„æ¶ˆæ¯åˆ†ç»„æ¥è§£å†³</p><p><img src="https://picbed.jnchan.top/springcloudImages/18 ç”Ÿäº§å®é™…æ¡ˆä¾‹.png" alt=""></p><h4 id="è§£å†³æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><a href="#è§£å†³æ¶ˆæ¯é‡å¤æ¶ˆè´¹" class="headerlink" title="è§£å†³æ¶ˆæ¯é‡å¤æ¶ˆè´¹"></a>è§£å†³æ¶ˆæ¯é‡å¤æ¶ˆè´¹</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>å¾®æœåŠ¡åº”ç”¨æ”¾ç½®äºåŒä¸€ä¸ª group ä¸­ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚</p><p>ä¸åŒç»„æ˜¯å¯ä»¥å…¨é¢æ¶ˆè´¹çš„(é‡å¤æ¶ˆè´¹)ï¼ŒåŒä¸€ç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚</p><h5 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h5><p>8002ï¼Œ8003 æ·»åŠ åˆ°åŒä¸€åˆ†ç»„å³å¯</p><p>application.yml ä¸­æ·»åŠ åˆ†ç»„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">group:</span> <span class="string">ailuoA</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: cloud-stream-provider</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span></span><br><span class="line">    port: <span class="number">5672</span></span><br><span class="line">    username: cj</span><br><span class="line">    password: <span class="number">123456</span></span><br><span class="line">  cloud:</span><br><span class="line">    stream:</span><br><span class="line">      binders: # é…ç½®è¦ç»‘å®šçš„rabbitMQçš„æœåŠ¡ä¿¡æ¯</span><br><span class="line">        defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºå’Œbindingæ•´åˆ</span><br><span class="line">          type: rabbit  # æ¶ˆæ¯ç»„ä»¶ç±»å‹</span><br><span class="line">      bindings: # æœåŠ¡çš„æ•´åˆå¤„ç†</span><br><span class="line">        input: # è¡¨ç¤ºæ˜¯æ¶ˆè´¹è€…ï¼Œè¿™é‡Œæ˜¯å”¯ä¸€å’Œç”Ÿäº§è€…ä¸åŒçš„åœ°æ–¹ï¼Œå‘rabbitMQå‘é€æ¶ˆæ¯</span><br><span class="line">          destination: studyExchange  # è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°</span><br><span class="line">          content-type: application/json  # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡æ˜¯jsonï¼Œæ–‡æœ¬æ˜¯ <span class="string">&quot;text/plain&quot;</span></span><br><span class="line">          binder: &#123; defaultRabbit &#125;  # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“é…ç½®</span><br><span class="line">          group: ailuoA</span><br></pre></td></tr></table></figure><h4 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a><strong>æŒä¹…åŒ–</strong></h4><p>é€šè¿‡ä¸Šè¿°ï¼Œè§£å†³äº†é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œå†çœ‹çœ‹æŒä¹…åŒ–</p><ul><li>åœæ­¢ 8802/8803 å¹¶å»é™¤æ‰ 8802 çš„åˆ†ç»„ group: ailuoAï¼Œ8803 çš„åˆ†ç»„ group: ailuoA æ²¡æœ‰å»æ‰</li><li>8801 å…ˆå‘é€ 4 æ¡æ¶ˆæ¯åˆ° rabbitmq</li><li>å…ˆå¯åŠ¨ 8802ï¼Œæ— åˆ†ç»„å±æ€§é…ç½®ï¼Œåå°æ²¡æœ‰æ‰“å‡ºæ¥æ¶ˆæ¯</li><li>å†å¯åŠ¨ 8803ï¼Œæœ‰åˆ†ç»„å±æ€§é…ç½®ï¼Œåå°æ‰“å‡ºæ¥äº† MQ ä¸Šçš„æ¶ˆæ¯(æ¶ˆæ¯æŒä¹…åŒ–ä½“ç°)</li></ul><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Sleuth%E5%88%86%E5%B8%83%E5%BC%8F%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" title="Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª">Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gitç¬”è®°</title>
      <link href="/2023/06/12/git%E5%91%BD%E4%BB%A4/"/>
      <url>/2023/06/12/git%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 align='center'>gitå‘½ä»¤</h1><h1 id="ä¸€ã€å¸¸ç”¨å‘½ä»¤"><a href="#ä¸€ã€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="ä¸€ã€å¸¸ç”¨å‘½ä»¤"></a>ä¸€ã€å¸¸ç”¨å‘½ä»¤</h1><h2 id="1-åŸºæœ¬æ“ä½œ"><a href="#1-åŸºæœ¬æ“ä½œ" class="headerlink" title="1.åŸºæœ¬æ“ä½œ"></a>1.åŸºæœ¬æ“ä½œ</h2><h3 id="ç”¨æˆ·é…ç½®"><a href="#ç”¨æˆ·é…ç½®" class="headerlink" title="ç”¨æˆ·é…ç½®"></a>ç”¨æˆ·é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;bettyaner&quot;</span><br><span class="line">git config --global user.email bettyaner@163.com</span><br></pre></td></tr></table></figure><h2 id="é…ç½®çº§åˆ«"><a href="#é…ç½®çº§åˆ«" class="headerlink" title="é…ç½®çº§åˆ«"></a>é…ç½®çº§åˆ«</h2><ul><li>â€“localï¼ˆé»˜è®¤ï¼Œé«˜çº§ä¼˜å…ˆï¼‰ï¼šåªå½±å“æœ¬åœ°ä»“åº“</li><li>â€“global(ä¸­ä¼˜å…ˆçº§)ï¼šåªå½±å“æ‰€æœ‰å½“å‰ç”¨æˆ·çš„ git ä»“åº“</li><li>â€“systemï¼ˆä½ä¼˜å…ˆçº§ï¼‰ï¼šå½±å“åˆ°å…¨ç³»ç»Ÿçš„ git ä»“åº“</li></ul><h1 id="äºŒã€é—®é¢˜å¤„ç†"><a href="#äºŒã€é—®é¢˜å¤„ç†" class="headerlink" title="äºŒã€é—®é¢˜å¤„ç†"></a>äºŒã€é—®é¢˜å¤„ç†</h1><h2 id="1ã€å½“éœ€è¦æœ¬åœ°ä»£ç ä¸è¿œç¨‹ä»“åº“åˆå¹¶æ—¶"><a href="#1ã€å½“éœ€è¦æœ¬åœ°ä»£ç ä¸è¿œç¨‹ä»“åº“åˆå¹¶æ—¶" class="headerlink" title="1ã€å½“éœ€è¦æœ¬åœ°ä»£ç ä¸è¿œç¨‹ä»“åº“åˆå¹¶æ—¶"></a>1ã€å½“éœ€è¦æœ¬åœ°ä»£ç ä¸è¿œç¨‹ä»“åº“åˆå¹¶æ—¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">è¿œç¨‹ä»“åº“å·²ç»å»ºç«‹ï¼Œå°†æœ¬åœ°ä»£ç ä¸Šä¼ è‡³è¿œç¨‹ä»“åº“ã€‚</span><br><span class="line"></span><br><span class="line">1ã€(å…ˆè¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹)é€šè¿‡å‘½ä»¤ git init æŠŠè¿™ä¸ªç›®å½•å˜æˆgitå¯ä»¥ç®¡ç†çš„ä»“åº“</span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line">2ã€æŠŠæ–‡ä»¶æ·»åŠ åˆ°ç‰ˆæœ¬åº“ä¸­ï¼Œä½¿ç”¨å‘½ä»¤ git add .æ·»åŠ åˆ°æš‚å­˜åŒºé‡Œé¢å»ï¼Œä¸è¦å¿˜è®°åé¢çš„å°æ•°ç‚¹â€œ.â€ï¼Œæ„ä¸ºæ·»åŠ æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">3ã€ç”¨å‘½ä»¤ git commitå‘Šè¯‰Gitï¼ŒæŠŠæ–‡ä»¶æäº¤åˆ°ä»“åº“ã€‚å¼•å·å†…ä¸ºæäº¤è¯´æ˜</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line"></span><br><span class="line">4ã€å…³è”åˆ°è¿œç¨‹åº“</span><br><span class="line">git remote add origin ä½ çš„è¿œç¨‹åº“åœ°å€</span><br><span class="line">å¦‚ï¼š</span><br><span class="line">git remote add origin https://github.com/cade8800/ionic-demo.git</span><br><span class="line"></span><br><span class="line">5ã€è·å–è¿œç¨‹åº“ä¸æœ¬åœ°åŒæ­¥åˆå¹¶(å¦‚æœè¿œç¨‹åº“ä¸ä¸ºç©ºå¿…é¡»åšè¿™ä¸€æ­¥ï¼Œå¦åˆ™åé¢çš„æäº¤ä¼šå¤±è´¥)</span><br><span class="line">git pull --rebase origin master</span><br><span class="line"></span><br><span class="line">6ã€æŠŠæœ¬åœ°åº“çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹ï¼Œä½¿ç”¨ git pushå‘½ä»¤ï¼Œå®é™…ä¸Šæ˜¯æŠŠå½“å‰åˆ†æ”¯masteræ¨é€åˆ°è¿œç¨‹ã€‚æ‰§è¡Œæ­¤å‘½ä»¤åä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åã€å¯†ç ï¼ŒéªŒè¯é€šè¿‡åå³å¼€å§‹ä¸Šä¼ ã€‚</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2ã€å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç æ›´æ–°åï¼Œè¦åˆå¹¶åˆ°-master-åˆ†æ”¯"><a href="#2ã€å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç æ›´æ–°åï¼Œè¦åˆå¹¶åˆ°-master-åˆ†æ”¯" class="headerlink" title="2ã€å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç æ›´æ–°åï¼Œè¦åˆå¹¶åˆ° master åˆ†æ”¯"></a>2ã€å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç æ›´æ–°åï¼Œè¦åˆå¹¶åˆ° master åˆ†æ”¯</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout dev     #åˆ‡æ¢åˆ°devåˆ†æ”¯</span><br><span class="line">git pull             #å°†è¿œç¨‹æ›´æ–°çš„ä»£ç åŒæ­¥åˆ°æœ¬åœ°</span><br><span class="line">git checkout master  #åˆ‡æ¢åˆ°master</span><br><span class="line">git merge dev        #å°†devåˆ†æ”¯åˆå¹¶åˆ°masterä¸Š</span><br><span class="line">git push -u origin master   #æäº¤</span><br></pre></td></tr></table></figure><h2 id="3ã€å½“-master-ä»£ç æ”¹åŠ¨äº†ï¼Œéœ€è¦æ›´æ–°å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç "><a href="#3ã€å½“-master-ä»£ç æ”¹åŠ¨äº†ï¼Œéœ€è¦æ›´æ–°å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç " class="headerlink" title="3ã€å½“ master ä»£ç æ”¹åŠ¨äº†ï¼Œéœ€è¦æ›´æ–°å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç "></a>3ã€å½“ master ä»£ç æ”¹åŠ¨äº†ï¼Œéœ€è¦æ›´æ–°å¼€å‘åˆ†æ”¯ï¼ˆdevï¼‰ä¸Šçš„ä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git pull</span><br><span class="line">git checkout dev</span><br><span class="line">git merge master</span><br><span class="line">git push -u origin dev</span><br></pre></td></tr></table></figure><h2 id="4ã€a-åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°†-a-åˆ†æ”¯ä»£ç æäº¤åˆ°æ–°åˆ†æ”¯-b"><a href="#4ã€a-åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°†-a-åˆ†æ”¯ä»£ç æäº¤åˆ°æ–°åˆ†æ”¯-b" class="headerlink" title="4ã€a åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°† a åˆ†æ”¯ä»£ç æäº¤åˆ°æ–°åˆ†æ”¯ b"></a>4ã€a åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°† a åˆ†æ”¯ä»£ç æäº¤åˆ°æ–°åˆ†æ”¯ b</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git branch b</span><br><span class="line">git checkout a</span><br><span class="line">git add xxxxxx</span><br><span class="line">git commit -m &quot;xxxx&quot;</span><br><span class="line">git push -u origin a:b</span><br></pre></td></tr></table></figure><h2 id="5ã€a-åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°†-a-åˆ†æ”¯ä»£ç åˆå¹¶åˆ°æ—§åˆ†æ”¯-b-ä¸Š"><a href="#5ã€a-åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°†-a-åˆ†æ”¯ä»£ç åˆå¹¶åˆ°æ—§åˆ†æ”¯-b-ä¸Š" class="headerlink" title="5ã€a åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°† a åˆ†æ”¯ä»£ç åˆå¹¶åˆ°æ—§åˆ†æ”¯ b ä¸Š"></a>5ã€a åˆ†æ”¯ä»£ç æ›´æ–°ï¼Œå°† a åˆ†æ”¯ä»£ç åˆå¹¶åˆ°æ—§åˆ†æ”¯ b ä¸Š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout b</span><br><span class="line">git pull origin b</span><br><span class="line">git merge a</span><br><span class="line">git push origin b</span><br></pre></td></tr></table></figure><h2 id="6ã€git-å‘½ä»¤"><a href="#6ã€git-å‘½ä»¤" class="headerlink" title="6ã€git å‘½ä»¤"></a>6ã€git å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git branch aaa    åˆ›å»ºaaaåˆ†æ”¯</span><br><span class="line">git checkout bbb         åˆ‡æ¢åˆ°bbbåˆ†æ”¯</span><br><span class="line">git pull origin bbb   è¡¨ç¤ºå°†è¿œç¨‹originä¸»æœºçš„bbbåˆ†æ”¯æ‹‰å–è¿‡æ¥å’Œæœ¬åœ°çš„å½“å‰åˆ†æ”¯è¿›è¡Œåˆå¹¶</span><br><span class="line">git status     æŸ¥çœ‹å½“å‰çŠ¶æ€</span><br><span class="line">git branch -a   æŸ¥çœ‹å½“å‰éƒ½æœ‰é‚£äº›åˆ†æ”¯</span><br><span class="line">git clean -xfd  æ¸…æ¥šæ‰æœ¬åœ°è¢«ä¿®æ”¹çš„æ–‡ä»¶</span><br><span class="line">git reset --hard å›é€€ä»£ç è‡³å½“å‰ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><h2 id="7ã€æäº¤æœ¬åœ°ä»£ç è‡³è¿œç¨‹ä»“åº“"><a href="#7ã€æäº¤æœ¬åœ°ä»£ç è‡³è¿œç¨‹ä»“åº“" class="headerlink" title="7ã€æäº¤æœ¬åœ°ä»£ç è‡³è¿œç¨‹ä»“åº“"></a>7ã€æäº¤æœ¬åœ°ä»£ç è‡³è¿œç¨‹ä»“åº“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git status   æŸ¥çœ‹å¾…æäº¤çš„æ–‡ä»¶global_pickup_recommend</span><br><span class="line">git add global_pickup_recommend</span><br><span class="line">git commit -m &quot;update&quot;</span><br><span class="line">git pull</span><br><span class="line">git push origin master    #åˆå¹¶åˆ°masterä¸Š</span><br></pre></td></tr></table></figure><h2 id="8ã€å½“ä»£ç æäº¤é”™è¯¯åˆ†æ”¯ï¼Œéœ€è¦å›æ»šæ—¶ï¼Œgit-å›é€€è¿œç¨‹ä»£ç åˆ°åˆ¶å®šç‰ˆæœ¬"><a href="#8ã€å½“ä»£ç æäº¤é”™è¯¯åˆ†æ”¯ï¼Œéœ€è¦å›æ»šæ—¶ï¼Œgit-å›é€€è¿œç¨‹ä»£ç åˆ°åˆ¶å®šç‰ˆæœ¬" class="headerlink" title="8ã€å½“ä»£ç æäº¤é”™è¯¯åˆ†æ”¯ï¼Œéœ€è¦å›æ»šæ—¶ï¼Œgit å›é€€è¿œç¨‹ä»£ç åˆ°åˆ¶å®šç‰ˆæœ¬"></a>8ã€å½“ä»£ç æäº¤é”™è¯¯åˆ†æ”¯ï¼Œéœ€è¦å›æ»šæ—¶ï¼Œgit å›é€€è¿œç¨‹ä»£ç åˆ°åˆ¶å®šç‰ˆæœ¬</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard 3266044634a9ac3891b015b3666d99e70aeaab98ï¼ˆå›åˆ°ç‰ˆæœ¬ï¼‰</span><br><span class="line"> git push origin HEAD --force</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>springcloudä»‹ç»</title>
      <link href="/2023/06/12/springcloud%E4%BB%8B%E7%BB%8D/"/>
      <url>/2023/06/12/springcloud%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€springcloudä»‹ç»"><a href="#ä¸€ã€springcloudä»‹ç»" class="headerlink" title="ä¸€ã€springcloudä»‹ç»"></a>ä¸€ã€springcloudä»‹ç»</h1><h2 id="1ã€ä»€ä¹ˆæ˜¯springcloud"><a href="#1ã€ä»€ä¹ˆæ˜¯springcloud" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯springcloud"></a>1ã€ä»€ä¹ˆæ˜¯springcloud</h2><p>SpringCloud æ˜¯å¾®æœåŠ¡ä¸€ç«™å¼æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œå¾®æœåŠ¡å…¨å®¶æ¡¶ã€‚å®ƒæ˜¯å¾®æœåŠ¡å¼€å‘çš„ä¸»æµæŠ€æœ¯æ ˆã€‚å®ƒé‡‡ç”¨äº†åç§°ï¼Œè€Œéæ•°å­—ç‰ˆæœ¬å·ã€‚</p><p>SpringCloud å’Œ springCloud Alibaba ç›®å‰æ˜¯æœ€ä¸»æµçš„å¾®æœåŠ¡æ¡†æ¶ç»„åˆã€‚</p><h2 id="2ã€SpringCloudç‰ˆæœ¬é€‰æ‹©"><a href="#2ã€SpringCloudç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="2ã€SpringCloudç‰ˆæœ¬é€‰æ‹©"></a>2ã€SpringCloudç‰ˆæœ¬é€‰æ‹©</h2><p>é€‰ç”¨ springboot å’Œ springCloud ç‰ˆæœ¬æœ‰çº¦æŸï¼Œä¸æŒ‰ç…§å®ƒçš„çº¦æŸä¼šæœ‰å†²çªã€‚</p><div class="table-container"><table><thead><tr><th><strong>Cloud Release Train</strong></th><th><strong>Boot Version</strong></th></tr></thead><tbody><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Hoxton-Release-Notes">Hoxton</a></td><td>2.2.x, 2.3.x (Starting with SR5)</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Greenwich-Release-Notes">Greenwich</a></td><td>2.1.x</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td><td>2.0.x</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td><td>1.5.x</td></tr><tr><td><a href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Dalston-Release-Notes">Dalston</a></td><td>1.5.x</td></tr></tbody></table></div><p>æŸ¥çœ‹ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š<a href="https://start.spring.io/actuator/info">https://start.spring.io/actuator/info</a>            </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;git&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;986e72b4a38a4dd320be9bf55b47e54f7ccc0095&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;commit&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;986e72b&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-07-12T18:06:05Z&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.1-SNAPSHOT&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;artifact&quot;</span><span class="punctuation">:</span> <span class="string">&quot;start-site&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;versions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;spring-boot&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;initializr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.20.1-SNAPSHOT&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;start.spring.io website&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-07-12T18:08:16.738Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;io.spring.start&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;bom-ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;codecentric-spring-boot-admin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2.6.8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;2.7.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.0.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.1.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.1.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hilla&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2.1.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;solace-spring-boot&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;1.2.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;2.0.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;solace-spring-cloud&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2.3.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.0.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spring-cloud&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2021.0.8&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;2022.0.3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spring-cloud-azure&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;4.9.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;5.3.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spring-cloud-gcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;3.5.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;4.5.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spring-cloud-services&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;3.4.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.5.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;4.0.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.1.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spring-modulith&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;1.0.0-M1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spring-shell&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2.1.11&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.0.6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.1.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.1.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;vaadin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;23.2.15&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;23.3.16&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;24.0.9&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.1.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;24.1.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.1.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wavefront&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2.2.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;2.3.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.0.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.1.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dependency-ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;okta&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2.1.6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.0.4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mybatis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;2.2.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;2.3.1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0-M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.0.2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pulsar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;0.2.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pulsar-reactive&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;0.2.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;camel&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;3.17.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;3.20.6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.7.0.M1 and &lt;3.0.0-M1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;4.0.0-RC1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=3.0.0-M1 and &lt;3.2.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;picocli&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;4.7.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;3.1.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;open-service-broker&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;3.5.0&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.6.0 and &lt;2.7.0-M1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong><font color='red'>Psï¼šcloudç‰ˆæœ¬å†³å®šäº†bootç‰ˆæœ¬</font></strong></p><h2 id="3ã€å¾®æœåŠ¡åœæ›´è¯´æ˜"><a href="#3ã€å¾®æœåŠ¡åœæ›´è¯´æ˜" class="headerlink" title="3ã€å¾®æœåŠ¡åœæ›´è¯´æ˜"></a>3ã€å¾®æœåŠ¡åœæ›´è¯´æ˜</h2><p>ä»¥å‰ï¼š</p><p><img src="https://picbed.jnchan.top/springcloudImages/20230713143610.png" alt=""></p><p>ç°åœ¨ï¼š</p><p>1ã€Eurekaåœç”¨,å¯ä»¥ä½¿ç”¨zkä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ</p><p>2ã€æœåŠ¡è°ƒç”¨,Ribbonå‡†å¤‡åœæ›´,ä»£æ›¿ä¸ºLoadBalance</p><p>3ã€Feignæ”¹ä¸ºOpenFeign</p><p>4ã€Hystrixåœæ›´,æ”¹ä¸ºresilence4j,æˆ–è€…é˜¿é‡Œå·´å·´çš„sentienl</p><p>5ã€Zuulæ”¹ä¸ºgateway</p><p>6ã€æœåŠ¡é…ç½®Configæ”¹ä¸ºNacos</p><p>7ã€æœåŠ¡æ€»çº¿Busæ”¹ä¸ºNacos</p><h2 id="4ã€è¦å­¦ç‚¹"><a href="#4ã€è¦å­¦ç‚¹" class="headerlink" title="4ã€è¦å­¦ç‚¹"></a>4ã€è¦å­¦ç‚¹</h2><p><img src="https://picbed.jnchan.top/springcloudImages/QQæˆªå›¾20230713151804.png" alt=""></p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/">springcloud</a>   <a href="https://www.bookstack.cn/read/spring-cloud-docs/docs-index.md">springcloudä¸­æ–‡æ–‡æ¡£</a>  <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/htmlsingle/">springboot v2.2.2</a></p><h2 id="5ã€è¯¾ç¨‹æ‰€ç”¨è½¯ä»¶ç‰ˆæœ¬"><a href="#5ã€è¯¾ç¨‹æ‰€ç”¨è½¯ä»¶ç‰ˆæœ¬" class="headerlink" title="5ã€è¯¾ç¨‹æ‰€ç”¨è½¯ä»¶ç‰ˆæœ¬"></a>5ã€è¯¾ç¨‹æ‰€ç”¨è½¯ä»¶ç‰ˆæœ¬</h2><div class="table-container"><table><thead><tr><th>cloud</th><th>Hoxton.SR1</th></tr></thead><tbody><tr><td>boot</td><td>2.2.2.RELEASE</td></tr><tr><td>cloud alibaba</td><td>2.1.0.RELEASE</td></tr><tr><td>java</td><td>java8</td></tr><tr><td>maven</td><td>3.5åŠä»¥ä¸Š</td></tr><tr><td>mysql</td><td>5.7åŠä»¥ä¸Š</td></tr></tbody></table></div><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA/" title="å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º">å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>zookeeperæœåŠ¡æ³¨å†Œä¸­å¿ƒğŸ˜¶</title>
      <link href="/2023/06/12/zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/"/>
      <url>/2023/06/12/zookeeper%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="zookeeper-æœåŠ¡æ³¨å†Œä¸­å¿ƒ-ğŸ˜¶"><a href="#zookeeper-æœåŠ¡æ³¨å†Œä¸­å¿ƒ-ğŸ˜¶" class="headerlink" title="zookeeper æœåŠ¡æ³¨å†Œä¸­å¿ƒ ğŸ˜¶"></a>zookeeper æœåŠ¡æ³¨å†Œä¸­å¿ƒ ğŸ˜¶</h1><h2 id="1ã€SpringCloud-æ•´åˆ-Zookeeper-ä»£æ›¿-Eureka"><a href="#1ã€SpringCloud-æ•´åˆ-Zookeeper-ä»£æ›¿-Eureka" class="headerlink" title="1ã€SpringCloud æ•´åˆ Zookeeper ä»£æ›¿ Eureka"></a>1ã€SpringCloud æ•´åˆ Zookeeper ä»£æ›¿ Eureka</h2><h3 id="1-1ã€æ³¨å†Œä¸­å¿ƒ-Zookeeper"><a href="#1-1ã€æ³¨å†Œä¸­å¿ƒ-Zookeeper" class="headerlink" title="1-1ã€æ³¨å†Œä¸­å¿ƒ Zookeeper"></a>1-1ã€æ³¨å†Œä¸­å¿ƒ Zookeeper</h3><p>zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œå¯ä»¥å®ç°æ³¨å†Œä¸­å¿ƒåŠŸèƒ½<br>å…³é—­ Linux æœåŠ¡å™¨é˜²ç«å¢™ååŠ¨ zookeeper æœåŠ¡å™¨<br>zookeeper æœåŠ¡å™¨å–ä»£ Eureka æœåŠ¡å™¨ï¼Œzk ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ</p><h2 id="2ã€æœåŠ¡æä¾›è€…"><a href="#2ã€æœåŠ¡æä¾›è€…" class="headerlink" title="2ã€æœåŠ¡æä¾›è€…"></a>2ã€æœåŠ¡æä¾›è€…</h2><h3 id="2-1ã€æ–°å»ºæ¨¡å—-cloud-provider-payment8004"><a href="#2-1ã€æ–°å»ºæ¨¡å—-cloud-provider-payment8004" class="headerlink" title="2-1ã€æ–°å»ºæ¨¡å— cloud-provider-payment8004"></a>2-1ã€æ–°å»ºæ¨¡å— cloud-provider-payment8004</h3><p>å¦‚æœ zookeeper çš„ç‰ˆæœ¬å’Œå¯¼å…¥çš„ jar åŒ…ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå¯åŠ¨å°±ä¼šæŠ¥é”™ï¼Œç”±äº zk-discovery å’Œ zk ä¹‹é—´çš„ jar åŒ…å†²çªçš„é—®é¢˜ã€‚</p><p>ä¸‹å›¾ç»™å‡ºçš„æ˜¯ spring-cloud-starter-zookeeper-discovery æ‰€å¼•å…¥çš„ zookeeper jar åŒ…ç‰ˆæœ¬ï¼Œå¯åœ¨çˆ¶ pom ä¸­æ‰¾åˆ°ï¼Œå¦‚æœè‡ªå·±çš„ zoookeeper ç‰ˆæœ¬å’Œå…¶ä¸€è‡´ï¼Œå¯ä¸ç”¨ä¿®æ”¹ã€‚</p><p>pom.xml</p><p>è§£å†³è¿™ç§å†²çªï¼Œéœ€è¦åœ¨ pom æ–‡ä»¶ä¸­ï¼Œæ’é™¤æ‰å¼•èµ·å†²çªçš„ jar åŒ…ï¼Œæ·»åŠ å’ŒæœåŠ¡å™¨ zookeeper ç‰ˆæœ¬ä¸€è‡´çš„ jar åŒ…ï¼Œä½†æ˜¯æ–°å¯¼å…¥çš„ zookeeper jar åŒ… åˆæœ‰ slf4j å†²çªé—®é¢˜ï¼Œäºæ˜¯å†æ¬¡æ’é™¤å¼•èµ·å†²çªçš„ jar åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8004<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springcloud æ•´åˆ zookeeper ç»„ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ’é™¤ä¸zookeeperç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´ å†²çªçš„ jaråŒ… --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ·»åŠ å¯¹åº”ç‰ˆæœ¬çš„jaråŒ… --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ’é™¤å’Œ slf4j å†²çªçš„ jaråŒ… --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--çƒ­éƒ¨ç½²--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-provider-payment</span></span><br><span class="line">    <span class="attr">cloud:</span></span><br><span class="line">        <span class="attr">zookeeper:</span></span><br><span class="line">            <span class="attr">connect-string:</span> <span class="number">119.3</span><span class="number">.211</span><span class="number">.104</span><span class="string">:2181</span> <span class="comment"># zkåœ°å€ 119.3.211.104æ˜¯linuxåœ°å€</span></span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">//è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨consulæˆ–è€…zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8004</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8004.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/payment/zk&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentzk</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with zookeeper: &quot;</span>+serverPort+<span class="string">&quot;\t&quot;</span>+ UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><p>ç„¶åå°±èƒ½åœ¨ zk é‡ŒæŸ¥åˆ°æ³¨å†Œçš„æœåŠ¡ä¿¡æ¯äº†ã€‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/9zookeeper.png" alt=""></p><h3 id="2-2ã€æ–°å»ºæ¶ˆè´¹è€…æ¨¡å—-cloud-consumerzk-order80"><a href="#2-2ã€æ–°å»ºæ¶ˆè´¹è€…æ¨¡å—-cloud-consumerzk-order80" class="headerlink" title="2-2ã€æ–°å»ºæ¶ˆè´¹è€…æ¨¡å— cloud-consumerzk-order80"></a>2-2ã€æ–°å»ºæ¶ˆè´¹è€…æ¨¡å— cloud-consumerzk-order80</h3><p>pom.xmlï¼Œapplication.ymlï¼Œä¸»å¯åŠ¨ç±»ä¸æœåŠ¡æä¾›è€…ç±»ä¼¼</p><p>config ç±»ï¼Œæ³¨å…¥ RestTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextBean</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller å±‚ä¹Ÿæ˜¯å’Œä¹‹å‰ç±»ä¼¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderZKController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://cloud-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/zk&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL+<span class="string">&quot;/payment/zk&quot;</span>,String.class);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%F0%9F%98%B6/" title="ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°ğŸ˜¶">ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°ğŸ˜¶</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹â­â­â­</title>
      <link href="/2023/06/12/%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%BC%82%E5%90%8C%E7%82%B9%E2%AD%90%E2%AD%90%E2%AD%90/"/>
      <url>/2023/06/12/%E4%B8%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%BC%82%E5%90%8C%E7%82%B9%E2%AD%90%E2%AD%90%E2%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹-â­â­â­"><a href="#ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹-â­â­â­" class="headerlink" title="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹ â­â­â­"></a>ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹ â­â­â­</h1><p><img src="https://picbed.jnchan.top/springcloudImages/10ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒçš„å¼‚åŒç‚¹.png" alt=""></p><h2 id="1ã€CAP"><a href="#1ã€CAP" class="headerlink" title="1ã€CAP"></a>1ã€CAP</h2><p>Cï¼šConsistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰</p><p>Aï¼šAvailabilityï¼ˆå¯ç”¨æ€§ï¼‰</p><p>Pï¼šPartition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</p><p>CAP ç†è®ºå…³æ³¨ç²’åº¦æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä½“ç³»ç»Ÿè®¾è®¡çš„ç­–ç•¥</p><h2 id="2ã€ç»å…¸-CAP-å›¾"><a href="#2ã€ç»å…¸-CAP-å›¾" class="headerlink" title="2ã€ç»å…¸ CAP å›¾"></a>2ã€ç»å…¸ CAP å›¾</h2><p>æœ€å¤šåªèƒ½åŒæ—¶è¾ƒå¥½çš„æ»¡è¶³ä¸¤ä¸ªã€‚</p><p>CAP ç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ã€‚</p><p>å› æ­¤ï¼Œæ ¹æ® CAP åŸç†å°† NoSQL æ•°æ®åº“åˆ†æˆäº†æ»¡è¶³ CA åŸåˆ™ã€æ»¡è¶³ CP åŸåˆ™å’Œæ»¡è¶³ AP åŸåˆ™ä¸‰å¤§ç±»ï¼š</p><p>CA - å•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¤ªå¼ºå¤§<br>CP - æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«é«˜<br>AP - æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸å¯èƒ½å¯¹ä¸€è‡´æ€§è¦æ±‚ä½ä¸€äº›<br><img src="https://picbed.jnchan.top/springcloudImages/10cap.png" alt=""></p><h3 id="AP-Eureka-ï¼š"><a href="#AP-Eureka-ï¼š" class="headerlink" title="AP(Eureka)ï¼š"></a>AP(Eureka)ï¼š</h3><p>AP æ¶æ„ï¼š</p><p>å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼Œç³»ç»Ÿ B å¯ä»¥è¿”å›æ—§å€¼ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p>ç»“è®ºï¼šè¿èƒŒäº†ä¸€è‡´æ€§ C çš„è¦æ±‚ï¼Œåªæ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ AP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10ap.png" alt=""></p><h3 id="CP-Zookeeper-Consul"><a href="#CP-Zookeeper-Consul" class="headerlink" title="CP(Zookeeper/Consul)"></a><strong>CP(Zookeeper/Consul)</strong></h3><p>CP æ¶æ„ï¼š</p><p>å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»æ‹’æ¥è¯·æ±‚ï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸€è‡´æ€§</p><p>ç»“è®ºï¼šè¿èƒŒäº†å¯ç”¨æ€§ A çš„è¦æ±‚ï¼Œåªæ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³ CP</p><p><img src="https://picbed.jnchan.top/springcloudImages/10cp.png" alt=""></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%F0%9F%98%90%F0%9F%98%90/" title="Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ğŸ˜ğŸ˜">Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨ğŸ˜ğŸ˜</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º</title>
      <link href="/2023/06/12/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA/"/>
      <url>/2023/06/12/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A0%81%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º"><a href="#å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º" class="headerlink" title="å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º"></a>å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º</h1><font color='red' >**çº¦å®š>é…ç½®>ç¼–ç **</font><h2 id="1ã€æ„å»ºçˆ¶å·¥ç¨‹"><a href="#1ã€æ„å»ºçˆ¶å·¥ç¨‹" class="headerlink" title="1ã€æ„å»ºçˆ¶å·¥ç¨‹"></a>1ã€æ„å»ºçˆ¶å·¥ç¨‹</h2><h4 id="1-1ã€åˆ›å»ºé¡¹ç›®"><a href="#1-1ã€åˆ›å»ºé¡¹ç›®" class="headerlink" title="1-1ã€åˆ›å»ºé¡¹ç›®"></a>1-1ã€åˆ›å»ºé¡¹ç›®</h4><p><img src="https://picbed.jnchan.top/springcloudImages/QQæˆªå›¾20230713154102.png" alt=""></p><h4 id="1-2ã€å­—ç¬¦ç¼–ç "><a href="#1-2ã€å­—ç¬¦ç¼–ç " class="headerlink" title="1-2ã€å­—ç¬¦ç¼–ç "></a>1-2ã€å­—ç¬¦ç¼–ç </h4><p><img src="https://picbed.jnchan.top/springcloudImages/QQæˆªå›¾20230713154759.png" alt=""></p><h4 id="1-3ã€æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»"><a href="#1-3ã€æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»" class="headerlink" title="1-3ã€æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»"></a>1-3ã€æ³¨è§£ç”Ÿæ•ˆæ¿€æ´»</h4><p><img src="https://picbed.jnchan.top/springcloudImages/å¾®ä¿¡å›¾ç‰‡_20230713154955.png" alt=""></p><h4 id="1-4ã€javaç¼–è¯‘ç‰ˆæœ¬é€‰æ‹©ï¼šjava8"><a href="#1-4ã€javaç¼–è¯‘ç‰ˆæœ¬é€‰æ‹©ï¼šjava8" class="headerlink" title="1-4ã€javaç¼–è¯‘ç‰ˆæœ¬é€‰æ‹©ï¼šjava8"></a>1-4ã€javaç¼–è¯‘ç‰ˆæœ¬é€‰æ‹©ï¼šjava8</h4><p><img src="https://picbed.jnchan.top/springcloudImages/QQæˆªå›¾20230713155247.png" alt=""></p><h4 id="1-5ã€çˆ¶å·¥ç¨‹pomæ–‡ä»¶"><a href="#1-5ã€çˆ¶å·¥ç¨‹pomæ–‡ä»¶" class="headerlink" title="1-5ã€çˆ¶å·¥ç¨‹pomæ–‡ä»¶"></a>1-5ã€çˆ¶å·¥ç¨‹pomæ–‡ä»¶</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ç»Ÿä¸€ç®¡ç† jar åŒ…ç‰ˆæœ¬ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å­å—åŸºç¡€ä¹‹åï¼Œæä¾›ä½œç”¨ï¼šé”å®šç‰ˆæœ¬ + å­moduleä¸ç”¨å†™ groupId å’Œ version --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¸‹é¢ä¸‰ä¸ªåŸºæœ¬æ˜¯å¾®æœåŠ¡æ¶æ„çš„æ ‡é… --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--spring cloud é˜¿é‡Œå·´å·´--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- druid--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--log4j--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="1-5-1ã€æŠ€æœ¯é—®é¢˜"><a href="#1-5-1ã€æŠ€æœ¯é—®é¢˜" class="headerlink" title="1-5-1ã€æŠ€æœ¯é—®é¢˜"></a>1-5-1ã€æŠ€æœ¯é—®é¢˜</h5><blockquote><p>é—®é¢˜ä¸€ã€</p><p>å½“å¯¼å…¥å®Œçˆ¶ç±»çš„pomæ–‡ä»¶æ—¶ï¼Œä¼šå¯¼å…¥ä¾èµ–å¤±è´¥</p><p>åŸå› ï¼šmavenä»“åº“ä¸­ä¸å­˜åœ¨è¯¥ä¾èµ–ï¼ŒdependencyManagementé™„åº¸äºå·²å­˜åœ¨çš„ä¾èµ–</p><p>è§£å†³æ–¹æ¡ˆï¼šæŠŠ   <dependencyManagement>æ ‡ç­¾å»æ‰ä¹‹åï¼Œå¡«å†™ä¾èµ–ç‰ˆæœ¬ï¼Œä¸‹è½½å®Œæˆåï¼Œåœ¨é‡æ–°æ·»åŠ <dependencyManagement>æ ‡ç­¾</p><p>é—®é¢˜äºŒã€</p><p><fork>true</fork>çˆ†çº¢</p><p>è§£å†³æ–¹æ¡ˆï¼šç»™pluinæ·»åŠ ç‰ˆæœ¬å·  <version>2.3.7.RELEASE</version></p></blockquote><hr><h2 id="2ã€Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º"><a href="#2ã€Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º" class="headerlink" title="2ã€Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º"></a>2ã€Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º</h2><h3 id="2-1ã€åˆ›å»ºæ”¯ä»˜æ¨¡å—moudle-8001"><a href="#2-1ã€åˆ›å»ºæ”¯ä»˜æ¨¡å—moudle-8001" class="headerlink" title="2-1ã€åˆ›å»ºæ”¯ä»˜æ¨¡å—moudle 8001"></a>2-1ã€åˆ›å»ºæ”¯ä»˜æ¨¡å—moudle 8001</h3><p><img src="https://picbed.jnchan.top/springcloudImages/cloud-provider-payment8001.png" alt=""></p><p>çˆ¶pomå˜åŒ–</p><p><img src="https://picbed.jnchan.top/springcloudImages/QQæˆªå›¾20230713165722.png" alt=""></p><p>ç¬¬ä¸€æ­¥:ç¼–å†™pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å›¾å½¢åŒ–æ˜¾ç¤º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šç¼–å†™application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span> <span class="comment"># é¡¹ç›®å,ä¹Ÿæ˜¯æ³¨å†Œçš„åå­—</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span>  <span class="comment">#å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.gjt.mm.mysql.Driver</span>    <span class="comment">#mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="comment"># æ‰€æœ‰Entity åˆ«åç±»æ‰€åœ¨åŒ…</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.jcvv.springcloud.entities</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥:ç¼–å†™ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 17:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬å››æ­¥ï¼šä¸šåŠ¡å®ç°</p><p>1ã€å»ºç«‹SQLè¡¨(payment)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS springcloud2023</span><br><span class="line">CREATE DATABASE springcloud2023;</span><br><span class="line">USE springcloud2023;</span><br><span class="line">CREATE TABLE `payment`(</span><br><span class="line">    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ID&#x27;,</span><br><span class="line">    `serial` VARCHAR(200) DEFAULT &#x27;&#x27;,</span><br><span class="line">    PRIMARY KEY (`id`)</span><br><span class="line">)ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line">SELECT * FROM payment;</span><br></pre></td></tr></table></figure><p>2ã€åˆ›å»ºå®ä½“entities</p><p><a id='entites'>æŠ½å–entitieså®ä½“ç±»åˆ°è¯¥æ¨¡å—ä¸­</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CommonResult</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 18:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonResult</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonResult</span><span class="params">(Integer code,String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(code, message,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3ã€ç¼–å†™daoå±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.dao;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentDao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 18:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span><span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–å†™mybatisæ˜ å°„æ–‡ä»¶PaymentMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jcvv.springcloud.dao.PaymentDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;create&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Payment&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into payment(serial)</span><br><span class="line">        values (#&#123;serial&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.jcvv.springcloud.entities.Payment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">property</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPaymentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Long&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from payment</span><br><span class="line">        where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4ã€ç¼–å†™serviceå±‚</p><p>4.1ã€ç¼–å†™PaymentService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 19:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span><span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.2ã€ç¼–å†™PaymentServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.dao.PaymentDao;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 19:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentDao paymentDao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.create(payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5ã€ç¼–å†™controllerå±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/13 19:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">create</span><span class="params">(<span class="meta">@RequestBody</span> Payment payment)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.create(payment);</span><br><span class="line">        log.info(<span class="string">&quot;*******æ’å…¥ç»“æœ&quot;</span> + result);</span><br><span class="line">        <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æ’å…¥æ•°æ®æˆåŠŸ!&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æ’å…¥æ•°æ®å¤±è´¥&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> paymentService.getPaymentById(id);</span><br><span class="line">        log.info(<span class="string">&quot;*******æ’å…¥ç»“æœ&quot;</span> + payment);</span><br><span class="line">        <span class="keyword">if</span> (payment !=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŸ¥è¯¢æˆåŠŸ!&quot;</span>, payment);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, <span class="string">&quot;æŸ¥è¯¢å¤±è´¥ï¼Œæ²¡æœ‰å¯¹åº”è®°å½•&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>6ã€æ¥å£æµ‹è¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/æ¥å£æµ‹è¯•8001.png" alt=""></p><h3 id="2-2ã€çƒ­åŠ è½½"><a href="#2-2ã€çƒ­åŠ è½½" class="headerlink" title="2-2ã€çƒ­åŠ è½½"></a>2-2ã€çƒ­åŠ è½½</h3><h4 id="1ã€æ–¹å¼ä¸€ã€DevTools"><a href="#1ã€æ–¹å¼ä¸€ã€DevTools" class="headerlink" title="1ã€æ–¹å¼ä¸€ã€DevTools"></a>1ã€æ–¹å¼ä¸€ã€DevTools</h4><p>1ã€å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2ã€æ–¹å¼äºŒã€çƒ­åŠ è½½ä¹‹JRebel"><a href="#2ã€æ–¹å¼äºŒã€çƒ­åŠ è½½ä¹‹JRebel" class="headerlink" title="2ã€æ–¹å¼äºŒã€çƒ­åŠ è½½ä¹‹JRebel"></a>2ã€æ–¹å¼äºŒã€çƒ­åŠ è½½ä¹‹JRebel</h4><p><strong>å®‰è£…JRebel</strong></p><p>1ã€åœ¨IDEAä¸­ä¸€æ¬¡ç‚¹å‡» File-&gt;Settings-&gt;Plugins-&gt;Brows Repositories<br>2ã€åœ¨æœç´¢æ¡†ä¸­è¾“å…¥JRebelè¿›è¡Œæœç´¢<br>3ã€æ‰¾åˆ°JRebel for intellij<br>4ã€install<br>5ã€å®‰è£…å¥½ä¹‹åéœ€è¦restart IDEA</p><p><img src="https://picbed.jnchan.top/springcloudImages/1å®‰è£…JRebel.png" alt=""></p><p><strong>æ¿€æ´»</strong></p><p>JRebelå¹¶éå…è´¹çš„æ’ä»¶ï¼Œéœ€è¦æ¿€æ´»ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚<br>1ã€é¦–å…ˆåˆ°githubä¸Šå»ä¸‹è½½ä¸€ä¸ªåå‘ä»£ç†è½¯ä»¶ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯windows x64ç‰ˆæœ¬ã€‚</p><p><a href="https://github.com/ilanyu/ReverseProxy/releases/tag/v1.4">ä¸‹è½½åœ°å€</a></p><p><img src="https://picbed.jnchan.top/springcloudImages/2JRebelä»£ç†.png" alt=""></p><p>2ã€åŒå‡»è¿è¡Œæˆ‘ä»¬ä¸‹è½½çš„ç¨‹åº</p><p><img src="https://picbed.jnchan.top/springcloudImages/3åŒå‡»æ‰“å¼€JRebelä»£ç†.png" alt=""></p><p>3ã€æ¿€æ´»JRebelé…ç½®ä¿¡æ¯</p><p>ç¬¬ä¸€è¡Œè¾“å…¥ <a href="http://127.0.0.1:8888/d3545f42-7b88-4a77-a2da-5242c46d4bc2">http://127.0.0.1:8888/d3545f42-7b88-4a77-a2da-5242c46d4bc2</a><br>ç¬¬äºŒè¡Œè¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼ï¼Œä¾‹å¦‚ï¼š test@123.com<br>å‹¾é€‰åŒæ„åè®®ï¼Œå†ç‚¹å‡»Activate JRebel æŒ‰é’®éªŒè¯æ¿€æ´»<br>æç¤ºï¼šd3545f42-7b88-4a77-a2da-5242c46d4bc2ä¸ºUUID,å¯ä»¥è‡ªå·±ç”Ÿæˆï¼Œå¹¶ä¸”å¿…é¡»æ˜¯UUIDæ‰èƒ½é€šè¿‡éªŒè¯</p><p><img src="https://picbed.jnchan.top/springcloudImages/4æ¿€æ´»jrebelé…ç½®ä¿¡æ¯.png" alt=""></p><p>4ã€ä¹‹åè¿˜ä¼šå¼¹å‡ºæ¥é¡µé¢ï¼Œç›¸ä¿¡ä½ èƒ½åº”ä»˜ã€‚æœ€ååˆ«å¿˜äº†æŠŠJRebelè®¾ç½®ä¸ºofflineæ¨¡å¼ ç‚¹ä¸€ä¸‹work offline</p><p><img src="https://picbed.jnchan.top/springcloudImages/6ç‚¹å‡»work offline.png" alt=""></p><h4 id="3ã€è¿›è¡Œç³»ç»Ÿè®¾ç½®"><a href="#3ã€è¿›è¡Œç³»ç»Ÿè®¾ç½®" class="headerlink" title="3ã€è¿›è¡Œç³»ç»Ÿè®¾ç½®"></a>3ã€è¿›è¡Œç³»ç»Ÿè®¾ç½®</h4><p>1ã€settingsé…ç½®æ‰“å‹¾</p><p><img src="https://picbed.jnchan.top/springcloudImages/QQæˆªå›¾20230713202601.png" alt=""></p><p>2ã€æ‰“å¼€çˆ¶ç±»pomæ–‡ä»¶</p><p>æŒ‰ctrl+alt+shift+/ å¼¹å‡ºçª—å£ï¼Œç„¶åè¿›å…¥Registry ï¼Œå‹¾é€‰è‡ªåŠ¨ç¼–è¯‘ -&gt; compiler.automake.allow.when.app.running</p><p><img src="https://picbed.jnchan.top/springcloudImages/devtoolsçƒ­éƒ¨ç½².png" alt=""></p><p>3ã€é‡å¯IDEA</p><h3 id="2-3ã€åˆ›å»ºæ¶ˆè´¹è€…è®¢å•æ¨¡å—moudle"><a href="#2-3ã€åˆ›å»ºæ¶ˆè´¹è€…è®¢å•æ¨¡å—moudle" class="headerlink" title="2-3ã€åˆ›å»ºæ¶ˆè´¹è€…è®¢å•æ¨¡å—moudle"></a>2-3ã€åˆ›å»ºæ¶ˆè´¹è€…è®¢å•æ¨¡å—moudle</h3><h4 id="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¨¡å—"><a href="#ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¨¡å—" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¨¡å—"></a>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¨¡å—</h4><p>åˆ›å»ºæ¨¡å—cloud-consumer-order80</p><h4 id="ç¬¬äºŒæ­¥-ï¼šå¯¼å…¥ä¾èµ–"><a href="#ç¬¬äºŒæ­¥-ï¼šå¯¼å…¥ä¾èµ–" class="headerlink" title="ç¬¬äºŒæ­¥ ï¼šå¯¼å…¥ä¾èµ–"></a>ç¬¬äºŒæ­¥ ï¼šå¯¼å…¥ä¾èµ–</h4><p>å¯¼å…¥ä¾èµ–ï¼ˆæ­¤å¤„ä¿ºè¢«å‘äº†ï¼Œæ²¡æœ‰ç”¨åˆ°çš„mybatiså’Œæ•°æ®åº“ä¾èµ–ä¸åˆ°å¯¼å…¥ï¼Œä¸ç„¶è¿è¡Œä¼šå‡ºé”™ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-order80<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å›¾å½¢åŒ–æ˜¾ç¤º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  devtools--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;scope&gt;runtime&lt;/scope&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;optional&gt;true&lt;/optional&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸‰æ­¥ï¼šç¼–å†™application-yml"><a href="#ç¬¬ä¸‰æ­¥ï¼šç¼–å†™application-yml" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šç¼–å†™application.yml"></a>ç¬¬ä¸‰æ­¥ï¼šç¼–å†™application.yml</h4><p>ç¼–å†™application.ymlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h4 id="ç¬¬å››æ­¥ï¼šç¼–å†™ä¸»å¯åŠ¨ç±»"><a href="#ç¬¬å››æ­¥ï¼šç¼–å†™ä¸»å¯åŠ¨ç±»" class="headerlink" title="ç¬¬å››æ­¥ï¼šç¼–å†™ä¸»å¯åŠ¨ç±»"></a>ç¬¬å››æ­¥ï¼šç¼–å†™ä¸»å¯åŠ¨ç±»</h4><p>ç¼–å†™ä¸»å¯åŠ¨ç±»</p><p>com.jcvv.springcloud.OrderMain80</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ç¬¬äº”æ­¥ä¸šåŠ¡å®ç°"><a href="#ç¬¬äº”æ­¥ä¸šåŠ¡å®ç°" class="headerlink" title="ç¬¬äº”æ­¥ä¸šåŠ¡å®ç°"></a>ç¬¬äº”æ­¥ä¸šåŠ¡å®ç°</h4><p>ä¸šåŠ¡å®ç°</p><h5 id="1ã€ç¼–å†™å®ä½“ç±»"><a href="#1ã€ç¼–å†™å®ä½“ç±»" class="headerlink" title="1ã€ç¼–å†™å®ä½“ç±»"></a>1ã€ç¼–å†™å®ä½“ç±»</h5><p>Payment</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Payment</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Payment</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  Long id;</span><br><span class="line">    <span class="keyword">private</span> String serial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CommonResult</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> CommonResult</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonResult</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonResult</span><span class="params">(Integer code,String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(code, message,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2ã€controllerå±‚"><a href="#2ã€controllerå±‚" class="headerlink" title="2ã€controllerå±‚"></a>2ã€controllerå±‚</h5><h5 id="3ã€RestTemplateä»‹ç»"><a href="#3ã€RestTemplateä»‹ç»" class="headerlink" title="3ã€RestTemplateä»‹ç»"></a>3ã€<a href="https://so.csdn.net/so/search?q=RestTemplate&amp;spm=1001.2101.3001.7020">RestTemplate</a>ä»‹ç»</h5><p>RestTemplateæä¾›äº†å¤šç§ä¾¿æ·è®¿é—®è¿œç¨‹HttpæœåŠ¡çš„æ–¹æ³•ï¼Œ æ˜¯ä¸€ç§ç®€å•ä¾¿æ·çš„è®¿é—®restfulæœåŠ¡æ¨¡æ¿ç±»ï¼Œæ˜¯Springæä¾›çš„ç”¨äºè®¿é—®RestæœåŠ¡çš„å®¢æˆ·ç«¯æ¨¡æ¿å·¥å…·é›†ã€‚</p><p>å®˜æ–¹ç½‘å€ï¼š<a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p><p><strong>ä½¿ç”¨</strong></p><p>ä½¿ç”¨restTemplateè®¿é—®restfulæ¥å£éå¸¸çš„ç®€å•ç²—æš´æ— è„‘ã€‚(url, requestMap, ResponseBean.class)è¿™ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨ RESTè¯·æ±‚åœ°å€ã€è¯·æ±‚å‚æ•°ã€HTTPå“åº”è½¬æ¢è¢«è½¬æ¢æˆçš„å¯¹è±¡ç±»å‹ã€‚</p><p>configé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ApplicationContextConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="4ã€controllerç±»"><a href="#4ã€controllerç±»" class="headerlink" title="4ã€controllerç±»"></a>4ã€controllerç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.CommonResult;</span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.entities.Payment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/14 10:08</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8001&quot;</span>;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payment</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="comment">//payment å‚æ•°,CommonResult.classè¿”å›ç±»å‹</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-4ã€ä½¿ç”¨Run-Dashboard"><a href="#2-4ã€ä½¿ç”¨Run-Dashboard" class="headerlink" title="2-4ã€ä½¿ç”¨Run Dashboard"></a>2-4ã€ä½¿ç”¨Run Dashboard</h3><p>ç¬¬ä¸€æ­¥:</p><p><img src="https://picbed.jnchan.top/springcloudImages/7é…ç½®RunDashboard_1.png" alt=""></p><p>ç¬¬äºŒæ­¥:</p><p><img src="https://picbed.jnchan.top/springcloudImages/8é…ç½®rundashboard_2.png" alt=""></p><p>ç¬¬ä¸‰æ­¥:é€‰æ‹©springbootå³å¯</p><p>psï¼šå¦‚æœä¸Šè¿°åˆ—è¡¨æ‰¾ä¸åˆ°Run Dashboard,åˆ™å¯ä»¥åœ¨å·¥ç¨‹ç›®å½•ä¸‹æ‰¾åˆ°.ideaæ–‡ä»¶å¤¹ä¸‹çš„workspace.xmlï¼Œåœ¨å…¶ä¸­ç›¸åº”ä½ç½®åŠ å…¥ä»¥ä¸‹ä»£ç ï¼ˆæ›¿æ¢ï¼‰å³å¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;RunDashboard&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;configurationTypes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;SpringBootApplicationConfigurationType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;ruleStates&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ConfigurationTypeDashboardGroupingRule&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;StatusDashboardGroupingRule&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-5ã€å·¥ç¨‹é‡æ„"><a href="#2-5ã€å·¥ç¨‹é‡æ„" class="headerlink" title="2-5ã€å·¥ç¨‹é‡æ„"></a>2-5ã€å·¥ç¨‹é‡æ„</h3><p>1ã€åˆ›å»ºæ¨¡å—cloud-api-common</p><p>2ã€å¯¼å…¥pomæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  devtools--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;scope&gt;runtime&lt;/scope&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            &lt;optional&gt;true&lt;/optional&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    å·¥å…·åŒ…ï¼ŒåŠŸèƒ½æœ‰æ—¶é—´è½¬æ¢...--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3ã€<a href='#entites'>æŠ½å–entitieså®ä½“ç±»åˆ°è¯¥æ¨¡å—ä¸­</a></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%F0%9F%98%B6/" title="EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒğŸ˜¶">EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒğŸ˜¶</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡é™çº§â€”â€”Hystrixæ–­è·¯å™¨</title>
      <link href="/2023/06/12/%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E2%80%94%E2%80%94Hystrix%E6%96%AD%E8%B7%AF%E5%99%A8/"/>
      <url>/2023/06/12/%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E2%80%94%E2%80%94Hystrix%E6%96%AD%E8%B7%AF%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="æœåŠ¡é™çº§â€”â€”Hystrix-æ–­è·¯å™¨"><a href="#æœåŠ¡é™çº§â€”â€”Hystrix-æ–­è·¯å™¨" class="headerlink" title="æœåŠ¡é™çº§â€”â€”Hystrix æ–­è·¯å™¨"></a>æœåŠ¡é™çº§â€”â€”Hystrix æ–­è·¯å™¨</h1><h2 id="1ã€Hystrix-ç®€è¿°"><a href="#1ã€Hystrix-ç®€è¿°" class="headerlink" title="1ã€Hystrix ç®€è¿°"></a>1ã€Hystrix ç®€è¿°</h2><h3 id="1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"><a href="#1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜" class="headerlink" title="1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"></a>1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜</h3><p>å¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…åœ°å¤±è´¥</p><p><img src="https://picbed.jnchan.top/springcloudImages/13hystrix.png" alt=""></p><p><strong>æœåŠ¡é›ªå´©ï¼š</strong><br>å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡ A è°ƒç”¨å¾®æœåŠ¡ B å’Œå¾®æœåŠ¡ Cï¼Œå¾®æœåŠ¡ B å’Œå¾®æœåŠ¡ C åˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ï¼Œå¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡ A çš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€ã€‚</p><p>å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œï¼Œæ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ã€å¤‡ä»½é˜Ÿåˆ—ã€çº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœï¼Œè¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿï¼Œæ‰€ä»¥ï¼Œé€šå¸¸å½“ä½ å‘ç°ä¸€ä¸ªæ¨¡å—ä¸‹çš„æŸä¸ªå®ä¾‹å¤±è´¥åï¼Œè¿™æ—¶å€™è¿™ä¸ªæ¨¡å—ä¾ç„¶è¿˜ä¼šæ¥æ”¶æµé‡ï¼Œç„¶åè¿™ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—è¿˜è°ƒç”¨äº†å…¶ä»–çš„æ¨¡å—ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿçº§è”æ•…éšœï¼Œæˆ–è€…å«é›ªå´©ã€‚</p><h3 id="1-2ã€Hystrix-æ˜¯ä»€ä¹ˆ"><a href="#1-2ã€Hystrix-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1-2ã€Hystrix æ˜¯ä»€ä¹ˆ"></a>1-2ã€Hystrix æ˜¯ä»€ä¹ˆ</h3><p>Hystrix æ˜¯ä¸€ä¸ª<font color='red'>ç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“</font>ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰ï¼ŒHystrix èƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚</p><p>â€œæ–­è·¯å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰å“åº”ï¼ˆFallBackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ã€ä¸å¿…è¦åœ°å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´©ã€‚</p><h3 id="1-3ã€Hystrix-èƒ½å¹²å˜›"><a href="#1-3ã€Hystrix-èƒ½å¹²å˜›" class="headerlink" title="1-3ã€Hystrix èƒ½å¹²å˜›"></a>1-3ã€Hystrix èƒ½å¹²å˜›</h3><blockquote><p>æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€æ¥è¿‘å®æ—¶çš„ç›‘æ§Â·Â·Â·Â·Â·Â·</p></blockquote><p>å®˜ç½‘èµ„æ–™ï¼š<a href="https://github.com/Netflix/Hystrix/wiki/How-To-Use">https://github.com/Netflix/Hystrix/wiki/How-To-Use</a></p><p>Hystrix å®˜å®£ï¼Œåœæ›´è¿›ç»´ï¼š<a href="https://github.com/Netflix/Hystrix">https://github.com/Netflix/Hystrix</a></p><p>è¢«åŠ¨ä¿®å¤ bugsã€ä¸å†æ¥å—åˆå¹¶è¯·æ±‚ã€ä¸å†å‘å¸ƒæ–°ç‰ˆæœ¬</p><h2 id="2ã€Hystrix-é‡è¦æ¦‚å¿µ"><a href="#2ã€Hystrix-é‡è¦æ¦‚å¿µ" class="headerlink" title="2ã€Hystrix é‡è¦æ¦‚å¿µ"></a>2ã€Hystrix é‡è¦æ¦‚å¿µ</h2><h3 id="2-1ã€æœåŠ¡é™çº§"><a href="#2-1ã€æœåŠ¡é™çº§" class="headerlink" title="2-1ã€æœåŠ¡é™çº§"></a>2-1ã€æœåŠ¡é™çº§</h3><p>æœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•ï¼Œä¸è®©å®¢æˆ·ç«¯ç­‰å¾…å¹¶ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤ºï¼Œfallback</p><p>å“ªäº›æƒ…å†µä¼šå‡ºå‘é™çº§ï¼Ÿ</p><ul><li>ç¨‹åºè¿è¡Œå¼‚å¸¸</li><li>è¶…æ—¶</li><li>æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§</li><li>çº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§</li></ul><h3 id="2-2ã€æœåŠ¡ç†”æ–­"><a href="#2-2ã€æœåŠ¡ç†”æ–­" class="headerlink" title="2-2ã€æœåŠ¡ç†”æ–­"></a>2-2ã€æœåŠ¡ç†”æ–­</h3><p>ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®åï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œæ‹‰é—¸é™ç”µï¼Œç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º</p><p>å°±æ˜¯ä¿é™©ä¸ï¼šæœåŠ¡çš„é™çº§-&gt;è¿›è€Œç†”æ–­-&gt;æ¢å¤è°ƒç”¨é“¾è·¯</p><h3 id="2-3ã€æœåŠ¡é™æµ"><a href="#2-3ã€æœåŠ¡é™æµ" class="headerlink" title="2-3ã€æœåŠ¡é™æµ"></a>2-3ã€æœåŠ¡é™æµ</h3><p>ç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤ï¼Œå¤§å®¶æ’é˜Ÿï¼Œä¸€ç§’é’Ÿ N ä¸ªï¼Œæœ‰åºè¿›è¡Œ</p><h2 id="3ã€hystrix-æ¡ˆä¾‹"><a href="#3ã€hystrix-æ¡ˆä¾‹" class="headerlink" title="3ã€hystrix æ¡ˆä¾‹"></a>3ã€hystrix æ¡ˆä¾‹</h2><h3 id="3-1ã€æ„å»ºæ¨¡å—-payment8001"><a href="#3-1ã€æ„å»ºæ¨¡å—-payment8001" class="headerlink" title="3-1ã€æ„å»ºæ¨¡å— payment8001"></a>3-1ã€æ„å»ºæ¨¡å— payment8001</h3><p>æ–°å»º cloud-provider-hystrix-payment8001</p><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a><strong>pom.xml</strong></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-hystrix-payment8001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-payment</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">service-url:</span></span><br><span class="line">            <span class="comment">#defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="service-å±‚"><a href="#service-å±‚" class="headerlink" title="service å±‚"></a>service å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­£å¸¸è®¿é—®ï¼Œè‚¯å®šOK</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_OK,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;o(n_n)oå“ˆå“ˆ~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">timeNumber</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(timeNumber);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOut,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;o(n_n)oå“ˆå“ˆ~&quot;</span> + <span class="string">&quot;  è€—æ—¶(s):&quot;</span>+ timeNumber + <span class="string">&quot;ç§’é’Ÿ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚"><a href="#controller-å±‚" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_OK(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_TimeOut(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="â‘ -æ­£å¸¸æµ‹è¯•"><a href="#â‘ -æ­£å¸¸æµ‹è¯•" class="headerlink" title="â‘  æ­£å¸¸æµ‹è¯•"></a>â‘  æ­£å¸¸æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/14hystrixæ­£å¸¸æµ‹è¯•.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/14hystrixæ­£å¸¸æµ‹è¯•_timeout.png" alt=""></p><h4 id="â‘¡-é«˜å¹¶å‘æµ‹è¯•"><a href="#â‘¡-é«˜å¹¶å‘æµ‹è¯•" class="headerlink" title="â‘¡ é«˜å¹¶å‘æµ‹è¯•"></a>â‘¡ é«˜å¹¶å‘æµ‹è¯•</h4><p>ä½¿ç”¨ JMeter è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæ¨¡æ‹Ÿå¤šä¸ªè¯·æ±‚</p><p>ä¸‹è½½å‹ç¼©åŒ…ï¼Œè§£å‹ï¼ŒåŒå‡» /bin/ ä¸‹çš„ jmeter.bat å³å¯å¯åŠ¨</p><p>å¼€å¯ Jmeterï¼Œæ¥ 20000 ä¸ªå¹¶å‘å‹æ­» 8001ï¼Œ20000 ä¸ªè¯·æ±‚éƒ½å»è®¿é—® paymentInfo_TimeOut æ¥å£</p><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•1.png" alt=""></p><p>ramp up çš„å€¼æ˜¯å¯åŠ¨å…¨éƒ¨çº¿ç¨‹æ‰€éœ€çš„æ—¶é—´</p><p>200 ä¸ªçº¿ç¨‹æ•°ï¼Œå¾ªç¯ 100 æ¬¡ï¼Œ1 ç§’é’Ÿå¯åŠ¨å®Œæ¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•2.png" alt=""></p><p>æ·»åŠ  HTTP è¯·æ±‚</p><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•3.png" alt=""></p><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•4.png" alt=""></p><p>æµ‹è¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•5.png" alt=""></p><blockquote><p>ä»æµ‹è¯•å¯ä»¥çœ‹å‡ºï¼Œå½“æ¨¡æ‹Ÿçš„è¶…é•¿è¯·æ±‚è¢«é«˜å¹¶å‘ä»¥åï¼Œè®¿é—®æ™®é€šçš„å°è¯·æ±‚é€Ÿç‡ä¹Ÿä¼šè¢«æ‹‰ä½ã€‚</p></blockquote><p>ä¸¤ä¸ªéƒ½åœ¨è‡ªå·±è½¬åœˆåœˆï¼Œä¸ºä»€ä¹ˆä¼šè¢«å¡æ­»ï¼Ÿ</p><p>tomcat çš„é»˜è®¤çš„å·¥ä½œçº¿ç¨‹æ•°è¢«æ‰“æ»¡äº†ï¼Œæ²¡æœ‰å¤šä½™çš„çº¿ç¨‹æ¥åˆ†è§£å‹åŠ›å’Œå¤„ç†<br>ä¸Šé¢è¿˜æ˜¯æœåŠ¡æä¾›è€… 8001 è‡ªå·±æµ‹è¯•ï¼Œå‡å¦‚æ­¤æ—¶å¤–éƒ¨çš„æ¶ˆè´¹è€… 80 ä¹Ÿæ¥è®¿é—®ï¼Œé‚£æ¶ˆè´¹è€…åªèƒ½å¹²ç­‰ï¼Œæœ€ç»ˆå¯¼è‡´æ¶ˆè´¹ç«¯ 80 ä¸æ»¡æ„ï¼ŒæœåŠ¡ç«¯ 8001 ç›´æ¥è¢«æ‹–æ­»</p><p>çœ‹çƒ­é—¹ä¸å«Œå¼ƒäº‹å¤§ï¼Œ80 æ–°å»ºåŠ å…¥</p><h3 id="3-2ã€æ„å»º-hystrix-order80-å†å‹æµ‹"><a href="#3-2ã€æ„å»º-hystrix-order80-å†å‹æµ‹" class="headerlink" title="3-2ã€æ„å»º hystrix-order80 å†å‹æµ‹"></a>3-2ã€æ„å»º hystrix-order80 å†å‹æµ‹</h3><p>æ–°å»ºæ¨¡å— cloud-consumer-feign-hystrix-order80</p><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-feign-hystrix-order80<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- hystrix --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># é…ç½®æœåŠ¡ä¸­å¿ƒï¼ŒopenFeignå»é‡Œé¢æ‰¾æœåŠ¡</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»"><a href="#ä¸»å¯åŠ¨ç±»" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderFeignMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 19:31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="service-å±‚-1"><a href="#service-å±‚-1" class="headerlink" title="service å±‚"></a>service å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFeignService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 19:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PAYMENT-SERVICE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentHystrixService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚-1"><a href="#controller-å±‚-1" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentHystrixService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderHystirxController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 19:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystirxController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="â‘ -æ­£å¸¸æµ‹è¯•-1"><a href="#â‘ -æ­£å¸¸æµ‹è¯•-1" class="headerlink" title="â‘  æ­£å¸¸æµ‹è¯•"></a>â‘  æ­£å¸¸æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•6.png" alt=""></p><h4 id="â‘¡-é«˜å¹¶å‘æµ‹è¯•-1"><a href="#â‘¡-é«˜å¹¶å‘æµ‹è¯•-1" class="headerlink" title="â‘¡ é«˜å¹¶å‘æµ‹è¯•"></a><strong>â‘¡ é«˜å¹¶å‘æµ‹è¯•</strong></h4><p>2W ä¸ªçº¿ç¨‹å‹ 8001ï¼Œæ¶ˆè´¹ç«¯ 80 å¾®æœåŠ¡å†å»è®¿é—®æœåŠ¡ç«¯ 8001 åœ°å€</p><ul><li>è¦ä¹ˆè½¬åœˆåœˆç­‰å¾…</li><li>è¦ä¹ˆæ¶ˆè´¹ç«¯æŠ¥è¶…æ—¶é”™è¯¯</li></ul><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•7.png" alt=""></p><h3 id="3-3ã€æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› "><a href="#3-3ã€æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› " class="headerlink" title="3-3ã€æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› "></a>3-3ã€æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå› </h3><p>8001 åŒä¸€å±‚æ¬¡çš„å…¶å®ƒæ¥å£æœåŠ¡è¢«å›°æ­»ï¼Œå› ä¸º tomcat çº¿ç¨‹æ± é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯•<br>80 æ­¤æ—¶è°ƒç”¨ 8001ï¼Œå®¢æˆ·ç«¯è®¿é—®å“åº”ç¼“æ…¢ï¼Œè½¬åœˆåœˆ<br>ä¸Šè¿°ç»“è®ºï¼šæ­£å› ä¸ºæœ‰ä¸Šè¿°æ•…éšœæˆ–ä¸ä½³è¡¨ç°ï¼Œæ‰æœ‰æˆ‘ä»¬çš„é™çº§/å®¹é”™/é™æµç­‰æŠ€æœ¯è¯ç”Ÿ</p><h3 id="3-4ã€å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚"><a href="#3-4ã€å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚" class="headerlink" title="3-4ã€å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚"></a>3-4ã€å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚</h3><p>è¶…æ—¶å¯¼è‡´æœåŠ¡å™¨å˜æ…¢(è½¬åœˆ)ï¼šè¶…æ—¶ä¸å†ç­‰å¾…<br>å‡ºé”™(å®•æœºæˆ–ç¨‹åºè¿è¡Œå‡ºé”™)ï¼šå‡ºé”™è¦æœ‰å…œåº•<br>è§£å†³ï¼š</p><p>å¯¹æ–¹æœåŠ¡(8001)è¶…æ—¶äº†ï¼Œè°ƒç”¨è€…(80)ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§<br>å¯¹æ–¹æœåŠ¡(8001)å®•æœºäº†ï¼Œè°ƒç”¨è€…(80)ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§<br>å¯¹æ–¹æœåŠ¡(8001)OKï¼Œè°ƒç”¨è€…(80)è‡ªå·±å‡ºæ•…éšœæˆ–æœ‰è‡ªæˆ‘è¦æ±‚ï¼ˆè‡ªå·±çš„ç­‰å¾…æ—¶é—´å°äºæœåŠ¡æä¾›è€…ï¼‰è‡ªå·±å¤„ç†é™çº§</p><hr><h2 id="4ã€æœåŠ¡é™çº§"><a href="#4ã€æœåŠ¡é™çº§" class="headerlink" title="4ã€æœåŠ¡é™çº§"></a>4ã€æœåŠ¡é™çº§</h2><h3 id="4-1ã€æœåŠ¡ç«¯é™çº§"><a href="#4-1ã€æœåŠ¡ç«¯é™çº§" class="headerlink" title="4-1ã€æœåŠ¡ç«¯é™çº§"></a>4-1ã€æœåŠ¡ç«¯é™çº§</h3><p>é™çº§é…ç½®ï¼šåœ¨ <code>@HystrixCommand</code>é‡Œé¢æŒ‡å®šè¶…æ—¶/å‡ºé”™çš„å›è°ƒæ–¹æ³•ï¼Œä½œä¸ºå…œåº•æ–¹æ³•</p><p>é¦–å…ˆ å¯¹ 8001 çš„ service è¿›è¡Œé…ç½®ï¼ˆå¯¹å®¹æ˜“è¶…æ—¶çš„æ–¹æ³•è¿›è¡Œé…ç½®) :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­£å¸¸è®¿é—®ï¼Œè‚¯å®šOK</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_OK,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;o(n_n)oå“ˆå“ˆ~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é™çº§é…ç½®ï¼šåœ¨é‡Œé¢æŒ‡å®šè¶…æ—¶/å‡ºé”™çš„å›è°ƒæ–¹æ³•ï¼Œä½œä¸ºå…œåº•æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;, //è¶…æ—¶å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)//è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">            &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// int s =10 /0;</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">timeNumber</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(timeNumber);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOut,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;o(n_n)oå“ˆå“ˆ~&quot;</span> + <span class="string">&quot;  è€—æ—¶(s):&quot;</span> + timeNumber + <span class="string">&quot;ç§’é’Ÿ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOutHandler</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOutHandler,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;/(ã„’oã„’)/~~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šå›¾æ•…æ„åˆ¶é€ ä¸¤ä¸ªå¼‚å¸¸ï¼š</p><p>int s =10 /0; è®¡ç®—å¼‚å¸¸<br>æˆ‘ä»¬èƒ½æ¥å— 3 ç§’é’Ÿï¼Œå®ƒè¿è¡Œ 5 ç§’é’Ÿï¼Œè¶…æ—¶å¼‚å¸¸<br><strong>@HystrixCommand æŠ¥å¼‚å¸¸åå¦‚ä½•å¤„ç†ï¼Ÿ</strong></p><p>ä¸€æ—¦è°ƒç”¨æœåŠ¡æ–¹æ³•å¤±è´¥å¹¶æŠ›å‡ºäº†é”™è¯¯ä¿¡æ¯åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨@HystrixCommand æ ‡æ³¨å¥½çš„ fallbackMethod è°ƒç”¨ç±»ä¸­çš„æŒ‡å®šæ–¹æ³•</p><p>ä¸»å¯åŠ¨ç±»åŠ ä¸Š @EnableCircuitBreaker æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><p><img src="https://picbed.jnchan.top/springcloudImages/14é«˜å¹¶å‘æµ‹è¯•8.png" alt=""></p><h3 id="4-2ã€æ¶ˆè´¹ç«¯é™çº§"><a href="#4-2ã€æ¶ˆè´¹ç«¯é™çº§" class="headerlink" title="4-2ã€æ¶ˆè´¹ç«¯é™çº§"></a>4-2ã€æ¶ˆè´¹ç«¯é™çº§</h3><p>ä¸Šé¢çš„æ¡ˆä¾‹æ˜¯æœåŠ¡ç«¯é™çº§ï¼Œç°åœ¨æˆ‘ä»¬æœåŠ¡ç«¯å¤„ç† 3sï¼Œç„¶åè¿”å›ã€‚ä½†æ˜¯æ¶ˆè´¹ç«¯ç­‰ 1s å°±ç­‰ä¸ä½äº†ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ¶ˆè´¹ç«¯ä¹Ÿæœ‰é™çº§æ–¹æ³•ã€‚</p><p>80 çš„é™çº§ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œä¸Šé¢çš„ @HystrixCommand é™çº§å¯ä»¥æ”¾åœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨æ¶ˆè´¹ç«¯ã€‚ä½†ä¸€èˆ¬æ”¾åœ¨æ¶ˆè´¹ç«¯ã€‚</p><p>ä¸»å¯åŠ¨ç±»åŠ ä¸Š@EnableHystrix</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.EnableHystrix;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderFeignMain80</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 19:31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableHystrix</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">service-url:</span> <span class="comment"># é…ç½®æœåŠ¡ä¸­å¿ƒï¼ŒopenFeignå»é‡Œé¢æ‰¾æœåŠ¡</span></span><br><span class="line">            <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"><span class="comment"># ç”¨äºæœåŠ¡é™çº§ åœ¨æ³¨è§£@FeignClient ä¸­æ·»åŠ  fallback å±æ€§å€¼</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">    <span class="attr">hystrix:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹ 80 è¿›è¡ŒæœåŠ¡é™çº§ï¼šå¾ˆæ˜æ˜¾ service å±‚æ˜¯æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹æ¶ˆè´¹è€…ï¼Œåœ¨å®ƒçš„ controller å±‚è¿›è¡Œé™çº§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentHystrixService;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderHystirxController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 19:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystirxController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,</span></span><br><span class="line"><span class="meta">                            value = &quot;5000&quot;)&#125;)</span><span class="comment">//åªç­‰1.5s</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯• æˆ–è€… è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="ç„¶åå‡ºç°äº†é—®é¢˜ï¼Œæ¶ˆè´¹ç«¯å…œåº•å¤±è´¥â­"><a href="#ç„¶åå‡ºç°äº†é—®é¢˜ï¼Œæ¶ˆè´¹ç«¯å…œåº•å¤±è´¥â­" class="headerlink" title="ç„¶åå‡ºç°äº†é—®é¢˜ï¼Œæ¶ˆè´¹ç«¯å…œåº•å¤±è´¥â­"></a><font color='red'><strong>ç„¶åå‡ºç°äº†é—®é¢˜ï¼Œæ¶ˆè´¹ç«¯å…œåº•å¤±è´¥</strong></font>â­</h5><p>controller ä¸­è¶…æ—¶æ—¶é—´é…ç½®ä¸ç”Ÿæ•ˆåŸå› ï¼š<br>å…³é”®åœ¨äº feign:hystrix:enabled: true çš„ä½œç”¨ï¼Œå®˜ç½‘è§£é‡Šâ€œFeign å°†ä½¿ç”¨æ–­è·¯å™¨åŒ…è£…æ‰€æœ‰æ–¹æ³•â€ï¼Œä¹Ÿå°±æ˜¯å°†@FeignClient æ ‡è®°çš„é‚£ä¸ª service æ¥å£ä¸‹æ‰€æœ‰çš„æ–¹æ³•è¿›è¡Œäº† hystrix åŒ…è£…ï¼ˆç±»ä¼¼äºåœ¨è¿™äº›æ–¹æ³•ä¸ŠåŠ äº†ä¸€ä¸ª@HystrixCommandï¼‰ï¼Œè¿™äº›æ–¹æ³•ä¼šåº”ç”¨ä¸€ä¸ªé»˜è®¤çš„è¶…æ—¶æ—¶é—´ä¸º 1sï¼Œæ‰€ä»¥ä½ çš„ service æ–¹æ³•ä¹Ÿæœ‰ä¸€ä¸ª 1s çš„è¶…æ—¶æ—¶é—´ï¼Œservice1s å°±ä¼šæŠ¥å¼‚å¸¸ï¼Œcontroller ç«‹é©¬è¿›å…¥å¤‡ç”¨æ–¹æ³•ï¼Œcontroller ä¸Šé‚£ä¸ª 3 ç§’é‚£è¶…æ—¶æ—¶é—´å°±æ²¡æœ‰æ•ˆæœäº†ã€‚</p><p>ä¿®æ”¹å¦‚ä¸‹</p><blockquote><p>feign:<br>hystrix:<br>enabled: true # åœ¨ feign ä¸­å¼€å¯ hystrix<br>client:<br>config:<br>default:<br>connect-timeout: 5000<br>read-timeout: 5000</p><p>hystrix:<br>command:<br>default:<br>execution:<br>isolation:<br>thread:<br>timeoutInMilliseconds: 5000</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 80</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    service-url: # é…ç½®æœåŠ¡ä¸­å¿ƒï¼ŒopenFeignå»é‡Œé¢æ‰¾æœåŠ¡</span><br><span class="line">      defaultZone: http://eureka7001.com:7001/eureka/</span><br><span class="line"># ç”¨äºæœåŠ¡é™çº§ åœ¨æ³¨è§£@FeignClient ä¸­æ·»åŠ  fallback å±æ€§å€¼</span><br><span class="line">feign:</span><br><span class="line">  hystrix:</span><br><span class="line">    enabled: true # åœ¨feignä¸­å¼€å¯ hystrix</span><br><span class="line">  client:</span><br><span class="line">    config:</span><br><span class="line">      default:</span><br><span class="line">        connect-timeout: 5000</span><br><span class="line">        read-timeout: 5000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hystrix:</span><br><span class="line">  command:</span><br><span class="line">    default:</span><br><span class="line">      execution:</span><br><span class="line">        isolation:</span><br><span class="line">          thread:</span><br><span class="line">            timeoutInMilliseconds: 5000</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ps:é…ç½®æ–‡ä»¶è¿™é‡Œçš„ timeoutInMilliseconds å¹¶ä¸æ˜¯è¦†ç›–æ³¨è§£ä¸­çš„è®¾ç½®ï¼Œè€Œæ˜¯ä¸¤è€…å–è¾ƒä½å€¼ï¼Œ<br>åŒæ—¶ä¹Ÿä¼šç®—ä¸Š feignï¼š ReadTimeout çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸‰è€…å–æœ€ä½å€¼ã€‚</p><h4 id="EnableHystrix-å’Œ-EnableCircuitBreaker-åŒºåˆ«"><a href="#EnableHystrix-å’Œ-EnableCircuitBreaker-åŒºåˆ«" class="headerlink" title="@EnableHystrix å’Œ@EnableCircuitBreaker åŒºåˆ«"></a>@EnableHystrix å’Œ@EnableCircuitBreaker åŒºåˆ«</h4><p>åœ¨å­¦ä¹ æœåŠ¡é™çº§ä¸­ï¼Œå‘ç°äº†@EnableHystrix å’Œ@EnableCircuitBreaker çš„åŠŸèƒ½ç±»ä¼¼ï¼Œç ”ç©¶åç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><p>æŸ¥çœ‹@EnableHystrix çš„æºç å¯ä»¥å‘ç°ï¼Œå®ƒç»§æ‰¿äº†@EnableCircuitBreakerï¼Œå¹¶å¯¹å®ƒè¿›è¡Œäº†åœ¨å°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line">        <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">        <span class="meta">@Documented</span></span><br><span class="line">        <span class="meta">@Inherited</span></span><br><span class="line">        <span class="meta">@EnableCircuitBreaker</span></span><br><span class="line">        <span class="keyword">public</span> <span class="meta">@interface</span> EnableHystrix &#123;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ³¨è§£éƒ½æ˜¯æ¿€æ´» hystrix çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æ ¹æ®ä¸Šé¢ä»£ç å¾—å‡ºæ¥ç»“è®ºï¼Œ<font color='red'>åªéœ€è¦åœ¨æœåŠ¡å¯åŠ¨ç±»åŠ å…¥@EnableHystrix æ³¨è§£å³å¯ï¼Œæ— é¡»å¢åŠ @EnableCircuitBreaker æ³¨è§£</font>ï¼Œæœ¬èº«@EnableHystrix æ³¨è§£å·²ç»æ¶µç›–äº† EnableCircuitBreaker çš„åŠŸèƒ½ã€‚</p><h3 id="4-3ã€ç›®å‰é—®é¢˜"><a href="#4-3ã€ç›®å‰é—®é¢˜" class="headerlink" title="4-3ã€ç›®å‰é—®é¢˜"></a>4-3ã€ç›®å‰é—®é¢˜</h3><h4 id="æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€"><a href="#æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€" class="headerlink" title="æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€"></a>æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€</h4><p>åŒæ ·å’Œè‡ªå®šä¹‰åˆ†å¼€<br>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå…¨å±€çš„å…œåº•æ–¹æ³•ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯ä¸ªæ–¹æ³•éƒ½å¾—å†™å…œåº•æ–¹æ³•äº†ã€‚</p><p>å…¨å±€å…œåº• @DefaultProperties</p><p>åŠ äº†@DefaultProperties å±æ€§æ³¨è§£ï¼š</p><ul><li>åŠ äº†@HystrixCommand å±æ€§æ³¨è§£ï¼Œå¹¶ä¸”æ²¡æœ‰å†™å…·ä½“å›è°ƒæ–¹æ³•çš„ï¼Œå°±ç”¨ç»Ÿä¸€å…¨å±€çš„</li><li>åŠ äº†@HystrixCommand å±æ€§æ³¨è§£ï¼Œå†™äº†å…·ä½“å›è°ƒæ–¹æ³•çš„ï¼Œå°±ç”¨è‡ªå·±çš„</li></ul><p>OrderHystirxController å¤´æ³¨è§£æ·»åŠ </p><blockquote><p>@DefaultProperties(defaultFallback = â€œpayment_Global_FallbackMethodâ€)</p></blockquote><p>OrderHystirxController æ–¹æ³•æ·»åŠ </p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// ä¸‹é¢æ˜¯å…¨å±€fallbackæ–¹æ³•</span><br><span class="line">public String payment_Global_FallbackMethod() &#123;</span><br><span class="line"> return &quot;Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å“ªäº›éœ€è¦é»˜è®¤å‡ºé”™è°ƒç”¨éœ€è¦æ·»åŠ ï¼š@HystrixCommand</span><br><span class="line"> @GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span><br><span class="line"> @HystrixCommand</span><br><span class="line"> public String paymentInfo_OK(@PathVariable(&quot;id&quot;) Integer id) &#123;</span><br><span class="line">     int i = 1 / 0;</span><br><span class="line">     String result = paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">     return result;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentHystrixService;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.DefaultProperties;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> OrderHystirxController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 19:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@DefaultProperties(defaultFallback = &quot;payment_Global_FallbackMethod&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystirxController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,</span></span><br><span class="line"><span class="meta">                            value = &quot;5000&quot;)&#125;)</span><span class="comment">//åªç­‰1.5s</span></span><br><span class="line">    <span class="comment">//@HystrixCommand</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯• æˆ–è€… è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢æ˜¯å…¨å±€fallbackæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">payment_Global_FallbackMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡é€»è¾‘æ··ä¹±åœ¨ä¸€èµ·çš„é—®é¢˜ï¼ˆè§£è€¦ï¼‰"><a href="#ä¸šåŠ¡é€»è¾‘æ··ä¹±åœ¨ä¸€èµ·çš„é—®é¢˜ï¼ˆè§£è€¦ï¼‰" class="headerlink" title="ä¸šåŠ¡é€»è¾‘æ··ä¹±åœ¨ä¸€èµ·çš„é—®é¢˜ï¼ˆè§£è€¦ï¼‰"></a><strong>ä¸šåŠ¡é€»è¾‘æ··ä¹±åœ¨ä¸€èµ·çš„é—®é¢˜ï¼ˆè§£è€¦ï¼‰</strong></h4><p>æˆ‘ä»¬æ”¹åœ¨ service å±‚è¿›è¡ŒæœåŠ¡é™çº§</p><p>æ ¹æ® cloud-consumer-feign-hystrix-order80 å·²ç»æœ‰çš„ PaymentHystrixService æ¥å£ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ªç±» PaymentFallbackService å®ç°è¯¥æ¥å£ï¼Œç»Ÿä¸€ä¸ºæ¥å£é‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFallbackService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/20 14:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentHystrixService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----PaymentFallbackService fall back-paymentInfo_OK ,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----PaymentFallbackService fall back-paymentInfo_TimeOut ,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°† controller ä¸­æ·»åŠ çš„ @HystrixCommand å’Œ @DefaultProperties ä¸¤ä¸ªæ³¨è§£å»æ‰ï¼Œåœ¨@FelignClient æ·»åŠ å›è°ƒç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentFeignService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 19:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;, fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentHystrixService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><p><img src="https://picbed.jnchan.top/springcloudImages/14ç›®å‰é—®é¢˜.png" alt=""></p><h2 id="5ã€æœåŠ¡ç†”æ–­"><a href="#5ã€æœåŠ¡ç†”æ–­" class="headerlink" title="5ã€æœåŠ¡ç†”æ–­"></a>5ã€æœåŠ¡ç†”æ–­</h2><p>æ–­è·¯å™¨ï¼šä¸€å¥è¯å°±æ˜¯å®¶é‡Œçš„ä¿é™©ä¸</p><p>ä½œè€…æ–‡ç« ï¼š<a href="https://martinfowler.com/bliki/CircuitBreaker.html">https://martinfowler.com/bliki/CircuitBreaker.html</a></p><h3 id="5-1ã€ç†”æ–­æ˜¯ä»€ä¹ˆ"><a href="#5-1ã€ç†”æ–­æ˜¯ä»€ä¹ˆ" class="headerlink" title="5-1ã€ç†”æ–­æ˜¯ä»€ä¹ˆ"></a>5-1ã€ç†”æ–­æ˜¯ä»€ä¹ˆ</h3><p>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ï¼Œå½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ï¼Œå½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚</p><p>åœ¨ Spring Cloud æ¡†æ¶é‡Œï¼Œç†”æ–­æœºåˆ¶é€šè¿‡ Hystrix å®ç°ã€‚Hystrix ä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯ 5 ç§’å†… 20 æ¬¡è°ƒç”¨å¤±è´¥ï¼Œå°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚</p><p>ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯@HystrixCommand</p><h3 id="5-2ã€å®æ“"><a href="#5-2ã€å®æ“" class="headerlink" title="5-2ã€å®æ“"></a>5-2ã€å®æ“</h3><p>ä¿®æ”¹ cloud-provider-hystrix-payment8001</p><h4 id="PaymentService"><a href="#PaymentService" class="headerlink" title="PaymentService"></a>PaymentService</h4><p>åœ¨ PaymentService é‡Œæ·»åŠ ç†”æ–­æ–¹æ³•</p><blockquote><p>//=====æœåŠ¡ç†”æ–­<br>@HystrixCommand(fallbackMethod = â€œpaymentCircuitBreaker_fallbackâ€,commandProperties = {<br>@HystrixProperty(name = â€œcircuitBreaker.enabledâ€,value = â€œtrueâ€),// æ˜¯å¦å¼€å¯æ–­è·¯å™¨<br>@HystrixProperty(name = â€œcircuitBreaker.requestVolumeThresholdâ€,value = â€œ10â€),// è¯·æ±‚æ¬¡æ•°<br>@HystrixProperty(name = â€œcircuitBreaker.sleepWindowInMillisecondsâ€,value = â€œ10000â€), // æ—¶é—´çª—å£æœŸ<br>@HystrixProperty(name = â€œcircuitBreaker.errorThresholdPercentageâ€,value = â€œ60â€),// å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸<br>})<br>public String paymentCircuitBreaker(@PathVariable(â€œidâ€) Integer id)<br>{<br>if(id &lt; 0)<br>{<br>throw new RuntimeException(â€œ<strong>**</strong>id ä¸èƒ½è´Ÿæ•°â€);<br>}<br>String serialNumber = IdUtil.simpleUUID();</p><p>return Thread.currentThread().getName()+â€\tâ€+â€è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: â€œ + serialNumber;<br>}<br>public String paymentCircuitBreaker_fallback(@PathVariable(â€œidâ€) Integer id)<br>{<br>return â€œid ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’ o ã„’)/~~ id: â€œ +id;<br>}</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­£å¸¸è®¿é—®ï¼Œè‚¯å®šOK</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_OK,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;o(n_n)oå“ˆå“ˆ~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é™çº§é…ç½®ï¼šåœ¨é‡Œé¢æŒ‡å®šè¶…æ—¶/å‡ºé”™çš„å›è°ƒæ–¹æ³•ï¼Œä½œä¸ºå…œåº•æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;, //è¶…æ—¶å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="meta">            commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;5000&quot;)//è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">            &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// int s =10 /0;</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± &quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;  paymentInfo_TimeOut,id:  &quot;</span> + id + <span class="string">&quot;\t&quot;</span></span><br><span class="line">                + <span class="string">&quot;o(n_n)oå“ˆå“ˆ~&quot;</span> + <span class="string">&quot;  è€—æ—¶(s):&quot;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOutHandler</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± :  &quot;</span>+Thread.currentThread().getName()+</span><br><span class="line">                <span class="string">&quot;  8001ç³»ç»Ÿç¹å¿™æˆ–è€…è¿è¡ŒæŠ¥é”™ï¼Œè¯·ç¨åå†è¯•,id:  &quot;</span>+id+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//=====æœåŠ¡ç†”æ–­</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),// æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),// è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;), // æ—¶é—´çª—å£æœŸ</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;),// å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(id &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;******id ä¸èƒ½è´Ÿæ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serialNumber</span> <span class="operator">=</span> IdUtil.simpleUUID();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: &quot;</span> + serialNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker_fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~   id: &quot;</span> +id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="controller-å±‚-2"><a href="#controller-å±‚-2" class="headerlink" title="controller å±‚"></a>controller å±‚</h4><blockquote><p>//====æœåŠ¡ç†”æ–­<br>@GetMapping(â€œ/payment/circuit/{id}â€)<br>public String paymentCircuitBreaker(@PathVariable(â€œidâ€) Integer id) {<br>String result = paymentService.paymentCircuitBreaker(id);<br>log.info(â€œ****result: â€œ + result);<br>return result;<br>}</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jcvv.springcloud.service.PaymentService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_OK(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentInfo_TimeOut(id);</span><br><span class="line">        log.info(<span class="string">&quot;******result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//====æœåŠ¡ç†”æ–­</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/circuit/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentCircuitBreaker(id);</span><br><span class="line">        log.info(<span class="string">&quot;****result: &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¦‚ä½•æµ‹è¯•ï¼Œè¾“å…¥ä¸€ä¸ªåœ°å€ <a href="http://localhost:8001//payment/circuit/-1ï¼Œå¸¦è´Ÿæ•°ã€‚ç–¯ç‹‚è¯·æ±‚">http://localhost:8001//payment/circuit/-1ï¼Œå¸¦è´Ÿæ•°ã€‚ç–¯ç‹‚è¯·æ±‚</a> 6 æ¬¡ä»¥ä¸Šï¼Œ</p><p>ç„¶åå¿«é€ŸæŠŠåœ°å€æ”¹ä¸ºæ­£æ•°ï¼š<a href="http://localhost:8001//payment/circuit/1ã€‚æ­¤æ—¶ï¼Œå‘ç°è¯·æ±‚å¤±è´¥">http://localhost:8001//payment/circuit/1ã€‚æ­¤æ—¶ï¼Œå‘ç°è¯·æ±‚å¤±è´¥</a></p><p>è¯´æ˜ç†”æ–­å™¨å¼€å¯</p><p><img src="https://picbed.jnchan.top/springcloudImages/14æœåŠ¡ç†”æ–­.png" alt=""></p><p>å®éªŒæ•ˆæœä¸ºï¼Œå¤šæ¬¡å‡ºé”™è°ƒç”¨ fallback åï¼Œè°ƒç”¨æ­£å¸¸çš„ä¹Ÿå‡ºé”™è°ƒç”¨ fallbackã€‚è¿‡äº†ä¸€ä¼šåˆè‡ªå·±æ¢å¤äº†ã€‚</p><h3 id="5-3ã€ç†”æ–­ç±»å‹"><a href="#5-3ã€ç†”æ–­ç±»å‹" class="headerlink" title="5-3ã€ç†”æ–­ç±»å‹"></a>5-3ã€ç†”æ–­ç±»å‹</h3><ul><li><p>ç†”æ–­æ‰“å¼€ï¼šè¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡ï¼Œå†…éƒ¨è®¾ç½®æ—¶é’Ÿä¸€åŠä¸º MTTR(å¹³å‡æ•…éšœå¤„ç†æ—¶é—´),å½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›è¡ŒåŠç†”æ–­çŠ¶æ€</p></li><li><p>ç†”æ–­å…³é—­ï¼šç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­</p></li><li>ç†”æ–­åŠå¼€ï¼šéƒ¨åˆ†è¯·æ±‚æ ¹æ®è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸ï¼Œå…³é—­ç†”æ–­</li></ul><h4 id="5-4ã€æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹èµ·ä½œç”¨"><a href="#5-4ã€æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹èµ·ä½œç”¨" class="headerlink" title="5-4ã€æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹èµ·ä½œç”¨"></a>5-4ã€æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹èµ·ä½œç”¨</h4><p>æ¶‰åŠåˆ°æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°å¿«ç…§æ—¶é—´çª—ã€è¯·æ±‚æ€»æ•°é˜€å€¼ã€é”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼</p><ul><li>å¿«ç…§æ—¶é—´çª—ï¼šæ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®ï¼Œè€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—ï¼Œé»˜è®¤ä¸ºæœ€è¿‘çš„ 10 ç§’ã€‚</li><li>è¯·æ±‚æ€»æ•°é˜€å€¼ï¼šåœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜€å€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚é»˜è®¤ä¸º 20ï¼Œæ„å‘³ç€åœ¨ 10 ç§’å†…ï¼Œå¦‚æœè¯¥ hystrix å‘½ä»¤çš„è°ƒç”¨æ¬¡æ•°ä¸è¶³ 20 æ¬¡ï¼Œå³ä½¿æ‰€æœ‰çš„è¯·æ±‚éƒ½è¶…æ—¶æˆ–å…·ä»–åŸå› å¤±è´¥ï¼Œæ–­è·¯å™¨éƒ½ä¸ä¼šæ‰“å¼€ã€‚</li><li>é”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼ï¼šå½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜€å€¼ï¼Œå‡è®¾å‘ç”Ÿäº† 30 æ¬¡è°ƒç”¨ï¼Œåœ¨è¿™ 30 æ¬¡è°ƒç”¨ä¸­ï¼Œæœ‰ 15 æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡ 50ï¼…çš„é”™è¯¯ç™¾åˆ†æ¯”ï¼Œåœ¨é»˜è®¤è®¾å®š 50ï¼…é˜€å€¼æƒ…å†µï¼Œè¿™æ—¶å€™å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ã€‚</li></ul><h4 id="5-5ã€æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶"><a href="#5-5ã€æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶" class="headerlink" title="5-5ã€æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶"></a>5-5ã€æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶</h4><ul><li>å½“æ»¡è¶³ä¸€å®šçš„é˜€å€¼çš„æ—¶å€™ï¼ˆé»˜è®¤ 10 ç§’å†…è¶…è¿‡ 20 ä¸ªè¯·æ±‚æ¬¡æ•°ï¼‰</li><li>å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™ï¼ˆé»˜è®¤ 10 ç§’å†…è¶…è¿‡ 50%çš„è¯·æ±‚å¤±è´¥ï¼‰</li><li>åˆ°è¾¾ä»¥ä¸Šé˜€å€¼ï¼Œæ–­è·¯å™¨å°†ä¼šå¼€å¯</li><li>å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘</li><li>ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯ 5 ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ï¼›å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼›è‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚é‡å¤ 4 å’Œ 5</li></ul><h4 id="5-6ã€æ–­è·¯å™¨æ‰“å¼€ä¹‹å"><a href="#5-6ã€æ–­è·¯å™¨æ‰“å¼€ä¹‹å" class="headerlink" title="5-6ã€æ–­è·¯å™¨æ‰“å¼€ä¹‹å"></a>5-6ã€æ–­è·¯å™¨æ‰“å¼€ä¹‹å</h4><p>å†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§ fallbackï¼Œé€šè¿‡æ–­è·¯å™¨ï¼Œå®ç°äº†è‡ªåŠ¨åœ°å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘ï¼Œå‡å°‘å“åº”å»¶è¿Ÿçš„æ•ˆæœ</p><h4 id="5-7ã€åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤"><a href="#5-7ã€åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤" class="headerlink" title="5-7ã€åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤"></a>5-7ã€åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤</h4><p>å¯¹äºè¿™ä¸€é—®é¢˜ï¼Œhystrix ä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚</p><p>å½“æ–­è·¯å™¨æ‰“å¼€ï¼Œå¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹åï¼Œhystrix ä¼šå¯åŠ¨ä¸€ä¸ªä¼‘çœ æ—¶é—´çª—ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸï¼Œæ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†ç»§ç»­é—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼›å¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œæ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶ã€‚</p><h4 id="5-8ã€-HystrixCommand-æ‰€æœ‰é…ç½®"><a href="#5-8ã€-HystrixCommand-æ‰€æœ‰é…ç½®" class="headerlink" title="5-8ã€@HystrixCommand æ‰€æœ‰é…ç½®"></a>5-8ã€@HystrixCommand æ‰€æœ‰é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;str_fallbackMethod&quot;,</span></span><br><span class="line"><span class="meta">        groupKey = &quot;strGroupCommand&quot;,</span></span><br><span class="line"><span class="meta">        commandKey = &quot;strCommand&quot;,</span></span><br><span class="line"><span class="meta">        threadPoolKey = &quot;strThreadPool&quot;,</span></span><br><span class="line"><span class="meta">        commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                // è®¾ç½®éš”ç¦»ç­–ç•¥ï¼ŒTHREAD è¡¨ç¤ºçº¿ç¨‹æ±  SEMAPHOREï¼šä¿¡å·æ± éš”ç¦»</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.strategy&quot;, value = &quot;THREAD&quot;),</span></span><br><span class="line"><span class="meta">                // å½“éš”ç¦»ç­–ç•¥é€‰æ‹©ä¿¡å·æ± éš”ç¦»çš„æ—¶å€™ï¼Œç”¨æ¥è®¾ç½®ä¿¡å·æ± çš„å¤§å°ï¼ˆæœ€å¤§å¹¶å‘æ•°ï¼‰</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.semaphore.maxConcurrentRequests&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // é…ç½®å‘½ä»¤æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.timeoutinMilliseconds&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // æ˜¯å¦å¯ç”¨è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.timeout.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // æ‰§è¡Œè¶…æ—¶çš„æ—¶å€™æ˜¯å¦ä¸­æ–­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.interruptOnTimeout&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // æ‰§è¡Œè¢«å–æ¶ˆçš„æ—¶å€™æ˜¯å¦ä¸­æ–­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.interruptOnCancel&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // å…è®¸å›è°ƒæ–¹æ³•æ‰§è¡Œçš„æœ€å¤§å¹¶å‘æ•°</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;fallback.isolation.semaphore.maxConcurrentRequests&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // æœåŠ¡é™çº§æ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦æ‰§è¡Œå›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;fallback.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // æ˜¯å¦å¯ç”¨æ–­è·¯å™¨</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œæ–­è·¯å™¨ç†”æ–­çš„æœ€å°è¯·æ±‚æ•°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤è¯¥å€¼ä¸º 20 çš„æ—¶å€™ï¼Œ</span></span><br><span class="line"><span class="meta">                // å¦‚æœæ»šåŠ¨æ—¶é—´çª—ï¼ˆé»˜è®¤10ç§’ï¼‰å†…ä»…æ”¶åˆ°äº†19ä¸ªè¯·æ±‚ï¼Œ å³ä½¿è¿™19ä¸ªè¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šæ‰“å¼€ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;, value = &quot;20&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œè¡¨ç¤ºåœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œåœ¨è¯·æ±‚æ•°é‡è¶…è¿‡</span></span><br><span class="line"><span class="meta">                // circuitBreaker.requestVolumeThreshold çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé”™è¯¯è¯·æ±‚æ•°çš„ç™¾åˆ†æ¯”è¶…è¿‡50,</span></span><br><span class="line"><span class="meta">                // å°±æŠŠæ–­è·¯å™¨è®¾ç½®ä¸º &quot;æ‰“å¼€&quot; çŠ¶æ€ï¼Œå¦åˆ™å°±è®¾ç½®ä¸º &quot;å…³é—­&quot; çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;, value = &quot;50&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å½“æ–­è·¯å™¨æ‰“å¼€ä¹‹åçš„ä¼‘çœ æ—¶é—´çª—ã€‚ ä¼‘çœ æ—¶é—´çª—ç»“æŸä¹‹åï¼Œ</span></span><br><span class="line"><span class="meta">                // ä¼šå°†æ–­è·¯å™¨ç½®ä¸º &quot;åŠå¼€&quot; çŠ¶æ€ï¼Œå°è¯•ç†”æ–­çš„è¯·æ±‚å‘½ä»¤ï¼Œå¦‚æœä¾ç„¶å¤±è´¥å°±å°†æ–­è·¯å™¨ç»§ç»­è®¾ç½®ä¸º &quot;æ‰“å¼€&quot; çŠ¶æ€ï¼Œ</span></span><br><span class="line"><span class="meta">                // å¦‚æœæˆåŠŸå°±è®¾ç½®ä¸º &quot;å…³é—­&quot; çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.sleepWindowinMilliseconds&quot;, value = &quot;5000&quot;),</span></span><br><span class="line"><span class="meta">                // æ–­è·¯å™¨å¼ºåˆ¶æ‰“å¼€</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.forceOpen&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // æ–­è·¯å™¨å¼ºåˆ¶å…³é—­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;circuitBreaker.forceClosed&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // æ»šåŠ¨æ—¶é—´çª—è®¾ç½®ï¼Œè¯¥æ—¶é—´ç”¨äºæ–­è·¯å™¨åˆ¤æ–­å¥åº·åº¦æ—¶éœ€è¦æ”¶é›†ä¿¡æ¯çš„æŒç»­æ—¶é—´</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingStats.timeinMilliseconds&quot;, value = &quot;10000&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®æ»šåŠ¨æ—¶é—´çª—ç»Ÿè®¡æŒ‡æ ‡ä¿¡æ¯æ—¶åˆ’åˆ†&quot;æ¡¶&quot;çš„æ•°é‡ï¼Œæ–­è·¯å™¨åœ¨æ”¶é›†æŒ‡æ ‡ä¿¡æ¯çš„æ—¶å€™ä¼šæ ¹æ®</span></span><br><span class="line"><span class="meta">                // è®¾ç½®çš„æ—¶é—´çª—é•¿åº¦æ‹†åˆ†æˆå¤šä¸ª &quot;æ¡¶&quot; æ¥ç´¯è®¡å„åº¦é‡å€¼ï¼Œæ¯ä¸ª&quot;æ¡¶&quot;è®°å½•äº†ä¸€æ®µæ—¶é—´å†…çš„é‡‡é›†æŒ‡æ ‡ã€‚</span></span><br><span class="line"><span class="meta">                // æ¯”å¦‚ 10 ç§’å†…æ‹†åˆ†æˆ 10 ä¸ª&quot;æ¡¶&quot;æ”¶é›†è¿™æ ·ï¼Œæ‰€ä»¥ timeinMilliseconds å¿…é¡»èƒ½è¢« numBuckets æ•´é™¤ã€‚å¦åˆ™ä¼šæŠ›å¼‚å¸¸</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingStats.numBuckets&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å¯¹å‘½ä»¤æ‰§è¡Œçš„å»¶è¿Ÿæ˜¯å¦ä½¿ç”¨ç™¾åˆ†ä½æ•°æ¥è·Ÿè¸ªå’Œè®¡ç®—ã€‚å¦‚æœè®¾ç½®ä¸º false, é‚£ä¹ˆæ‰€æœ‰çš„æ¦‚è¦ç»Ÿè®¡éƒ½å°†è¿”å› -1ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.enabled&quot;, value = &quot;false&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡çš„æ»šåŠ¨çª—å£çš„æŒç»­æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.timeInMilliseconds&quot;, value = &quot;60000&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡æ»šåŠ¨çª—å£ä¸­ä½¿ç”¨ â€œ æ¡¶ â€çš„æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.numBuckets&quot;, value = &quot;60000&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸ª â€œæ¡¶â€ ä¸­ä¿ç•™çš„æœ€å¤§æ‰§è¡Œæ¬¡æ•°ã€‚å¦‚æœåœ¨æ»šåŠ¨æ—¶é—´çª—å†…å‘ç”Ÿè¶…è¿‡è¯¥è®¾å®šå€¼çš„æ‰§è¡Œæ¬¡æ•°ï¼Œ</span></span><br><span class="line"><span class="meta">                // å°±ä»æœ€åˆçš„ä½ç½®å¼€å§‹é‡å†™ã€‚ä¾‹å¦‚ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸º100, æ»šåŠ¨çª—å£ä¸º10ç§’ï¼Œè‹¥åœ¨10ç§’å†…ä¸€ä¸ª â€œæ¡¶ â€ä¸­å‘ç”Ÿäº†500æ¬¡æ‰§è¡Œï¼Œ</span></span><br><span class="line"><span class="meta">                // é‚£ä¹ˆè¯¥ â€œæ¡¶â€ ä¸­åªä¿ç•™ æœ€åçš„100æ¬¡æ‰§è¡Œçš„ç»Ÿè®¡ã€‚å¦å¤–ï¼Œå¢åŠ è¯¥å€¼çš„å¤§å°å°†ä¼šå¢åŠ å†…å­˜é‡çš„æ¶ˆè€—ï¼Œå¹¶å¢åŠ æ’åºç™¾åˆ†ä½æ•°æ‰€éœ€çš„è®¡ç®—æ—¶é—´ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.rollingPercentile.bucketSize&quot;, value = &quot;100&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å±æ€§ç”¨æ¥è®¾ç½®é‡‡é›†å½±å“æ–­è·¯å™¨çŠ¶æ€çš„å¥åº·å¿«ç…§ï¼ˆè¯·æ±‚çš„æˆåŠŸã€ é”™è¯¯ç™¾åˆ†æ¯”ï¼‰çš„é—´éš”ç­‰å¾…æ—¶é—´ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;metrics.healthSnapshot.intervalinMilliseconds&quot;, value = &quot;500&quot;),</span></span><br><span class="line"><span class="meta">                // æ˜¯å¦å¼€å¯è¯·æ±‚ç¼“å­˜</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;requestCache.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">                // HystrixCommandçš„æ‰§è¡Œå’Œäº‹ä»¶æ˜¯å¦æ‰“å°æ—¥å¿—åˆ° HystrixRequestLog ä¸­</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;requestLog.enabled&quot;, value = &quot;true&quot;),</span></span><br><span class="line"><span class="meta">        &#125;,</span></span><br><span class="line"><span class="meta">        threadPoolProperties = &#123;</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®æ‰§è¡Œå‘½ä»¤çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè¯¥å€¼ä¹Ÿå°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„æœ€å¤§å¹¶å‘é‡</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;coreSize&quot;, value = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®çº¿ç¨‹æ± çš„æœ€å¤§é˜Ÿåˆ—å¤§å°ã€‚å½“è®¾ç½®ä¸º -1 æ—¶ï¼Œçº¿ç¨‹æ± å°†ä½¿ç”¨ SynchronousQueue å®ç°çš„é˜Ÿåˆ—ï¼Œ</span></span><br><span class="line"><span class="meta">                // å¦åˆ™å°†ä½¿ç”¨ LinkedBlockingQueue å®ç°çš„é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;maxQueueSize&quot;, value = &quot;-1&quot;),</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ç”¨æ¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ‹’ç»é˜ˆå€¼ã€‚ é€šè¿‡è¯¥å‚æ•°ï¼Œ å³ä½¿é˜Ÿåˆ—æ²¡æœ‰è¾¾åˆ°æœ€å¤§å€¼ä¹Ÿèƒ½æ‹’ç»è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="meta">                // è¯¥å‚æ•°ä¸»è¦æ˜¯å¯¹ LinkedBlockingQueue é˜Ÿåˆ—çš„è¡¥å……,å› ä¸º LinkedBlockingQueue</span></span><br><span class="line"><span class="meta">                // é˜Ÿåˆ—ä¸èƒ½åŠ¨æ€ä¿®æ”¹å®ƒçš„å¯¹è±¡å¤§å°ï¼Œè€Œé€šè¿‡è¯¥å±æ€§å°±å¯ä»¥è°ƒæ•´æ‹’ç»è¯·æ±‚çš„é˜Ÿåˆ—å¤§å°äº†ã€‚</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;queueSizeRejectionThreshold&quot;, value = &quot;5&quot;),</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure><h2 id="6ã€æœåŠ¡é™æµ"><a href="#6ã€æœåŠ¡é™æµ" class="headerlink" title="6ã€æœåŠ¡é™æµ"></a>6ã€æœåŠ¡é™æµ</h2><p>åé¢é«˜çº§ç¯‡è®²è§£ alibaba çš„ Sentinel è¯´æ˜</p><h2 id="7ã€æœåŠ¡ç›‘æ§-hystrixDashboard"><a href="#7ã€æœåŠ¡ç›‘æ§-hystrixDashboard" class="headerlink" title="7ã€æœåŠ¡ç›‘æ§ hystrixDashboard"></a>7ã€æœåŠ¡ç›‘æ§ hystrixDashboard</h2><h3 id="7-1ã€æ¦‚è¿°"><a href="#7-1ã€æ¦‚è¿°" class="headerlink" title="7-1ã€æ¦‚è¿°"></a>7-1ã€æ¦‚è¿°</h3><p>é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–ï¼ŒHystrix è¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§ï¼ˆHystrix Dashboardï¼‰</p><p>Hystrix ä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡ Hystrix å‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚å¤šå°‘æˆåŠŸï¼Œå¤šå°‘å¤±è´¥ç­‰ã€‚Netflix é€šè¿‡ hystrix-metrics-event-stream é¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚Spring Cloud ä¹Ÿæä¾›äº† Hystrix Dashboard çš„æ•´åˆï¼Œå¯¹ç›‘æ§å†…å®¹è½¬åŒ–æˆå¯è§†åŒ–ç•Œé¢ã€‚</p><h3 id="7-2ã€ä»ªè¡¨ç›˜-9001"><a href="#7-2ã€ä»ªè¡¨ç›˜-9001" class="headerlink" title="7-2ã€ä»ªè¡¨ç›˜ 9001"></a>7-2ã€ä»ªè¡¨ç›˜ 9001</h3><p>æ–°å»º cloud-consumer-hystrix-dashboard9001</p><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springCloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcvv.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-consumer-hystrix-dashboard9001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9001</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨ç±»-1"><a href="#ä¸»å¯åŠ¨ç±»-1" class="headerlink" title="ä¸»å¯åŠ¨ç±»"></a>ä¸»å¯åŠ¨ç±»</h4><p>åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼š@EnableHystrixDashboard</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> HystrixDashboardMain9001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/20 15:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HystrixDashboardMain9001</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HystrixDashboardMain9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/15æœåŠ¡ç›‘æ§.png" alt=""></p><h3 id="7-3ã€ç›‘æ§å®æˆ˜"><a href="#7-3ã€ç›‘æ§å®æˆ˜" class="headerlink" title="7-3ã€ç›‘æ§å®æˆ˜"></a>7-3ã€ç›‘æ§å®æˆ˜</h3><p>æ‰€æœ‰ Provider å¾®æœåŠ¡æä¾›ç±»(8001/8002/8003)éƒ½éœ€è¦ç›‘æ§ä¾èµ–é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- actuatorç›‘æ§ä¿¡æ¯å®Œå–„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤–è¿˜è¦æœ‰ä¸»å¯åŠ¨ç±»ä¸ŠåŠ  <code>@EnableCircuitBreaker</code>ï¼Œç”¨äºå¯¹è±ªçŒªç†”æ–­æœºåˆ¶çš„æ”¯æŒ</p><p>8001 ä¸»å¯åŠ¨ç±»</p><p>æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æ— å…³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯åŠ¨ 1 ä¸ª eureka æˆ–è€… 3 ä¸ª eureka é›†ç¾¤å‡å¯</p><p>9001 ç›‘æ§ 8001ï¼Œå¡«å†™ç›‘æ§åœ°å€ï¼š<a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a></p><p>æ³¨æ„ï¼šSpringCloud ç‰ˆæœ¬è¿‡é«˜ä¼šå¯¼è‡´ä¸€ç›´ loadingï¼Œéœ€è¦é™ç‰ˆæœ¬ã€‚</p><h4 id="é”™è¯¯"><a href="#é”™è¯¯" class="headerlink" title="é”™è¯¯"></a><strong>é”™è¯¯</strong></h4><p><img src="https://picbed.jnchan.top/springcloudImages/15æœåŠ¡ç›‘æ§_é”™è¯¯.png" alt=""></p><h4 id="å¤„ç†æ–¹å¼"><a href="#å¤„ç†æ–¹å¼" class="headerlink" title="å¤„ç†æ–¹å¼"></a>å¤„ç†æ–¹å¼</h4><p>åœ¨ 8001 ä¸»å¯åŠ¨ç±»åŠ ä¸Šä¸€ä¸‹æ–¹æ³•</p><blockquote><p>/** &gt; <em>æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloud å‡çº§åçš„å‘</em>ServletRegistrationBean å› ä¸º springboot çš„é»˜è®¤è·¯å¾„ä¸æ˜¯â€/hystrix.streamâ€ï¼Œ<br><em>åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„ servlet å°±å¯ä»¥äº†</em>/<br>@Bean<br>public ServletRegistrationBean getServlet() {<br>HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();<br>ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);<br>registrationBean.setLoadOnStartup(1);<br>registrationBean.addUrlMappings(â€œ/hystrix.streamâ€);<br>registrationBean.setName(â€œHystrixMetricsStreamServletâ€);<br>return registrationBean;<br>}</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jcvv.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> PaymentHystrixMain8001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> chengzhi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2023/7/19 17:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by chengzhi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘</span></span><br><span class="line"><span class="comment">     *ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯&quot;/hystrix.stream&quot;ï¼Œ</span></span><br><span class="line"><span class="comment">     *åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">getServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HystrixMetricsStreamServlet</span> <span class="variable">streamServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HystrixMetricsStreamServlet</span>();</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(streamServlet);</span><br><span class="line">        registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        registrationBean.addUrlMappings(<span class="string">&quot;/hystrix.stream&quot;</span>);</span><br><span class="line">        registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å†æµ‹è¯•"><a href="#å†æµ‹è¯•" class="headerlink" title="å†æµ‹è¯•"></a>å†æµ‹è¯•</h4><p><img src="https://picbed.jnchan.top/springcloudImages/15æœåŠ¡ç›‘æ§_è¾“å…¥.png" alt=""></p><p>æ‰“å¼€æ–°ç½‘é¡µï¼Œè¾“å…¥ <a href="http://localhost:8001//payment/circuit/1ï¼Œå†åˆ‡å›">http://localhost:8001//payment/circuit/1ï¼Œå†åˆ‡å›</a> hystrix dashboardï¼Œæµ‹è¯•æˆåŠŸ</p><p><img src="https://picbed.jnchan.top/springcloudImages/15æœåŠ¡ç›‘æ§_æµ‹è¯•æˆåŠŸ.png" alt=""></p><p>ç›¸å…³é“¾æ¥ï¼š<a href="/2023/06/12/Gateway%E7%BD%91%E5%85%B3/" title="Gatewayç½‘å…³">Gatewayç½‘å…³</a></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mavenä¸­é‡åˆ°ä¾èµ–ä¸‹è½½å¤±è´¥é—®é¢˜</title>
      <link href="/2023/01/12/maven/"/>
      <url>/2023/01/12/maven/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯"><a href="#ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯" class="headerlink" title="ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯"></a>ä¾èµ–ä¸‹è½½å¤±è´¥é”™è¯¯</h3><p>maven ä¸­åŠ å…¥<code>&lt;dependencyManagement&gt;</code>æŠ¥é”™ä¸èƒ½ä¸‹è½½ä¾èµ–ï¼Œå»æ‰è¯¥æ ‡ç­¾åï¼Œå³å¯ä¸‹è½½ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¿‡æ¥çœ‹ç”µå½±å‘€</title>
      <link href="/2023/01/12/%E8%BF%87%E6%9D%A5%E7%9C%8B%E5%8A%A8%E6%BC%AB%E5%91%80/"/>
      <url>/2023/01/12/%E8%BF%87%E6%9D%A5%E7%9C%8B%E5%8A%A8%E6%BC%AB%E5%91%80/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è¾“å…¥å¯†ç åæŸ¥çœ‹è¯¥åšå®¢</title>
      <link href="/2016/03/30/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E5%90%8E%E6%9F%A5%E7%9C%8B/"/>
      <url>/2016/03/30/%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E5%90%8E%E6%9F%A5%E7%9C%8B/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="216952a6a1549f9490e116c2884d497ae1b4059217732ebd3c5d23d4421dbd14">8857952509ef9895f61625fe2d594ef357a1a3250a28d09057dd7eb025e6500a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> ä½œä¸ºæ—¥è®°åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
